typedef unsigned char   undefined;

typedef unsigned char    bool;
typedef unsigned char    byte;
typedef unsigned int    dword;
typedef unsigned long    qword;
typedef unsigned char    uchar;
typedef unsigned int    uint;
typedef unsigned long    ulong;
typedef unsigned long long    ulonglong;
typedef unsigned char    undefined1;
typedef unsigned short    undefined2;
typedef unsigned int    undefined4;
typedef unsigned long    undefined8;
typedef unsigned short    word;
typedef struct IOSurfaceEvent IOSurfaceEvent, *PIOSurfaceEvent;

struct IOSurfaceEvent { // PlaceHolder Class Structure
};

typedef uint __darwin_natural_t;

typedef __darwin_natural_t __darwin_mach_port_name_t;

typedef ulong __darwin_size_t;

typedef __darwin_mach_port_name_t __darwin_mach_port_t;

typedef ulonglong uint64_t;

typedef ulong uintptr_t;

typedef __darwin_size_t size_t;

typedef int kern_return_t;

typedef __darwin_natural_t natural_t;

typedef natural_t mach_msg_type_number_t;

typedef uint uint32_t;

typedef uint boolean_t;

typedef __darwin_mach_port_t mach_port_t;

typedef int vm_region_flavor_t;

typedef int *vm_region_info_t;

typedef struct OSMetaClass OSMetaClass, *POSMetaClass;

struct OSMetaClass { // PlaceHolder Structure
};

typedef struct OSMetaClassBase OSMetaClassBase, *POSMetaClassBase;

struct OSMetaClassBase { // PlaceHolder Structure
};

typedef struct IOExternalMethodArguments IOExternalMethodArguments, *PIOExternalMethodArguments;

struct IOExternalMethodArguments { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedEventReference IOSurfaceSharedEventReference, *PIOSurfaceSharedEventReference;

struct IOSurfaceSharedEventReference { // PlaceHolder Structure
};

typedef struct IOMultiMemoryDescriptor IOMultiMemoryDescriptor, *PIOMultiMemoryDescriptor;

struct IOMultiMemoryDescriptor { // PlaceHolder Structure
};

typedef struct OSSet OSSet, *POSSet;

struct OSSet { // PlaceHolder Structure
};

typedef struct IOSurfaceUnlockResult IOSurfaceUnlockResult, *PIOSurfaceUnlockResult;

struct IOSurfaceUnlockResult { // PlaceHolder Structure
};

typedef struct IOInterruptEventSource IOInterruptEventSource, *PIOInterruptEventSource;

struct IOInterruptEventSource { // PlaceHolder Structure
};

typedef struct IOSurfaceDescriptorComponent IOSurfaceDescriptorComponent, *PIOSurfaceDescriptorComponent;

struct IOSurfaceDescriptorComponent { // PlaceHolder Structure
};

typedef struct IOUserClient2022 IOUserClient2022, *PIOUserClient2022;

struct IOUserClient2022 { // PlaceHolder Structure
};

typedef struct IOUserClient IOUserClient, *PIOUserClient;

struct IOUserClient { // PlaceHolder Structure
};

typedef struct IORegistryPlane IORegistryPlane, *PIORegistryPlane;

struct IORegistryPlane { // PlaceHolder Structure
};

typedef struct OSArray OSArray, *POSArray;

struct OSArray { // PlaceHolder Structure
};

typedef struct IOSurfaceDeviceCache IOSurfaceDeviceCache, *PIOSurfaceDeviceCache;

struct IOSurfaceDeviceCache { // PlaceHolder Structure
};

typedef struct IOSurfaceValueResultArgs IOSurfaceValueResultArgs, *PIOSurfaceValueResultArgs;

struct IOSurfaceValueResultArgs { // PlaceHolder Structure
};

typedef struct OSObject OSObject, *POSObject;

struct OSObject { // PlaceHolder Structure
};

typedef struct OSCollection OSCollection, *POSCollection;

struct OSCollection { // PlaceHolder Structure
};

typedef struct IOSurfaceValueArgs IOSurfaceValueArgs, *PIOSurfaceValueArgs;

struct IOSurfaceValueArgs { // PlaceHolder Structure
};

typedef struct IOSurfaceLockData IOSurfaceLockData, *PIOSurfaceLockData;

struct IOSurfaceLockData { // PlaceHolder Structure
};

typedef struct _IOSurfaceSharedListEntry _IOSurfaceSharedListEntry, *P_IOSurfaceSharedListEntry;

struct _IOSurfaceSharedListEntry { // PlaceHolder Structure
};

typedef struct IOSurfaceGetLimitsResult IOSurfaceGetLimitsResult, *PIOSurfaceGetLimitsResult;

struct IOSurfaceGetLimitsResult { // PlaceHolder Structure
};

typedef struct IOSurfaceSendRight IOSurfaceSendRight, *PIOSurfaceSendRight;

struct IOSurfaceSendRight { // PlaceHolder Structure
};

typedef struct IOReportChannelList IOReportChannelList, *PIOReportChannelList;

struct IOReportChannelList { // PlaceHolder Structure
};

typedef struct IOSurfaceDescriptor IOSurfaceDescriptor, *PIOSurfaceDescriptor;

struct IOSurfaceDescriptor { // PlaceHolder Structure
};

typedef struct IOSurfaceLockResultPlaneInfo IOSurfaceLockResultPlaneInfo, *PIOSurfaceLockResultPlaneInfo;

struct IOSurfaceLockResultPlaneInfo { // PlaceHolder Structure
};

typedef struct IOPowerConnection IOPowerConnection, *PIOPowerConnection;

struct IOPowerConnection { // PlaceHolder Structure
};

typedef struct IOSurfaceRoot IOSurfaceRoot, *PIOSurfaceRoot;

struct IOSurfaceRoot { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedEventNotificationPort IOSurfaceSharedEventNotificationPort, *PIOSurfaceSharedEventNotificationPort;

struct IOSurfaceSharedEventNotificationPort { // PlaceHolder Structure
};

typedef struct IOMapper IOMapper, *PIOMapper;

struct IOMapper { // PlaceHolder Structure
};

typedef struct task task, *Ptask;

struct task { // PlaceHolder Structure
};

typedef struct zone zone, *Pzone;

struct zone { // PlaceHolder Structure
};

typedef struct semaphore semaphore, *Psemaphore;

struct semaphore { // PlaceHolder Structure
};

typedef struct IOSurfaceRootParavirtMapperInterface IOSurfaceRootParavirtMapperInterface, *PIOSurfaceRootParavirtMapperInterface;

struct IOSurfaceRootParavirtMapperInterface { // PlaceHolder Structure
};

typedef struct OSSymbol OSSymbol, *POSSymbol;

struct OSSymbol { // PlaceHolder Structure
};

typedef struct IOExternalMethodDispatch IOExternalMethodDispatch, *PIOExternalMethodDispatch;

struct IOExternalMethodDispatch { // PlaceHolder Structure
};

typedef struct IOSurfaceNotifyRequest IOSurfaceNotifyRequest, *PIOSurfaceNotifyRequest;

struct IOSurfaceNotifyRequest { // PlaceHolder Structure
};

typedef struct IOSurfaceDescriptorContext IOSurfaceDescriptorContext, *PIOSurfaceDescriptorContext;

struct IOSurfaceDescriptorContext { // PlaceHolder Structure
};

typedef struct IOService IOService, *PIOService;

struct IOService { // PlaceHolder Structure
};

typedef struct OSString OSString, *POSString;

struct OSString { // PlaceHolder Structure
};

typedef struct IOSurfaceClient IOSurfaceClient, *PIOSurfaceClient;

struct IOSurfaceClient { // PlaceHolder Structure
};

typedef struct OSSharedPtr OSSharedPtr, *POSSharedPtr;

struct OSSharedPtr { // PlaceHolder Structure
};

typedef struct IOSurfaceEventNotifierClient IOSurfaceEventNotifierClient, *PIOSurfaceEventNotifierClient;

struct IOSurfaceEventNotifierClient { // PlaceHolder Structure
};

typedef struct IOSurfaceMemoryTag IOSurfaceMemoryTag, *PIOSurfaceMemoryTag;

struct IOSurfaceMemoryTag { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedEventNotification IOSurfaceSharedEventNotification, *PIOSurfaceSharedEventNotification;

struct IOSurfaceSharedEventNotification { // PlaceHolder Structure
};

typedef struct IOSurfaceRootUserClient IOSurfaceRootUserClient, *PIOSurfaceRootUserClient;

struct IOSurfaceRootUserClient { // PlaceHolder Structure
};

typedef struct OSNumber OSNumber, *POSNumber;

struct OSNumber { // PlaceHolder Structure
};

typedef struct IORegistryEntry IORegistryEntry, *PIORegistryEntry;

struct IORegistryEntry { // PlaceHolder Structure
};

typedef struct IOSurfaceLockResult IOSurfaceLockResult, *PIOSurfaceLockResult;

struct IOSurfaceLockResult { // PlaceHolder Structure
};

typedef struct IOFence IOFence, *PIOFence;

struct IOFence { // PlaceHolder Structure
};

typedef struct IOSurfaceDeviceMemoryRegion IOSurfaceDeviceMemoryRegion, *PIOSurfaceDeviceMemoryRegion;

struct IOSurfaceDeviceMemoryRegion { // PlaceHolder Structure
};

typedef struct IOSurfaceShared IOSurfaceShared, *PIOSurfaceShared;

struct IOSurfaceShared { // PlaceHolder Structure
};

typedef struct IOSurface IOSurface, *PIOSurface;

struct IOSurface { // PlaceHolder Structure
};

typedef struct IOSurfaceColorAndSpatialKeysArgs IOSurfaceColorAndSpatialKeysArgs, *PIOSurfaceColorAndSpatialKeysArgs;

struct IOSurfaceColorAndSpatialKeysArgs { // PlaceHolder Structure
};

typedef struct IOSurfaceAdditionalPlaneInfo IOSurfaceAdditionalPlaneInfo, *PIOSurfaceAdditionalPlaneInfo;

struct IOSurfaceAdditionalPlaneInfo { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedRW IOSurfaceSharedRW, *PIOSurfaceSharedRW;

struct IOSurfaceSharedRW { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedEventListener IOSurfaceSharedEventListener, *PIOSurfaceSharedEventListener;

struct IOSurfaceSharedEventListener { // PlaceHolder Structure
};

typedef struct IOSurfaceUnlockData IOSurfaceUnlockData, *PIOSurfaceUnlockData;

struct IOSurfaceUnlockData { // PlaceHolder Structure
};

typedef struct IOFenceTransaction IOFenceTransaction, *PIOFenceTransaction;

struct IOFenceTransaction { // PlaceHolder Structure
};

typedef struct IOSurfaceSetTimestampArgs IOSurfaceSetTimestampArgs, *PIOSurfaceSetTimestampArgs;

struct IOSurfaceSetTimestampArgs { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedRO IOSurfaceSharedRO, *PIOSurfaceSharedRO;

struct IOSurfaceSharedRO { // PlaceHolder Structure
};

typedef struct IOSurfaceDeviceCacheList IOSurfaceDeviceCacheList, *PIOSurfaceDeviceCacheList;

struct IOSurfaceDeviceCacheList { // PlaceHolder Structure
};

typedef struct IOSurfaceWiredSendRight IOSurfaceWiredSendRight, *PIOSurfaceWiredSendRight;

struct IOSurfaceWiredSendRight { // PlaceHolder Structure
};

typedef struct IOExternalMethodDispatch2022 IOExternalMethodDispatch2022, *PIOExternalMethodDispatch2022;

struct IOExternalMethodDispatch2022 { // PlaceHolder Structure
};

typedef struct IOMemoryDescriptor IOMemoryDescriptor, *PIOMemoryDescriptor;

struct IOMemoryDescriptor { // PlaceHolder Structure
};

typedef struct IOSurfaceSharedEvent IOSurfaceSharedEvent, *PIOSurfaceSharedEvent;

struct IOSurfaceSharedEvent { // PlaceHolder Structure
};

typedef struct IOSurfaceMemoryPool IOSurfaceMemoryPool, *PIOSurfaceMemoryPool;

struct IOSurfaceMemoryPool { // PlaceHolder Structure
};

typedef struct _IOSurfaceClientSharedListEntry _IOSurfaceClientSharedListEntry, *P_IOSurfaceClientSharedListEntry;

struct _IOSurfaceClientSharedListEntry { // PlaceHolder Structure
};

typedef struct IOSurfaceNotifyArgs IOSurfaceNotifyArgs, *PIOSurfaceNotifyArgs;

struct IOSurfaceNotifyArgs { // PlaceHolder Structure
};

typedef struct IOPMPowerState IOPMPowerState, *PIOPMPowerState;

struct IOPMPowerState { // PlaceHolder Structure
};

typedef struct IOFenceTraceData IOFenceTraceData, *PIOFenceTraceData;

struct IOFenceTraceData { // PlaceHolder Structure
};

typedef struct IOSurfaceMemoryRegion IOSurfaceMemoryRegion, *PIOSurfaceMemoryRegion;

struct IOSurfaceMemoryRegion { // PlaceHolder Structure
};

typedef struct ipc_port ipc_port, *Pipc_port;

struct ipc_port { // PlaceHolder Structure
};

typedef struct _IOSurfaceFastCreateArgs _IOSurfaceFastCreateArgs, *P_IOSurfaceFastCreateArgs;

struct _IOSurfaceFastCreateArgs { // PlaceHolder Structure
};

typedef struct IOSurfaceColorAndSpatialKeysStruct IOSurfaceColorAndSpatialKeysStruct, *PIOSurfaceColorAndSpatialKeysStruct;

struct IOSurfaceColorAndSpatialKeysStruct { // PlaceHolder Structure
};

typedef undefined zone_create_flags_t;

typedef struct IOSurfaceMemoryPoolBunch IOSurfaceMemoryPoolBunch, *PIOSurfaceMemoryPoolBunch;

struct IOSurfaceMemoryPoolBunch { // PlaceHolder Structure
};

typedef struct IOExternalMethodArgumentsOpaque IOExternalMethodArgumentsOpaque, *PIOExternalMethodArgumentsOpaque;

struct IOExternalMethodArgumentsOpaque { // PlaceHolder Structure
};

typedef struct OSSerialize OSSerialize, *POSSerialize;

struct OSSerialize { // PlaceHolder Structure
};

typedef struct OSDictionary OSDictionary, *POSDictionary;

struct OSDictionary { // PlaceHolder Structure
};

typedef undefined thread_call_priority_t;

typedef undefined IORPC;

typedef struct MetaClass MetaClass, *PMetaClass;

struct MetaClass { // PlaceHolder Structure
};

typedef undefined retain_t;

typedef struct CS_CodeDirectory CS_CodeDirectory, *PCS_CodeDirectory;

struct CS_CodeDirectory {
    dword magic; // magic number (CSMAGIC_CODEDIRECTORY)
    dword length; // total length of CodeDirectory blob
    dword version; // compatibility version
    dword flags; // setup and mode flags
    dword hashOffset; // offset of hash slot element at index zero
    dword identOffset; // offset of identifier string
    dword nSpecialSlots; // number of special hash slots
    dword nCodeSlots; // number of ordinary (code) hash slots
    dword codeLimit; // limit to main image signature range
    byte hashSize; // size of each hash in bytes
    byte hashType; // type of hash (cdHashType* constants)
    byte platform; // platform identifier; zero if not platform binary
    byte pageSize; // log2(page size in bytes); 0 => infinite
    dword spare2; // unused (must be zero)
    dword scatterOffset; // offset of optional scatter vector
};

typedef struct uuid_command uuid_command, *Puuid_command;

struct uuid_command {
    dword cmd;
    dword cmdsize;
    byte uuid[16];
};

typedef struct CS_BlobIndex CS_BlobIndex, *PCS_BlobIndex;

struct CS_BlobIndex {
    dword type; // type of entry
    dword offset; // offset of entry
};

typedef struct section section, *Psection;

struct section {
    char sectname[16];
    char segname[16];
    qword addr;
    qword size;
    dword offset;
    dword align;
    dword reloff;
    dword nrelocs;
    dword flags;
    dword reserved1;
    dword reserved2;
    dword reserved3;
};

typedef struct nlist nlist, *Pnlist;

struct nlist {
    dword n_strx;
    byte n_type;
    byte n_sect;
    word n_desc;
    qword n_value;
};

typedef struct dysymtab_command dysymtab_command, *Pdysymtab_command;

struct dysymtab_command {
    dword cmd;
    dword cmdsize;
    dword ilocalsym;
    dword nlocalsym;
    dword iextdefsym;
    dword nextdefsym;
    dword iundefsym;
    dword nundefsym;
    dword tocoff;
    dword ntoc;
    dword modtaboff;
    dword nmodtab;
    dword extrefsymoff;
    dword nextrefsyms;
    dword indirectsymoff;
    dword nindirectsyms;
    dword extreloff;
    dword nextrel;
    dword locreloff;
    dword nlocrel;
};

typedef struct CS_SuperBlob CS_SuperBlob, *PCS_SuperBlob;

struct CS_SuperBlob {
    dword magic; // magic number
    dword length; // total length of SuperBlob
    dword count; // number of index entries following
    struct CS_BlobIndex index[3]; // (count) entries
};

typedef struct segment_command segment_command, *Psegment_command;

struct segment_command {
    dword cmd;
    dword cmdsize;
    char segname[16];
    qword vmaddr;
    qword vmsize;
    qword fileoff;
    qword filesize;
    dword maxprot;
    dword initprot;
    dword nsects;
    dword flags;
};

typedef struct symtab_command symtab_command, *Psymtab_command;

struct symtab_command {
    dword cmd;
    dword cmdsize;
    dword symoff;
    dword nsyms;
    dword stroff;
    dword strsize;
};

typedef struct source_version_command source_version_command, *Psource_version_command;

struct source_version_command {
    dword cmd;
    dword cmdsize;
    qword version;
};

typedef struct mach_header mach_header, *Pmach_header;

struct mach_header {
    dword magic;
    dword cputype;
    dword cpusubtype;
    dword filetype;
    dword ncmds;
    dword sizeofcmds;
    dword flags;
    dword reserved;
};

typedef struct linkedit_data_command linkedit_data_command, *Plinkedit_data_command;

struct linkedit_data_command {
    dword cmd;
    dword cmdsize;
    dword dataoff;
    dword datasize;
};

typedef struct CS_GenericBlob CS_GenericBlob, *PCS_GenericBlob;

struct CS_GenericBlob {
    dword magic; // magic number
    dword length; // total length of blob
};

typedef uint64_t mach_vm_address_t;

typedef uintptr_t vm_offset_t;

typedef vm_offset_t vm_address_t;

typedef uint64_t mach_vm_size_t;

typedef mach_port_t vm_map_t;

typedef uintptr_t vm_size_t;



undefined *PTR_gMetaClass_00027048;
pointer PTR_~MetaClass_00027310;
pointer PTR_~IOSurfaceSharedEventListener_000271e0;
pointer IOSurfaceSharedEventListener_ktv;
undefined8 gMetaClass;
undefined *PTR_vtable_00027078;
undefined *PTR____stack_chk_guard_00027088;
pointer PTR_~MetaClass_00027538;
pointer PTR_~IOSurfaceSharedEventNotificationPort_00027408;
pointer IOSurfaceSharedEventNotificationPort_ktv;
pointer PTR_~MetaClass_00027760;
pointer PTR_~IOSurfaceSharedEventReference_00027630;
pointer IOSurfaceSharedEventReference_ktv;
pointer PTR_~MetaClass_00027990;
pointer PTR_~IOSurfaceSharedEvent_00027858;
pointer IOSurfaceSharedEvent_ktv;
undefined DAT_aaaaaaaaaaaaaaaa;
pointer PTR_~MetaClass_00027bb8;
pointer PTR_~IOSurfaceSharedEventNotification_00027a88;
pointer IOSurfaceSharedEventNotification_ktv;
pointer PTR_~MetaClass_00027de8;
pointer PTR_~IOFenceTransaction_00027cb0;
pointer IOFenceTransaction_ktv;
undefined1 kalloc_type_view_72;
undefined1 kalloc_type_view_137;
undefined1 kalloc_type_view_144;
undefined8 _gIOSurfaceRoot;
undefined *PTR___NSConcreteStackBlock_00027000;
undefined1 sDeadlockDetectionLimitReached;
undefined *PTR___os_log_default_00027090;
undefined8 IOSurface_zone;
pointer PTR_~MetaClass_000283a8;
pointer PTR_~IOSurface_00028270;
undefined *PTR_metaClass_00027008;
section section_000003d0;
undefined *PTR_metaClass_00027068;
undefined *PTR__kOSBooleanTrue_000270a8;
undefined *PTR__page_size_000270c0;
undefined *PTR__kOSBooleanFalse_000270a0;
undefined *PTR_metaClass_00027010;
undefined *PTR_metaClass_00027058;
undefined1 kalloc_type_view_992;
pointer kalloc_type_view_2420;
pointer kalloc_type_view_450;
undefined1 kalloc_type_view_553;
pointer kalloc_type_view_533;
undefined *PTR_metaClass_00027038;
undefined *PTR_metaClass_00027040;
undefined *PTR_metaClass_00027030;
undefined1 kalloc_type_view_2928;
undefined1 kalloc_type_view_2950;
undefined1 kalloc_type_view_3228;
undefined1 kalloc_type_view_3406;
undefined1 kalloc_type_view_3448;
undefined1 kalloc_type_view_3497;
undefined *PTR__kdebug_enable_000270b0;
undefined1 isDevFused;
pointer kalloc_type_view_5372;
pointer PTR_~MetaClass_00028628;
pointer PTR_~IOSurfaceClient_000284f0;
pointer IOSurfaceClient_ktv;
undefined1 kalloc_type_view_58;
undefined1 kalloc_type_view_106;
pointer PTR_~MetaClass_00028858;
pointer PTR_~IOSurfaceMemoryTag_00028720;
pointer IOSurfaceMemoryTag_ktv;
pointer PTR_~MetaClass_00028ac0;
pointer PTR_~IOSurfaceDeviceCache_00028950;
pointer IOSurfaceDeviceCache_ktv;
undefined *PTR_metaClass_00027018;
pointer PTR_~MetaClass_00028ce8;
pointer PTR_~IOSurfaceDescriptor_00028bb8;
pointer IOSurfaceDescriptor_ktv;
pointer kalloc_type_view_34;
pointer kalloc_type_view_57;
pointer PTR_~MetaClass_00028f70;
pointer gMetaClass;
pointer PTR_~IOSurfaceDeviceMemoryRegion_00028de0;
pointer IOSurfaceDeviceMemoryRegion_ktv;
pointer PTR_~MetaClass_000291f0;
pointer PTR_~IOSurfaceMemoryRegion_00029068;
pointer IOSurfaceMemoryRegion_ktv;
pointer PTR_~MetaClass_00029428;
pointer PTR_~IOSurfaceRootParavirtMapperInterface_000292e8;
pointer IOSurfaceRootParavirtMapperInterface_ktv;
undefined *PTR_gMetaClass_00027060;
pointer PTR_~MetaClass_00029d88;
pointer PTR_~IOSurfaceRoot_00029520;
pointer IOSurfaceRoot_ktv;
undefined *PTR_vtable_00027080;
undefined8 sNextGlobalTraceID;
undefined1 kalloc_type_view_110;
pointer _sysctl__debug_iosurface;
pointer _sysctl__debug_iosurface_iofence_ddd;
undefined1 kalloc_type_view_178;
undefined fenceDispatch;
undefined *PTR__gIODTPlane_00027098;
undefined signal_event_clients_thread;
undefined async_release_thread;
undefined installMemoryRegions;
undefined1 kalloc_type_view_1530;
undefined1 kalloc_type_view_1549;
undefined1 kalloc_type_view_1736;
undefined1 kalloc_type_view_1568;
pointer kalloc_type_view_2006;
pointer kalloc_type_view_2017;
pointer kalloc_type_view_2028;
pointer kalloc_type_view_1293;
pointer kalloc_type_view_1339;
pointer kalloc_type_view_1387;
undefined1 kalloc_type_view_1698;
undefined1 kalloc_type_view_1717;
pointer kalloc_type_view_1871;
pointer kalloc_type_view_1886;
pointer kalloc_type_view_1895;
undefined waitForFence_gated;
undefined8 __ZL32gIODARTFunctionSetCacheAttribute.0;
undefined4 _gIOSurfaceDeadlockDetectionDepth;
pointer kalloc_type_view_2629;
pointer kalloc_type_view_2659;
undefined1 kalloc_type_view_2683;
undefined1 kalloc_type_view_2693;
undefined *PTR_gMetaClass_00027020;
pointer PTR_~MetaClass_0002a8a8;
pointer PTR_~IOSurfaceRootUserClient_00029f00;
pointer IOSurfaceRootUserClient_ktv;
undefined *PTR_vtable_00027070;
undefined1 kalloc_type_view_2462;
undefined4 DAT_00026fdc;
undefined ___Block_byref_object_copy_.46;
undefined ___Block_byref_object_dispose_.47;
segment_command segment_command_00000020;
pointer sMethodDescs;
pointer sMethodDescsRestricted;
pointer sTrapDescs;
pointer sTrapDescsRestricted;
undefined ___Block_byref_object_copy_;
undefined ___Block_byref_object_dispose_;
undefined1 kalloc_type_view_2433;
undefined1 kalloc_type_view_2452;
pointer PTR_~MetaClass_0002bec8;
pointer PTR_~IOFence_0002bd90;
pointer IOFence_ktv;
pointer PTR_~MetaClass_0002c0f0;
pointer PTR_~IOSurfaceShared_0002bfc0;
pointer IOSurfaceShared_ktv;
pointer kalloc_type_view_55;
pointer kalloc_type_view_64;
pointer kalloc_type_view_73;
pointer kalloc_type_view_117;
pointer kalloc_type_view_129;
pointer PTR_~MetaClass_0002c318;
pointer PTR_~IOSurfaceDescriptorContext_0002c1e8;
pointer IOSurfaceDescriptorContext_ktv;
pointer PTR_~MetaClass_0002c540;
pointer PTR_~IOSurfaceDescriptorComponent_0002c410;
pointer IOSurfaceDescriptorComponent_ktv;
pointer PTR_~MetaClass_0002c768;
pointer PTR_~IOSurfaceMemoryPoolBunch_0002c638;
pointer IOSurfaceMemoryPoolBunch_ktv;
undefined *PTR_metaClass_00027028;
undefined *PTR_metaClass_00027050;
undefined1 kalloc_type_view_676;
undefined1 kalloc_type_view_692;
pointer PTR_~MetaClass_0002c998;
pointer PTR_~IOSurfaceMemoryPool_0002c860;
pointer IOSurfaceMemoryPool_ktv;
undefined *PTR__kernel_task_000270b8;
pointer PTR_~MetaClass_0002cbd0;
pointer PTR_~IOSurfaceSendRight_0002ca90;
pointer IOSurfaceSendRight_ktv;
pointer PTR_~MetaClass_0002ce08;
pointer PTR_~IOSurfaceWiredSendRight_0002ccc8;
pointer IOSurfaceWiredSendRight_ktv;
undefined8 __realmain;
undefined8 __antimain;

// IOSurfaceSharedEventListener::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventListener::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventListener",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  *(undefined ***)this = &PTR__MetaClass_00027310;
  return;
}



// IOSurfaceSharedEventListener::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventListener::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventListener::IOSurfaceSharedEventListener(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventListener::IOSurfaceSharedEventListener
          (IOSurfaceSharedEventListener *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventListener_000271e0;
  return;
}



// IOSurfaceSharedEventListener::IOSurfaceSharedEventListener(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventListener::IOSurfaceSharedEventListener
          (IOSurfaceSharedEventListener *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventListener_000271e0;
  return;
}



// IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener()

void __thiscall
IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener(IOSurfaceSharedEventListener *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener()

void __thiscall
IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener(IOSurfaceSharedEventListener *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener()

void __thiscall
IOSurfaceSharedEventListener::~IOSurfaceSharedEventListener(IOSurfaceSharedEventListener *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventListener_ktv,this,0x38);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventListener::operator delete(void*, unsigned long)

void __cdecl IOSurfaceSharedEventListener::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventListener_ktv,param_1,param_2);
  return;
}



// IOSurfaceSharedEventListener::getMetaClass() const

undefined8 * IOSurfaceSharedEventListener::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSharedEventListener::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventListener::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventListener",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  *(undefined ***)this = &PTR__MetaClass_00027310;
  return;
}



// IOSurfaceSharedEventListener::MetaClass::alloc() const

OSObject * IOSurfaceSharedEventListener::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSharedEventListener_ktv,0x38);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventListener_000271e0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSharedEventListener::operator new(unsigned long)

void * __thiscall IOSurfaceSharedEventListener::operator_new(IOSurfaceSharedEventListener *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSharedEventListener_ktv,this);
  return pvVar1;
}



// IOSurfaceSharedEventListener::IOSurfaceSharedEventListener()

void __thiscall
IOSurfaceSharedEventListener::IOSurfaceSharedEventListener(IOSurfaceSharedEventListener *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventListener_000271e0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventListener::IOSurfaceSharedEventListener()

void __thiscall
IOSurfaceSharedEventListener::IOSurfaceSharedEventListener(IOSurfaceSharedEventListener *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventListener_000271e0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventListener::listener(thread_call_priority_t)

IOSurfaceSharedEventListener * __cdecl IOSurfaceSharedEventListener::listener(undefined4 param_1)

{
  bool bVar1;
  IOSurfaceSharedEventListener *this;
  
  this = (IOSurfaceSharedEventListener *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEventListener *)0x0) {
    bVar1 = init(this,param_1);
    if (bVar1) {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEventListener *)0x0;
}



// IOSurfaceSharedEventListener::init(thread_call_priority_t)

bool __thiscall
IOSurfaceSharedEventListener::init(IOSurfaceSharedEventListener *this,undefined4 param_1)

{
  char cVar1;
  long lVar2;
  
  cVar1 = (**(code **)(PTR_vtable_00027078 + 0x98))();
  if (cVar1 != '\0') {
    lVar2 = _IOLockAlloc();
    *(long *)(this + 0x10) = lVar2;
    if (lVar2 != 0) {
      *(undefined8 *)(this + 0x18) = 0;
      *(IOSurfaceSharedEventListener **)(this + 0x20) = this + 0x18;
      lVar2 = _thread_call_allocate_with_priority(0xce6,this,param_1);
      *(long *)(this + 0x28) = lVar2;
      return lVar2 != 0;
    }
  }
  return false;
}



// IOSurfaceSharedEventListener::event_notification_thread()

void __thiscall
IOSurfaceSharedEventListener::event_notification_thread(IOSurfaceSharedEventListener *this)

{
  IOSurfaceSharedEventNotification *pIVar1;
  long *plVar2;
  IOSurfaceSharedEventNotification *pIVar3;
  long *plVar4;
  char *pcVar5;
  IOSurfaceSharedEventNotification *local_40;
  long *local_38;
  
  _IOLockLock(*(undefined8 *)(this + 0x10));
  pIVar3 = *(IOSurfaceSharedEventNotification **)(this + 0x18);
  if (pIVar3 != (IOSurfaceSharedEventNotification *)0x0) {
    do {
      *(IOSurfaceSharedEventNotification ***)(pIVar3 + 0x30) = &local_40;
      local_38 = *(long **)(this + 0x20);
      *(undefined8 *)(this + 0x18) = 0;
      *(IOSurfaceSharedEventListener **)(this + 0x20) = this + 0x18;
      local_40 = pIVar3;
      _IOLockUnlock(*(undefined8 *)(this + 0x10));
      pIVar3 = local_40;
      while (pIVar3 != (IOSurfaceSharedEventNotification *)0x0) {
        pIVar1 = *(IOSurfaceSharedEventNotification **)(pIVar3 + 0x28);
        if (pIVar1 == (IOSurfaceSharedEventNotification *)0x0) {
          plVar4 = *(long **)(pIVar3 + 0x30);
          plVar2 = plVar4;
          if ((IOSurfaceSharedEventNotification *)*plVar4 != pIVar3) {
LAB_00000dd4:
            pcVar5 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00000de4:
                    // WARNING: Subroutine does not return
            _panic(pcVar5,pIVar3,0x8c,"IOSurfaceEvent.cpp",0x8c);
          }
        }
        else {
          if (*(IOSurfaceSharedEventNotification **)(pIVar1 + 0x30) != pIVar3 + 0x28) {
            pcVar5 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
            goto LAB_00000de4;
          }
          if ((IOSurfaceSharedEventNotification *)**(long **)(pIVar3 + 0x30) != pIVar3)
          goto LAB_00000dd4;
          *(long **)(pIVar1 + 0x30) = *(long **)(pIVar3 + 0x30);
          plVar4 = *(long **)(pIVar3 + 0x30);
          plVar2 = local_38;
        }
        local_38 = plVar2;
        *plVar4 = (long)pIVar1;
        IOSurfaceSharedEventNotification::sendNotification(pIVar3);
        (**(code **)(*(long *)pIVar3 + 0x28))(pIVar3);
        pIVar3 = pIVar1;
      }
      _IOLockLock(*(undefined8 *)(this + 0x10));
      pIVar3 = *(IOSurfaceSharedEventNotification **)(this + 0x18);
    } while (pIVar3 != (IOSurfaceSharedEventNotification *)0x0);
  }
  this[0x30] = (IOSurfaceSharedEventListener)0x0;
  _IOLockUnlock(*(undefined8 *)(this + 0x10));
  (**(code **)(*(long *)this + 0x28))(this);
  return;
}



// IOSurfaceSharedEventListener::free()

void __thiscall IOSurfaceSharedEventListener::free(IOSurfaceSharedEventListener *this)

{
  if (*(long *)(this + 0x18) == 0) {
    if (*(long *)(this + 0x28) != 0) {
      _thread_call_free();
      *(undefined8 *)(this + 0x28) = 0;
    }
    if (*(long *)(this + 0x10) != 0) {
      _IOLockFree();
      *(undefined8 *)(this + 0x10) = 0;
    }
                    // WARNING: Could not recover jumptable at 0x00000e4c. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
    return;
  }
  free();
  return;
}



// IOSurfaceSharedEventListener::schedule_event_notification(IOSurfaceSharedEventNotification*)

void __thiscall
IOSurfaceSharedEventListener::schedule_event_notification
          (IOSurfaceSharedEventListener *this,long *param_1)

{
  undefined8 *puVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x10));
  param_1[5] = 0;
  puVar1 = *(undefined8 **)(this + 0x20);
  param_1[6] = (long)puVar1;
  *puVar1 = param_1;
  *(long **)(this + 0x20) = param_1 + 5;
  (**(code **)(*param_1 + 0x20))(param_1);
  if (this[0x30] == (IOSurfaceSharedEventListener)0x0) {
    this[0x30] = (IOSurfaceSharedEventListener)0x1;
    (**(code **)(*(long *)this + 0x20))(this);
    _thread_call_enter(*(undefined8 *)(this + 0x28));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x10));
  return;
}



// IOSurfaceSharedEventNotification::sendNotification()

void __thiscall
IOSurfaceSharedEventNotification::sendNotification(IOSurfaceSharedEventNotification *this)

{
  long lVar1;
  undefined8 uVar2;
  undefined8 uVar3;
  undefined8 uVar4;
  code *UNRECOVERED_JUMPTABLE;
  ulonglong local_38;
  undefined8 local_30;
  ulong local_28;
  ulong local_20;
  long local_10;
  
  local_10 = *(long *)PTR____stack_chk_guard_00027088;
  if (*(long *)(this + 0x48) == 0) {
    lVar1 = *(long *)(this + 0x60);
    if (lVar1 == 0) {
      UNRECOVERED_JUMPTABLE = *(code **)(this + 0x58);
      if (UNRECOVERED_JUMPTABLE == (code *)0x0) goto LAB_00000f17;
      lVar1 = *(long *)(this + 0x50);
      uVar4 = *(undefined8 *)(this + 0x38);
      uVar3 = *(undefined8 *)(this + 0x10);
      uVar2 = *(undefined8 *)(this + 0x20);
    }
    else {
      uVar4 = *(undefined8 *)(this + 0x38);
      uVar3 = *(undefined8 *)(this + 0x10);
      uVar2 = *(undefined8 *)(this + 0x20);
      UNRECOVERED_JUMPTABLE = *(code **)(lVar1 + 0x10);
    }
    if (*(long *)PTR____stack_chk_guard_00027088 == local_10) {
                    // WARNING: Could not recover jumptable at 0x00000f79. Too many branches
                    // WARNING: Treating indirect jump as call
      (*UNRECOVERED_JUMPTABLE)(lVar1,uVar4,uVar3,uVar2,UNRECOVERED_JUMPTABLE);
      return;
    }
  }
  else {
    local_28 = *(ulong *)(this + 0x10);
    local_30 = *(undefined8 *)(this + 0x18);
    local_38 = *(ulonglong *)(this + 0x20);
    local_20 = local_28 >> 0x20;
    IOUserClient::sendAsyncResult64((ulonglong *)(*(long *)(this + 0x48) + 0x38),0,&local_38,4);
LAB_00000f17:
    if (*(long *)PTR____stack_chk_guard_00027088 == local_10) {
      return;
    }
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceSharedEventNotificationPort::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventNotificationPort::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventNotificationPort",
             (OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass,0x78);
  *(undefined ***)this = &PTR__MetaClass_00027538;
  return;
}



// IOSurfaceSharedEventNotificationPort::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventNotificationPort::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotificationPort_00027408;
  return;
}



// IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotificationPort_00027408;
  return;
}



// IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort()

void __thiscall
IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort()

void __thiscall
IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort()

void __thiscall
IOSurfaceSharedEventNotificationPort::~IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventNotificationPort_ktv,this,0x78);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotificationPort::operator delete(void*, unsigned long)

void __cdecl
IOSurfaceSharedEventNotificationPort::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventNotificationPort_ktv,param_1,param_2);
  return;
}



// IOSurfaceSharedEventNotificationPort::getMetaClass() const

undefined8 * IOSurfaceSharedEventNotificationPort::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSharedEventNotificationPort::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventNotificationPort::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventNotificationPort",
             (OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass,0x78);
  *(undefined ***)this = &PTR__MetaClass_00027538;
  return;
}



// IOSurfaceSharedEventNotificationPort::MetaClass::alloc() const

OSObject * IOSurfaceSharedEventNotificationPort::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSharedEventNotificationPort_ktv,0x78);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSharedEventNotificationPort::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotificationPort_00027408;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSharedEventNotificationPort::operator new(unsigned long)

void * __thiscall
IOSurfaceSharedEventNotificationPort::operator_new(IOSurfaceSharedEventNotificationPort *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSharedEventNotificationPort_ktv,this);
  return pvVar1;
}



// IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort()

void __thiscall
IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotificationPort_00027408;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort()

void __thiscall
IOSurfaceSharedEventNotificationPort::IOSurfaceSharedEventNotificationPort
          (IOSurfaceSharedEventNotificationPort *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotificationPort_00027408;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventNotificationPort::__OSFinalClass()

void IOSurfaceSharedEventNotificationPort::__OSFinalClass(void)

{
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotificationPort::withAsyncReference64(unsigned long long*)

IOSurfaceSharedEventNotificationPort * __cdecl
IOSurfaceSharedEventNotificationPort::withAsyncReference64(undefined8 *param_1)

{
  IOSurfaceSharedEventNotificationPort *this;
  undefined8 uVar1;
  
  this = (IOSurfaceSharedEventNotificationPort *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEventNotificationPort *)0x0) {
    uVar1 = initWithAsyncReference64(this,param_1);
    if ((char)uVar1 != '\0') {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEventNotificationPort *)0x0;
}



// IOSurfaceSharedEventNotificationPort::initWithAsyncReference64(unsigned long long*)

undefined8 __thiscall
IOSurfaceSharedEventNotificationPort::initWithAsyncReference64
          (IOSurfaceSharedEventNotificationPort *this,undefined8 *param_1)

{
  ipc_port *piVar1;
  bool bVar2;
  undefined7 extraout_var;
  undefined7 extraout_var_00;
  undefined7 uVar4;
  undefined8 uVar3;
  
  bVar2 = IOSurfaceSharedEventListener::init((IOSurfaceSharedEventListener *)this,1);
  if (bVar2) {
    piVar1 = (ipc_port *)*param_1;
    uVar4 = extraout_var;
    if (piVar1 != (ipc_port *)0x0) {
      IOUserClient::setAsyncReference64((ulonglong *)(this + 0x38),piVar1,param_1[1],param_1[2]);
      uVar4 = extraout_var_00;
    }
    uVar3 = CONCAT71(uVar4,piVar1 != (ipc_port *)0x0);
  }
  else {
    uVar3 = 0;
  }
  return uVar3;
}



// IOSurfaceSharedEventNotificationPort::free()

void __thiscall
IOSurfaceSharedEventNotificationPort::free(IOSurfaceSharedEventNotificationPort *this)

{
  if (*(long *)(this + 0x38) != 0) {
    IOUserClient::releaseAsyncReference64((ulonglong *)(this + 0x38));
  }
  IOSurfaceSharedEventListener::free((IOSurfaceSharedEventListener *)this);
  return;
}



// IOSurfaceSharedEventNotificationPort::sendNotification(unsigned long long, unsigned long long,
// unsigned long long)

void __thiscall
IOSurfaceSharedEventNotificationPort::sendNotification
          (IOSurfaceSharedEventNotificationPort *this,ulong param_1,undefined8 param_2,
          ulonglong param_3)

{
  ulonglong local_38;
  undefined8 local_30;
  ulong local_28;
  ulong local_20;
  long local_10;
  
  local_10 = *(long *)PTR____stack_chk_guard_00027088;
  local_20 = param_1 >> 0x20;
  local_38 = param_3;
  local_30 = param_2;
  local_28 = param_1;
  IOUserClient::sendAsyncResult64((ulonglong *)(this + 0x38),0,&local_38,4);
  if (*(long *)PTR____stack_chk_guard_00027088 == local_10) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceSharedEventReference::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventReference::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventReference",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_00027760;
  return;
}



// IOSurfaceSharedEventReference::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventReference::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventReference::IOSurfaceSharedEventReference(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventReference::IOSurfaceSharedEventReference
          (IOSurfaceSharedEventReference *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  *(undefined8 *)(this + 0x10) = 0;
  return;
}



// IOSurfaceSharedEventReference::IOSurfaceSharedEventReference(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventReference::IOSurfaceSharedEventReference
          (IOSurfaceSharedEventReference *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  *(undefined8 *)(this + 0x10) = 0;
  return;
}



// IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference()

void __thiscall
IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference(IOSurfaceSharedEventReference *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference()

void __thiscall
IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference(IOSurfaceSharedEventReference *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference()

void __thiscall
IOSurfaceSharedEventReference::~IOSurfaceSharedEventReference(IOSurfaceSharedEventReference *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventReference_ktv,this,0x18);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventReference::operator delete(void*, unsigned long)

void __cdecl IOSurfaceSharedEventReference::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventReference_ktv,param_1,param_2);
  return;
}



// IOSurfaceSharedEventReference::getMetaClass() const

undefined8 * IOSurfaceSharedEventReference::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSharedEventReference::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventReference::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventReference",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_00027760;
  return;
}



// IOSurfaceSharedEventReference::MetaClass::alloc() const

OSObject * IOSurfaceSharedEventReference::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSharedEventReference_ktv,0x18);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSharedEventReference::operator new(unsigned long)

void * __thiscall IOSurfaceSharedEventReference::operator_new(IOSurfaceSharedEventReference *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSharedEventReference_ktv,this);
  return pvVar1;
}



// IOSurfaceSharedEventReference::IOSurfaceSharedEventReference()

void __thiscall
IOSurfaceSharedEventReference::IOSurfaceSharedEventReference(IOSurfaceSharedEventReference *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventReference::IOSurfaceSharedEventReference()

void __thiscall
IOSurfaceSharedEventReference::IOSurfaceSharedEventReference(IOSurfaceSharedEventReference *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventReference_00027630;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventReference::__OSFinalClass()

void IOSurfaceSharedEventReference::__OSFinalClass(void)

{
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventReference::withSharedEvent(IOSurfaceSharedEvent*)

long __cdecl IOSurfaceSharedEventReference::withSharedEvent(long *param_1)

{
  long *plVar1;
  long lVar2;
  
  lVar2 = (**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (lVar2 != 0) {
    plVar1 = *(long **)(lVar2 + 0x10);
    *(long **)(lVar2 + 0x10) = param_1;
    if (param_1 != (long *)0x0) {
      (**(code **)(*param_1 + 0x20))(param_1);
    }
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  return lVar2;
}



// IOSurfaceSharedEventReference::initWithEvent(IOSurfaceSharedEvent*)

undefined8 __thiscall
IOSurfaceSharedEventReference::initWithEvent(IOSurfaceSharedEventReference *this,long *param_1)

{
  long *plVar1;
  undefined8 in_RAX;
  
  plVar1 = *(long **)(this + 0x10);
  *(long **)(this + 0x10) = param_1;
  if (param_1 != (long *)0x0) {
    in_RAX = (**(code **)(*param_1 + 0x20))(param_1);
  }
  if (plVar1 != (long *)0x0) {
    in_RAX = (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  return CONCAT71((int7)((ulong)in_RAX >> 8),1);
}



// IOSurfaceSharedEventReference::free()

void __thiscall IOSurfaceSharedEventReference::free(IOSurfaceSharedEventReference *this)

{
  IOSurfaceSharedEvent::signal_completed_internal
            (*(IOSurfaceSharedEvent **)(this + 0x10),0xffffffffffffffff,1);
                    // WARNING: Could not recover jumptable at 0x000015aa. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceSharedEvent::signalCompleted(unsigned long long)

void __thiscall IOSurfaceSharedEvent::signalCompleted(IOSurfaceSharedEvent *this,ulong param_1)

{
  signal_completed_internal(this,param_1,1);
  return;
}



// IOSurfaceSharedEventReference::getSharedEvent() const

undefined8 __thiscall
IOSurfaceSharedEventReference::getSharedEvent(IOSurfaceSharedEventReference *this)

{
  return *(undefined8 *)(this + 0x10);
}



// IOSurfaceSharedEventReference::retainSharedEvent()

long * __thiscall
IOSurfaceSharedEventReference::retainSharedEvent(IOSurfaceSharedEventReference *this)

{
  long *plVar1;
  
  plVar1 = *(long **)(this + 0x10);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x20))(plVar1);
  }
  return plVar1;
}



// IOSurfaceSharedEvent::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEvent::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEvent",(OSMetaClass *)PTR_gMetaClass_00027048,0x60)
  ;
  *(undefined ***)this = &PTR__MetaClass_00027990;
  return;
}



// IOSurfaceSharedEvent::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEvent::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEvent::IOSurfaceSharedEvent(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEvent::IOSurfaceSharedEvent(IOSurfaceSharedEvent *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEvent_00027858;
  return;
}



// IOSurfaceSharedEvent::IOSurfaceSharedEvent(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEvent::IOSurfaceSharedEvent(IOSurfaceSharedEvent *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEvent_00027858;
  return;
}



// IOSurfaceSharedEvent::~IOSurfaceSharedEvent()

void __thiscall IOSurfaceSharedEvent::~IOSurfaceSharedEvent(IOSurfaceSharedEvent *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEvent::~IOSurfaceSharedEvent()

void __thiscall IOSurfaceSharedEvent::~IOSurfaceSharedEvent(IOSurfaceSharedEvent *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEvent::~IOSurfaceSharedEvent()

void __thiscall IOSurfaceSharedEvent::~IOSurfaceSharedEvent(IOSurfaceSharedEvent *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceSharedEvent_ktv,this,0x60);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::operator delete(void*, unsigned long)

void __cdecl IOSurfaceSharedEvent::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSharedEvent_ktv,param_1,param_2);
  return;
}



// IOSurfaceSharedEvent::getMetaClass() const

undefined8 * IOSurfaceSharedEvent::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSharedEvent::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEvent::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEvent",(OSMetaClass *)PTR_gMetaClass_00027048,0x60)
  ;
  *(undefined ***)this = &PTR__MetaClass_00027990;
  return;
}



// IOSurfaceSharedEvent::MetaClass::alloc() const

OSObject * IOSurfaceSharedEvent::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSharedEvent_ktv,0x60);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSharedEvent::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEvent_00027858;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSharedEvent::operator new(unsigned long)

void * __thiscall IOSurfaceSharedEvent::operator_new(IOSurfaceSharedEvent *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSharedEvent_ktv,this);
  return pvVar1;
}



// IOSurfaceSharedEvent::IOSurfaceSharedEvent()

void __thiscall IOSurfaceSharedEvent::IOSurfaceSharedEvent(IOSurfaceSharedEvent *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEvent_00027858;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEvent::IOSurfaceSharedEvent()

void __thiscall IOSurfaceSharedEvent::IOSurfaceSharedEvent(IOSurfaceSharedEvent *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEvent_00027858;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEvent::__OSFinalClass()

void IOSurfaceSharedEvent::__OSFinalClass(void)

{
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::sharedEventWithOptions(IOSurfaceRoot*, unsigned long long)

IOSurfaceSharedEvent * __cdecl
IOSurfaceSharedEvent::sharedEventWithOptions(IOSurfaceRoot *param_1,ulong param_2)

{
  IOSurfaceSharedEvent *this;
  undefined8 uVar1;
  
  this = (IOSurfaceSharedEvent *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEvent *)0x0) {
    uVar1 = init(this,param_1,param_2);
    if ((char)uVar1 != '\0') {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEvent *)0x0;
}



// IOSurfaceSharedEvent::init(IOSurfaceRoot*, unsigned long long)

undefined8 __thiscall
IOSurfaceSharedEvent::init(IOSurfaceSharedEvent *this,IOSurfaceRoot *param_1,ulong param_2)

{
  ulong uVar1;
  long lVar2;
  undefined1 *local_28;
  
  (**(code **)(PTR_vtable_00027078 + 0x98))();
  _iosfc_ref_init_count_internal((uint *)(this + 0xc),1);
  *(IOSurfaceRoot **)(this + 0x10) = param_1;
  (**(code **)(*(long *)param_1 + 0x20))(param_1);
  if (param_2 < 4) {
    *(ulong *)(this + 0x58) = param_2;
    uVar1 = IOSurfaceRoot::alloc_shared_event_handle(param_1,(undefined4 *)(this + 0x1c));
    if ((char)uVar1 != '\0') {
      local_28 = &DAT_aaaaaaaaaaaaaaaa;
      uVar1 = IOSurfaceRoot::alloc_event_shared
                        (param_1,*(uint *)(this + 0x1c),(uint *)(this + 0x40),(long *)&local_28);
      if ((char)uVar1 != '\0') {
        *(undefined1 **)(this + 0x28) = local_28;
        *(undefined1 **)(this + 0x20) = local_28;
        if (*(int *)(this + 0x1c) == *(int *)(this + 0x40)) {
          *(ulong *)(this + 0x58) = *(ulong *)(this + 0x58) | 2;
        }
        else if ((*(ulong *)(this + 0x58) & 2) != 0) {
          return 0;
        }
        *(undefined8 *)(this + 0x48) = 0;
        *(IOSurfaceSharedEvent **)(this + 0x50) = this + 0x48;
        lVar2 = IOSurfaceRoot::getNextGlobalTraceID();
        *(long *)(this + 0x30) = lVar2;
        lVar2 = _IOLockAlloc();
        *(long *)(this + 0x38) = lVar2;
        if (lVar2 != 0) {
          uVar1 = IOSurfaceRoot::set_shared_event_with_handle
                            (param_1,(long)this,*(uint *)(this + 0x1c));
          return CONCAT71((int7)(uVar1 >> 8),1);
        }
      }
    }
  }
  return 0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::sharedEvent(IOSurfaceRoot*)

void __cdecl IOSurfaceSharedEvent::sharedEvent(IOSurfaceRoot *param_1)

{
  sharedEventWithOptions(param_1,0);
  return;
}



// IOSurfaceSharedEvent::finalize()

void __thiscall IOSurfaceSharedEvent::finalize(IOSurfaceSharedEvent *this)

{
  if (*(uint *)(this + 0x1c) != 0) {
    IOSurfaceRoot::free_shared_event_handle
              (*(IOSurfaceRoot **)(this + 0x10),(long)this,*(uint *)(this + 0x1c));
    *(undefined4 *)(this + 0x1c) = 0;
  }
                    // WARNING: Could not recover jumptable at 0x0000193f. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x90))(this);
  return;
}



// IOSurfaceSharedEvent::free()

void __thiscall IOSurfaceSharedEvent::free(IOSurfaceSharedEvent *this)

{
  if (*(long *)(this + 0x48) == 0) {
    *(undefined8 *)(this + 0x28) = 0;
    *(undefined8 *)(this + 0x20) = 0;
    if (*(long *)(this + 0x38) != 0) {
      _IOLockFree();
      *(undefined8 *)(this + 0x38) = 0;
    }
    if (*(long **)(this + 0x10) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x10) + 0x28))();
    }
    *(undefined8 *)(this + 0x10) = 0;
                    // WARNING: Could not recover jumptable at 0x0000199d. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
    return;
  }
  free();
  return;
}



// IOSurfaceSharedEvent::signal_completed_internal(unsigned long long, bool)

void __thiscall
IOSurfaceSharedEvent::signal_completed_internal
          (IOSurfaceSharedEvent *this,ulong param_1,byte param_2)

{
  ulong uVar1;
  bool bVar2;
  
  if (((byte)this[0x58] & 1) == 0) {
    do {
      uVar1 = **(ulong **)(this + 0x28);
      if (param_1 <= uVar1) break;
      LOCK();
      bVar2 = uVar1 == **(ulong **)(this + 0x28);
      if (bVar2) {
        **(ulong **)(this + 0x28) = param_1;
      }
      UNLOCK();
    } while (!bVar2);
    bVar2 = param_1 <= uVar1;
  }
  else {
    LOCK();
    **(ulong **)(this + 0x28) = param_1;
    UNLOCK();
    bVar2 = false;
  }
  if (param_1 != 0xffffffffffffffff) {
    _kernel_debug(0x85210028,*(uintptr_t *)(this + 0x30),param_1,0,0,0);
  }
  if (!bVar2) {
    IOSurfaceRoot::signal_event_notifier_clients(*(IOSurfaceRoot **)(this + 0x10),(uint)param_2);
    do_notify(this,param_2);
    return;
  }
  return;
}



// IOSurfaceSharedEvent::signalUserCompleted(unsigned long long)

void __thiscall IOSurfaceSharedEvent::signalUserCompleted(IOSurfaceSharedEvent *this,ulong param_1)

{
  signal_completed_internal(this,param_1,0);
  return;
}



// IOSurfaceSharedEvent::do_notify(bool)

void __thiscall IOSurfaceSharedEvent::do_notify(IOSurfaceSharedEvent *this,char param_1)

{
  IOSurfaceSharedEventNotification *pIVar1;
  IOSurfaceSharedEventNotification *pIVar2;
  long lVar3;
  IOSurfaceSharedEventNotification *pIVar4;
  long *plVar5;
  undefined8 uVar6;
  IOSurfaceSharedEventNotification *this_00;
  char *pcVar7;
  undefined8 uVar8;
  IOSurfaceSharedEventNotification *local_38;
  IOSurfaceSharedEventNotification *local_30;
  
  if (*(int *)(this + 0x18) != 0) {
    _thread_wakeup_prim(this,0,0);
  }
  local_30 = (IOSurfaceSharedEventNotification *)&local_38;
  local_38 = (IOSurfaceSharedEventNotification *)0x0;
  _IOLockLock(*(undefined8 *)(this + 0x38));
  pIVar2 = *(IOSurfaceSharedEventNotification **)(this + 0x48);
  while (this_00 = pIVar2, this_00 != (IOSurfaceSharedEventNotification *)0x0) {
    pIVar2 = *(IOSurfaceSharedEventNotification **)(this_00 + 0x28);
    if (*(ulong *)(this_00 + 0x10) <= **(ulong **)(this + 0x28)) {
      pIVar1 = this_00 + 0x28;
      lVar3 = *(long *)pIVar1;
      if (lVar3 == 0) {
        plVar5 = *(long **)(this_00 + 0x30);
        if ((IOSurfaceSharedEventNotification *)*plVar5 != this_00) {
LAB_00001bc6:
          pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
          goto LAB_00001bd6;
        }
        *(long **)(this + 0x50) = plVar5;
      }
      else {
        if (*(IOSurfaceSharedEventNotification **)(lVar3 + 0x30) != pIVar1) {
          pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_00001bd6:
          uVar6 = 0x1b0;
          uVar8 = 0x1b0;
          goto LAB_00001beb;
        }
        if ((IOSurfaceSharedEventNotification *)**(long **)(this_00 + 0x30) != this_00)
        goto LAB_00001bc6;
        *(long **)(lVar3 + 0x30) = *(long **)(this_00 + 0x30);
        plVar5 = *(long **)(this_00 + 0x30);
      }
      *plVar5 = lVar3;
      if (param_1 == '\0') {
        *(undefined8 *)(this_00 + 0x28) = 0;
        *(IOSurfaceSharedEventNotification **)(this_00 + 0x30) = local_30;
        *(IOSurfaceSharedEventNotification **)local_30 = this_00;
        local_30 = pIVar1;
      }
      else {
        IOSurfaceSharedEventListener::schedule_event_notification
                  (*(IOSurfaceSharedEventListener **)(this_00 + 0x40),(long *)this_00);
        (**(code **)(*(long *)this_00 + 0x28))(this_00);
      }
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x38));
  this_00 = local_38;
  pIVar2 = local_30;
  do {
    if (this_00 == (IOSurfaceSharedEventNotification *)0x0) {
      return;
    }
    pIVar1 = *(IOSurfaceSharedEventNotification **)(this_00 + 0x28);
    if (pIVar1 == (IOSurfaceSharedEventNotification *)0x0) {
      pIVar4 = *(IOSurfaceSharedEventNotification **)(this_00 + 0x30);
      local_30 = pIVar4;
      if (*(IOSurfaceSharedEventNotification **)pIVar4 != this_00) {
LAB_00001b9f:
        pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00001baf:
        uVar6 = 0x1c0;
        uVar8 = 0x1c0;
        local_30 = pIVar2;
LAB_00001beb:
                    // WARNING: Subroutine does not return
        _panic(pcVar7,this_00,uVar6,"IOSurfaceEvent.cpp",uVar8);
      }
    }
    else {
      if (*(IOSurfaceSharedEventNotification **)(pIVar1 + 0x30) != this_00 + 0x28) {
        pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_00001baf;
      }
      if ((IOSurfaceSharedEventNotification *)**(long **)(this_00 + 0x30) != this_00)
      goto LAB_00001b9f;
      *(long **)(pIVar1 + 0x30) = *(long **)(this_00 + 0x30);
      pIVar4 = *(IOSurfaceSharedEventNotification **)(this_00 + 0x30);
      local_30 = pIVar2;
    }
    *(IOSurfaceSharedEventNotification **)pIVar4 = pIVar1;
    IOSurfaceSharedEventNotification::sendNotification(this_00);
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    this_00 = pIVar1;
    pIVar2 = local_30;
  } while( true );
}



// IOSurfaceSharedEvent::signal()

void __thiscall IOSurfaceSharedEvent::signal(IOSurfaceSharedEvent *this)

{
  _kernel_debug(0x85210028,*(uintptr_t *)(this + 0x30),**(uintptr_t **)(this + 0x28),0,0,0);
  IOSurfaceRoot::signal_event_notifier_clients(*(IOSurfaceRoot **)(this + 0x10),1);
  do_notify(this,'\x01');
  return;
}



// IOSurfaceSharedEventNotification::scheduleNotification()

void __thiscall
IOSurfaceSharedEventNotification::scheduleNotification(IOSurfaceSharedEventNotification *this)

{
  IOSurfaceSharedEventListener::schedule_event_notification
            (*(IOSurfaceSharedEventListener **)(this + 0x40),(long *)this);
  return;
}



// IOSurfaceSharedEvent::waitCompleted(unsigned long long, unsigned long long)

ulong __thiscall
IOSurfaceSharedEvent::waitCompleted(IOSurfaceSharedEvent *this,ulong param_1,undefined8 param_2)

{
  int iVar1;
  undefined8 unaff_R12;
  ulong uVar2;
  
  uVar2 = CONCAT71((int7)((ulong)unaff_R12 >> 8),1);
  if (**(ulong **)(this + 0x28) < param_1) {
    LOCK();
    *(int *)(this + 0x18) = *(int *)(this + 0x18) + 1;
    UNLOCK();
    do {
      uVar2 = CONCAT71((int7)(uVar2 >> 8),1);
      if (param_1 <= **(ulong **)(this + 0x28)) goto LAB_00001cc8;
      iVar1 = _assert_wait_deadline(this,1,param_2);
      if (param_1 <= **(ulong **)(this + 0x28)) {
        _thread_wakeup_prim(this,0,0);
        goto LAB_00001cc8;
      }
      if (iVar1 == -1) {
        iVar1 = _thread_block(0);
      }
      else if (iVar1 == 0) goto LAB_00001cc8;
    } while (1 < iVar1 - 1U);
    uVar2 = 0;
LAB_00001cc8:
    LOCK();
    *(int *)(this + 0x18) = *(int *)(this + 0x18) + -1;
    UNLOCK();
  }
  return uVar2 & 0xffffffff;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::retainFromTask(task*, unsigned int)

long * __cdecl IOSurfaceSharedEvent::retainFromTask(task *param_1,uint param_2)

{
  int iVar1;
  long lVar2;
  long *plVar3;
  OSMetaClassBase *local_18;
  
  local_18 = (OSMetaClassBase *)0x0;
  iVar1 = IOUserClient::copyObjectForPortNameInTask(param_1,param_2,(OSSharedPtr *)&local_18);
  if (iVar1 == 0) {
    lVar2 = OSMetaClassBase::safeMetaCast
                      (local_18,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
    if ((lVar2 != 0) && (plVar3 = *(long **)(lVar2 + 0x10), plVar3 != (long *)0x0)) {
      (**(code **)(*plVar3 + 0x20))(plVar3);
      goto LAB_00001cf4;
    }
  }
  plVar3 = (long *)0x0;
LAB_00001cf4:
  if (local_18 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_18 + 0x28))();
  }
  return plVar3;
}



// IOSurfaceSharedEvent::getTraceID() const

undefined8 __thiscall IOSurfaceSharedEvent::getTraceID(IOSurfaceSharedEvent *this)

{
  return *(undefined8 *)(this + 0x30);
}



// IOSurfaceSharedEvent::getCompletedValue() const

undefined8 __thiscall IOSurfaceSharedEvent::getCompletedValue(IOSurfaceSharedEvent *this)

{
  return **(undefined8 **)(this + 0x28);
}



// IOSurfaceSharedEvent::getSharedID() const

undefined4 __thiscall IOSurfaceSharedEvent::getSharedID(IOSurfaceSharedEvent *this)

{
  return *(undefined4 *)(this + 0x1c);
}



// IOSurfaceSharedEvent::getShmemIndex() const

undefined4 __thiscall IOSurfaceSharedEvent::getShmemIndex(IOSurfaceSharedEvent *this)

{
  return *(undefined4 *)(this + 0x40);
}



// IOSurfaceSharedEvent::getSignalPointer()

undefined8 __thiscall IOSurfaceSharedEvent::getSignalPointer(IOSurfaceSharedEvent *this)

{
  return *(undefined8 *)(this + 0x28);
}



// IOSurfaceSharedEvent::getEventOptions() const

undefined8 __thiscall IOSurfaceSharedEvent::getEventOptions(IOSurfaceSharedEvent *this)

{
  return *(undefined8 *)(this + 0x58);
}



// IOSurfaceSharedEvent::add_notification(IOSurfaceSharedEventNotification*)

void __thiscall IOSurfaceSharedEvent::add_notification(IOSurfaceSharedEvent *this,long *param_1)

{
  undefined8 *puVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x38));
  if (**(ulong **)(this + 0x28) < (ulong)param_1[2]) {
    param_1[5] = 0;
    puVar1 = *(undefined8 **)(this + 0x50);
    param_1[6] = (long)puVar1;
    *puVar1 = param_1;
    *(long **)(this + 0x50) = param_1 + 5;
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  else {
    IOSurfaceSharedEventListener::schedule_event_notification
              ((IOSurfaceSharedEventListener *)param_1[8],param_1);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x38));
  return;
}



// IOSurfaceSharedEvent::notifyPort(IOSurfaceSharedEventNotificationPort*, unsigned long long,
// unsigned long long, unsigned long long)

undefined8 __thiscall
IOSurfaceSharedEvent::notifyPort
          (IOSurfaceSharedEvent *this,long *param_1,ulong param_2,undefined8 param_3,
          undefined8 param_4)

{
  IOSurfaceSharedEventNotification *pIVar1;
  undefined8 uVar2;
  
  pIVar1 = IOSurfaceSharedEventNotification::withEvent((long *)this,param_1,param_2,param_3,param_4)
  ;
  if (pIVar1 == (IOSurfaceSharedEventNotification *)0x0) {
    uVar2 = 0xe00002bd;
  }
  else {
    if (**(ulong **)(this + 0x28) < param_2) {
      add_notification(this,(long *)pIVar1);
    }
    else {
      IOSurfaceSharedEventListener::schedule_event_notification
                (*(IOSurfaceSharedEventListener **)(pIVar1 + 0x40),(long *)pIVar1);
    }
    (**(code **)(*(long *)pIVar1 + 0x28))(pIVar1);
    uVar2 = 0;
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotification::withEvent(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventNotificationPort*, unsigned long long, unsigned long long, unsigned long
// long)

IOSurfaceSharedEventNotification * __cdecl
IOSurfaceSharedEventNotification::withEvent
          (long *param_1,long *param_2,undefined8 param_3,undefined8 param_4,undefined8 param_5)

{
  IOSurfaceSharedEventNotification *this;
  undefined8 uVar1;
  
  this = (IOSurfaceSharedEventNotification *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEventNotification *)0x0) {
    uVar1 = initWithEvent(this,param_1,param_2,param_3,param_4,param_5);
    if ((char)uVar1 != '\0') {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEventNotification *)0x0;
}



// IOSurfaceSharedEvent::notifyListener(IOSurfaceSharedEventListener*, unsigned long long, unsigned
// long long, OSObject*, void (*)(OSObject*, IOSurfaceSharedEvent*, unsigned long long, unsigned
// long long))

undefined8 __thiscall
IOSurfaceSharedEvent::notifyListener
          (IOSurfaceSharedEvent *this,long *param_1,ulong param_2,undefined8 param_3,long *param_4,
          long param_5)

{
  IOSurfaceSharedEventNotification *pIVar1;
  undefined8 uVar2;
  
  pIVar1 = IOSurfaceSharedEventNotification::withEventListener
                     ((long *)this,param_1,param_2,param_3,param_4,param_5);
  if (pIVar1 == (IOSurfaceSharedEventNotification *)0x0) {
    uVar2 = 0xe00002bd;
  }
  else {
    if (**(ulong **)(this + 0x28) < param_2) {
      add_notification(this,(long *)pIVar1);
    }
    else {
      IOSurfaceSharedEventListener::schedule_event_notification
                (*(IOSurfaceSharedEventListener **)(pIVar1 + 0x40),(long *)pIVar1);
    }
    (**(code **)(*(long *)pIVar1 + 0x28))(pIVar1);
    uVar2 = 0;
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotification::withEventListener(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventListener*, unsigned long long, unsigned long long, OSObject*, void
// (*)(OSObject*, IOSurfaceSharedEvent*, unsigned long long, unsigned long long))

IOSurfaceSharedEventNotification * __cdecl
IOSurfaceSharedEventNotification::withEventListener
          (long *param_1,long *param_2,undefined8 param_3,undefined8 param_4,long *param_5,
          long param_6)

{
  IOSurfaceSharedEventNotification *this;
  undefined8 uVar1;
  
  this = (IOSurfaceSharedEventNotification *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEventNotification *)0x0) {
    uVar1 = initWithEvent(this,param_1,param_2,param_3,param_4,param_5,param_6);
    if ((char)uVar1 != '\0') {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEventNotification *)0x0;
}



// IOSurfaceSharedEvent::notifyListener(IOSurfaceSharedEventListener*, unsigned long long, unsigned
// long long, void ( block_pointer)(IOSurfaceSharedEvent*, unsigned long long, unsigned long long))

undefined8 __thiscall
IOSurfaceSharedEvent::notifyListener
          (IOSurfaceSharedEvent *this,long *param_1,ulong param_2,undefined8 param_3,void *param_4)

{
  IOSurfaceSharedEventNotification *pIVar1;
  undefined8 uVar2;
  
  pIVar1 = IOSurfaceSharedEventNotification::withEventListener
                     ((long *)this,param_1,param_2,param_3,param_4);
  if (pIVar1 == (IOSurfaceSharedEventNotification *)0x0) {
    uVar2 = 0xe00002bd;
  }
  else {
    if (**(ulong **)(this + 0x28) < param_2) {
      add_notification(this,(long *)pIVar1);
    }
    else {
      IOSurfaceSharedEventListener::schedule_event_notification
                (*(IOSurfaceSharedEventListener **)(pIVar1 + 0x40),(long *)pIVar1);
    }
    (**(code **)(*(long *)pIVar1 + 0x28))(pIVar1);
    uVar2 = 0;
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotification::withEventListener(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventListener*, unsigned long long, unsigned long long, void (
// block_pointer)(IOSurfaceSharedEvent*, unsigned long long, unsigned long long))

IOSurfaceSharedEventNotification * __cdecl
IOSurfaceSharedEventNotification::withEventListener
          (long *param_1,long *param_2,undefined8 param_3,undefined8 param_4,void *param_5)

{
  bool bVar1;
  IOSurfaceSharedEventNotification *this;
  
  this = (IOSurfaceSharedEventNotification *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceSharedEventNotification *)0x0) {
    bVar1 = initWithEvent(this,param_1,param_2,param_3,param_4,param_5);
    if (bVar1) {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceSharedEventNotification *)0x0;
}



// IOSurfaceSharedEvent::getRetainCount() const

undefined4 __thiscall IOSurfaceSharedEvent::getRetainCount(IOSurfaceSharedEvent *this)

{
  return *(undefined4 *)(this + 0xc);
}



// IOSurfaceSharedEvent::tryRetain() const

void __thiscall IOSurfaceSharedEvent::tryRetain(IOSurfaceSharedEvent *this)

{
  _iosfc_ref_retain_try_internal((uint *)(this + 0xc));
  return;
}



// IOSurfaceSharedEvent::retain() const

void __thiscall IOSurfaceSharedEvent::retain(IOSurfaceSharedEvent *this)

{
  uint uVar1;
  IOSurfaceSharedEvent *pIVar2;
  
  pIVar2 = this + 0xc;
  LOCK();
  uVar1 = *(uint *)pIVar2;
  *(uint *)pIVar2 = *(uint *)pIVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(pIVar2,uVar1);
  return;
}



// IOSurfaceSharedEvent::release() const

void __thiscall IOSurfaceSharedEvent::release(IOSurfaceSharedEvent *this)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x000020b9. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x118))(this);
  return;
}



// IOSurfaceSharedEvent::release(int) const

void __thiscall IOSurfaceSharedEvent::release(IOSurfaceSharedEvent *this,int param_1)

{
  int iVar1;
  
  if (param_1 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x000020f8. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    release();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::taggedRetain(void const*) const

void __cdecl IOSurfaceSharedEvent::taggedRetain(long param_1)

{
  uint uVar1;
  uint *puVar2;
  
  puVar2 = (uint *)(param_1 + 0xc);
  LOCK();
  uVar1 = *puVar2;
  *puVar2 = *puVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(puVar2,uVar1);
  return;
}



// IOSurfaceSharedEvent::taggedRelease(void const*, int) const

void __thiscall
IOSurfaceSharedEvent::taggedRelease(IOSurfaceSharedEvent *this,undefined8 param_2_00,int param_2)

{
  int iVar1;
  
  if (param_2 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x0000214c. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    taggedRelease();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEvent::taggedRelease(void const*) const

void __cdecl IOSurfaceSharedEvent::taggedRelease(long *param_1)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)((long)param_1 + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x0000218d. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x118))(param_1);
  return;
}



// IOSurfaceSharedEventNotification::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventNotification::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventNotification",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x68);
  *(undefined ***)this = &PTR__MetaClass_00027bb8;
  return;
}



// IOSurfaceSharedEventNotification::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventNotification::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  return;
}



// IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification(OSMetaClass const*)

void __thiscall
IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  return;
}



// IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification()

void __thiscall
IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  if (*(long **)(this + 0x50) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x50) + 0x28))();
  }
  *(undefined8 *)(this + 0x50) = 0;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x38) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x38) + 0x28))();
  }
  *(undefined8 *)(this + 0x38) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification()

void __thiscall
IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  if (*(long **)(this + 0x50) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x50) + 0x28))();
  }
  *(undefined8 *)(this + 0x50) = 0;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x38) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x38) + 0x28))();
  }
  *(undefined8 *)(this + 0x38) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification()

void __thiscall
IOSurfaceSharedEventNotification::~IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this)

{
  ~IOSurfaceSharedEventNotification(this);
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventNotification_ktv,this,0x68);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSharedEventNotification::operator delete(void*, unsigned long)

void __cdecl
IOSurfaceSharedEventNotification::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSharedEventNotification_ktv,param_1,param_2);
  return;
}



// IOSurfaceSharedEventNotification::getMetaClass() const

undefined8 * IOSurfaceSharedEventNotification::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSharedEventNotification::MetaClass::MetaClass()

void __thiscall IOSurfaceSharedEventNotification::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSharedEventNotification",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x68);
  *(undefined ***)this = &PTR__MetaClass_00027bb8;
  return;
}



// IOSurfaceSharedEventNotification::MetaClass::alloc() const

OSObject * IOSurfaceSharedEventNotification::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSharedEventNotification_ktv,0x68);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSharedEventNotification::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSharedEventNotification::operator new(unsigned long)

void * __thiscall
IOSurfaceSharedEventNotification::operator_new(IOSurfaceSharedEventNotification *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSharedEventNotification_ktv,this);
  return pvVar1;
}



// IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification()

void __thiscall
IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification()

void __thiscall
IOSurfaceSharedEventNotification::IOSurfaceSharedEventNotification
          (IOSurfaceSharedEventNotification *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSharedEventNotification_00027a88;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSharedEventNotification::__OSFinalClass()

void IOSurfaceSharedEventNotification::__OSFinalClass(void)

{
  return;
}



// IOSurfaceSharedEventNotification::initWithEvent(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventNotificationPort*, unsigned long long, unsigned long long, unsigned long
// long)

undefined8 __thiscall
IOSurfaceSharedEventNotification::initWithEvent
          (IOSurfaceSharedEventNotification *this,long *param_1,long *param_2,undefined8 param_3,
          undefined8 param_4,undefined8 param_5)

{
  long *plVar1;
  char cVar2;
  undefined8 uVar3;
  
  uVar3 = 0;
  if ((param_1 != (long *)0x0) && (param_2 != (long *)0x0)) {
    cVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))();
    if (cVar2 == '\0') {
      uVar3 = 0;
    }
    else {
      plVar1 = *(long **)(this + 0x38);
      *(long **)(this + 0x38) = param_1;
      (**(code **)(*param_1 + 0x20))(param_1);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      plVar1 = *(long **)(this + 0x40);
      *(long **)(this + 0x40) = param_2;
      (**(code **)(*param_2 + 0x20))(param_2);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      *(long **)(this + 0x48) = param_2;
      *(undefined8 *)(this + 0x18) = param_4;
      *(undefined8 *)(this + 0x10) = param_3;
      *(undefined8 *)(this + 0x20) = param_5;
      uVar3 = CONCAT71((int7)((ulong)param_5 >> 8),1);
    }
  }
  return uVar3;
}



// IOSurfaceSharedEventNotification::initWithEvent(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventListener*, unsigned long long, unsigned long long, OSObject*, void
// (*)(OSObject*, IOSurfaceSharedEvent*, unsigned long long, unsigned long long))

undefined8 __thiscall
IOSurfaceSharedEventNotification::initWithEvent
          (IOSurfaceSharedEventNotification *this,long *param_1,long *param_2,undefined8 param_3,
          undefined8 param_4,long *param_5,long param_6)

{
  long *plVar1;
  char cVar2;
  undefined8 uVar3;
  
  uVar3 = 0;
  if (((param_1 != (long *)0x0) && (param_2 != (long *)0x0)) && (param_6 != 0)) {
    cVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))();
    if (cVar2 == '\0') {
      uVar3 = 0;
    }
    else {
      plVar1 = *(long **)(this + 0x38);
      *(long **)(this + 0x38) = param_1;
      (**(code **)(*param_1 + 0x20))(param_1);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      plVar1 = *(long **)(this + 0x40);
      *(long **)(this + 0x40) = param_2;
      (**(code **)(*param_2 + 0x20))(param_2);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      *(undefined8 *)(this + 0x18) = 0;
      *(undefined8 *)(this + 0x10) = param_3;
      *(undefined8 *)(this + 0x20) = param_4;
      plVar1 = *(long **)(this + 0x50);
      *(long **)(this + 0x50) = param_5;
      if (param_5 != (long *)0x0) {
        param_4 = (**(code **)(*param_5 + 0x20))(param_5);
      }
      if (plVar1 != (long *)0x0) {
        param_4 = (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      *(long *)(this + 0x58) = param_6;
      uVar3 = CONCAT71((int7)((ulong)param_4 >> 8),1);
    }
  }
  return uVar3;
}



// IOSurfaceSharedEventNotification::initWithEvent(IOSurfaceSharedEvent*,
// IOSurfaceSharedEventListener*, unsigned long long, unsigned long long, void (
// block_pointer)(IOSurfaceSharedEvent*, unsigned long long, unsigned long long))

bool __thiscall
IOSurfaceSharedEventNotification::initWithEvent
          (IOSurfaceSharedEventNotification *this,long *param_1,long *param_2,undefined8 param_3,
          undefined8 param_4,void *param_5)

{
  long *plVar1;
  char cVar2;
  void *pvVar3;
  bool bVar4;
  
  bVar4 = false;
  if (((param_1 != (long *)0x0) && (bVar4 = false, param_2 != (long *)0x0)) &&
     (bVar4 = false, param_5 != (void *)0x0)) {
    cVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))();
    if (cVar2 == '\0') {
      bVar4 = false;
    }
    else {
      plVar1 = *(long **)(this + 0x38);
      *(long **)(this + 0x38) = param_1;
      (**(code **)(*param_1 + 0x20))(param_1);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      plVar1 = *(long **)(this + 0x40);
      *(long **)(this + 0x40) = param_2;
      (**(code **)(*param_2 + 0x20))(param_2);
      if (plVar1 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
      *(undefined8 *)(this + 0x18) = 0;
      *(undefined8 *)(this + 0x10) = param_3;
      *(undefined8 *)(this + 0x20) = param_4;
      pvVar3 = __Block_copy(param_5);
      *(void **)(this + 0x60) = pvVar3;
      bVar4 = pvVar3 != (void *)0x0;
    }
  }
  return bVar4;
}



// IOSurfaceSharedEventNotification::free()

void __thiscall IOSurfaceSharedEventNotification::free(IOSurfaceSharedEventNotification *this)

{
  if (*(void **)(this + 0x60) != (void *)0x0) {
    __Block_release(*(void **)(this + 0x60));
    *(undefined8 *)(this + 0x60) = 0;
  }
                    // WARNING: Could not recover jumptable at 0x0000271f. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceEvent::getTraceID() const

undefined8 __thiscall IOSurfaceEvent::getTraceID(IOSurfaceEvent *this)

{
  return *(undefined8 *)(this + 0x30);
}



// IOSurfaceSharedEventListener::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventListener::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventNotificationPort::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventNotificationPort::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventReference::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventReference::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEvent::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEvent::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSharedEventNotification::MetaClass::~MetaClass()

void __thiscall IOSurfaceSharedEventNotification::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceEvent_cpp(void)

{
  undefined *puVar1;
  
  puVar1 = PTR_gMetaClass_00027048;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass,"IOSurfaceSharedEventListener"
             ,(OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  IOSurfaceSharedEventListener::gMetaClass = &PTR__MetaClass_00027310;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSharedEventNotificationPort::gMetaClass,
             "IOSurfaceSharedEventNotificationPort",
             (OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass,0x78);
  IOSurfaceSharedEventNotificationPort::gMetaClass = &PTR__MetaClass_00027538;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass,
             "IOSurfaceSharedEventReference",(OSMetaClass *)puVar1,0x18);
  IOSurfaceSharedEventReference::gMetaClass = &PTR__MetaClass_00027760;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSharedEvent::gMetaClass,"IOSurfaceSharedEvent",
             (OSMetaClass *)puVar1,0x60);
  IOSurfaceSharedEvent::gMetaClass = &PTR__MetaClass_00027990;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSharedEventNotification::gMetaClass,
             "IOSurfaceSharedEventNotification",(OSMetaClass *)puVar1,0x68);
  IOSurfaceSharedEventNotification::gMetaClass = &PTR__MetaClass_00027bb8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSharedEventNotification::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSharedEvent::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSharedEventNotificationPort::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSharedEventListener::gMetaClass);
  return;
}



// IOFenceTransaction::MetaClass::MetaClass()

void __thiscall IOFenceTransaction::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOFenceTransaction",(OSMetaClass *)PTR_gMetaClass_00027048,0x58);
  *(undefined ***)this = &PTR__MetaClass_00027de8;
  return;
}



// IOFenceTransaction::MetaClass::~MetaClass()

void __thiscall IOFenceTransaction::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOFenceTransaction::IOFenceTransaction(OSMetaClass const*)

void __thiscall
IOFenceTransaction::IOFenceTransaction(IOFenceTransaction *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  return;
}



// IOFenceTransaction::IOFenceTransaction(OSMetaClass const*)

void __thiscall
IOFenceTransaction::IOFenceTransaction(IOFenceTransaction *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  return;
}



// IOFenceTransaction::~IOFenceTransaction()

void __thiscall IOFenceTransaction::~IOFenceTransaction(IOFenceTransaction *this)

{
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOFenceTransaction::~IOFenceTransaction()

void __thiscall IOFenceTransaction::~IOFenceTransaction(IOFenceTransaction *this)

{
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOFenceTransaction::~IOFenceTransaction()

void __thiscall IOFenceTransaction::~IOFenceTransaction(IOFenceTransaction *this)

{
  ~IOFenceTransaction(this);
  _OSObject_typed_operator_delete(&IOFenceTransaction_ktv,this,0x58);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOFenceTransaction::operator delete(void*, unsigned long)

void __cdecl IOFenceTransaction::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOFenceTransaction_ktv,param_1,param_2);
  return;
}



// IOFenceTransaction::getMetaClass() const

undefined8 * IOFenceTransaction::getMetaClass(void)

{
  return &gMetaClass;
}



// IOFenceTransaction::MetaClass::MetaClass()

void __thiscall IOFenceTransaction::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOFenceTransaction",(OSMetaClass *)PTR_gMetaClass_00027048,0x58);
  *(undefined ***)this = &PTR__MetaClass_00027de8;
  return;
}



// IOFenceTransaction::MetaClass::alloc() const

OSObject * IOFenceTransaction::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOFenceTransaction_ktv,0x58);
  OSObject::OSObject(this,(OSMetaClass *)&IOFenceTransaction::gMetaClass);
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOFenceTransaction::operator new(unsigned long)

void * __thiscall IOFenceTransaction::operator_new(IOFenceTransaction *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOFenceTransaction_ktv,this);
  return pvVar1;
}



// IOFenceTransaction::IOFenceTransaction()

void __thiscall IOFenceTransaction::IOFenceTransaction(IOFenceTransaction *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOFenceTransaction::IOFenceTransaction()

void __thiscall IOFenceTransaction::IOFenceTransaction(IOFenceTransaction *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOFenceTransaction_00027cb0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOFenceTransaction::fenceTransaction(IOService*)

long * __cdecl IOFenceTransaction::fenceTransaction(undefined8 param_1)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x118))(plVar2,param_1);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOFenceTransaction::init(IOService*)

undefined8 __thiscall IOFenceTransaction::init(IOFenceTransaction *this,long *param_1)

{
  long *plVar1;
  undefined8 uVar2;
  
  uVar2 = _IOLockAlloc();
  *(undefined8 *)(this + 0x20) = uVar2;
  plVar1 = *(long **)(this + 0x10);
  *(long **)(this + 0x10) = param_1;
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  *(undefined4 *)(this + 0x2c) = 4;
  if (*(long *)(this + 0x20) != 0) {
                    // WARNING: Could not recover jumptable at 0x00002bbb. Too many branches
                    // WARNING: Treating indirect jump as call
    uVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))(this);
    return uVar2;
  }
  return 0;
}



// IOFenceTransaction::free()

void __thiscall IOFenceTransaction::free(IOFenceTransaction *this)

{
  long lVar1;
  long lVar2;
  
  if (*(int *)(this + 0x28) == 0) {
    lVar1 = *(long *)(this + 0x30);
    if (lVar1 != 0) {
      lVar2 = -0x8000000000000000;
      if (-1 < (long)*(int *)(this + 0x2c)) {
        lVar2 = (long)*(int *)(this + 0x2c) * 8;
      }
      *(undefined8 *)(this + 0x30) = 0;
      _IOFreeTypeVarImpl(&free()::kalloc_type_view_72,lVar1,lVar2);
    }
    if (*(long *)(this + 0x20) != 0) {
      _IOLockFree();
    }
                    // WARNING: Could not recover jumptable at 0x00002c35. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
    return;
  }
                    // WARNING: Subroutine does not return
  _panic("\"IOFenceTransaction %p freed with non-zero fence count!\\n\" @%s:%d",this,
         "IOSurfaceFenceTransaction.cpp",0x44);
}



// IOFenceTransaction::lock() const

void __thiscall IOFenceTransaction::lock(IOFenceTransaction *this)

{
  _IOLockLock(*(undefined8 *)(this + 0x20));
  return;
}



// IOFenceTransaction::unlock() const

void __thiscall IOFenceTransaction::unlock(IOFenceTransaction *this)

{
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  return;
}



// IOFenceTransaction::dump()

void __thiscall IOFenceTransaction::dump(IOFenceTransaction *this)

{
  uint uVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  IOFenceTransaction *pIVar7;
  
  _IOLockLock(*(undefined8 *)(this + 0x20));
  uVar1 = *(uint *)(this + 0x2c);
  if ((ulong)uVar1 == 4) {
    pIVar7 = this + 0x38;
  }
  else {
    if ((int)uVar1 < 0) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                ("bounded_array_ref: Can\'t construct from a size greater than UINT32_MAX");
    }
    pIVar7 = *(IOFenceTransaction **)(this + 0x30);
  }
  if (0 < *(int *)(this + 0x28)) {
    uVar4 = (long)(pIVar7 + (ulong)uVar1 * 8) - (long)pIVar7;
    if ((pIVar7 + (ulong)uVar1 * 8 < pIVar7) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar6 = 0;
    lVar5 = 0;
    do {
      if (lVar5 == 0x10000000) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                  );
      }
      if (((long)uVar6 < 0) || ((uint)uVar4 < (int)(uVar6 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                  );
      }
      uVar3 = (ulong)CARRY8(uVar6 >> 0x20,(ulong)pIVar7);
      uVar2 = -uVar3;
      if ((uVar3 != uVar2) || ((long)uVar2 < 0)) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                  );
      }
      _printf("\tfence: %p\n",*(void **)(pIVar7 + (uVar6 >> 0x20)));
      lVar5 = lVar5 + 1;
      uVar6 = uVar6 + 0x800000000;
    } while (lVar5 < *(int *)(this + 0x28));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  return;
}



// IOFenceTransaction::add_fence(IOFence*)

void __thiscall IOFenceTransaction::add_fence(IOFenceTransaction *this,undefined8 param_1)

{
  uint uVar1;
  uint uVar2;
  IOFenceTransaction *pIVar3;
  IOFenceTransaction *pIVar4;
  int iVar5;
  ulong uVar6;
  ulong uVar7;
  long lVar8;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  uint uVar13;
  IOFenceTransaction *pIVar14;
  
  _IOLockLock(*(undefined8 *)(this + 0x20));
  uVar2 = *(uint *)(this + 0x28);
  uVar9 = (ulong)uVar2;
  if ((int)uVar2 < 0x10000) {
    uVar1 = *(uint *)(this + 0x2c);
    if (uVar1 == 4) {
      pIVar3 = (IOFenceTransaction *)0x0;
      pIVar14 = this + 0x38;
    }
    else {
      if ((int)uVar1 < 0) goto LAB_00003024;
      pIVar3 = *(IOFenceTransaction **)(this + 0x30);
      pIVar14 = pIVar3;
    }
    if (uVar2 == uVar1) {
      uVar1 = uVar2 * 2;
      lVar8 = (long)(int)uVar1 * 8;
      if ((int)uVar1 < 0) {
        lVar8 = -0x8000000000000000;
      }
      pIVar4 = (IOFenceTransaction *)
               _IOMallocTypeVarImpl(&add_fence(IOFence*)::kalloc_type_view_137,lVar8);
      if ((int)uVar1 < 0) {
LAB_00003024:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  ("bounded_array_ref: Can\'t construct from a size greater than UINT32_MAX");
      }
      if (pIVar4 == (IOFenceTransaction *)0x0) {
        add_fence();
        return;
      }
      uVar2 = *(uint *)(this + 0x28);
      if (0 < (int)uVar2) {
        uVar7 = (long)(pIVar4 + (ulong)uVar1 * 8) - (long)pIVar4;
        uVar6 = (long)(pIVar14 + uVar9 * 8) - (long)pIVar14;
        if ((pIVar14 + uVar9 * 8 < pIVar14) || (uVar6 >> 0x20 != 0)) goto LAB_0000300c;
        uVar9 = 0;
        uVar10 = 0;
        do {
          if (uVar10 == 0x10000000) goto LAB_00003018;
          if ((long)uVar9 < 0) goto LAB_00002ff4;
          uVar11 = uVar9 >> 0x20;
          uVar13 = (int)(uVar9 >> 0x20) + 8;
          if ((uint)uVar6 < uVar13) goto LAB_00002ff4;
          uVar12 = -(ulong)CARRY8((ulong)pIVar14,uVar11);
          if ((CARRY8((ulong)pIVar14,uVar11) != uVar12) || ((long)uVar12 < 0)) goto LAB_00003000;
          if (pIVar4 + (ulong)uVar1 * 8 < pIVar4 || uVar7 >> 0x20 != 0) goto LAB_0000300c;
          if ((uint)uVar7 < uVar13) goto LAB_00002ff4;
          uVar12 = -(ulong)CARRY8(uVar11,(ulong)pIVar4);
          if ((CARRY8(uVar11,(ulong)pIVar4) != uVar12) || ((long)uVar12 < 0)) goto LAB_00003000;
          *(undefined8 *)(pIVar4 + uVar11) = *(undefined8 *)(pIVar14 + uVar11);
          uVar10 = uVar10 + 1;
          uVar9 = uVar9 + 0x800000000;
        } while (uVar2 != uVar10);
      }
      if (pIVar3 != (IOFenceTransaction *)0x0) {
        lVar8 = -0x8000000000000000;
        if (-1 < (long)*(int *)(this + 0x2c)) {
          lVar8 = (long)*(int *)(this + 0x2c) * 8;
        }
        _IOFreeTypeVarImpl(&add_fence(IOFence*)::kalloc_type_view_144,pIVar3,lVar8);
        uVar2 = *(uint *)(this + 0x28);
      }
      *(IOFenceTransaction **)(this + 0x30) = pIVar4;
      *(uint *)(this + 0x2c) = uVar1;
      uVar9 = (ulong)uVar2;
      pIVar14 = pIVar4;
    }
    iVar5 = (int)uVar9;
    *(int *)(this + 0x28) = iVar5 + 1;
    uVar6 = (long)(pIVar14 + (ulong)uVar1 * 8) - (long)pIVar14;
    if ((pIVar14 + (ulong)uVar1 * 8 < pIVar14) || (uVar6 >> 0x20 != 0)) {
LAB_0000300c:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar7 = (ulong)(uint)-iVar5;
    if (-iVar5 < 0) {
      uVar7 = uVar9;
    }
    uVar9 = uVar7 * -8;
    if (-1 < iVar5) {
      uVar9 = uVar7 * 8;
    }
    iVar5 = (int)uVar9;
    if ((long)iVar5 != uVar9) {
LAB_00003018:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    if ((iVar5 < 0) || ((uint)uVar6 < iVar5 + 8U)) {
LAB_00002ff4:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar7 = (ulong)CARRY8((ulong)pIVar14,uVar9 & 0xffffffff);
    uVar6 = -uVar7;
    if ((uVar7 != uVar6) || ((long)uVar6 < 0)) {
LAB_00003000:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    *(undefined8 *)(pIVar14 + (uVar9 & 0xffffffff)) = param_1;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  return;
}



// IOFenceTransaction::remove_fence(IOFence*)

void __thiscall IOFenceTransaction::remove_fence(IOFenceTransaction *this,long param_1)

{
  IOFenceTransaction *pIVar1;
  uint uVar2;
  ulong uVar3;
  long lVar4;
  ulong uVar5;
  ulong uVar6;
  ulong uVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  
  _IOLockLock(*(undefined8 *)(this + 0x20));
  uVar3 = (ulong)*(uint *)(this + 0x2c);
  if (uVar3 == 4) {
    pIVar1 = this + 0x38;
  }
  else {
    if ((int)*(uint *)(this + 0x2c) < 0) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                ("bounded_array_ref: Can\'t construct from a size greater than UINT32_MAX");
    }
    pIVar1 = *(IOFenceTransaction **)(this + 0x30);
  }
  uVar2 = *(uint *)(this + 0x28);
  uVar8 = (ulong)uVar2;
  if ((int)uVar2 < 1) {
    uVar6 = 0;
LAB_0000312d:
    if ((int)uVar6 < (int)uVar8) {
      uVar5 = (long)(pIVar1 + uVar3 * 8) - (long)pIVar1;
      if ((pIVar1 + uVar3 * 8 < pIVar1) || (uVar5 >> 0x20 != 0)) goto LAB_00003240;
      uVar6 = uVar6 & 0xffffffff;
      uVar7 = uVar6 * 8 - 0x80000008;
      lVar4 = uVar8 - uVar6;
      uVar3 = uVar6 << 0x23;
      do {
        if (uVar7 + 0x10 < 0xffffffff00000000) {
LAB_00003228:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        uVar8 = uVar3 + 0x800000000;
        if ((long)uVar8 < 0) {
LAB_0000321c:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        uVar2 = (uint)uVar5;
        if (uVar2 < (int)(uVar8 >> 0x20) + 8U) goto LAB_0000321c;
        uVar9 = (ulong)CARRY8(uVar8 >> 0x20,(ulong)pIVar1);
        uVar6 = -uVar9;
        if ((uVar9 != uVar6) || ((long)uVar6 < 0)) {
LAB_00003234:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        uVar7 = uVar7 + 8;
        if (uVar7 < 0xffffffff00000000) goto LAB_00003228;
        if (((long)uVar3 < 0) || (uVar2 < (int)(uVar3 >> 0x20) + 8U)) goto LAB_0000321c;
        uVar9 = (ulong)CARRY8(uVar3 >> 0x20,(ulong)pIVar1);
        uVar6 = -uVar9;
        if ((uVar9 != uVar6) || ((long)uVar6 < 0)) goto LAB_00003234;
        *(undefined8 *)(pIVar1 + (uVar3 >> 0x20)) = *(undefined8 *)(pIVar1 + (uVar8 >> 0x20));
        lVar4 = lVar4 + -1;
        uVar3 = uVar8;
      } while (lVar4 != 0);
    }
  }
  else {
    uVar5 = (long)(pIVar1 + uVar3 * 8) - (long)pIVar1;
    if ((pIVar1 + uVar3 * 8 < pIVar1) || (uVar5 >> 0x20 != 0)) {
LAB_00003240:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar7 = 0xffffffff80000000;
    uVar9 = 0;
    uVar6 = 0;
    do {
      if (uVar7 == 0) goto LAB_00003228;
      if (((long)uVar9 < 0) || ((uint)uVar5 < (int)(uVar9 >> 0x20) + 8U)) goto LAB_0000321c;
      uVar11 = (ulong)CARRY8(uVar9 >> 0x20,(ulong)pIVar1);
      uVar10 = -uVar11;
      if ((uVar11 != uVar10) || ((long)uVar10 < 0)) goto LAB_00003234;
      if (*(long *)(pIVar1 + (uVar9 >> 0x20)) == param_1) {
        if (uVar7 < 0xffffffff00000000) goto LAB_00003228;
        *(long *)(pIVar1 + (uVar9 >> 0x20)) = 0;
        *(uint *)(this + 0x28) = uVar2 - 1;
        uVar8 = (ulong)(uVar2 - 1);
        goto LAB_0000312d;
      }
      uVar6 = uVar6 + 1;
      uVar7 = uVar7 + 8;
      uVar9 = uVar9 + 0x800000000;
    } while (uVar8 != uVar6);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  return;
}



// IOFenceTransaction::copy_fences() const

long * __thiscall IOFenceTransaction::copy_fences(IOFenceTransaction *this)

{
  uint uVar1;
  IOFence *this_00;
  char cVar2;
  long *plVar3;
  IOFenceTransaction *pIVar4;
  ulong uVar5;
  ulong uVar6;
  long lVar7;
  ulong uVar8;
  ulong uVar9;
  
  _IOLockLock(*(undefined8 *)(this + 0x20));
  plVar3 = (long *)OSArray::withCapacity(*(uint *)(this + 0x28));
  if (plVar3 != (long *)0x0) {
    uVar1 = *(uint *)(this + 0x2c);
    if ((ulong)uVar1 == 4) {
      pIVar4 = this + 0x38;
    }
    else {
      if ((int)uVar1 < 0) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  ("bounded_array_ref: Can\'t construct from a size greater than UINT32_MAX");
      }
      pIVar4 = *(IOFenceTransaction **)(this + 0x30);
    }
    if (0 < *(int *)(this + 0x28)) {
      uVar8 = (long)(pIVar4 + (ulong)uVar1 * 8) - (long)pIVar4;
      if ((pIVar4 + (ulong)uVar1 * 8 < pIVar4) || (uVar8 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      uVar9 = 0;
      lVar7 = 0;
      do {
        if (lVar7 == 0x10000000) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        if (((long)uVar9 < 0) || ((uint)uVar8 < (int)(uVar9 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        uVar6 = (ulong)CARRY8(uVar9 >> 0x20,(ulong)pIVar4);
        uVar5 = -uVar6;
        if ((uVar6 != uVar5) || ((long)uVar5 < 0)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        this_00 = *(IOFence **)(pIVar4 + (uVar9 >> 0x20));
        cVar2 = IOFence::tryRetain(this_00);
        if (cVar2 != '\0') {
          (**(code **)(*plVar3 + 0x1b8))(plVar3,this_00);
          (**(code **)(*(long *)this_00 + 0x28))(this_00);
        }
        lVar7 = lVar7 + 1;
        uVar9 = uVar9 + 0x800000000;
      } while (lVar7 < *(int *)(this + 0x28));
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  return plVar3;
}



// IOFenceTransaction::addTransaction(IOFenceTransaction*)

void __thiscall IOFenceTransaction::addTransaction(IOFenceTransaction *this,long param_1)

{
  int iVar1;
  ulong uVar2;
  long *plVar3;
  
  iVar1 = IOSurfaceRoot::deadlockCheckLimit(_gIOSurfaceRoot);
  if (iVar1 != 0) {
    uVar2 = runTransactionDeadlockCheck(this,this,param_1,0);
    if ((char)uVar2 == '\0') {
      _IOLockLock(*(undefined8 *)(this + 0x20));
      plVar3 = *(long **)(this + 0x18);
      if (plVar3 == (long *)0x0) {
        plVar3 = (long *)OSSet::withCapacity(1);
        if (*(long **)(this + 0x18) != (long *)0x0) {
          (**(code **)(**(long **)(this + 0x18) + 0x28))();
        }
        *(long **)(this + 0x18) = plVar3;
      }
      (**(code **)(*plVar3 + 0x1c0))(plVar3,param_1);
      _IOLockUnlock(*(undefined8 *)(this + 0x20));
      return;
    }
  }
  return;
}



// IOFenceTransaction::runTransactionDeadlockCheck(IOFenceTransaction*, IOFenceTransaction*,
// unsigned int)

ulong __thiscall
IOFenceTransaction::runTransactionDeadlockCheck
          (IOFenceTransaction *this,undefined8 param_1,long param_2,uint param_3)

{
  undefined1 uVar1;
  OSSet *pOVar2;
  IOSurface *this_00;
  int iVar3;
  uint uVar4;
  OSSharedPtr *pOVar5;
  long lVar6;
  IOSurfaceRoot *pIVar7;
  int iVar8;
  undefined8 local_80;
  undefined8 *local_78;
  undefined8 local_70;
  undefined1 local_68;
  IOFenceTransaction *local_60;
  long local_58;
  ulong local_50;
  long *local_48;
  undefined8 local_40;
  undefined4 local_34;
  
  local_58 = param_2;
  local_34 = IOSurfaceRoot::debugBits();
  _IOLockLock(*(undefined8 *)(this + 0x20));
  pOVar2 = *(OSSet **)(this + 0x18);
  local_50 = (ulong)param_3;
  local_40 = param_1;
  if (pOVar2 == (OSSet *)0x0) {
    pOVar5 = (OSSharedPtr *)OSSet::withCapacity(0x40);
  }
  else {
    iVar3 = (**(code **)(*(long *)pOVar2 + 0x130))(pOVar2);
    pOVar5 = (OSSharedPtr *)OSSet::withSet(pOVar2,iVar3 + 0x40);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x20));
  local_60 = this;
  local_48 = copy_fences(this);
  iVar3 = (**(code **)(*local_48 + 0x130))();
  if (0 < iVar3) {
    iVar8 = 0;
    do {
      lVar6 = (**(code **)(*local_48 + 0x1e8))(local_48,iVar8);
      this_00 = *(IOSurface **)(lVar6 + 0x10);
      if (pOVar5 != (OSSharedPtr *)0x0) {
        (**(code **)(*(long *)pOVar5 + 0x20))(pOVar5);
      }
      IOSurface::gather_dependent_transactions(this_00,lVar6,pOVar5);
      iVar8 = iVar8 + 1;
    } while (iVar3 != iVar8);
  }
  if (local_58 != 0) {
    (**(code **)(*(long *)pOVar5 + 0x1c0))(pOVar5);
  }
  OSCollection::iterateObjects((_func_bool_OSObject_ptr *)pOVar5);
  local_80 = 0;
  local_70 = 0x2000000000;
  local_68 = 0;
  local_78 = &local_80;
  OSCollection::iterateObjects((_func_bool_OSObject_ptr *)pOVar5);
  if (*(char *)(local_78 + 3) == '\0') {
    iVar3 = (int)local_50;
    pIVar7 = (IOSurfaceRoot *)IOSurfaceRoot::root();
    uVar4 = IOSurfaceRoot::deadlockCheckLimit(pIVar7);
    if (iVar3 + 1U < uVar4) {
      OSCollection::iterateObjects((_func_bool_OSObject_ptr *)pOVar5);
    }
    else if (sDeadlockDetectionLimitReached == '\0') {
      sDeadlockDetectionLimitReached = '\x01';
      pIVar7 = (IOSurfaceRoot *)IOSurfaceRoot::root();
      IOSurfaceRoot::deadlockCheckLimit(pIVar7);
      pIVar7 = (IOSurfaceRoot *)IOSurfaceRoot::root();
      iVar3 = IOSurfaceRoot::deadlockCheckLimit(pIVar7);
      __os_log_internal(0,PTR___os_log_default_00027090,0,
                        "IOSurfaceRoot: deadlock detection depth limit %d reached\n",iVar3);
    }
  }
  uVar1 = *(undefined1 *)(local_78 + 3);
  __Block_object_dispose(&local_80,8);
  (**(code **)(*local_48 + 0x28))();
  if (pOVar5 != (OSSharedPtr *)0x0) {
    (**(code **)(*(long *)pOVar5 + 0x28))(pOVar5);
  }
  return CONCAT71((int7)((ulong)&local_80 >> 8),uVar1) & 0xffffffff;
}



undefined8 ____ZN18IOFenceTransaction27runTransactionDeadlockCheckEPS_S0_j_block_invoke(void)

{
  return 0;
}



undefined8
____ZN18IOFenceTransaction27runTransactionDeadlockCheckEPS_S0_j_block_invoke_2
          (long param_1,long param_2)

{
  int param2;
  undefined8 uVar1;
  long lVar2;
  char local_178 [320];
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  if (*(long *)(param_1 + 0x28) == param_2) {
    *(undefined1 *)(*(long *)(*(long *)(param_1 + 0x20) + 8) + 0x18) = 1;
    uVar1 = _current_task();
    lVar2 = _get_bsdtask_info(uVar1);
    ___bzero(local_178 + 0x40,0x100);
    if (lVar2 == 0) {
      param2 = 0;
    }
    else {
      param2 = _proc_pid(lVar2);
      _proc_selfname(local_178 + 0x40,0x100);
    }
    __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                      "process %s (%d) caught causing IOFence deadlock!\n",local_178 + 0x40,param2);
    _printf("process %s (%d) caught causing IOFence deadlock!\n",local_178 + 0x40,param2);
    if (((lVar2 != 0) && (param2 != 0)) && ((*(byte *)(param_1 + 0x31) & 2) != 0)) {
      uVar1 = _os_reason_create(0x15,2);
      local_178[0x38] = '\0';
      local_178[0x39] = '\0';
      local_178[0x3a] = '\0';
      local_178[0x3b] = '\0';
      local_178[0x3c] = '\0';
      local_178[0x3d] = '\0';
      local_178[0x3e] = '\0';
      local_178[0x3f] = '\0';
      local_178[0x30] = '\0';
      local_178[0x31] = '\0';
      local_178[0x32] = '\0';
      local_178[0x33] = '\0';
      local_178[0x34] = '\0';
      local_178[0x35] = '\0';
      local_178[0x36] = '\0';
      local_178[0x37] = '\0';
      local_178[0x28] = '\0';
      local_178[0x29] = '\0';
      local_178[0x2a] = '\0';
      local_178[0x2b] = '\0';
      local_178[0x2c] = '\0';
      local_178[0x2d] = '\0';
      local_178[0x2e] = '\0';
      local_178[0x2f] = '\0';
      local_178[0x20] = '\0';
      local_178[0x21] = '\0';
      local_178[0x22] = '\0';
      local_178[0x23] = '\0';
      local_178[0x24] = '\0';
      local_178[0x25] = '\0';
      local_178[0x26] = '\0';
      local_178[0x27] = '\0';
      local_178[0x18] = '\0';
      local_178[0x19] = '\0';
      local_178[0x1a] = '\0';
      local_178[0x1b] = '\0';
      local_178[0x1c] = '\0';
      local_178[0x1d] = '\0';
      local_178[0x1e] = '\0';
      local_178[0x1f] = '\0';
      local_178[0x10] = '\0';
      local_178[0x11] = '\0';
      local_178[0x12] = '\0';
      local_178[0x13] = '\0';
      local_178[0x14] = '\0';
      local_178[0x15] = '\0';
      local_178[0x16] = '\0';
      local_178[0x17] = '\0';
      local_178[8] = '\0';
      local_178[9] = '\0';
      local_178[10] = '\0';
      local_178[0xb] = '\0';
      local_178[0xc] = '\0';
      local_178[0xd] = '\0';
      local_178[0xe] = '\0';
      local_178[0xf] = '\0';
      local_178[0] = '\0';
      local_178[1] = '\0';
      local_178[2] = '\0';
      local_178[3] = '\0';
      local_178[4] = '\0';
      local_178[5] = '\0';
      local_178[6] = '\0';
      local_178[7] = '\0';
      _strlcpy(local_178,"Process caught creating IOFence deadlock",0x40);
      _os_reason_set_flags(uVar1,0x82);
      _os_reason_set_description_data(uVar1,2,local_178,0x40);
      _psignal_sigkill_with_reason(lVar2,uVar1);
      __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                        "Killed process %s (%d) for causing IOFence deadlock!\n",local_178 + 0x40,
                        param2);
      _printf("Killed process %s (%d) for causing IOFence deadlock!\n",local_178 + 0x40,param2);
    }
  }
  lVar2 = *(long *)(*(long *)(param_1 + 0x20) + 8);
  if (*(long *)PTR____stack_chk_guard_00027088 == local_38) {
    return CONCAT71((int7)((ulong)lVar2 >> 8),*(undefined1 *)(lVar2 + 0x18));
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



void ___destroy_helper_block_8_32r(long param_1)

{
  __Block_object_dispose(*(void **)(param_1 + 0x20),8);
  return;
}



undefined8
____ZN18IOFenceTransaction27runTransactionDeadlockCheckEPS_S0_j_block_invoke_14
          (long param_1,IOFenceTransaction *param_2)

{
  long lVar1;
  ulong uVar2;
  
  uVar2 = IOFenceTransaction::runTransactionDeadlockCheck
                    (param_2,*(undefined8 *)(param_1 + 0x28),0,*(int *)(param_1 + 0x30) + 1);
  *(char *)(*(long *)(*(long *)(param_1 + 0x20) + 8) + 0x18) = (char)uVar2;
  lVar1 = *(long *)(*(long *)(param_1 + 0x20) + 8);
  return CONCAT71((int7)((ulong)lVar1 >> 8),*(undefined1 *)(lVar1 + 0x18));
}



// IOFenceTransaction::MetaClass::~MetaClass()

void __thiscall IOFenceTransaction::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



void __GLOBAL__sub_I_IOSurfaceFenceTransaction_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOFenceTransaction::gMetaClass,"IOFenceTransaction",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x58);
  IOFenceTransaction::gMetaClass = &PTR__MetaClass_00027de8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOFenceTransaction::gMetaClass);
  return;
}



// IOSurface::MetaClass::MetaClass()

void __thiscall IOSurface::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurface",PTR_gMetaClass_00027048,0x3d0,&IOSurface_zone,
             "iokit.IOSurface",0x2000000);
  *(undefined ***)this = &PTR__MetaClass_000283a8;
  return;
}



// IOSurface::MetaClass::~MetaClass()

void __thiscall IOSurface::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurface::IOSurface(OSMetaClass const*)

void __thiscall IOSurface::IOSurface(IOSurface *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurface_00028270;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x180) = 0;
  *(undefined4 *)(this + 0x188) = 0;
  *(undefined8 *)(this + 0x198) = 0;
  *(undefined8 *)(this + 0x1a0) = 0;
  *(undefined8 *)(this + 0x1a8) = 0;
  *(undefined8 *)(this + 0x1f0) = 0;
  *(undefined8 *)(this + 0x248) = 0;
  *(undefined8 *)(this + 0x2e8) = 0;
  *(undefined4 *)(this + 0x2f0) = 0;
  *(undefined8 *)(this + 0x2f8) = 0;
  *(undefined4 *)(this + 0x300) = 0;
  *(undefined8 *)(this + 0x330) = 0;
  *(undefined4 *)(this + 0x338) = 0;
  *(undefined8 *)(this + 0x358) = 0;
  *(undefined8 *)(this + 0x3c0) = 0;
  return;
}



// IOSurface::IOSurface(OSMetaClass const*)

void __thiscall IOSurface::IOSurface(IOSurface *this,OSMetaClass *param_1)

{
  IOSurface(this,param_1);
  return;
}



// IOSurface::~IOSurface()

void __thiscall IOSurface::~IOSurface(IOSurface *this)

{
  long *plVar1;
  long lVar2;
  
  *(undefined ***)this = &PTR__IOSurface_00028270;
  if (*(long **)(this + 0x3c0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x3c0) + 0x28))();
  }
  *(undefined8 *)(this + 0x3c0) = 0;
  if (*(long **)(this + 0x358) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x358) + 0x28))();
  }
  *(undefined8 *)(this + 0x358) = 0;
  if (*(long **)(this + 0x248) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x248) + 0x28))();
  }
  *(undefined8 *)(this + 0x248) = 0;
  if (*(long **)(this + 0x1f0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1f0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1f0) = 0;
  if (*(long **)(this + 0x1a8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1a8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1a8) = 0;
  lVar2 = 0x1a0;
  do {
    if (*(long **)(this + lVar2) != (long *)0x0) {
      (**(code **)(**(long **)(this + lVar2) + 0x28))();
    }
    *(undefined8 *)(this + lVar2) = 0;
    lVar2 = lVar2 + -8;
  } while (lVar2 != 400);
  plVar1 = *(long **)(this + 0x30);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x50))(plVar1,*(undefined8 *)PTR_metaClass_00027008);
  }
  *(undefined8 *)(this + 0x30) = 0;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurface::~IOSurface()

void __thiscall IOSurface::~IOSurface(IOSurface *this)

{
  long *plVar1;
  long lVar2;
  
  *(undefined ***)this = &PTR__IOSurface_00028270;
  if (*(long **)(this + 0x3c0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x3c0) + 0x28))();
  }
  *(undefined8 *)(this + 0x3c0) = 0;
  if (*(long **)(this + 0x358) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x358) + 0x28))();
  }
  *(undefined8 *)(this + 0x358) = 0;
  if (*(long **)(this + 0x248) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x248) + 0x28))();
  }
  *(undefined8 *)(this + 0x248) = 0;
  if (*(long **)(this + 0x1f0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1f0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1f0) = 0;
  if (*(long **)(this + 0x1a8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1a8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1a8) = 0;
  lVar2 = 0x1a0;
  do {
    if (*(long **)(this + lVar2) != (long *)0x0) {
      (**(code **)(**(long **)(this + lVar2) + 0x28))();
    }
    *(undefined8 *)(this + lVar2) = 0;
    lVar2 = lVar2 + -8;
  } while (lVar2 != 400);
  plVar1 = *(long **)(this + 0x30);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x50))(plVar1,*(undefined8 *)PTR_metaClass_00027008);
  }
  *(undefined8 *)(this + 0x30) = 0;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurface::~IOSurface()

void __thiscall IOSurface::~IOSurface(IOSurface *this)

{
  ~IOSurface(this);
  operator_delete(this,0x3d0);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::operator delete(void*, unsigned long)

void __cdecl IOSurface::operator_delete(void *param_1,ulong param_2)

{
  if (IOSurface_zone != 0) {
    _kern_os_zfree();
    return;
  }
  OSObject::operator_delete(param_1,param_2);
  return;
}



// IOSurface::getMetaClass() const

undefined8 * IOSurface::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurface::MetaClass::MetaClass()

void __thiscall IOSurface::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurface",PTR_gMetaClass_00027048,0x3d0,&IOSurface_zone,
             "iokit.IOSurface",0x2000000);
  *(undefined ***)this = &PTR__MetaClass_000283a8;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::MetaClass::alloc() const

IOSurface * __cdecl IOSurface::MetaClass::alloc(undefined8 param_1,ulong param_2)

{
  IOSurface *this;
  
  this = IOSurface::operator_new((IOSurface *)&section_000003d0,param_2);
  IOSurface(this);
  return this;
}



// IOSurface::operator new(unsigned long)

void * __thiscall IOSurface::operator_new(IOSurface *this,ulong param_1)

{
  void *pvVar1;
  
  if (IOSurface_zone != 0) {
    pvVar1 = (void *)_zalloc_flags(IOSurface_zone,4);
    return pvVar1;
  }
  pvVar1 = OSObject::operator_new((OSObject *)this,param_1);
  return pvVar1;
}



// IOSurface::IOSurface()

void __thiscall IOSurface::IOSurface(IOSurface *this)

{
  IOSurface(this);
  return;
}



// IOSurface::IOSurface()

void __thiscall IOSurface::IOSurface(IOSurface *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurface_00028270;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x180) = 0;
  *(undefined4 *)(this + 0x188) = 0;
  *(undefined8 *)(this + 0x198) = 0;
  *(undefined8 *)(this + 0x1a0) = 0;
  *(undefined8 *)(this + 0x1a8) = 0;
  *(undefined8 *)(this + 0x1f0) = 0;
  *(undefined8 *)(this + 0x248) = 0;
  *(undefined8 *)(this + 0x2e8) = 0;
  *(undefined4 *)(this + 0x2f0) = 0;
  *(undefined8 *)(this + 0x2f8) = 0;
  *(undefined4 *)(this + 0x300) = 0;
  *(undefined8 *)(this + 0x330) = 0;
  *(undefined4 *)(this + 0x338) = 0;
  *(undefined8 *)(this + 0x358) = 0;
  *(undefined8 *)(this + 0x3c0) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurface::init(IOSurfaceRoot*, task*, OSDictionary*)

void __thiscall IOSurface::init(IOSurface *this,undefined8 param_1,long param_2,long *param_3)

{
  init(this,param_1,param_2,param_3,(long *)0x0);
  return;
}



// IOSurface::init(IOSurfaceRoot*, task*, OSDictionary*, IOSurface*)

bool __thiscall
IOSurface::init(IOSurface *this,undefined8 param_2_00,long param_2,long *param_3,long *param_4)

{
  long *plVar1;
  int iVar2;
  long lVar3;
  ulong uVar4;
  OSMetaClassBase *pOVar5;
  undefined8 uVar6;
  undefined8 *puVar7;
  bool bVar8;
  uintptr_t local_48;
  undefined1 *local_40;
  undefined1 *local_38;
  
  _iosfc_ref_init_count_internal((uint *)(this + 0xc),1);
  lVar3 = IOSurfaceRoot::getNextGlobalTraceID();
  *(long *)(this + 0x360) = lVar3;
  if (param_4 != (long *)0x0) {
    if (param_4[0x6b] != 0) {
      return false;
    }
    plVar1 = *(long **)(this + 0x358);
    *(long **)(this + 0x358) = param_4;
    (**(code **)(*param_4 + 0x20))(param_4);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  uVar4 = IOSurfaceRoot::alloc_surfaceid(_gIOSurfaceRoot,(undefined4 *)(this + 0x10));
  if ((char)uVar4 == '\0') {
    return false;
  }
  pOVar5 = (OSMetaClassBase *)
           (**(code **)(*param_3 + 0x208))(param_3,"IOSurfacePixelSizeCastingAllowed");
  lVar3 = OSMetaClassBase::safeMetaCast(pOVar5,*(OSMetaClass **)PTR_metaClass_00027068);
  if (lVar3 == 0) {
    puVar7 = (undefined8 *)PTR__kOSBooleanFalse_000270a0;
    if (((byte)_gIOSurfaceRoot[0x1b4] & 2) == 0) {
      puVar7 = (undefined8 *)PTR__kOSBooleanTrue_000270a8;
    }
    (**(code **)(*param_3 + 0x1d0))
              (param_3,"IOSurfacePixelSizeCastingAllowed",*(undefined8 *)*puVar7);
  }
  plVar1 = *(long **)(this + 0x248);
  *(long **)(this + 0x248) = param_3;
  (**(code **)(*param_3 + 0x20))(param_3);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  if (param_2 != 0) {
    *(long *)(this + 0x170) = param_2;
  }
  *(undefined8 *)(this + 0x78) = 0;
  *(undefined8 *)(this + 0x98) = 0;
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffffef33;
  *(undefined4 *)(this + 400) = 0;
  if (*(long **)(this + 0x1a8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1a8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1a8) = 0;
  if (*(long **)(this + 0x1f0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1f0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1f0) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  *(IOSurface **)(this + 0x48) = this + 0x40;
  *(undefined8 *)(this + 0x2d0) = 0;
  *(IOSurface **)(this + 0x2d8) = this + 0x2d0;
  *(undefined8 *)(this + 0x38) = 0;
  *(undefined4 *)(this + 0x70) = 0x1010001;
  *(undefined8 *)(this + 0x1f8) = 0;
  *(undefined8 *)(this + 0x150) = 0;
  *(undefined4 *)(this + 0x348) = 3;
  *(undefined4 *)(this + 0x20c) = 0;
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffedb3fd;
  lVar3 = _IOLockAlloc();
  *(long *)(this + 0x50) = lVar3;
  if (lVar3 == 0) {
    return false;
  }
  lVar3 = _IOLockAlloc();
  *(long *)(this + 0x398) = lVar3;
  if (lVar3 == 0) {
    return false;
  }
  *(uint *)(this + 0xa0) = *(uint *)(this + 0x10);
  *(undefined8 *)(this + 0x178) = 0;
  *(undefined8 *)(this + 0x2e0) = 0;
  *(undefined4 *)(this + 0x200) = 0;
  *(undefined8 *)(this + 0x220) = 0;
  *(IOSurface **)(this + 0x228) = this + 0x220;
  *(undefined8 *)(this + 0x230) = 0;
  *(IOSurface **)(this + 0x238) = this + 0x230;
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffff5fff | 0x8000;
  *(undefined4 *)(this + 0x208) = 2;
  local_40 = &DAT_aaaaaaaaaaaaaaaa;
  local_38 = &DAT_aaaaaaaaaaaaaaaa;
  uVar4 = IOSurfaceRoot::alloc_surface_shared
                    (_gIOSurfaceRoot,*(uint *)(this + 0x10),(long *)&local_40,(long *)&local_38);
  if ((char)uVar4 == '\0') {
    return false;
  }
  *(undefined1 **)(this + 0x178) = local_40;
  *(undefined1 **)(this + 0x2e0) = local_38;
  this[0x3ca] = (IOSurface)((byte)this[0x3ca] | 1);
  local_40[0x2c] = 1;
  uVar4 = parse_properties(this,param_3);
  if ((char)uVar4 == '\0') {
    return false;
  }
  if (*(long *)(this + 0x170) == 0) {
    lVar3 = *(long *)PTR__page_size_000270c0;
  }
  else {
    uVar6 = _get_task_map();
    iVar2 = _vm_map_page_size(uVar6);
    lVar3 = (long)iVar2;
    if (*(long *)PTR__page_size_000270c0 != lVar3) {
      uVar4 = *(ulong *)(this + 0x90);
      *(undefined8 *)(this + 0x158) = *(undefined8 *)(this + 0x150);
      *(undefined8 *)(this + 0x168) = 0;
      goto LAB_00004179;
    }
  }
  uVar4 = lVar3 - 1U & *(ulong *)(this + 0x150);
  *(ulong *)(this + 0x158) = *(ulong *)(this + 0x150) & -lVar3;
  *(ulong *)(this + 0x168) = uVar4;
  uVar4 = lVar3 + uVar4 + -1 + *(long *)(this + 0x90) & -lVar3;
LAB_00004179:
  *(ulong *)(this + 0x160) = uVar4;
  uVar6 = allocate(this);
  bVar8 = (int)uVar6 == 0;
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffffeff | (uint)bVar8 << 8;
  local_48 = 0;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_48);
  _kernel_debug(0x85210018,local_48,(ulong)*(uint *)(this + 0x10),(ulong)*(uint *)(this + 0x80),
                *(long *)(this + 0x60) << 0x20 | *(ulong *)(this + 0x58),0);
  return bVar8;
}



// IOSurface::parse_properties(OSDictionary*)

ulong __thiscall IOSurface::parse_properties(IOSurface *this,long *param_1)

{
  OSMetaClass *pOVar1;
  uint *puVar2;
  OSMetaClass *pOVar3;
  OSMetaClass *pOVar4;
  IOSurface *pIVar5;
  ulong *puVar6;
  uint *puVar7;
  OSMetaClass OVar8;
  IOSurface IVar9;
  ushort uVar10;
  OSMetaClass *pOVar11;
  undefined8 *puVar12;
  undefined1 auVar13 [16];
  undefined1 auVar14 [16];
  undefined1 auVar15 [16];
  undefined1 auVar16 [16];
  undefined1 auVar17 [16];
  undefined1 auVar18 [16];
  undefined1 auVar19 [16];
  undefined1 auVar20 [16];
  undefined1 auVar21 [16];
  undefined1 auVar22 [16];
  undefined1 auVar23 [16];
  undefined1 auVar24 [16];
  undefined1 auVar25 [16];
  undefined1 auVar26 [16];
  undefined1 auVar27 [16];
  undefined1 auVar28 [16];
  undefined1 auVar29 [16];
  undefined1 auVar30 [16];
  bool bVar31;
  bool bVar32;
  uint uVar33;
  uint uVar34;
  ulong uVar35;
  long *plVar36;
  long lVar37;
  byte *pbVar38;
  undefined4 *puVar39;
  ulong uVar40;
  OSMetaClassBase *pOVar41;
  long *plVar42;
  undefined1 *puVar43;
  void *pvVar44;
  void *pvVar45;
  ulong uVar46;
  int iVar47;
  ulong uVar48;
  ulong uVar49;
  ulong extraout_RDX;
  size_t sVar50;
  uint uVar51;
  ulong uVar52;
  OSMetaClass *pOVar53;
  char *pcVar54;
  long lVar55;
  undefined1 *puVar56;
  ulong uVar57;
  ulong uVar58;
  uint *puVar59;
  OSMetaClass *pOVar60;
  IOSurface *pIVar61;
  undefined1 *puVar62;
  IOSurface *pIVar63;
  bool bVar64;
  undefined1 auVar65 [16];
  uint local_98;
  byte local_69;
  OSMetaClass *local_68;
  long *local_60;
  undefined1 *local_58;
  OSMetaClass *local_50;
  undefined1 *local_48;
  undefined1 *local_40;
  byte local_31;
  
  local_40 = &DAT_aaaaaaaaaaaaaaaa;
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar31 = getBoolPropertyInternal(param_1,"IOSurfaceDisableMapperFlush",(undefined1 *)&local_58);
  if (bVar31) {
    *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xff7fffff | (uint)(byte)local_58 << 0x17;
  }
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar31 = getBoolPropertyInternal(param_1,"IOSurfaceCoreSurfaceLegacy",(undefined1 *)&local_58);
  bVar64 = (byte)local_58 != '\0';
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfacePreallocPages",(undefined1 *)&local_58);
  if (bVar32) {
    *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffff7ff | (uint)(byte)local_58 << 0xb;
  }
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfacePrefetchPages",(undefined1 *)&local_58);
  if (bVar32) {
    *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffffbfff | (uint)(byte)local_58 << 0xe;
  }
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceHostOnly",(undefined1 *)&local_58);
  if (bVar32) {
    uVar33 = *(uint *)(this + 0x3c8) & 0xfeffffff | (uint)(byte)local_58 << 0x18;
    *(uint *)(this + 0x3c8) = uVar33;
  }
  else {
    uVar33 = *(uint *)(this + 0x3c8);
  }
  pIVar61 = this + 0x3c8;
  if ((uVar33 >> 0xe & 1) != 0) {
    *(uint *)pIVar61 = uVar33 & 0xfffff7ff;
  }
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceUseReserve",(undefined1 *)&local_58);
  if (bVar32) {
    *(uint *)pIVar61 = *(uint *)pIVar61 & 0xfffdffff | (uint)(byte)local_58 << 0x11;
  }
  local_69 = 0;
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceNonPurgeable",&local_69);
  if (bVar32) {
    *(uint *)pIVar61 = *(uint *)pIVar61 & 0xffff7fff | (local_69 ^ 1) << 0xf;
  }
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IsDisplayable",(undefined1 *)&local_58);
  if (bVar32) {
    uVar33 = *(uint *)pIVar61 & 0xffefffff | (uint)(byte)local_58 << 0x14;
    *(uint *)pIVar61 = uVar33;
  }
  else {
    uVar33 = *(uint *)pIVar61;
  }
  *(byte *)(*(long *)(this + 0x178) + 0x2d) = (byte)(uVar33 >> 0x14) & 1;
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceSysMemOnly",(undefined1 *)&local_58);
  if (bVar32) {
    uVar33 = *(uint *)pIVar61 & 0xfffbffff | (uint)(byte)local_58 << 0x12;
    *(uint *)pIVar61 = uVar33;
  }
  else {
    uVar33 = *(uint *)pIVar61;
  }
  *(byte *)(*(long *)(this + 0x178) + 0x2e) = (byte)(uVar33 >> 0x12) & 1;
  uVar35 = getUInt32MaxOptionalProperty(param_1,"IOSurfaceSubsampling",(undefined4 *)(this + 0x3b0))
  ;
  if ((char)uVar35 == '\0') goto LAB_000066d1;
  local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
  bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceProhibitUseCount",(undefined1 *)&local_58);
  if (bVar32) {
    *(uint *)pIVar61 = *(uint *)pIVar61 & 0xffdfffff | (uint)(byte)local_58 << 0x15;
  }
  *(undefined8 *)(this + 0x2e8) = 0;
  *(undefined4 *)(this + 0x2f0) = 0;
  *(undefined4 *)(this + 0x3bc) = 0;
  plVar36 = (long *)getArrayProperty(param_1);
  if (plVar36 != (long *)0x0) {
    uVar33 = (**(code **)(*plVar36 + 0x130))(plVar36);
    *(uint *)(this + 0x98) = uVar33;
    if (uVar33 != 0) {
      *(ulong *)(this + 0x308) = (ulong)uVar33;
      lVar37 = _IOMallocZeroData((ulong)uVar33 * 0x18);
      if (*(ulong *)(this + 0x308) >> 0x20 != 0) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  ("bounded_array_ref: Can\'t construct from a size greater than UINT32_MAX");
      }
      *(long *)(this + 0x2f8) = lVar37;
      *(int *)(this + 0x300) = (int)*(ulong *)(this + 0x308);
      if (lVar37 != 0) {
        *(ulong *)(this + 0x328) = (ulong)*(uint *)(this + 0x98) << 5;
        lVar37 = _IOMallocZeroData();
        uVar33 = *(uint *)(this + 0x98);
        *(long *)(this + 0x330) = lVar37;
        *(uint *)(this + 0x338) = uVar33;
        if (lVar37 != 0) {
          if (uVar33 < 4) {
            *(IOSurface **)(this + 0x180) = this + 0xa8;
            *(uint *)(this + 0x188) = uVar33;
          }
          else {
            if (0x14 < uVar33) {
              pcVar54 = "IOSurface: maximum plane count of %d exceeded.\n";
              puVar43 = (undefined1 *)0x14;
LAB_000066af:
              uVar35 = 0;
              _IOLog(pcVar54,puVar43);
              goto LAB_000066d4;
            }
            lVar37 = _IOMallocTypeVarImpl(&parse_properties(OSDictionary*)::kalloc_type_view_992);
            uVar33 = *(uint *)(this + 0x98);
            *(long *)(this + 0x180) = lVar37;
            *(uint *)(this + 0x188) = uVar33;
            if (lVar37 == 0) goto LAB_000066d1;
          }
          if (uVar33 != 0) {
            pOVar11 = *(OSMetaClass **)PTR_metaClass_00027010;
            uVar33 = 0;
LAB_000046ec:
            local_50 = *(OSMetaClass **)(this + 0x180);
            uVar35 = (long)(local_50 + (ulong)*(uint *)(this + 0x188) * 0x38) - (long)local_50;
            if ((local_50 + (ulong)*(uint *)(this + 0x188) * 0x38 < local_50) ||
               (uVar35 >> 0x20 != 0)) goto LAB_00006cdd;
            puVar43 = (undefined1 *)(ulong)uVar33;
            if ((long)puVar43 * 0x38 - 0x80000000U < 0xffffffff00000000) goto LAB_00006ce9;
            uVar46 = (long)puVar43 * 0x3800000000;
            if (((long)uVar46 < 0) || ((uint)uVar35 < (int)(uVar46 >> 0x20) + 0x38U))
            goto LAB_00006cd1;
            pOVar53 = local_50 + (uVar46 >> 0x20);
            uVar46 = (ulong)CARRY8((ulong)local_50,uVar46 >> 0x20);
            uVar35 = -uVar46;
            local_50 = pOVar53;
            if ((uVar46 != uVar35) || ((long)uVar35 < 0)) goto LAB_00006cf5;
            uVar35 = *(ulong *)(this + 0x330);
            uVar46 = (ulong)*(uint *)(this + 0x338) * 0x20 + uVar35;
            uVar40 = uVar46 - uVar35;
            if ((uVar46 < uVar35) || (uVar40 >> 0x20 != 0)) goto LAB_00006cdd;
            if ((long)puVar43 * 0x20 - 0x80000000U < 0xffffffff00000000) goto LAB_00006ce9;
            uVar46 = (long)puVar43 << 0x25;
            if (((long)uVar46 < 0) || ((uint)uVar40 < (int)(uVar46 >> 0x20) + 0x20U))
            goto LAB_00006cd1;
            puVar7 = (uint *)(uVar35 + (uVar46 >> 0x20));
            uVar46 = (ulong)CARRY8(uVar35,uVar46 >> 0x20);
            uVar35 = -uVar46;
            if ((uVar46 != uVar35) || ((long)uVar35 < 0)) goto LAB_00006cf5;
            uVar35 = 0;
            *(undefined1 **)(pOVar53 + 0x30) = (undefined1 *)0x0;
            *(undefined1 **)(pOVar53 + 0x28) = (undefined1 *)0x0;
            *(undefined1 **)(pOVar53 + 0x20) = (undefined1 *)0x0;
            *(undefined1 **)(pOVar53 + 0x18) = (undefined1 *)0x0;
            *(undefined1 **)(pOVar53 + 0x10) = (undefined1 *)0x0;
            *(undefined1 **)(pOVar53 + 8) = (undefined1 *)0x0;
            *(undefined1 **)pOVar53 = (undefined1 *)0x0;
            local_48 = puVar43;
            pOVar41 = (OSMetaClassBase *)(**(code **)(*plVar36 + 0x1e8))();
            plVar42 = (long *)OSMetaClassBase::safeMetaCast(pOVar41,pOVar11);
            if (plVar42 == (long *)0x0) goto LAB_000066d4;
            bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneWidth",(undefined8 *)pOVar53);
            if (!bVar32) goto LAB_000066d1;
            pOVar1 = local_50 + 8;
            bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneHeight",(undefined8 *)pOVar1);
            if (!bVar32) goto LAB_000066d1;
            puVar2 = puVar7 + 2;
            uVar35 = getUInt32MaxOptionalProperty
                               (plVar42,"IOSurfacePlaneExtendedPixelsOnLeft",puVar2);
            if (((char)uVar35 == '\0') ||
               (uVar35 = getUInt32MaxOptionalProperty
                                   (plVar42,"IOSurfacePlaneExtendedPixelsOnRight",puVar7),
               (char)uVar35 == '\0')) goto LAB_000066d1;
            uVar35 = getUInt32MaxOptionalProperty
                               (plVar42,"IOSurfacePlaneExtendedPixelsOnTop",puVar7 + 3);
            if ((char)uVar35 == '\0') goto LAB_000066d1;
            puVar59 = puVar7 + 1;
            uVar35 = getUInt32MaxOptionalProperty
                               (plVar42,"IOSurfacePlaneExtendedPixelsOnBottom",puVar59);
            if ((char)uVar35 == '\0') goto LAB_000066d1;
            local_68 = pOVar53;
            bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneBytesPerElement",&local_40);
            local_60 = plVar42;
            if (bVar32) {
              if ((undefined1 *)0x1fff < local_40) {
                pcVar54 = "IOSurface: kIOSurfacePlaneBytesPerElement out of range\n";
                goto LAB_0000467f;
              }
              *(short *)(local_68 + 0x30) = (short)local_40;
              puVar43 = local_40;
              puVar56 = (undefined1 *)(((ulong)local_40 & 0xffff) << 3);
LAB_000049de:
              if ((short)puVar43 == 0) {
                pcVar54 = "IOSurface: plane[%d] bytes per element is zero.\n";
                puVar43 = local_48;
                goto LAB_000066af;
              }
            }
            else {
              bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneBitsPerElement",&local_40);
              if (bVar32) {
                if (local_40 < (undefined1 *)0x10000) {
LAB_000049d8:
                  puVar43 = (undefined1 *)(((ulong)local_40 & 0xffff) >> 3);
                  *(short *)(local_68 + 0x30) = (short)puVar43;
                  puVar56 = local_40;
                  goto LAB_000049de;
                }
                pcVar54 = "IOSurface: kIOSurfacePlaneBitsPerElement out of range\n";
                goto LAB_0000467f;
              }
              bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneBitsPerBlock",&local_40);
              if (bVar32) {
                if (local_40 < (undefined1 *)0x10000) goto LAB_000049d8;
                pcVar54 = "IOSurface: kIOSurfacePlaneBitsPerBlock out of range\n";
                goto LAB_0000467f;
              }
              *(undefined2 *)(local_68 + 0x30) = 1;
              puVar56 = (undefined1 *)0x8;
            }
            pOVar60 = local_68;
            pOVar53 = local_50 + 0x34;
            local_68[0x34] = (OSMetaClass)0x1;
            uVar35 = getUInt8MaxOptionalProperty(local_60,"IOSurfacePlaneElementWidth",pOVar53);
            if ((char)uVar35 == '\0') goto LAB_000066d1;
            if (*pOVar53 == (OSMetaClass)0x0) {
              pcVar54 = "IOSurface: plane[%d] element width is zero.\n";
              puVar43 = local_48;
              goto LAB_000066af;
            }
            pOVar3 = local_50 + 0x35;
            pOVar60[0x35] = (OSMetaClass)0x1;
            uVar35 = getUInt8MaxOptionalProperty(local_60,"IOSurfacePlaneElementHeight",pOVar3);
            if ((char)uVar35 == '\0') goto LAB_000066d1;
            if (*pOVar3 == (OSMetaClass)0x0) {
              pcVar54 = "IOSurface: plane[%d] element height is zero.\n";
              puVar43 = local_48;
              goto LAB_000066af;
            }
            pOVar4 = local_50 + 0x36;
            pOVar60[0x36] = (OSMetaClass)0x0;
            uVar35 = getUInt8MaxOptionalProperty(local_60,"IOSurfaceAddressFormat",pOVar4);
            if ((char)uVar35 == '\0') goto LAB_000066d1;
            puVar43 = *(undefined1 **)pOVar60 + *puVar7;
            uVar35 = (ulong)(byte)pOVar60[0x34];
            iVar47 = (byte)pOVar60[0x34] - 1;
            uVar46 = (ulong)iVar47;
            lVar55 = ((long)uVar46 >> 0x3f) + (ulong)CARRY8((ulong)puVar43,uVar46);
            lVar37 = -(ulong)((uint)lVar55 & 1);
            if (((CARRY8((ulong)*puVar7,(ulong)*(undefined1 **)pOVar60)) || (lVar55 != lVar37)) ||
               (lVar37 < 0)) {
              pcVar54 = "IOSurface: plane[%d] extended width exceeds 64bit limit\n";
              puVar43 = local_48;
              goto LAB_000066af;
            }
            uVar40 = (ulong)(puVar43 + uVar46) / uVar35;
            uVar33 = *puVar2;
            if ((long)-(ulong)((iVar47 >> 0x1f) + (uint)CARRY8((ulong)uVar33,uVar46) & 1) < 0) {
              _IOLog("IOSurface: plane[%d] extended left exceeds 64bit limit\n",local_48);
              uVar35 = (ulong)(byte)*pOVar53;
            }
            uVar35 = (uVar33 + uVar46) / uVar35;
            bVar32 = getUInt64Property(local_60,"IOSurfacePlaneBytesPerRow",&local_40);
            puVar43 = local_48;
            if (bVar32) {
              *(undefined1 **)(local_68 + 0x20) = local_40;
              uVar48 = (ulong)*(ushort *)(local_68 + 0x30);
              puVar62 = local_40;
            }
            else {
              auVar65._8_8_ = 0;
              auVar65._0_8_ = uVar40;
              if (SUB168(auVar65 * ZEXT116((byte)*pOVar53),8) != 0) {
                pcVar54 = "IOSurface: plane[%d] calculated width in pixels exceeds 64bit limit\n";
                goto LAB_000066af;
              }
              if (CARRY8(uVar40,uVar35)) {
                pcVar54 = "IOSurface: plane[%d] total width in elements exceeds 64bit limit\n";
                goto LAB_000066af;
              }
              uVar48 = CONCAT62(0,*(ushort *)(local_68 + 0x30));
              auVar13._8_8_ = 0;
              auVar13._0_8_ = uVar40 + uVar35;
              auVar24._8_8_ = 0;
              auVar24._0_8_ = uVar48;
              uVar46 = SUB168(auVar13 * auVar24,0);
              if (SUB168(auVar13 * auVar24,8) != 0) {
                pcVar54 = "IOSurface: plane[%d] bytesPerRow exceeds 64bit limit\n";
                goto LAB_000066af;
              }
              uVar49 = (ulong)*(uint *)(_gIOSurfaceRoot + 0xb0);
              if (CARRY8(uVar46,uVar49)) {
                pcVar54 = "IOSurface: plane[%d] calculated bytesPerRow exceeds 64bit limit\n";
                goto LAB_000066af;
              }
              puVar62 = (undefined1 *)(uVar46 + uVar49 & ~uVar49);
              *(undefined1 **)(local_68 + 0x20) = puVar62;
            }
            auVar14._8_8_ = 0;
            auVar14._0_8_ = uVar40;
            auVar25._8_8_ = 0;
            auVar25._0_8_ = uVar48;
            uVar46 = SUB168(auVar14 * auVar25,0);
            if (SUB168(auVar14 * auVar25,8) != 0) {
              pcVar54 = "IOSurface: plane[%d] plane width in bytes exceeds 64bit limit\n";
              goto LAB_000066af;
            }
            auVar15._8_8_ = 0;
            auVar15._0_8_ = uVar35;
            auVar26._8_8_ = 0;
            auVar26._0_8_ = uVar48;
            uVar35 = SUB168(auVar15 * auVar26,0);
            if (SUB168(auVar15 * auVar26,8) != 0) {
              pcVar54 = 
              "IOSurface: plane[%d] minimum extended left bytes per row value exceeds 64bit limit\n"
              ;
              goto LAB_000066af;
            }
            if (CARRY8(uVar46,uVar35)) {
              pcVar54 = "IOSurface: plane[%d] minimum bytes per row value exceeds 64bit limit\n";
              goto LAB_000066af;
            }
            if (puVar62 < (undefined1 *)(uVar46 + uVar35)) {
              pcVar54 = "IOSurface: plane[%d] bytes per row value of %llu is too small\n";
LAB_00005ee8:
              uVar35 = 0;
              _IOLog(pcVar54,puVar43,puVar62);
              goto LAB_000066d4;
            }
            puVar62 = *(undefined1 **)pOVar1 + *puVar59;
            uVar35 = (ulong)(int)((byte)*pOVar3 - 1);
            lVar55 = ((long)uVar35 >> 0x3f) + (ulong)CARRY8(uVar35,(ulong)puVar62);
            lVar37 = -(ulong)((uint)lVar55 & 1);
            if (((CARRY8((ulong)*puVar59,(ulong)*(undefined1 **)pOVar1)) || (lVar55 != lVar37)) ||
               (lVar37 < 0)) {
              pcVar54 = "IOSurface: plane[%d] extended height exceeds 64bit limit\n";
              goto LAB_000066af;
            }
            uVar35 = (ulong)(puVar62 + uVar35) / (ulong)(byte)*pOVar3;
            bVar32 = getUInt64Property(local_60,"IOSurfacePlaneSize",&local_40);
            puVar43 = local_48;
            pOVar53 = local_68;
            puVar62 = local_40;
            if ((bVar32) ||
               (auVar16._8_8_ = 0, auVar16._0_8_ = uVar35, auVar27._8_8_ = 0,
               auVar27._0_8_ = *(undefined1 **)(local_68 + 0x20),
               puVar62 = SUB168(auVar16 * auVar27,0), SUB168(auVar16 * auVar27,8) == 0)) {
              *(undefined1 **)(local_68 + 0x28) = puVar62;
              if (puVar62 == (undefined1 *)0x0) {
                pcVar54 = "IOSurface: plane[%d] size is zero\n";
                goto LAB_000065f8;
              }
              bVar32 = getUInt64Property(local_60,"IOSurfacePlaneOffset",&local_40);
              puVar62 = local_40;
              if (!bVar32) {
                if (puVar43 == (undefined1 *)0x0) {
                  puVar62 = (undefined1 *)0x0;
                }
                else {
                  uVar46 = *(ulong *)(this + 0x180);
                  uVar48 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar46;
                  uVar49 = uVar48 - uVar46;
                  if ((uVar48 < uVar46) || (uVar49 >> 0x20 != 0)) goto LAB_00006cdd;
                  uVar48 = (ulong)((int)puVar43 - 1);
                  if (uVar48 * 0x38 - 0x80000000 < 0xffffffff00000000) goto LAB_00006ce9;
                  uVar48 = uVar48 * 0x3800000000;
                  if (((long)uVar48 < 0) || ((uint)uVar49 < (int)(uVar48 >> 0x20) + 0x38U))
                  goto LAB_00006cd1;
                  lVar37 = uVar46 + (uVar48 >> 0x20);
                  uVar48 = (ulong)CARRY8(uVar46,uVar48 >> 0x20);
                  uVar46 = -uVar48;
                  if ((uVar48 != uVar46) || ((long)uVar46 < 0)) goto LAB_00006cf5;
                  uVar48 = *(ulong *)(lVar37 + 0x10);
                  uVar49 = *(ulong *)(lVar37 + 0x28);
                  uVar46 = uVar48 + uVar49;
                  uVar33 = *(uint *)(_gIOSurfaceRoot + 0xac);
                  if ((CARRY8(uVar48,uVar49)) || (CARRY8(uVar46,(ulong)uVar33))) {
                    pcVar54 = "IOSurface: plane[%d] calculated offset value exceeds 64bit limit\n";
                    goto LAB_000065f8;
                  }
                  puVar62 = (undefined1 *)(ulong)((int)uVar46 + uVar33 & ~uVar33);
                }
              }
              pOVar60 = local_50 + 0x18;
              *(undefined1 **)(pOVar53 + 0x18) = puVar62;
              bVar32 = getUInt64Property(local_60,"IOSurfacePlaneBase",(undefined8 *)&local_40);
              puVar43 = local_48;
              plVar42 = local_60;
              pOVar53 = pOVar60;
              if (bVar32) {
                pOVar53 = (OSMetaClass *)&local_40;
              }
              puVar62 = *(undefined1 **)pOVar53;
              *(undefined1 **)(local_68 + 0x10) = puVar62;
              local_50 = pOVar60;
              if ((*(long *)(this + 0x358) == 0) && ((int)local_48 != 0)) {
                uVar46 = *(ulong *)(this + 0x180);
                uVar48 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar46;
                uVar49 = uVar48 - uVar46;
                if ((uVar48 < uVar46) || (uVar49 >> 0x20 != 0)) goto LAB_00006cdd;
                uVar48 = 0xffffffff7fffffc8;
                uVar52 = 0;
                iVar47 = 0;
                do {
                  uVar48 = uVar48 + 0x38;
                  if (uVar48 < 0xffffffff00000000) goto LAB_00006ce9;
                  if (((long)uVar52 < 0) || ((uint)uVar49 < (int)(uVar52 >> 0x20) + 0x38U))
                  goto LAB_00006cd1;
                  lVar37 = (uVar52 >> 0x20) + uVar46;
                  uVar58 = (ulong)CARRY8(uVar52 >> 0x20,uVar46);
                  uVar57 = -uVar58;
                  if ((uVar58 != uVar57) || ((long)uVar57 < 0)) goto LAB_00006cf5;
                  if (puVar62 < (undefined1 *)(*(long *)(lVar37 + 0x28) + *(long *)(lVar37 + 0x10)))
                  {
                    uVar35 = 0;
                    _IOLog("IOSurface: plane[%d] base %016llx overlaps with previous plane %d\n",
                           (ulong)local_48 & 0xffffffff,*(undefined1 **)pOVar60);
                    goto LAB_000066d4;
                  }
                  uVar52 = uVar52 + 0x3800000000;
                  iVar47 = iVar47 + 1;
                } while ((int)local_48 != iVar47);
              }
              if (*(undefined1 **)pOVar60 < puVar62) {
                uVar35 = 0;
                _IOLog("IOSurface: plane[%d] offset %016llx is less than plane[%d] base %016llx\n",
                       (ulong)local_48 & 0xffffffff,*(undefined1 **)pOVar60,
                       (ulong)local_48 & 0xffffffff);
                goto LAB_000066d4;
              }
              if (CARRY8((ulong)*(undefined1 **)(local_68 + 0x28),(ulong)puVar62)) {
                uVar35 = 0;
                _IOLog("IOSurface: plane[%d] base %016llx plus plane size %016llx exceeds 64bit limit\n"
                       ,(ulong)local_48 & 0xffffffff,puVar62,puVar62);
                goto LAB_000066d4;
              }
              auVar17._8_8_ = 0;
              auVar17._0_8_ = uVar35 - 1;
              auVar28._8_8_ = 0;
              auVar28._0_8_ = *(undefined1 **)(local_68 + 0x20);
              uVar35 = SUB168(auVar17 * auVar28,0);
              if (SUB168(auVar17 * auVar28,8) != 0) {
                pcVar54 = "IOSurface: plane[%d] required size exceeds 64bit limit\n";
                goto LAB_000065f8;
              }
              auVar18._8_8_ = 0;
              auVar18._0_8_ = uVar40;
              uVar46 = SUB168(auVar18 * ZEXT216(*(ushort *)(local_68 + 0x30)),0);
              if (SUB168(auVar18 * ZEXT216(*(ushort *)(local_68 + 0x30)),8) != 0) {
                pcVar54 = "IOSurface: plane[%d] required size for one line exceeds 64bit limit\n";
                goto LAB_000065f8;
              }
              if (CARRY8(uVar35,uVar46)) {
                pcVar54 = "IOSurface: plane[%d] total required size exceeds 64bit limit\n";
                goto LAB_000065f8;
              }
              uVar48 = *(ulong *)(this + 0x2f8);
              uVar40 = uVar48 + (ulong)*(uint *)(this + 0x300) * 0x18;
              uVar49 = uVar40 - uVar48;
              if ((uVar40 < uVar48) || (uVar49 >> 0x20 != 0)) goto LAB_00006cdd;
              if ((long)local_48 * 0x18 - 0x80000000U < 0xffffffff00000000) goto LAB_00006ce9;
              uVar40 = ((long)local_48 << 0x23) * 3;
              if (((long)uVar40 < 0) || ((uint)uVar49 < (int)(uVar40 >> 0x20) + 0x18U))
              goto LAB_00006cd1;
              uVar52 = (ulong)CARRY8(uVar48,uVar40 >> 0x20);
              uVar49 = -uVar52;
              if ((uVar52 != uVar49) || ((long)uVar49 < 0)) goto LAB_00006cf5;
              uVar40 = parseAdditionalPlaneInfo((byte *)(uVar48 + (uVar40 >> 0x20)),local_60);
              if ((char)uVar40 == '\0') {
                pcVar54 = "IOSurface: plane[%d] parseAdditionalPlaneInfo failed.\n";
                goto LAB_000065f8;
              }
              bVar32 = getUInt64Property(plVar42,"IOSurfacePlaneCompressionType",&local_40);
              puVar43 = local_40;
              if (bVar32) {
                if (((undefined1 *)0x2 < local_40 + -1) && (local_40 != (undefined1 *)0x4)) {
                  if (local_40 != (undefined1 *)0x0) {
                    pcVar54 = "IOSurface: plane[%d] illegal compression type\n";
                    puVar43 = local_48;
                    goto LAB_000066af;
                  }
                  if (*pOVar4 != (OSMetaClass)0x5) goto LAB_00005116;
                }
                uVar40 = *(ulong *)(this + 0x2e8);
                if (uVar40 == 0) {
                  uVar40 = _IOMallocZeroData((ulong)*(uint *)(this + 0x98) * 0x3c);
                  uVar33 = *(uint *)(this + 0x98);
                  *(ulong *)(this + 0x2e8) = uVar40;
                  *(uint *)(this + 0x2f0) = uVar33;
                  if (uVar40 == 0) goto LAB_000066d1;
                }
                else {
                  uVar33 = *(uint *)(this + 0x2f0);
                }
                uVar48 = (ulong)uVar33 * 0x3c + uVar40;
                uVar49 = uVar48 - uVar40;
                if ((uVar48 < uVar40) || (uVar49 >> 0x20 != 0)) goto LAB_00006cdd;
                if ((long)local_48 * 0x3c - 0x80000000U < 0xffffffff00000000) goto LAB_00006ce9;
                uVar48 = (long)local_48 * 0x3c00000000;
                if (((long)uVar48 < 0) || ((uint)uVar49 < (int)(uVar48 >> 0x20) + 0x3cU))
                goto LAB_00006cd1;
                uVar52 = (ulong)CARRY8(uVar40,uVar48 >> 0x20);
                uVar49 = -uVar52;
                if ((uVar52 != uVar49) || ((long)uVar49 < 0)) goto LAB_00006cf5;
                *(char *)(uVar40 + (uVar48 >> 0x20) + 0x20) = (char)puVar43;
                local_58 = (undefined1 *)0x0;
                puVar62 = (undefined1 *)0x1;
                if (puVar43 + -3 < (undefined1 *)0xfffffffffffffffe) {
                  bVar32 = getUInt64Property(param_1,"IOSurfaceSliceCount",&local_58);
                  puVar62 = (undefined1 *)0x1;
                  if ((bVar32) &&
                     (puVar62 = local_58, local_58 + -0x100000000 < (undefined1 *)0xffffffff00000002
                     )) {
                    pcVar54 = 
                    "IOSurface: sliceCount provided %d is out of bound for maximum / minimum number of required slices.\n"
                    ;
                    puVar43 = local_58;
                    goto LAB_000066af;
                  }
                }
                *(int *)(this + 0x3bc) = (int)puVar62;
              }
LAB_00005116:
              puVar43 = local_48;
              uVar40 = *(ulong *)(this + 0x2e8);
              if (uVar40 == 0) {
                if (*(long *)(this + 0x358) == 0) {
                  if (*(undefined1 **)(local_68 + 0x10) + (long)*(undefined1 **)(local_68 + 0x28) <
                      *(undefined1 **)(local_68 + 0x18) + uVar35 + uVar46) {
                    pcVar54 = 
                    "IOSurface: plane[%d] Image data doesn\'t fit within allocated plane size\n";
                    goto LAB_000066af;
                  }
                }
                else if (*(undefined1 **)(local_68 + 0x10) +
                         *(long *)(*(long *)(this + 0x358) + 0x90) <
                         *(undefined1 **)(local_68 + 0x18) + uVar35 + uVar46) {
                  pcVar54 = 
                  "IOSurface: child surface plane[%d] Image data doesn\'t fit within allocated parent plane size\n"
                  ;
                  goto LAB_000066af;
                }
LAB_00005a29:
                uVar33 = (int)puVar43 + 1;
                if (*(uint *)(this + 0x98) <= uVar33) goto LAB_00005a37;
                goto LAB_000046ec;
              }
              uVar35 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar40;
              uVar46 = uVar35 - uVar40;
              if ((uVar35 < uVar40) || (uVar46 >> 0x20 != 0)) goto LAB_00006cdd;
              if ((long)local_48 * 0x3c - 0x80000000U < 0xffffffff00000000) goto LAB_00006ce9;
              uVar35 = (long)local_48 * 0x3c00000000;
              if (((long)uVar35 < 0) || ((uint)uVar46 < (int)(uVar35 >> 0x20) + 0x3cU))
              goto LAB_00006cd1;
              pOVar53 = (OSMetaClass *)(uVar40 + (uVar35 >> 0x20));
              uVar46 = (ulong)CARRY8(uVar40,uVar35 >> 0x20);
              uVar35 = -uVar46;
              if ((uVar46 != uVar35) || ((long)uVar35 < 0)) goto LAB_00006cf5;
              OVar8 = pOVar53[0x20];
              local_50 = pOVar53;
              if ((byte)((char)OVar8 - 1U) < 3) {
                if (OVar8 == (OSMetaClass)0x1) {
                  bVar32 = getUInt64Property(local_60,"IOSurfacePlaneHTPCPredictionSelector",
                                             &local_40);
                  if (bVar32) {
                    if ((undefined1 *)0xff < local_40) goto LAB_000066d1;
                    local_50[0x21] = SUB81(local_40,0);
                    if (1 < (byte)SUB81(local_40,0)) {
                      pcVar54 = 
                      "IOSurface: compressed plane[%d] HTPCPredictionSelector must be in range\n";
                      goto LAB_000065f8;
                    }
                  }
                  else {
                    local_50[0x21] = (OSMetaClass)0x0;
                  }
                }
              }
              else if ((OVar8 != (OSMetaClass)0x4) &&
                      ((OVar8 != (OSMetaClass)0x0 || (*pOVar4 != (OSMetaClass)0x5)))) {
                _IOLog("IOSurface: Unsupportted compression type: %d");
                goto LAB_00005a29;
              }
              bVar32 = getUInt64Property(local_60,"IOSurfacePlaneBytesPerCompressedTileHeader",
                                         &local_40);
              if (bVar32) {
                if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                *(uint *)(local_50 + 0x10) = (uint)local_40;
              }
              OVar8 = local_50[0x20];
              if ((byte)OVar8 - 2 < 3) {
LAB_000052c0:
                if ((0x20 < (ulong)*(uint *)(local_50 + 0x10)) ||
                   ((0x100000104U >> ((ulong)*(uint *)(local_50 + 0x10) & 0x3f) & 1) == 0)) {
                  pcVar54 = 
                  "IOSurface: AGX BytesPerCompressedTileHeader of plane[%d] must be 2 or 8 or 32\n";
                  goto LAB_000065f8;
                }
                if (((byte)((char)OVar8 - 3U) < 2) &&
                   (bVar32 = getUInt64Property(local_60,"IOSurfacePlaneCompressionFootprint",
                                               &local_40), bVar32)) {
                  if ((undefined1 *)0x3 < local_40) {
                    pcVar54 = 
                    "IOSurface: plane[%d] illegal compression footprint for type kIOSurfaceCompressionTypeInterchangeLossy %lld \n"
                    ;
                    puVar62 = local_40;
                    puVar43 = (undefined1 *)((ulong)puVar43 & 0xffffffff);
                    goto LAB_00005ee8;
                  }
                  local_50[0x28] = SUB81(local_40,0);
                }
              }
              else if (OVar8 == (OSMetaClass)0x0) {
                if (*pOVar4 == (OSMetaClass)0x5) goto LAB_000052c0;
              }
              else if (((OVar8 == (OSMetaClass)0x1) && (*(uint *)(local_50 + 0x10) != 4)) &&
                      (*(uint *)(local_50 + 0x10) != 8)) {
                pcVar54 = 
                "IOSurface: HTPC compressed plane[%d] Tile header must be 32-bit or 64-bit\n";
                goto LAB_000065f8;
              }
              bVar32 = getUInt64Property(local_60,"IOSurfacePlaneCompressedTileWidth",&local_40);
              if (bVar32) {
                if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                *(uint *)local_50 = (uint)local_40;
                puVar62 = local_40;
              }
              else {
                puVar62 = (undefined1 *)(ulong)*(uint *)local_50;
              }
              uVar33 = (uint)puVar62;
              if (uVar33 == 0) {
                pcVar54 = "IOSurface: compressed plane[%d] CompressedTileWidth must be at least 1\n"
                ;
                goto LAB_000066af;
              }
              if ((uVar33 & uVar33 - 1) != 0) {
                pcVar54 = "IOSurface: compressed plane[%d] CompressedTileWidth must be power of 2\n"
                ;
                goto LAB_000066af;
              }
              if (0x3ff < uVar33) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] CompressedTileWidth must be less than 1024\n";
                goto LAB_000066af;
              }
              if ((ulong)(*(undefined1 **)local_68 + ((ulong)puVar62 & 0xffffffff)) >> 0x20 != 0) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] Width + CompressedTileWidth doesn\'t fit in 32 bits\n"
                ;
                goto LAB_000066af;
              }
              bVar32 = getUInt64Property(local_60,"IOSurfacePlaneCompressedTileHeight",&local_40);
              if (bVar32) {
                if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                *(uint *)(local_50 + 4) = (uint)local_40;
                puVar62 = local_40;
              }
              else {
                puVar62 = (undefined1 *)(ulong)*(uint *)(local_50 + 4);
              }
              uVar33 = (uint)puVar62;
              if (uVar33 == 0) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] CompressedTileHeight must be at least 1\n";
                goto LAB_000066af;
              }
              if (0x3ff < uVar33) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] CompressedTileHeight must be less than 1024\n";
                goto LAB_000066af;
              }
              if ((uVar33 & uVar33 - 1) != 0) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] CompressedTileHeight must be power of 2\n";
                goto LAB_000066af;
              }
              if ((ulong)(*(undefined1 **)pOVar1 +
                         (ulong)*(uint *)(local_50 + 0x10) + ((ulong)puVar62 & 0xffffffff)) >> 0x20
                  != 0) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] Height + CompressedTileHeight doesn\'t fit in 32 bits\n"
                ;
                goto LAB_000066af;
              }
              bVar32 = getUInt64Property(local_60,
                                         "IOSurfacePlaneHorizontalPixelOffsetWithinCompressedTileArray"
                                         ,&local_40);
              if (bVar32) {
                if ((undefined1 *)0xffff < local_40) goto LAB_000066d1;
                *(short *)(local_50 + 0x24) = (short)local_40;
                puVar62 = local_40;
              }
              else {
                puVar62 = (undefined1 *)(ulong)*(ushort *)(local_50 + 0x24);
              }
              if (*(uint *)local_50 < ((uint)puVar62 & 0xffff)) {
                pcVar54 = 
                "IOSurface: compressed plane[%d] kIOSurfacePlaneHorizontalPixelOffsetWithinCompressedTileArray is more than a kIOSurfacePlaneCompressedTileWidth.\n"
                ;
              }
              else {
                bVar32 = getUInt64Property(local_60,
                                           "IOSurfacePlaneVerticalPixelOffsetWithinCompressedTileArray"
                                           ,&local_40);
                if (bVar32) {
                  if ((undefined1 *)0xffff < local_40) goto LAB_000066d1;
                  *(short *)(local_50 + 0x26) = (short)local_40;
                  puVar62 = local_40;
                }
                else {
                  puVar62 = (undefined1 *)(ulong)*(ushort *)(local_50 + 0x26);
                }
                if (*(uint *)(local_50 + 4) < ((uint)puVar62 & 0xffff)) {
                  pcVar54 = 
                  "IOSurface: compressed plane[%d] kIOSurfacePlaneVerticalPixelOffsetWithinCompressedTileArray is more than a kIOSurfacePlaneCompressedTileHeight.\n"
                  ;
                }
                else {
                  bVar32 = getUInt64Property(local_60,"IOSurfacePlaneBytesPerTileData",&local_40);
                  if (bVar32) {
                    if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                    *(uint *)(local_50 + 0x2c) = (uint)local_40;
                  }
                  OVar8 = local_50[0x20];
                  uVar33 = 1;
                  if ((byte)OVar8 - 2 < 3) {
LAB_000054e6:
                    local_50[0x22] = (OSMetaClass)0x0;
                  }
                  else if (OVar8 == (OSMetaClass)0x0) {
                    if (*pOVar4 == (OSMetaClass)0x5) goto LAB_000054e6;
                  }
                  else if (OVar8 == (OSMetaClass)0x1) {
                    local_58 = (undefined1 *)0x0;
                    bVar32 = getUInt64Property(local_60,
                                               "IOSurfacePlaneHTPCVerticalHeaderGroupingMode",
                                               &local_58);
                    if ((bVar32) && ((undefined1 *)0xff < local_58)) goto LAB_000066d1;
                    local_50[0x22] = SUB81(local_58,0);
                    if (((ulong)local_58 & 0xfc) != 0) {
                      pcVar54 = 
                      "IOSurface: compressed plane[%d] HTPCVerticalHeaderGroupingMode must be in range\n"
                      ;
                      uVar35 = (ulong)puVar43 & 0xffffffff;
                      goto LAB_000065a3;
                    }
                    uVar33 = 1 << ((byte)SUB81(local_58,0) & 0x1f);
                  }
                  bVar32 = getUInt64Property(local_60,"IOSurfacePlaneWidthInCompressedTiles",
                                             &local_40);
                  if (bVar32) {
                    if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                    *(uint *)(local_50 + 0x14) = (uint)local_40;
                  }
                  if (*puVar2 == 0) {
                    if (puVar7[3] != 0) {
                      pcVar54 = 
                      "IOSurface: compressed plane[%d] extended top is not supported for compressed iosurfaces\n"
                      ;
                      goto LAB_000065f8;
                    }
                    uVar10 = *(ushort *)(local_50 + 0x24);
                    uVar35 = (ulong)uVar10;
                    uVar51 = *puVar7;
                    uVar46 = (ulong)*(uint *)local_50;
                    uVar34 = *(uint *)local_50 - 1;
                    if ((!CARRY4((uint)uVar10,uVar51)) && (!CARRY4(uVar34,uVar10 + uVar51))) {
                      puVar62 = *(undefined1 **)local_68;
                      uVar40 = (ulong)(uVar34 + uVar10 + uVar51);
                      puVar43 = local_48;
                      if (CARRY8(uVar40,(ulong)puVar62)) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] full width calculation overflow\n";
                        goto LAB_000066af;
                      }
                      uVar49 = (ulong)*(uint *)(local_50 + 0x14);
                      uVar48 = (ulong)(puVar62 + uVar40) % uVar46;
                      if ((ulong)(puVar62 + uVar40) / uVar46 != uVar49) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] CompressedTileHeaderRegionWidth must exactly cover the width in tiles\n"
                        ;
                        goto LAB_000066af;
                      }
                      if (CARRY8((ulong)puVar62,(ulong)uVar51)) {
                        _IOLog("IOSurface: compressed plane[%d] extended width calculation overflow\n"
                               ,local_48,uVar48,uVar35,uVar10 + uVar51);
                        uVar46 = (ulong)*(uint *)local_50;
                        uVar49 = (ulong)*(uint *)(local_50 + 0x14);
                        uVar35 = (ulong)*(ushort *)(local_50 + 0x24);
                        uVar48 = extraout_RDX;
                      }
                      uVar49 = uVar49 * uVar46;
                      if (uVar49 < uVar35 || uVar49 - uVar35 == 0) {
                        _IOLog("IOSurface: compressed plane[%d] planeHorizontalPixelOffsetWithinCompressedTile exceeds compressedPlaneBytesPerTileRow\n"
                               ,local_48,uVar48);
                        uVar35 = (ulong)*(ushort *)(local_50 + 0x24);
                      }
                      if ((undefined1 *)(uVar49 - uVar35) < puVar62 + uVar51) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] Plane width must fit into tiles\n";
                        puVar43 = local_48;
                        goto LAB_000066af;
                      }
                      bVar32 = getUInt64Property(local_60,"IOSurfacePlaneBytesPerRowOfTileData",
                                                 &local_40);
                      if (bVar32) {
                        if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                        if ((*(uint *)(local_50 + 0x2c) != 0) &&
                           (local_40 !=
                            (undefined1 *)
                            (ulong)(*(uint *)(local_50 + 0x14) * *(uint *)(local_50 + 0x2c)))) {
                          uVar35 = 0;
                          _IOLog("IOSurface: compressed plane[%d] kIOSurfacePlaneBytesPerRowOfTileData is %d less than WidthInCompressedTiles %d x BytesPerTileData %d Bytes.\n"
                                 ,local_48);
                          goto LAB_000066d4;
                        }
                        *(uint *)(local_50 + 0x30) = (uint)local_40;
                      }
                      bVar32 = getUInt64Property(local_60,"IOSurfacePlaneHeightInCompressedTiles",
                                                 &local_40);
                      if (bVar32) {
                        if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                        *(uint *)(local_50 + 0x18) = (uint)local_40;
                      }
                      uVar35 = (ulong)*puVar59;
                      puVar62 = *(undefined1 **)pOVar1;
                      puVar43 = puVar62 + uVar35;
                      uVar10 = *(ushort *)(local_50 + 0x26);
                      if ((CARRY8(uVar35,(ulong)puVar62)) || (CARRY8((ulong)uVar10,(ulong)puVar43)))
                      {
                        _IOLog("IOSurface: compressed plane[%d] extendedHeight overflow\n",local_48,
                               puVar62,puVar62 + uVar35);
                      }
                      uVar34 = *(uint *)(local_50 + 4);
                      uVar51 = uVar34 - 1;
                      if (CARRY8((ulong)(puVar43 + uVar10),(ulong)uVar51)) {
                        _IOLog("IOSurface: compressed plane[%d] roundedExtendedHeight overflow\n",
                               local_48);
                        uVar34 = *(uint *)(local_50 + 4);
                      }
                      uVar35 = (ulong)uVar33 + (ulong)(puVar43 + uVar10 + uVar51) / (ulong)uVar34;
                      puVar43 = local_48;
                      if (0xfffffffe < uVar35) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] tilesToCoverHeight + headersInGroup doesn\'t fit in 32 bits\n"
                        ;
                        goto LAB_000066af;
                      }
                      uVar51 = *(uint *)(local_50 + 0x18);
                      if ((ulong)uVar51 < (ulong)(-uVar33 & (int)uVar35 - 1U)) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] CompressedTileHeaderRegionHeight must exactly cover the height in tiles\n"
                        ;
                        goto LAB_000066af;
                      }
                      if ((uVar51 & uVar33 - 1) != 0) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] Header region height must fit header group\n"
                        ;
                        goto LAB_000066af;
                      }
                      if ((undefined1 *)
                          ((ulong)uVar51 * (ulong)uVar34 - (ulong)*(ushort *)(local_50 + 0x26)) <
                          *(undefined1 **)pOVar1) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] Plane height must fit into tiles\n";
                        goto LAB_000066af;
                      }
                      bVar32 = getUInt64Property(local_60,
                                                 "IOSurfacePlaneBytesPerRowOfCompressedTileHeaderGroups"
                                                 ,&local_40);
                      pOVar53 = local_50;
                      plVar42 = local_60;
                      if (bVar32) {
                        if ((ulong)local_40 >> 0x20 != 0) goto LAB_000066d1;
                        *(uint *)(local_50 + 0x1c) = (uint)local_40;
                      }
                      uVar35 = (ulong)*(uint *)(local_50 + 0x14) *
                               (ulong)(*(uint *)(local_50 + 0x10) << ((byte)local_50[0x22] & 0x1f));
                      puVar43 = local_48;
                      if (uVar35 >> 0x20 != 0) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] bytesPerCompressedTileHeaderGroup * planeWidthInCompressedTiles doesn\'t fit in 32 bits\n"
                        ;
                        goto LAB_000066af;
                      }
                      if ((local_50[0x20] == (OSMetaClass)0x1) &&
                         (*(uint *)(local_50 + 0x1c) <= uVar35 &&
                          uVar35 - *(uint *)(local_50 + 0x1c) != 0)) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] BytesPerRowOfCompressedTileHeaderGroups needs to be enough for a row of groups of tiles at this width\n"
                        ;
                        goto LAB_000066af;
                      }
                      pOVar1 = local_50 + 8;
                      uVar35 = getUInt32MaxRequiredProperty
                                         (local_60,"IOSurfacePlaneCompressedTileHeaderRegionOffset",
                                          (undefined4 *)pOVar1);
                      if ((char)uVar35 == '\0') goto LAB_000066d1;
                      pOVar60 = pOVar53 + 0xc;
                      uVar35 = getUInt32MaxRequiredProperty
                                         (plVar42,"IOSurfacePlaneCompressedTileDataRegionOffset",
                                          (undefined4 *)pOVar60);
                      if ((char)uVar35 == '\0') goto LAB_000066d1;
                      puVar62 = (undefined1 *)
                                ((ulong)(*(uint *)(pOVar53 + 0x18) >> ((byte)pOVar53[0x22] & 0x3f))
                                * (ulong)*(uint *)(pOVar53 + 0x1c));
                      puVar43 = local_48;
                      if (*(undefined1 **)(local_68 + 0x28) +
                          (long)*(undefined1 **)(local_68 + 0x10) < puVar62 + *(uint *)(pOVar53 + 8)
                         ) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] Header region doesn\'t fit into plane size\n"
                        ;
                        goto LAB_000066af;
                      }
                      uVar35 = (ulong)*(uint *)(pOVar53 + 0x2c);
                      if (uVar35 == 0) {
                        uVar35 = ((ulong)puVar56 & 0xffff) * (ulong)*(uint *)pOVar53 *
                                 (ulong)*(uint *)(pOVar53 + 4) + 7;
                        if (uVar35 >> 0x23 != 0) {
                          pcVar54 = 
                          "IOSurface: compressed plane[%d] uncompressedTileSize doesn\'t fit in 32 bits\n"
                          ;
                          goto LAB_000066af;
                        }
                        uVar35 = uVar35 >> 3;
                      }
                      uVar35 = *(uint *)(pOVar53 + 0x14) * uVar35;
                      if ((ulong)*(uint *)(pOVar53 + 0x30) != 0) {
                        uVar35 = (ulong)*(uint *)(pOVar53 + 0x30);
                      }
                      if (uVar35 >> 0x20 != 0) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] rowOfUncompressedTiles doesn\'t fit in 32 bits\n"
                        ;
                        goto LAB_000066af;
                      }
                      uVar35 = uVar35 * *(uint *)(pOVar53 + 0x18);
                      if (uVar35 >> 0x20 != 0) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] dataRegionTotalSize doesn\'t fit in 32 bits\n"
                        ;
                        goto LAB_000066af;
                      }
                      if (*(undefined1 **)(local_68 + 0x28) +
                          (long)*(undefined1 **)(local_68 + 0x10) <
                          (undefined1 *)(uVar35 * *(uint *)(this + 0x3bc) + (ulong)*(uint *)pOVar60)
                         ) {
                        pcVar54 = 
                        "IOSurface: compressed plane[%d] Data region doesn\'t fit into plane size\n"
                        ;
                        goto LAB_000066af;
                      }
                      if (*(uint *)(this + 0x3bc) < 2) {
LAB_00005940:
                        OVar8 = pOVar53[0x20];
                        puVar43 = local_48;
                        if ((byte)OVar8 - 2 < 3) {
LAB_00005951:
                          if ((ulong)*(uint *)pOVar1 <
                              uVar35 * *(uint *)(this + 0x3bc) + (ulong)*(uint *)pOVar60) {
                            pcVar54 = 
                            "IOSurface: compressed plane[%d] Data region overlaps header region\n";
                            goto LAB_000066af;
                          }
                          if (1 < *(uint *)(this + 0x3bc)) {
                            bVar32 = getUInt64Property(local_60,
                                                  "IOSurfacePlaneHeaderRegionBytesPerSlice",
                                                  &local_40);
                            if (!bVar32) {
                              uVar33 = *(uint *)(this + 0x3bc);
                              pcVar54 = 
                              "IOSurface: kIOSurfacePlaneHeaderRegionBytesPerSlice must be present for multi-slice plane %d with sliceCount %d .\n"
                              ;
                              goto LAB_000065bc;
                            }
                            if ((ulong)local_40 >> 0x20 != 0) {
                              pcVar54 = 
                              "IOSurface: kIOSurfacePlaneHeaderRegionBytesPerSlice %d exeeds maximum value.\n"
                              ;
                              puVar43 = (undefined1 *)((ulong)local_40 & 0xffffffff);
                              goto LAB_000066af;
                            }
                            if (local_40 < puVar62) {
                              pcVar54 = 
                              "IOSurface: kIOSurfacePlaneHeaderRegionBytesPerSlice %d is smaller than expected value %d .\n"
                              ;
                              puVar43 = (undefined1 *)((ulong)puVar62 & 0xffffffff);
                              puVar56 = (undefined1 *)((ulong)local_40 & 0xffffffff);
                              goto LAB_000065e5;
                            }
                            *(uint *)(local_50 + 0x38) = (uint)local_40;
                            if (*(undefined1 **)(local_68 + 0x28) <
                                (undefined1 *)
                                (ulong)((*(uint *)(local_50 + 0x34) + (uint)local_40) *
                                       *(int *)(this + 0x3bc))) {
                              uVar35 = 0;
                              _IOLog("IOSurface: multi-slice interchange compressed plane[%d] (DataRegionBytesPerSlice %d + HeaderRegionBytesPerSlice %d) * sliceCount %d size is greater than total planeSize %lld\n"
                                     ,local_48);
                              goto LAB_000066d4;
                            }
                          }
                        }
                        else if (OVar8 == (OSMetaClass)0x0) {
                          if (*pOVar4 == (OSMetaClass)0x5) goto LAB_00005951;
                        }
                        else if ((OVar8 == (OSMetaClass)0x1) &&
                                ((undefined1 *)(ulong)*(uint *)pOVar60 < puVar62 + *(uint *)pOVar1))
                        {
                          pcVar54 = 
                          "IOSurface: HTPC compressed plane[%d] Header region overlaps data region\n"
                          ;
                          goto LAB_000066af;
                        }
                        puVar43 = local_48;
                        if ((uint)local_48 < 5) {
                          *(int *)(*(long *)(this + 0x178) + 0xa0 + (long)local_48 * 4) =
                               (int)uVar35;
                        }
                        goto LAB_00005a29;
                      }
                      bVar32 = getUInt64Property(local_60,"IOSurfacePlaneDataRegionBytesPerSlice",
                                                 &local_40);
                      if (bVar32) {
                        if ((ulong)local_40 >> 0x20 != 0) {
                          pcVar54 = 
                          "IOSurface: kIOSurfacePlaneDataRegionBytesPerSlice %d exceeds maximum value.\n"
                          ;
                          puVar43 = local_40;
                          goto LAB_000066af;
                        }
                        puVar43 = (undefined1 *)
                                  (ulong)(*(uint *)(local_50 + 0x18) * *(uint *)(local_50 + 0x14) *
                                         *(uint *)(local_50 + 0x2c));
                        if (puVar43 <= local_40) {
                          *(uint *)(local_50 + 0x34) = (uint)local_40;
                          pOVar53 = local_50;
                          goto LAB_00005940;
                        }
                        pcVar54 = 
                        "IOSurface: kIOSurfacePlaneDataRegionBytesPerSlice %d is smaller than expected value %d .\n"
                        ;
                        puVar56 = local_40;
                      }
                      else {
                        uVar33 = *(uint *)(this + 0x3bc);
                        pcVar54 = 
                        "IOSurface: kIOSurfacePlaneDataRegionBytesPerSlice must be present for multi-slice plane %d with sliceCount %d .\n"
                        ;
LAB_000065bc:
                        puVar43 = (undefined1 *)(ulong)uVar33;
                        puVar56 = local_48;
                      }
LAB_000065e5:
                      uVar35 = 0;
                      _IOLog(pcVar54,puVar56,puVar43);
                      goto LAB_000066d4;
                    }
                    pcVar54 = "IOSurface: compressed plane[%d] extra width calculation overflow\n";
                  }
                  else {
                    pcVar54 = 
                    "IOSurface: compressed plane[%d] extended left is not supported for compressed iosurfaces\n"
                    ;
                  }
                }
              }
            }
            else {
              pcVar54 = "IOSurface: plane[%d] calculated size value exceeds 64bit limit\n";
            }
LAB_000065f8:
            puVar43 = (undefined1 *)((ulong)puVar43 & 0xffffffff);
            goto LAB_000066af;
          }
          goto LAB_00005a37;
        }
      }
      goto LAB_000066d1;
    }
    pcVar54 = "IOSurface: kIOSurfacePlaneInfo array must not be empty.\n";
    goto LAB_0000467f;
  }
  *(undefined8 *)(this + 0x180) = 0;
  *(undefined4 *)(this + 0x188) = 0;
  *(undefined8 *)(this + 0x308) = 1;
  pbVar38 = (byte *)_IOMallocZeroData(0x18);
  *(byte **)(this + 0x2f8) = pbVar38;
  *(undefined4 *)(this + 0x300) = 1;
  if (pbVar38 != (byte *)0x0) {
    uVar35 = (long)(pbVar38 + 0x18) - (long)pbVar38;
    if ((pbVar38 + 0x18 < pbVar38) || (uVar35 >> 0x20 != 0)) goto LAB_00006cdd;
    if ((uint)uVar35 < 0x18) goto LAB_00006cd1;
    uVar35 = parseAdditionalPlaneInfo(pbVar38,param_1);
    if ((char)uVar35 == '\0') {
      pcVar54 = "IOSurface: parseAdditionalPlaneInfo failed.\n";
      goto LAB_0000467f;
    }
    *(undefined8 *)(this + 0x328) = 0x20;
    puVar39 = (undefined4 *)_IOMallocZeroData(0x20);
    *(undefined4 **)(this + 0x330) = puVar39;
    *(undefined4 *)(this + 0x338) = 1;
    if (puVar39 == (undefined4 *)0x0) goto LAB_000066d1;
    uVar35 = (long)(puVar39 + 8) - (long)puVar39;
    if ((puVar39 + 8 < puVar39) || (uVar35 >> 0x20 != 0)) goto LAB_00006cdd;
    if ((uVar35 & 0xffffffe0) == 0) goto LAB_00006cd1;
    getUInt32MaxOptionalProperty(param_1,"IOSurfacePlaneExtendedPixelsOnLeft",puVar39 + 2);
    getUInt32MaxOptionalProperty(param_1,"IOSurfacePlaneExtendedPixelsOnRight",puVar39);
    getUInt32MaxOptionalProperty(param_1,"IOSurfacePlaneExtendedPixelsOnBottom",puVar39 + 1);
    getUInt32MaxOptionalProperty(param_1,"IOSurfacePlaneExtendedPixelsOnTop",puVar39 + 3);
LAB_00005a37:
    *(undefined8 *)(this + 0x3a0) = 0;
    if (*(long *)(this + 0x358) == 0) {
      getBoolPropertyInternal(param_1,"IOSurfaceEnableStatistics",(undefined1 *)&local_58);
      local_58 = (undefined1 *)0x0;
      bVar32 = getUInt64Property(param_1,"IOSurfaceProtectionOptions",&local_58);
      if (bVar32) {
        if ((undefined1 *)0xf < local_58) {
          uVar35 = 0;
          _IOLog("Unsupported protection bits set: %016llx\n");
          goto LAB_000066d4;
        }
        *(undefined1 **)(this + 0x3a0) = local_58;
      }
    }
    else {
      uVar35 = *(ulong *)(*(long *)(this + 0x358) + 0x3a0);
      if (((byte)_gIOSurfaceRoot[0x1b5] & 0x20) == 0) {
        if (uVar35 != 0) {
          pcVar54 = "Cannot create children of protected surfaces";
          goto LAB_0000467f;
        }
        uVar35 = 0;
      }
      *(ulong *)(this + 0x3a0) = uVar35 & 0xffffffff;
    }
    getUInt32MaxOptionalProperty(param_1,"IOSurfaceBufferTileFormat",(undefined4 *)(this + 0x214));
    local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
    bVar32 = getBoolPropertyInternal(param_1,"IOFenceAllowTearing",(undefined1 *)&local_58);
    if (bVar32) {
      *(uint *)pIVar61 = *(uint *)pIVar61 & 0xffffdfff | (uint)(byte)local_58 << 0xd;
    }
    local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
    bVar32 = getBoolPropertyInternal(param_1,"IOSurfaceBufferTileMode",(undefined1 *)&local_58);
    if (bVar32) {
      uVar33 = *(uint *)pIVar61 & 0xfffffdff | (uint)(byte)local_58 << 9;
      *(uint *)pIVar61 = uVar33;
    }
    else {
      uVar33 = *(uint *)pIVar61;
    }
    *(byte *)(*(long *)(this + 0x178) + 0x14) = (byte)(uVar33 >> 9) & 1;
    local_58 = (undefined1 *)((ulong)local_58 & 0xffffffffffffff00);
    bVar32 = getBoolPropertyInternal
                       (param_1,"IOSurfacePixelSizeCastingAllowed",(undefined1 *)&local_58);
    if (bVar32) {
      uVar33 = *(uint *)pIVar61 & 0xfffeffff | (uint)(byte)local_58 << 0x10;
      *(uint *)pIVar61 = uVar33;
    }
    else {
      uVar33 = *(uint *)pIVar61;
    }
    *(byte *)(*(long *)(this + 0x178) + 0x2c) = (byte)(uVar33 >> 0x10) & 1;
    local_58 = (undefined1 *)0x0;
    bVar32 = getUInt64Property(param_1,"IOSurfacePixelFormat",&local_58);
    if (bVar32) {
      *(undefined4 *)(this + 0x80) = local_58._0_4_;
    }
    bVar32 = getUInt64Property(param_1,"IOSurfaceBitsPerBlock",&local_40);
    if (bVar32) {
      if ((undefined1 *)0xffff < local_40) goto LAB_000066d1;
      *(short *)(this + 0x70) = (short)(((ulong)local_40 & 0xffff) >> 3);
    }
    bVar32 = getUInt64Property(param_1,"IOSurfaceBytesPerElement",&local_40);
    if (bVar32) {
      puVar43 = local_40;
      if (local_40 < (undefined1 *)0x10000) goto LAB_00005d1b;
    }
    else {
      if (bVar31 && bVar64) {
        iVar47 = *(int *)(this + 0x80);
        if (iVar47 < 0x52476641) {
          if (iVar47 < 0x4c353535) {
            if ((iVar47 == 0x34343434) || (iVar47 == 0x35353531)) {
LAB_00005d17:
              puVar43 = (undefined1 *)0x2;
              goto LAB_00005d1b;
            }
            if (iVar47 == 0x42475241) {
LAB_00005cf8:
              puVar43 = (undefined1 *)0x4;
              goto LAB_00005d1b;
            }
          }
          else {
            if ((iVar47 == 0x4c353535) || (iVar47 == 0x4c353635)) goto LAB_00005d17;
            if (iVar47 == 0x52474241) goto LAB_00005cf8;
          }
LAB_00005f1e:
          puVar43 = (undefined1 *)0x1;
        }
        else {
          if (0x53353534 < iVar47) {
            if (((iVar47 == 0x53353535) || (iVar47 == 0x53353635)) || (iVar47 == 0x73353531))
            goto LAB_00005d17;
            goto LAB_00005f1e;
          }
          if (iVar47 == 0x52476641) {
            puVar43 = (undefined1 *)0x10;
          }
          else {
            if (iVar47 != 0x52476841) {
              if (iVar47 == 0x53333262) goto LAB_00005cf8;
              goto LAB_00005f1e;
            }
            puVar43 = (undefined1 *)0x8;
          }
        }
LAB_00005d1b:
        *(short *)(this + 0x70) = (short)puVar43;
      }
      bVar31 = getUInt64Property(param_1,"IOSurfaceWidth",&local_40);
      if (!bVar31) {
        if (*(int *)(this + 0x98) == 0) goto LAB_00005d49;
LAB_00005d73:
        pcVar54 = "IOSurface: Planar surfaces must specify a valid buffer width and height.\n";
        goto LAB_0000467f;
      }
      *(undefined1 **)(this + 0x58) = local_40;
LAB_00005d49:
      bVar31 = getUInt64Property(param_1,"IOSurfaceHeight",&local_40);
      if (bVar31) {
        *(undefined1 **)(this + 0x60) = local_40;
      }
      else if (*(int *)(this + 0x98) != 0) goto LAB_00005d73;
      bVar31 = getUInt64Property(param_1,"IOSurfaceElementWidth",&local_40);
      if (bVar31) {
        if ((undefined1 *)0xff < local_40) goto LAB_000066d1;
        this[0x72] = SUB81(local_40,0);
      }
      bVar31 = getUInt64Property(param_1,"IOSurfaceElementHeight",&local_40);
      if (bVar31) {
        if ((undefined1 *)0xff < local_40) goto LAB_000066d1;
        this[0x73] = SUB81(local_40,0);
      }
      if (*(short *)(this + 0x70) == 0) {
        pcVar54 = "IOSurface: buffer bytes per element is zero.\n";
      }
      else {
        IVar9 = this[0x72];
        if (IVar9 == (IOSurface)0x0) {
          pcVar54 = "IOSurface: buffer element width is zero.\n";
        }
        else if (this[0x73] == (IOSurface)0x0) {
          pcVar54 = "IOSurface: buffer element height is zero.\n";
        }
        else {
          uVar46 = (ulong)CARRY8((ulong)((byte)IVar9 - 1),*(ulong *)(this + 0x58));
          uVar35 = -uVar46;
          if ((uVar46 != uVar35) || ((long)uVar35 < 0)) {
            pcVar54 = "IOSurface: buffer width overflow\n";
            goto LAB_0000467f;
          }
          uVar35 = ((ulong)((byte)IVar9 - 1) + *(ulong *)(this + 0x58)) / (ulong)(byte)IVar9;
          bVar31 = getUInt64Property(param_1,"IOSurfaceBytesPerRow",&local_40);
          if (bVar31) {
            *(undefined1 **)(this + 0x68) = local_40;
            auVar19._8_8_ = 0;
            auVar19._0_8_ = uVar35;
            puVar43 = SUB168(auVar19 * ZEXT216(*(ushort *)(this + 0x70)),0);
            bVar31 = SUB168(auVar19 * ZEXT216(*(ushort *)(this + 0x70)),8) != 0;
            puVar56 = local_40;
          }
          else {
            auVar20._8_8_ = 0;
            auVar20._0_8_ = uVar35;
            puVar43 = SUB168(auVar20 * ZEXT216(*(ushort *)(this + 0x70)),0);
            uVar46 = (ulong)*(uint *)(_gIOSurfaceRoot + 0xb0);
            if ((SUB168(auVar20 * ZEXT216(*(ushort *)(this + 0x70)),8) != 0) ||
               (CARRY8(uVar46,(ulong)puVar43))) {
              pcVar54 = "IOSurface: bytesPerRow calculation overflow\n";
              goto LAB_0000467f;
            }
            puVar56 = (undefined1 *)((ulong)(puVar43 + uVar46) & ~uVar46);
            *(undefined1 **)(this + 0x68) = puVar56;
            bVar31 = false;
          }
          if (bVar31) {
            pcVar54 = "IOSurface: buffer required width in bytes overflow\n";
          }
          else if (puVar56 < puVar43) {
            pcVar54 = "IOSurface: buffer bytes per row value is too small\n";
          }
          else {
            bVar31 = getUInt64Property(param_1,"IOSurfaceOffset",&local_40);
            if (bVar31) {
              *(undefined1 **)(this + 0x78) = local_40;
            }
            if (*(long *)(this + 0x358) == 0) {
              bVar31 = getUInt64Property(param_1,"IOSurfaceAllocSize",&local_40);
              puVar43 = local_40;
              if (!bVar31) {
                if (*(int *)(this + 0x98) == 0) {
                  auVar21._8_8_ = 0;
                  auVar21._0_8_ = *(ulong *)(this + 0x68);
                  auVar29._8_8_ = 0;
                  auVar29._0_8_ = *(ulong *)(this + 0x60);
                  uVar46 = SUB168(auVar21 * auVar29,0);
                  uVar40 = uVar46 + *(ulong *)(this + 0x78);
                  if ((SUB168(auVar21 * auVar29,8) != 0) || (CARRY8(uVar46,*(ulong *)(this + 0x78)))
                     ) {
                    pcVar54 = "IOSurface: required allocation size overflow\n";
                    goto LAB_0000467f;
                  }
                }
                else {
                  uVar46 = *(ulong *)(this + 0x180);
                  uVar40 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar46;
                  uVar48 = uVar40 - uVar46;
                  if ((uVar40 < uVar46) || (uVar48 >> 0x20 != 0)) goto LAB_00006cdd;
                  uVar40 = (ulong)(*(int *)(this + 0x98) - 1);
                  lVar37 = uVar40 * 0x38;
                  if ((int)lVar37 != lVar37) {
LAB_00006ce9:
                    // WARNING: Subroutine does not return
                    os_detail::panic_trapping_policy::trap
                              (
                              "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                              );
                  }
                  uVar40 = uVar40 * 0x3800000000;
                  if (((long)uVar40 < 0) || ((uint)uVar48 < (int)(uVar40 >> 0x20) + 0x38U))
                  goto LAB_00006cd1;
                  lVar37 = uVar46 + (uVar40 >> 0x20);
                  uVar40 = (ulong)CARRY8(uVar46,uVar40 >> 0x20);
                  uVar46 = -uVar40;
                  if ((uVar40 != uVar46) || ((long)uVar46 < 0)) {
LAB_00006cf5:
                    // WARNING: Subroutine does not return
                    os_detail::panic_trapping_policy::trap
                              (
                              "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                              );
                  }
                  uVar46 = *(ulong *)(lVar37 + 0x10);
                  puVar6 = (ulong *)(lVar37 + 0x28);
                  uVar40 = uVar46 + *puVar6;
                  if (CARRY8(uVar46,*puVar6)) {
                    pcVar54 = "IOSurface: required planar allocation size overflow\n";
                    goto LAB_000066ca;
                  }
                }
                uVar46 = (ulong)*(uint *)(_gIOSurfaceRoot + 0xac);
                if (CARRY8(uVar40,uVar46)) {
                  pcVar54 = "IOSurface: aligned allocation size overflow\n";
                  goto LAB_000066ca;
                }
                puVar43 = (undefined1 *)(uVar40 + uVar46 & ~uVar46);
              }
            }
            else {
              puVar43 = *(undefined1 **)(*(long *)(this + 0x358) + 0x90);
            }
            *(undefined1 **)(this + 0x90) = puVar43;
            if ((undefined1 *)((ulong)(puVar43 + 0xfff) & 0xfffffffffffff000) < puVar43) {
              pcVar54 = "IOSurface: allocation size overflow\n";
            }
            else if ((*(long *)(this + 0x358) == 0) ||
                    (puVar43 <= *(undefined1 **)(*(long *)(this + 0x358) + 0x90))) {
              if (puVar43 == (undefined1 *)0x0) goto LAB_000066d1;
              if (*(int *)(this + 0x98) == 0) {
                uVar46 = (ulong)(int)((byte)this[0x73] - 1);
                lVar55 = ((long)uVar46 >> 0x3f) + (ulong)CARRY8(uVar46,*(ulong *)(this + 0x60));
                lVar37 = -(ulong)((uint)lVar55 & 1);
                if ((lVar55 != lVar37) || (lVar37 < 0)) {
                  pcVar54 = "IOSurface: aligned height calculation overflow";
LAB_0000467f:
                  uVar35 = 0;
                  _IOLog(pcVar54);
                  goto LAB_000066d4;
                }
                auVar22._8_8_ = 0;
                auVar22._0_8_ = uVar35;
                uVar35 = SUB168(auVar22 * ZEXT216(*(ushort *)(this + 0x70)),0);
                if (SUB168(auVar22 * ZEXT216(*(ushort *)(this + 0x70)),8) == 0) {
                  auVar23._8_8_ = 0;
                  auVar23._0_8_ = (uVar46 + *(ulong *)(this + 0x60)) / (ulong)(byte)this[0x73] - 1;
                  auVar30._8_8_ = 0;
                  auVar30._0_8_ = *(ulong *)(this + 0x68);
                  uVar46 = SUB168(auVar23 * auVar30,0);
                  uVar40 = uVar35 + uVar46;
                  if ((SUB168(auVar23 * auVar30,8) != 0) || (CARRY8(uVar35,uVar46))) {
                    pcVar54 = "IOSurface: required image bytes overflow";
                    goto LAB_0000467f;
                  }
                  puVar56 = (undefined1 *)(uVar40 + *(ulong *)(this + 0x78));
                  if (!CARRY8(uVar40,*(ulong *)(this + 0x78))) {
                    if (puVar43 < puVar56) {
                      _IOLog("IOSurface: buffer allocation size is too small to cover valid image area: fAllocSize=%llu, requiredSizeInBytes=%llu\n"
                             ,puVar43,puVar56);
                      goto LAB_000066d1;
                    }
                    goto LAB_0000633a;
                  }
                  pcVar54 = "IOSurface: required allocation size overflow";
                }
                else {
                  pcVar54 = "IOSurface: required bytes per line overflow";
                }
              }
              else {
                uVar35 = *(ulong *)(this + 0x180);
                uVar46 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar35;
                uVar40 = uVar46 - uVar35;
                if ((uVar46 < uVar35) || (uVar40 >> 0x20 != 0)) goto LAB_00006cdd;
                uVar46 = 0xffffffff7fffffc8;
                uVar48 = 0;
                iVar47 = 0;
                do {
                  uVar46 = uVar46 + 0x38;
                  if (uVar46 < 0xffffffff00000000) goto LAB_00006ce9;
                  if (((long)uVar48 < 0) || ((uint)uVar40 < (int)(uVar48 >> 0x20) + 0x38U))
                  goto LAB_00006cd1;
                  lVar37 = (uVar48 >> 0x20) + uVar35;
                  uVar52 = (ulong)CARRY8(uVar48 >> 0x20,uVar35);
                  uVar49 = -uVar52;
                  if ((uVar52 != uVar49) || ((long)uVar49 < 0)) goto LAB_00006cf5;
                  uVar49 = *(ulong *)(lVar37 + 0x10);
                  puVar6 = (ulong *)(lVar37 + 0x28);
                  if (CARRY8(uVar49,*puVar6)) {
                    pcVar54 = "IOSurface: plane limit calculation overflow";
                    goto LAB_000066ca;
                  }
                  if (puVar43 < (undefined1 *)(uVar49 + *puVar6)) {
                    _IOLog("IOSurface: buffer allocation size is too small to cover valid image area of plane %d: fAllocSize=%llu, planeLimit=%llu\n"
                           ,iVar47,puVar43);
                    goto LAB_000066d1;
                  }
                  uVar48 = uVar48 + 0x3800000000;
                  iVar47 = iVar47 + 1;
                } while (*(int *)(this + 0x98) != iVar47);
LAB_0000633a:
                bVar31 = getUInt64Property(param_1,"IOSurfaceDirection",&local_40);
                if (bVar31) {
                  *(uint *)(this + 0x348) = (uint)local_40;
                  if (((uint)local_40 & 0xfffffffe) != 2) {
                    pcVar54 = "IOSurface: client direction not InOut or Out\n";
                    goto LAB_000066ca;
                  }
                }
                bVar31 = getUInt64Property(param_1,"IOSurfaceAddressOffset",&local_40);
                if ((bVar31) &&
                   (*(ulong *)(this + 0x168) = (ulong)local_40 & 0xffffffff,
                   *(ulong *)PTR__page_size_000270c0 <= ((ulong)local_40 & 0xffffffff))) {
                  pcVar54 = "IOSurface: fClientAlignedOffset >= page_size\n";
                }
                else {
                  plVar36 = (long *)getOSDataProperty(param_1);
                  if (plVar36 != (long *)0x0) {
                    uVar33 = (**(code **)(*plVar36 + 0x140))(plVar36);
                    if ((uVar33 < 0x10) || ((uVar33 & 0xf) != 0)) {
                      pcVar54 = "IOSurface: address ranges size not multiple of IOAddressRange\n";
                      goto LAB_0000467f;
                    }
                    if (*(long *)(this + 0x3a0) != 0) goto LAB_000066d1;
                    pvVar44 = (void *)_IOMallocData();
                    *(void **)(this + 0x350) = pvVar44;
                    *(uint *)(this + 0x3b8) = uVar33 >> 4;
                    pvVar45 = (void *)(**(code **)(*plVar36 + 0x178))(plVar36);
                    _memmove(pvVar44,pvVar45,(ulong)uVar33);
                  }
                  bVar31 = getUInt64Property(param_1,"IOSurfaceAddress",&local_40);
                  if (bVar31) {
                    if (*(long *)(this + 0x2e8) != 0) {
                      pcVar54 = 
                      "IOSurface: Cannot use kIOSurfaceClientAddress with compressed iosurfaces.\n";
                      goto LAB_000066ca;
                    }
                    if (*(long *)(this + 0x3a0) != 0) goto LAB_000066d1;
                    *(undefined1 **)(this + 0x150) = local_40;
                  }
                  bVar31 = getUInt64Property(param_1,"IOSurfaceYCbCrMatrix",&local_40);
                  if (bVar31) {
                    *(OSMetaClass *)(*(long *)(this + 0x178) + 0x6a) = local_40._0_1_;
                  }
                  bVar31 = getUInt64Property(param_1,"IOSurfaceCacheMode",&local_40);
                  if (bVar31) {
                    uVar51 = (uint)local_40 & 0xf00;
                    uVar35 = (ulong)uVar51;
                    uVar33 = 0;
                    if (0x9ff >= uVar51) {
                      uVar33 = uVar51;
                    }
                    *(uint *)(this + 0x9c) = uVar33;
                    if (0x9ff < uVar51) {
                      pcVar54 = "Unknown cache mode: %08x\n";
LAB_000065a3:
                      _IOLog(pcVar54,uVar35);
                      goto LAB_000066d1;
                    }
                  }
                  bVar31 = getUInt64Property(param_1,"IOSurfaceMapCacheAttribute",&local_40);
                  if (bVar31) {
                    *(uint *)(this + 0x210) = (uint)local_40;
                  }
                  local_31 = 0;
                  bVar31 = getBoolPropertyInternal(param_1,"IOSurfaceIsGlobal",&local_31);
                  if (bVar31) {
                    *(uint *)pIVar61 = *(uint *)pIVar61 & 0xfffffffd | (uint)local_31 * 2;
                  }
                  local_31 = 0;
                  bVar31 = getBoolPropertyInternal(param_1,"IOSurfaceIsPrivate",&local_31);
                  if (bVar31) {
                    uVar33 = *(uint *)pIVar61 & 0xfff7ffff | (uint)local_31 << 0x13;
                    *(uint *)pIVar61 = uVar33;
                  }
                  else {
                    uVar33 = *(uint *)pIVar61;
                  }
                  if ((~uVar33 & 0x80002) != 0) {
                    local_31 = 0;
                    bVar31 = getBoolPropertyInternal(param_1,"IOSurfacePurgeWhenNotInUse",&local_31)
                    ;
                    if (bVar31) {
                      *(uint *)pIVar61 = *(uint *)pIVar61 & 0xffffffbf | (uint)local_31 << 6;
                    }
                    local_31 = 0;
                    bVar31 = getBoolPropertyInternal
                                       (param_1,"IOSurfaceResetDefaultAttachmentsWhenNotInUse",
                                        &local_31);
                    if (bVar31) {
                      *(uint *)pIVar61 = *(uint *)pIVar61 & 0xffffff7f | (uint)local_31 << 7;
                    }
                    plVar36 = (long *)getDictionaryProperty(param_1);
                    if (plVar36 != (long *)0x0) {
                      plVar42 = *(long **)(this + 0x1f0);
                      *(long **)(this + 0x1f0) = plVar36;
                      (**(code **)(*plVar36 + 0x20))(plVar36);
                      if (plVar42 != (long *)0x0) {
                        (**(code **)(*plVar42 + 0x28))(plVar42);
                      }
                    }
                    plVar36 = (long *)getOSDataProperty(param_1);
                    if ((plVar36 != (long *)0x0) &&
                       (pvVar44 = (void *)(**(code **)(*plVar36 + 0x178))(plVar36),
                       pvVar44 != (void *)0x0)) {
                      lVar37 = _IOMallocTypeImpl(&parse_properties(OSDictionary*)::
                                                  kalloc_type_view_2420);
                      *(long *)(this + 0x240) = lVar37;
                      if (lVar37 != 0) {
                        uVar33 = (**(code **)(*plVar36 + 0x140))(plVar36);
                        puVar12 = *(undefined8 **)(this + 0x240);
                        *puVar12 = 0;
                        puVar12[1] = 0;
                        puVar12[2] = 0;
                        puVar12[3] = 0;
                        puVar12[4] = 0;
                        puVar12[5] = 0;
                        puVar12[6] = 0;
                        puVar12[7] = 0;
                        puVar12[8] = 0;
                        puVar12[9] = 0;
                        puVar12[10] = 0;
                        puVar12[0xb] = 0;
                        puVar12[0xc] = 0;
                        puVar12[0xd] = 0;
                        sVar50 = 0x70;
                        if (uVar33 < 0x70) {
                          sVar50 = (size_t)uVar33;
                        }
                        _memmove(*(void **)(this + 0x240),pvVar44,sVar50);
                      }
                    }
                    lVar37 = getStringProperty(param_1);
                    if (lVar37 == 0) {
                      local_50 = (OSMetaClass *)getArrayProperty(param_1);
                      if (local_50 != (OSMetaClass *)0x0) {
                        uVar51 = (**(code **)(*(undefined1 **)local_50 + 0x130))();
                        uVar33 = 2;
                        if (uVar51 < 2) {
                          uVar33 = uVar51;
                        }
                        local_60 = (long *)CONCAT44(local_60._4_4_,uVar33);
                        if (uVar33 != 0) {
                          local_68 = *(OSMetaClass **)PTR_metaClass_00027058;
                          pIVar5 = this + 0x198;
                          uVar46 = (long)(this + 0x1a8) - (long)pIVar5;
                          local_48 = (undefined1 *)
                                     CONCAT71(local_48._1_7_,
                                              uVar46 >> 0x20 != 0 || this + 0x1a8 < pIVar5);
                          pIVar61 = (IOSurface *)0x0;
                          uVar35 = uVar46;
                          do {
                            pOVar41 = (OSMetaClassBase *)
                                      (**(code **)(*(undefined1 **)local_50 + 0x1e8))
                                                (local_50,pIVar61,uVar35);
                            auVar65 = OSMetaClassBase::safeMetaCast(pOVar41,local_68);
                            uVar35 = auVar65._8_8_;
                            if (auVar65._0_8_ != 0) {
                              plVar36 = IOSurfaceRoot::lookupMemoryRegion
                                                  (_gIOSurfaceRoot,auVar65._0_8_);
                              if ((char)local_48 != '\0') goto LAB_00006cdd;
                              uVar33 = *(uint *)(this + 400);
                              uVar40 = (ulong)uVar33;
                              if (uVar40 * 8 - 0x80000000 < 0xffffffff00000000) goto LAB_00006ce9;
                              uVar35 = uVar40 << 0x23;
                              if ((long)uVar35 < 0) goto LAB_00006cd1;
                              local_98 = (uint)uVar46;
                              if (local_98 < (int)(uVar35 >> 0x20) + 8U) goto LAB_00006cd1;
                              pIVar63 = pIVar5 + (uVar35 >> 0x20);
                              uVar48 = (ulong)CARRY8(uVar35 >> 0x20,(ulong)pIVar5);
                              uVar35 = -uVar48;
                              if ((uVar48 != uVar35) || ((long)uVar35 < 0)) goto LAB_00006cf5;
                              if (*(long **)pIVar63 == (long *)0x0) {
                                *(long **)pIVar63 = plVar36;
                              }
                              else {
                                (**(code **)(**(long **)pIVar63 + 0x28))();
                                uVar33 = *(uint *)(this + 400);
                                uVar40 = (ulong)uVar33;
                                *(long **)pIVar63 = plVar36;
                                if (uVar40 * 8 - 0x80000000 < 0xffffffff00000000) goto LAB_00006ce9;
                              }
                              uVar40 = uVar40 << 0x23;
                              if (((long)uVar40 < 0) || (local_98 < (int)(uVar40 >> 0x20) + 8U))
                              goto LAB_00006cd1;
                              uVar48 = (ulong)CARRY8(uVar40 >> 0x20,(ulong)pIVar5);
                              uVar35 = -uVar48;
                              if ((uVar48 != uVar35) || ((long)uVar35 < 0)) goto LAB_00006cf5;
                              if (*(long *)(pIVar5 + (uVar40 >> 0x20)) != 0) {
                                *(uint *)(this + 400) = uVar33 + 1;
                              }
                            }
                            uVar33 = (int)pIVar61 + 1;
                            pIVar61 = (IOSurface *)(ulong)uVar33;
                          } while ((uint)local_60 != uVar33);
                        }
                      }
                    }
                    else {
                      plVar36 = IOSurfaceRoot::lookupMemoryRegion(_gIOSurfaceRoot,lVar37);
                      pIVar5 = this + 0x198;
                      uVar35 = (long)(this + 0x1a8) - (long)pIVar5;
                      if ((this + 0x1a8 < pIVar5) || (uVar35 >> 0x20 != 0)) {
LAB_00006cdd:
                    // WARNING: Subroutine does not return
                        os_detail::panic_trapping_policy::trap
                                  (
                                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                                  );
                      }
                      if ((uVar35 & 0xfffffff8) == 0) {
LAB_00006cd1:
                    // WARNING: Subroutine does not return
                        os_detail::panic_trapping_policy::trap
                                  (
                                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                                  );
                      }
                      if (*(long **)pIVar5 != (long *)0x0) {
                        (**(code **)(**(long **)pIVar5 + 0x28))();
                      }
                      *(long **)pIVar5 = plVar36;
                      if (plVar36 != (long *)0x0) {
                        *(undefined4 *)(this + 400) = 1;
                      }
                    }
                    bVar31 = getUInt64Property(param_1,"IOSurfaceAllocateFromSuperbuffer",&local_40)
                    ;
                    if (bVar31) {
                      *(ulong *)(this + 800) = (ulong)local_40 & 0xffffffff;
                    }
                    _kernel_debug(0x5400010,(ulong)*(uint *)(this + 0x10),
                                  (ulong)*(uint *)(this + 0x80),*(uintptr_t *)(this + 0x90),
                                  (ulong)(*(uint *)(this + 0x3c8) >> 9 & 1 |
                                         *(int *)(this + 0x98) << 8),0);
                    _kernel_debug(0x5400014,(ulong)*(uint *)(this + 0x10),
                                  *(uintptr_t *)(this + 0x58),*(uintptr_t *)(this + 0x60),
                                  (ulong)*(ushort *)(this + 0x70) |
                                  (long)(int)((uint)(byte)this[0x72] << 0x18) |
                                  (ulong)(byte)this[0x73] << 0x10,0);
                    init_values(this);
                    uVar35 = CONCAT71((int7)((ulong)pIVar61 >> 8),1);
                    goto LAB_000066d4;
                  }
                  pcVar54 = "IOSurface: Cannot set both global and private properties\n";
                }
              }
            }
            else {
              pcVar54 = 
              "IOSurface: child surfaces must specify an allocation size less than or equal to the parent surface size\n"
              ;
            }
          }
        }
      }
LAB_000066ca:
      _IOLog(pcVar54);
    }
  }
LAB_000066d1:
  uVar35 = 0;
LAB_000066d4:
  return uVar35 & 0xffffffff;
}



// IOSurface::allocate()

undefined8 __thiscall IOSurface::allocate(IOSurface *this)

{
  int *piVar1;
  long lVar2;
  long *plVar3;
  char cVar4;
  vm_map_t vVar5;
  kern_return_t kVar6;
  int iVar7;
  int iVar8;
  undefined4 uVar9;
  long *plVar10;
  undefined8 uVar11;
  ulong uVar12;
  IOMemoryDescriptor *pIVar13;
  IOSurfaceMemoryPoolBunch *pIVar14;
  ulong uVar15;
  ulong uVar16;
  IOSurface *pIVar17;
  mach_vm_address_t *address;
  ulong uVar18;
  ulong uVar19;
  uint uVar20;
  undefined1 *local_88;
  undefined1 *local_80;
  undefined1 *local_78;
  undefined1 *local_70;
  undefined4 local_68;
  mach_msg_type_number_t local_64;
  mach_vm_size_t local_60;
  IOSurface *local_58;
  ulong local_50;
  IOSurface *local_48;
  mach_vm_address_t local_40;
  char local_31;
  
  if (*(long *)(this + 0x358) != 0) {
    libkern::intrusive_shared_ptr<>::reset
              ((long *)(this + 0x30),*(long **)(*(long *)(this + 0x358) + 0x30));
    goto LAB_00006d33;
  }
  local_58 = this;
  if (*(long *)(this + 0x150) != 0) {
    uVar19 = *(ulong *)(this + 0x158);
    uVar11 = *(undefined8 *)(this + 0x170);
    uVar18 = *(long *)(this + 0x150) + *(long *)(this + 0x160);
    local_60 = 0;
    local_48 = (IOSurface *)CONCAT44(local_48._4_4_,0x110003);
    local_50 = 0;
    uVar15 = 0;
    local_40 = uVar19;
    do {
      while( true ) {
        local_64 = 9;
        local_70 = &DAT_aaaaaaaaaaaaaaaa;
        local_78 = &DAT_aaaaaaaaaaaaaaaa;
        local_80 = &DAT_aaaaaaaaaaaaaaaa;
        local_88 = &DAT_aaaaaaaaaaaaaaaa;
        local_68 = 0xaaaaaaaa;
        if (local_60 != 0) {
          uVar15 = local_60 + local_40;
          local_60 = 0;
          local_40 = uVar15;
        }
        vVar5 = _get_task_map(uVar11);
        address = &local_40;
        kVar6 = _mach_vm_region(vVar5,address,&local_60,9,(vm_region_info_t)&local_88,&local_64,
                                (mach_port_t *)0x0);
        this = local_58;
        if (kVar6 != 0) {
          return 0xe00002c8;
        }
        if (uVar19 < local_40 && uVar15 == 0) {
          return 0xe00002c8;
        }
        if (uVar15 != 0 && uVar15 != local_40) {
          return 0xe00002c8;
        }
        if (((ulong)local_88 & 4) != 0) {
          return 0xe00002c8;
        }
        if (((ulong)local_88 & 0x200000000) != 0) break;
        local_48 = (IOSurface *)CONCAT44(local_48._4_4_,0x110002);
        local_50 = CONCAT71((int7)((ulong)address >> 8),1);
        if (uVar18 <= local_60 + local_40) goto LAB_000070e5;
      }
    } while (local_60 + local_40 < uVar18);
    if ((local_50 & 1) == 0) {
      plVar10 = (long *)IOMemoryDescriptor::withAddressRange
                                  (*(ulonglong *)(local_58 + 0x158),*(ulonglong *)(local_58 + 0x160)
                                   ,(uint)local_48,*(task **)(local_58 + 0x170));
LAB_0000717a:
      internal_set_memory_descriptor((long)this,plVar10);
      if (plVar10 != (long *)0x0) {
        (**(code **)(*plVar10 + 0x28))(plVar10);
      }
    }
    else {
LAB_000070e5:
      local_88 = (undefined1 *)0x0;
      local_40 = 0;
      uVar11 = _get_task_map(*(undefined8 *)(local_58 + 0x170));
      iVar8 = _vm_map_copyin(uVar11,*(undefined8 *)(this + 0x158),*(undefined8 *)(this + 0x90),0,
                             &local_88);
      if (iVar8 == 0) {
        uVar11 = _get_task_map(*(undefined8 *)(this + 0x170));
        iVar8 = _vm_map_copyout(uVar11,&local_40,local_88);
        if (iVar8 == 0) {
          plVar10 = (long *)IOMemoryDescriptor::withAddressRange
                                      (local_40,*(ulonglong *)(this + 0x160),0x110003,
                                       *(task **)(this + 0x170));
          vVar5 = _get_task_map(*(undefined8 *)(this + 0x170));
          _vm_deallocate(vVar5,local_40,*(vm_size_t *)(this + 0x160));
          goto LAB_0000717a;
        }
        _vm_map_copy_discard(local_88);
      }
    }
    if ((*(long *)(this + 0x30) != 0) && (*(long *)(this + 0x170) != 0)) {
      uVar11 = _get_task_map();
      iVar8 = _vm_map_page_size(uVar11);
      if (*(long *)PTR__page_size_000270c0 != (long)iVar8) {
        local_88 = &DAT_aaaaaaaaaaaaaaaa;
        IOMemoryDescriptor::getDMAMapLength(*(ulonglong **)(this + 0x30));
        *(ulong *)(this + 0x168) = (ulong)local_88 & 0xffffffff;
      }
    }
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0x20);
    lVar2 = *(long *)(this + 0x178);
    piVar1 = (int *)(lVar2 + 0xc);
    *piVar1 = *piVar1 + 1;
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0xc);
    piVar1 = (int *)(lVar2 + 0x10);
    *piVar1 = *piVar1 + 1;
    goto LAB_00006d33;
  }
  if (*(long *)(this + 0x350) != 0) {
    return 0xe00002c7;
  }
  if (*(int *)(this + 400) != 0) {
    local_48 = this + 0x198;
    local_50 = (long)(this + 0x1a8) - (long)local_48;
    local_31 = local_50 >> 0x20 != 0 || this + 0x1a8 < local_48;
    uVar18 = 0;
    uVar19 = 0xffffffff80000000;
    uVar15 = 0;
    do {
      iVar8 = (int)(uVar18 >> 0x20);
      if (*(int *)(this + 0x9c) == 0) {
        if (local_31 != '\0') goto LAB_0000744c;
        if (uVar19 < 0xffffffff00000000) goto LAB_00007434;
        if (((long)uVar18 < 0) || ((uint)local_50 < iVar8 + 8U)) goto LAB_00007428;
        uVar16 = (ulong)CARRY8(uVar18 >> 0x20,(ulong)local_48);
        uVar12 = -uVar16;
        if ((uVar16 != uVar12) || ((long)uVar12 < 0)) goto LAB_00007440;
        uVar9 = (**(code **)(**(long **)(local_48 + (uVar18 >> 0x20)) + 0x158))();
        *(undefined4 *)(this + 0x9c) = uVar9;
      }
      else {
        if (local_31 != '\0') {
LAB_0000744c:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                    );
        }
        if (uVar19 < 0xffffffff00000000) goto LAB_00007434;
        if (((long)uVar18 < 0) || ((uint)local_50 < iVar8 + 8U)) goto LAB_00007428;
        pIVar17 = local_48 + (uVar18 >> 0x20);
        uVar16 = (ulong)CARRY8(uVar18 >> 0x20,(ulong)local_48);
        uVar12 = -uVar16;
        if ((uVar16 != uVar12) || ((long)uVar12 < 0)) goto LAB_00007440;
        iVar7 = (**(code **)(**(long **)pIVar17 + 0x158))();
        if (((iVar7 == 0x400) || (iVar7 == 0x100)) &&
           (uVar20 = *(uint *)(local_58 + 0x9c), (uVar20 | 0x100) == 0x300)) {
          uVar9 = (**(code **)(**(long **)pIVar17 + 0x158))();
          _IOLog("IOSurface::allocate() - requested cache mode %08x incompatible with memory region cache mode %08x\n"
                 ,uVar20,uVar9);
          return 0xe00002c2;
        }
      }
      this = local_58;
      if (*(long *)(local_58 + 0x3a0) == 0) {
        if (uVar19 < 0xffffffff00000000) {
LAB_00007434:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        if ((long)uVar18 < 0) {
LAB_00007428:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        if ((uint)local_50 < iVar8 + 8U) goto LAB_00007428;
        pIVar17 = local_48 + (uVar18 >> 0x20);
        uVar16 = (ulong)CARRY8(uVar18 >> 0x20,(ulong)local_48);
        uVar12 = -uVar16;
        if ((uVar16 != uVar12) || ((long)uVar12 < 0)) {
LAB_00007440:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        plVar10 = *(long **)pIVar17;
        cVar4 = (**(code **)(*plVar10 + 0x120))(plVar10,local_58);
        if (cVar4 != '\0') {
          plVar10 = *(long **)pIVar17;
          plVar3 = *(long **)(this + 0x28);
          *(long **)(this + 0x28) = plVar10;
          if (plVar10 != (long *)0x0) {
            (**(code **)(*plVar10 + 0x20))();
          }
          if (plVar3 != (long *)0x0) {
            (**(code **)(*plVar3 + 0x28))(plVar3);
          }
          pIVar13 = (IOMemoryDescriptor *)(**(code **)(**(long **)(this + 0x28) + 0x130))();
          plVar10 = (long *)IOSubMemoryDescriptor::withSubRange
                                      (pIVar13,*(ulonglong *)(this + 0x88),
                                       *(long *)(this + 0x90) + 0xfffU & 0xfffffffffffff000,0x100003
                                      );
          internal_set_memory_descriptor((long)this,plVar10);
          if (plVar10 != (long *)0x0) {
            (**(code **)(*plVar10 + 0x28))();
          }
          uVar20 = *(uint *)(this + 400);
          break;
        }
      }
      uVar15 = uVar15 + 1;
      uVar20 = *(uint *)(this + 400);
      uVar18 = uVar18 + 0x800000000;
      uVar19 = uVar19 + 8;
    } while (uVar15 < uVar20);
    if ((uVar20 != 0) && (*(long *)(this + 0x30) != 0)) goto LAB_00006d33;
  }
  uVar20 = *(uint *)(this + 0x3c8) >> 9 & 0x40 | *(uint *)(this + 0x9c) |
           (*(uint *)(this + 0x3c8) & 0x20000) << 6 | 0x110023;
  if ((*(long *)(this + 800) != 0) &&
     (pIVar14 = (IOSurfaceMemoryPoolBunch *)IOSurfaceRoot::getMemoryPoolBunch(_gIOSurfaceRoot),
     pIVar14 != (IOSurfaceMemoryPoolBunch *)0x0)) {
    plVar10 = IOSurfaceMemoryPoolBunch::newWiredMemoryDescriptorWithLength
                        (pIVar14,*(long *)(this + 0x90) + 0xfffU & 0xfffffffffffff000,uVar20,
                         *(long *)(this + 800),*(undefined8 *)(this + 0x170),
                         *(uint *)(this + 0x3c8) >> 0xb & 1);
    internal_set_memory_descriptor((long)this,plVar10);
    if (plVar10 != (long *)0x0) {
      (**(code **)(*plVar10 + 0x28))(plVar10);
    }
    (**(code **)(*(long *)pIVar14 + 0x28))();
  }
  if (*(long *)(this + 0x30) == 0) {
    plVar10 = (long *)IOBufferMemoryDescriptor::inTaskWithOptions
                                ((task *)0x0,uVar20,
                                 *(long *)(this + 0x90) + 0xfffU & 0xfffffffffffff000,
                                 *(ulong *)PTR__page_size_000270c0);
    internal_set_memory_descriptor((long)this,plVar10);
    if (plVar10 != (long *)0x0) {
      (**(code **)(*plVar10 + 0x28))(plVar10);
    }
    if (*(long *)(this + 0x30) != 0) goto LAB_000073a5;
LAB_000073cb:
    uVar20 = *(uint *)(this + 0x3c8) | 0x20;
  }
  else {
LAB_000073a5:
    iVar8 = *(int *)(this + 0x9c);
    if (((iVar8 != 0x100) && (iVar8 != 0x700)) && (iVar8 != 0x400)) goto LAB_000073cb;
    uVar20 = *(uint *)(this + 0x3c8) & 0xffffffdf;
  }
  *(uint *)(this + 0x3c8) = uVar20;
LAB_00006d33:
  if ((*(long *)(this + 0x30) != 0) ||
     (_IOLog("IOSurface warning: buffer allocation failed.  %llu x %llu fmt: %08x size: %llu bytes\n"
             ,*(undefined8 *)(this + 0x58),*(undefined8 *)(this + 0x60),*(undefined4 *)(this + 0x80)
             ,*(undefined8 *)(this + 0x90)), *(long *)(this + 0x30) != 0)) {
    plVar10 = IOSurfaceMemoryTag::withSurface(this);
    IOMemoryDescriptor::setContext(*(OSObject **)(this + 0x30));
    if (plVar10 != (long *)0x0) {
      (**(code **)(*plVar10 + 0x28))(plVar10);
    }
  }
  uVar11 = 0xe00002be;
  if (*(long *)(this + 0x30) != 0) {
    uVar11 = 0;
  }
  return uVar11;
}



// IOSurface::finalize()

void __thiscall IOSurface::finalize(IOSurface *this)

{
  long *plVar1;
  uintptr_t local_20;
  
  local_20 = 0;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_20);
  _kernel_debug(0x85210024,local_20,(ulong)*(uint *)(this + 0x10),0,0,0);
  plVar1 = *(long **)(this + 0x30);
  if ((plVar1 != (long *)0x0) && (((byte)this[0x3c9] & 4) != 0)) {
    (**(code **)(*plVar1 + 0x1f8))(plVar1,0);
  }
  unregister_surface(this);
  if (*(uint *)(this + 0x10) != 0) {
    *(undefined8 *)(this + 0x178) = 0;
    *(undefined8 *)(this + 0x2e0) = 0;
    IOSurfaceRoot::free_surface_handle(_gIOSurfaceRoot,(long)this,*(uint *)(this + 0x10));
    *(undefined4 *)(this + 0x10) = 0;
  }
  if (*(long *)(this + 0x240) != 0) {
    *(undefined8 *)(this + 0x240) = 0;
    _IOFreeTypeImpl(&finalize()::kalloc_type_view_450);
    *(undefined8 *)(this + 0x240) = 0;
  }
  (**(code **)(*(long *)this + 0x90))(this);
  return;
}



// IOSurface::unregister_surface()

void __thiscall IOSurface::unregister_surface(IOSurface *this)

{
  _IOLockLock(*(undefined8 *)(_gIOSurfaceRoot + 0x138));
  if (((byte)this[0x3c8] & 1) != 0) {
    IOSurfaceRoot::remove_surface_buffer(_gIOSurfaceRoot,(long)this);
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] & 0xfe);
  }
  _IOLockUnlock(*(undefined8 *)(_gIOSurfaceRoot + 0x138));
  return;
}



// IOSurface::getRetainCount() const

undefined4 __thiscall IOSurface::getRetainCount(IOSurface *this)

{
  return *(undefined4 *)(this + 0xc);
}



// IOSurface::tryRetain() const

void __thiscall IOSurface::tryRetain(IOSurface *this)

{
  _iosfc_ref_retain_try_internal((uint *)(this + 0xc));
  return;
}



// IOSurface::retain() const

void __thiscall IOSurface::retain(IOSurface *this)

{
  uint uVar1;
  IOSurface *pIVar2;
  
  pIVar2 = this + 0xc;
  LOCK();
  uVar1 = *(uint *)pIVar2;
  *(uint *)pIVar2 = *(uint *)pIVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(pIVar2,uVar1);
  return;
}



// IOSurface::release() const

void __thiscall IOSurface::release(IOSurface *this)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x000075d3. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x118))(this);
  return;
}



// IOSurface::release(int) const

void __thiscall IOSurface::release(IOSurface *this,int param_1)

{
  int iVar1;
  
  if (param_1 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x00007612. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    release();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::taggedRetain(void const*) const

void __cdecl IOSurface::taggedRetain(long param_1)

{
  uint uVar1;
  uint *puVar2;
  
  puVar2 = (uint *)(param_1 + 0xc);
  LOCK();
  uVar1 = *puVar2;
  *puVar2 = *puVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(puVar2,uVar1);
  return;
}



// IOSurface::taggedRelease(void const*, int) const

void __thiscall IOSurface::taggedRelease(IOSurface *this,undefined8 param_2_00,int param_2)

{
  int iVar1;
  
  if (param_2 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x00007666. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    taggedRelease();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::taggedRelease(void const*) const

void __cdecl IOSurface::taggedRelease(long *param_1)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)((long)param_1 + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x000076a7. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x118))(param_1);
  return;
}



// IOSurface::free()

void __thiscall IOSurface::free(IOSurface *this)

{
  IOSurface *pIVar1;
  undefined1 auVar2 [16];
  long lVar3;
  undefined8 uVar4;
  ulong uVar5;
  char *pcVar6;
  
  if (*(int *)(this + 0x3b4) == 0) {
    if (*(long *)(this + 0x220) == 0) {
      if (*(long *)(this + 0x230) == 0) {
        if (*(long **)(this + 0x358) != (long *)0x0) {
          (**(code **)(**(long **)(this + 0x358) + 0x28))();
        }
        *(undefined8 *)(this + 0x358) = 0;
        if (*(long *)(this + 0x40) == 0) {
          if (*(long *)(this + 0x340) != 0) {
            *(undefined8 *)(this + 0x340) = 0;
            _IOFreeTypeImpl(&free()::kalloc_type_view_533);
            *(undefined8 *)(this + 0x340) = 0;
          }
          deallocate(this);
          lVar3 = *(long *)(this + 0x350);
          if (lVar3 != 0) {
            *(undefined8 *)(this + 0x350) = 0;
            _IOFreeData(lVar3,(ulong)*(uint *)(this + 0x3b8) << 4);
            *(undefined8 *)(this + 0x350) = 0;
          }
          pIVar1 = *(IOSurface **)(this + 0x180);
          if (((pIVar1 != (IOSurface *)0x0) && ((ulong)*(uint *)(this + 0x98) != 0)) &&
             (pIVar1 != this + 0xa8)) {
            _IOFreeTypeVarImpl(&free()::kalloc_type_view_553,pIVar1,
                               (ulong)*(uint *)(this + 0x98) * 0x38);
            *(undefined8 *)(this + 0x180) = 0;
            *(undefined4 *)(this + 0x188) = 0;
          }
          if (*(long *)(this + 0x2f8) != 0) {
            auVar2._8_8_ = 0;
            auVar2._0_8_ = *(ulong *)(this + 0x308);
            lVar3 = SUB168(ZEXT816(0x18) * auVar2,0);
            if (lVar3 < 0) {
              lVar3 = -0x8000000000000000;
            }
            if (SUB168(ZEXT816(0x18) * auVar2,8) != 0) {
              lVar3 = -0x8000000000000000;
            }
            _IOFreeData(*(long *)(this + 0x2f8),lVar3);
            *(undefined8 *)(this + 0x2f8) = 0;
            *(undefined4 *)(this + 0x300) = 0;
          }
          if (*(long *)(this + 0x330) != 0) {
            uVar5 = *(ulong *)(this + 0x328) & 0xffffffffffffffe0;
            if ((long)uVar5 < 0) {
              uVar5 = 0x8000000000000000;
            }
            _IOFreeData(*(long *)(this + 0x330),uVar5);
            *(undefined8 *)(this + 0x330) = 0;
            *(undefined4 *)(this + 0x338) = 0;
          }
          if ((*(long *)(this + 0x2e8) != 0) && ((ulong)*(uint *)(this + 0x98) != 0)) {
            _IOFreeData(*(long *)(this + 0x2e8),(ulong)*(uint *)(this + 0x98) * 0x3c);
            *(undefined8 *)(this + 0x2e8) = 0;
            *(undefined4 *)(this + 0x2f0) = 0;
            *(undefined4 *)(this + 0x3bc) = 0;
          }
          if (*(int *)(this + 0xa0) != 0) {
            *(undefined4 *)(this + 0xa0) = 0;
          }
          *(undefined8 *)(this + 0x170) = 0;
          if (*(long *)(this + 0x398) != 0) {
            _IOLockFree();
          }
          if (*(long *)(this + 0x50) != 0) {
            _IOLockFree();
          }
                    // WARNING: Could not recover jumptable at 0x000078b6. Too many branches
                    // WARNING: Treating indirect jump as call
          (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
          return;
        }
        pcVar6 = "\"fDeviceCacheList is not empty for surface: %p\" @%s:%d";
        uVar4 = 0x211;
      }
      else {
        pcVar6 = "\"IOFence wait queue is not empty for surface: %p\" @%s:%d";
        uVar4 = 0x209;
      }
    }
    else {
      pcVar6 = "\"IOFence current queue is not empty for surface: %p\" @%s:%d";
      uVar4 = 0x205;
    }
  }
  else {
    pcVar6 = "\"IOSurface released with non-zero client retain count: %p\" @%s:%d";
    uVar4 = 0x200;
  }
                    // WARNING: Subroutine does not return
  _panic(pcVar6,this,"IOSurface.cpp",uVar4);
}



// IOSurface::deallocate()

void __thiscall IOSurface::deallocate(IOSurface *this)

{
  long *plVar1;
  
  if (*(long **)(this + 0x3c0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x3c0) + 0x28))();
    *(undefined8 *)(this + 0x3c0) = 0;
  }
  plVar1 = *(long **)(this + 0x30);
  if (plVar1 == (long *)0x0) goto LAB_000079a4;
  if (((byte)this[0x3ca] & 0x80) == 0) {
    IOSurfaceRoot::purge_iomd_from_mappers(_gIOSurfaceRoot);
    plVar1 = *(long **)(this + 0x30);
    if (plVar1 != (long *)0x0) goto LAB_00007972;
  }
  else {
LAB_00007972:
    (**(code **)(*plVar1 + 0x50))(plVar1,*(undefined8 *)PTR_metaClass_00027008);
  }
  *(undefined8 *)(this + 0x30) = 0;
  _kernel_debug(0x540000c,(ulong)*(uint *)(this + 0x10),0,0,0,0);
LAB_000079a4:
  plVar1 = *(long **)(this + 0x28);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x128))(plVar1,this);
    if (*(long **)(this + 0x28) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x28) + 0x28))();
    }
    *(undefined8 *)(this + 0x28) = 0;
  }
  return;
}



// IOSurface::register_surface()

void __thiscall IOSurface::register_surface(IOSurface *this)

{
  _IOLockLock(*(undefined8 *)(_gIOSurfaceRoot + 0x138));
  if (((byte)this[0x3c8] & 1) == 0) {
    IOSurfaceRoot::add_surface_buffer(_gIOSurfaceRoot,(long)this);
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 1);
  }
  _IOLockUnlock(*(undefined8 *)(_gIOSurfaceRoot + 0x138));
  return;
}



// IOSurface::deviceCacheForAccelerator(void*, unsigned int, unsigned int)

long * __thiscall
IOSurface::deviceCacheForAccelerator(IOSurface *this,long param_1,undefined4 param_2,int param_3)

{
  IOSurface *pIVar1;
  long lVar2;
  long *plVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  plVar3 = *(long **)(this + 0x40);
  do {
    if (plVar3 == (long *)0x0) {
      pIVar1 = this + 0x40;
      plVar3 = IOSurfaceDeviceCache::withSurfaceBufferOnAccelerator
                         (this,param_1,param_2,param_3,pIVar1);
      if (plVar3 != (long *)0x0) {
        lVar2 = *(long *)pIVar1;
        if (lVar2 == 0) {
          plVar3[6] = 0;
          *(long **)(this + 0x48) = plVar3 + 6;
        }
        else {
          if (*(IOSurface **)(lVar2 + 0x38) != pIVar1) {
                    // WARNING: Subroutine does not return
            _panic("\"Bad tailq head %p first->prev != head @%u\" @%s:%d",pIVar1,0x291,
                   "IOSurface.cpp",0x291);
          }
          plVar3[6] = lVar2;
          *(long **)(lVar2 + 0x38) = plVar3 + 6;
        }
        *(long **)pIVar1 = plVar3;
        plVar3[7] = (long)pIVar1;
      }
LAB_00007ac3:
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      return plVar3;
    }
    if ((plVar3[3] == param_1) && (*(int *)((long)plVar3 + 0x54) == param_3)) {
      if (*(char *)((long)plVar3 + 0x59) == '\0') {
        (**(code **)(*plVar3 + 0x20))(plVar3);
      }
      else {
        (**(code **)(*(long *)this + 0x20))(this);
        *(undefined1 *)((long)plVar3 + 0x59) = 0;
      }
      goto LAB_00007ac3;
    }
    plVar3 = (long *)plVar3[6];
  } while( true );
}



// IOSurface::unorphan_device_cache(IOSurfaceDeviceCache*)

void __thiscall IOSurface::unorphan_device_cache(undefined8 param_1_00,long param_2)

{
  *(undefined1 *)(param_2 + 0x59) = 0;
  return;
}



// IOSurface::remove_device_cache(IOSurfaceDeviceCache*)

void __thiscall IOSurface::remove_device_cache(IOSurface *this,long param_1)

{
  long lVar1;
  undefined8 *puVar2;
  long *plVar3;
  char *pcVar4;
  
  if (*(long *)(param_1 + 0x40) == 0) goto LAB_00007b71;
  lVar1 = *(long *)(param_1 + 0x30);
  if (lVar1 == 0) {
    plVar3 = *(long **)(param_1 + 0x38);
    if (*plVar3 != param_1) {
LAB_00007b8f:
      pcVar4 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00007b9f:
                    // WARNING: Subroutine does not return
      _panic(pcVar4,param_1,0x2c9,"IOSurface.cpp",0x2c9);
    }
    *(long **)(*(long *)(param_1 + 0x40) + 8) = plVar3;
  }
  else {
    if (*(long *)(lVar1 + 0x38) != param_1 + 0x30) {
      pcVar4 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_00007b9f;
    }
    if (**(long **)(param_1 + 0x38) != param_1) goto LAB_00007b8f;
    *(long **)(lVar1 + 0x38) = *(long **)(param_1 + 0x38);
    plVar3 = *(long **)(param_1 + 0x38);
  }
  *plVar3 = lVar1;
LAB_00007b71:
  if (*(long *)(this + 0x38) == param_1) {
    *(undefined8 *)(this + 0x38) = 0;
    puVar2 = *(undefined8 **)(this + 0x178);
    *(undefined2 *)(puVar2 + 1) = 0;
    *puVar2 = 0;
  }
  return;
}



// IOSurface::orphan_device_cache(IOSurfaceDeviceCache*)

void __thiscall IOSurface::orphan_device_cache(undefined8 param_1_00,long param_2)

{
  *(undefined1 *)(param_2 + 0x59) = 1;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getBoolPropertyInternal(OSDictionary*, char const*, bool&)

bool __cdecl getBoolPropertyInternal(long *param_1,undefined8 param_2,undefined1 *param_3)

{
  undefined1 uVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  
  pOVar2 = (OSMetaClassBase *)(**(code **)(*param_1 + 0x208))();
  plVar3 = (long *)OSMetaClassBase::safeMetaCast(pOVar2,*(OSMetaClass **)PTR_metaClass_00027068);
  if (plVar3 != (long *)0x0) {
    uVar1 = (**(code **)(*plVar3 + 0x128))(plVar3);
    *param_3 = uVar1;
  }
  return plVar3 != (long *)0x0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getUInt32MaxOptionalProperty(OSDictionary*, char const*, unsigned int&)

ulong __cdecl getUInt32MaxOptionalProperty(long *param_1,undefined8 param_2,undefined4 *param_3)

{
  bool bVar1;
  undefined8 unaff_R14;
  ulong uVar2;
  undefined1 *local_28;
  
  local_28 = &DAT_aaaaaaaaaaaaaaaa;
  bVar1 = getUInt64Property(param_1,param_2,&local_28);
  uVar2 = CONCAT71((int7)((ulong)unaff_R14 >> 8),1);
  if (bVar1) {
    if ((ulong)local_28 >> 0x20 == 0) {
      *param_3 = (int)local_28;
    }
    else {
      uVar2 = 0;
      _IOLog("IOSurface: %s exceeds maximum value\n",param_2);
    }
  }
  return uVar2 & 0xffffffff;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getArrayProperty(OSDictionary*, char const*)

void __cdecl getArrayProperty(long *param_1)

{
  OSMetaClassBase *pOVar1;
  
  pOVar1 = (OSMetaClassBase *)getObject(param_1);
  OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027038);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getUInt64Property(OSDictionary*, char const*, unsigned long long&)

bool __cdecl getUInt64Property(long *param_1,undefined8 param_2,undefined8 *param_3)

{
  OSMetaClassBase *pOVar1;
  long *plVar2;
  undefined8 uVar3;
  
  pOVar1 = (OSMetaClassBase *)(**(code **)(*param_1 + 0x208))();
  plVar2 = (long *)OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027040);
  if (plVar2 != (long *)0x0) {
    uVar3 = (**(code **)(*plVar2 + 0x150))(plVar2);
    *param_3 = uVar3;
  }
  return plVar2 != (long *)0x0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getUInt8MaxOptionalProperty(OSDictionary*, char const*, unsigned char&)

ulong __cdecl getUInt8MaxOptionalProperty(long *param_1,undefined8 param_2,undefined1 *param_3)

{
  bool bVar1;
  undefined8 unaff_R14;
  ulong uVar2;
  undefined1 *local_28;
  
  local_28 = &DAT_aaaaaaaaaaaaaaaa;
  bVar1 = getUInt64Property(param_1,param_2,&local_28);
  uVar2 = CONCAT71((int7)((ulong)unaff_R14 >> 8),1);
  if (bVar1) {
    if (local_28 < (undefined1 *)0x100) {
      *param_3 = (char)local_28;
    }
    else {
      uVar2 = 0;
      _IOLog("IOSurface: %s exceeds maximum value\n",param_2);
    }
  }
  return uVar2 & 0xffffffff;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// parseAdditionalPlaneInfo(IOSurfaceAdditionalPlaneInfo*, OSDictionary*)

ulong __cdecl parseAdditionalPlaneInfo(byte *param_1,long *param_2)

{
  ulong uVar1;
  
  uVar1 = validateAdditionalPlaneComponentInfo
                    (param_1,param_2,"IOSurfacePlaneComponentBitDepths",(long)(param_1 + 4));
  if ((char)uVar1 != '\0') {
    uVar1 = validateAdditionalPlaneComponentInfo
                      (param_1,param_2,"IOSurfacePlaneComponentBitOffsets",(long)(param_1 + 8));
    if ((char)uVar1 != '\0') {
      uVar1 = validateAdditionalPlaneComponentInfo
                        (param_1,param_2,"IOSurfacePlaneComponentNames",(long)(param_1 + 0xc));
      if ((char)uVar1 != '\0') {
        uVar1 = validateAdditionalPlaneComponentInfo
                          (param_1,param_2,"IOSurfacePlaneComponentTypes",(long)(param_1 + 0x10));
        if ((char)uVar1 != '\0') {
          uVar1 = validateAdditionalPlaneComponentInfo
                            (param_1,param_2,"IOSurfacePlaneComponentRanges",(long)(param_1 + 0x14))
          ;
          return uVar1;
        }
      }
    }
  }
  return 0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getUInt32MaxRequiredProperty(OSDictionary*, char const*, unsigned int&)

ulong __cdecl getUInt32MaxRequiredProperty(long *param_1,undefined8 param_2,undefined4 *param_3)

{
  bool bVar1;
  char *pcVar2;
  ulong uVar3;
  undefined1 *local_20;
  
  local_20 = &DAT_aaaaaaaaaaaaaaaa;
  bVar1 = getUInt64Property(param_1,param_2,&local_20);
  if (bVar1) {
    if ((ulong)local_20 >> 0x20 == 0) {
      *param_3 = (int)local_20;
      uVar3 = CONCAT71((int7)((ulong)param_3 >> 8),1);
      goto LAB_00007e19;
    }
    pcVar2 = "IOSurface: %s exceeds maximum value\n";
  }
  else {
    pcVar2 = "IOSurface: Required property %s missing\n";
  }
  uVar3 = 0;
  _IOLog(pcVar2,param_2);
LAB_00007e19:
  return uVar3 & 0xffffffff;
}



// IOSurface::getProtectionOptions() const

undefined8 __thiscall IOSurface::getProtectionOptions(IOSurface *this)

{
  return *(undefined8 *)(this + 0x3a0);
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getOSDataProperty(OSDictionary*, char const*)

void __cdecl getOSDataProperty(long *param_1)

{
  OSMetaClassBase *pOVar1;
  
  pOVar1 = (OSMetaClassBase *)getObject(param_1);
  OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027030);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getDictionaryProperty(OSDictionary*, char const*)

void __cdecl getDictionaryProperty(long *param_1)

{
  OSMetaClassBase *pOVar1;
  
  pOVar1 = (OSMetaClassBase *)getObject(param_1);
  OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027010);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getStringProperty(OSDictionary*, char const*)

void __cdecl getStringProperty(long *param_1)

{
  OSMetaClassBase *pOVar1;
  
  pOVar1 = (OSMetaClassBase *)getObject(param_1);
  OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027058);
  return;
}



// IOSurface::init_values()

void __thiscall IOSurface::init_values(IOSurface *this)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  long lVar3;
  
  plVar1 = (long *)OSDictionary::withCapacity(4);
  if (*(long **)(this + 0x1a8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1a8) + 0x28))();
  }
  *(long **)(this + 0x1a8) = plVar1;
  if (*(long *)(this + 0x248) != 0) {
    (**(code **)(*plVar1 + 0x1d0))(plVar1,"CreationProperties");
    pOVar2 = (OSMetaClassBase *)
             (**(code **)(**(long **)(this + 0x248) + 0x208))
                       (*(long **)(this + 0x248),"IOSurfaceName");
    if (pOVar2 != (OSMetaClassBase *)0x0) {
      lVar3 = OSMetaClassBase::safeMetaCast(pOVar2,*(OSMetaClass **)PTR_metaClass_00027058);
      if (lVar3 != 0) {
        (**(code **)(**(long **)(this + 0x1a8) + 0x1d0))
                  (*(long **)(this + 0x1a8),"IOSurfaceName",pOVar2);
      }
    }
  }
  if (*(_func_bool_OSSymbol_ptr_OSObject_ptr **)(this + 0x1f0) !=
      (_func_bool_OSSymbol_ptr_OSObject_ptr *)0x0) {
    OSDictionary::iterateObjects(*(_func_bool_OSSymbol_ptr_OSObject_ptr **)(this + 0x1f0));
  }
  lVar3 = *(long *)(this + 0x178);
  if (*(void **)(this + 0x240) == (void *)0x0) {
    *(undefined8 *)(lVar3 + 0x98) = 0;
    *(undefined8 *)(lVar3 + 0x90) = 0;
    *(undefined8 *)(lVar3 + 0x88) = 0;
    *(undefined8 *)(lVar3 + 0x80) = 0;
    *(undefined8 *)(lVar3 + 0x78) = 0;
    *(undefined8 *)(lVar3 + 0x70) = 0;
    *(undefined8 *)(lVar3 + 0x68) = 0;
    *(undefined8 *)(lVar3 + 0x60) = 0;
    *(undefined8 *)(lVar3 + 0x58) = 0;
    *(undefined8 *)(lVar3 + 0x50) = 0;
    *(undefined8 *)(lVar3 + 0x48) = 0;
    *(undefined8 *)(lVar3 + 0x40) = 0;
    *(undefined8 *)(lVar3 + 0x38) = 0;
    *(undefined8 *)(lVar3 + 0x30) = 0;
  }
  else {
    _memmove((undefined8 *)(lVar3 + 0x30),*(void **)(this + 0x240),0x70);
  }
  return;
}



// IOSurface::flushProcessorCaches()

void __thiscall IOSurface::flushProcessorCaches(IOSurface *this)

{
  long *plVar1;
  uint uVar2;
  int iVar3;
  undefined8 uVar4;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if (((byte)this[0x3c8] & 0x20) == 0) goto LAB_00008045;
  iVar3 = *(int *)(this + 0x9c);
  if (iVar3 == 0) {
    if (*(long **)(this + 0x28) == (long *)0x0) {
      iVar3 = 0;
    }
    else {
      iVar3 = (**(code **)(**(long **)(this + 0x28) + 0x158))();
      *(int *)(this + 0x9c) = iVar3;
    }
  }
  uVar2 = iVar3 - 0x100U >> 8;
  if ((6 < (uVar2 | iVar3 << 0x18)) || ((0x4bU >> (uVar2 & 0x1f) & 1) == 0)) {
    plVar1 = *(long **)(this + 0x30);
    if (plVar1 != (long *)0x0) {
      iVar3 = (**(code **)(*plVar1 + 0x1f0))(plVar1,0);
      if (iVar3 == 0) {
        plVar1 = *(long **)(this + 0x30);
        uVar4 = (**(code **)(*plVar1 + 0x1c8))(plVar1);
        (**(code **)(*plVar1 + 0x128))(plVar1,1,0,uVar4);
        (**(code **)(**(long **)(this + 0x30) + 0x1f8))(*(long **)(this + 0x30),0);
        goto LAB_0000803e;
      }
    }
    _IOLog("IOSurface::flushProcessorCaches memory prepare failed\n");
  }
LAB_0000803e:
  this[0x3c8] = (IOSurface)((byte)this[0x3c8] & 0xdf);
LAB_00008045:
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::cleanProcessorCaches()

void __thiscall IOSurface::cleanProcessorCaches(IOSurface *this)

{
  long *plVar1;
  int iVar2;
  undefined8 uVar3;
  
  iVar2 = *(int *)(this + 0x9c);
  if (iVar2 == 0) {
    if (*(long **)(this + 0x28) == (long *)0x0) goto LAB_000080f8;
    iVar2 = (**(code **)(**(long **)(this + 0x28) + 0x158))();
    *(int *)(this + 0x9c) = iVar2;
  }
  if (iVar2 == 0x100) {
    return;
  }
  if (iVar2 == 0x700) {
    return;
  }
  if (iVar2 == 0x400) {
    return;
  }
LAB_000080f8:
  if ((*(char *)(_gIOSurfaceRoot + 0x89) == '\0') &&
     (plVar1 = *(long **)(this + 0x30), plVar1 != (long *)0x0)) {
    iVar2 = (**(code **)(*plVar1 + 0x1f0))(plVar1,0);
    if (iVar2 != 0) {
      _IOLog("IOSurface::cleanProcessorCaches memory prepare failed\n");
      return;
    }
    plVar1 = *(long **)(this + 0x30);
    uVar3 = (**(code **)(*plVar1 + 0x1c8))(plVar1);
    (**(code **)(*plVar1 + 0x128))(plVar1,1,0,uVar3);
                    // WARNING: Could not recover jumptable at 0x00008172. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(**(long **)(this + 0x30) + 0x1f8))(*(long **)(this + 0x30),0);
    return;
  }
  return;
}



// IOSurface::processorDataUpdated(bool, bool)

undefined4 __thiscall IOSurface::processorDataUpdated(IOSurface *this,uint param_1,int param_2)

{
  int *piVar1;
  undefined4 uVar2;
  long lVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  lVar3 = *(long *)(this + 0x178);
  if (param_2 != 0) {
    piVar1 = (int *)(lVar3 + 0xc);
    *piVar1 = *piVar1 + 1;
  }
  *(uint *)(this + 0x3c8) = (param_1 & 0xff) << 4 | *(uint *)(this + 0x3c8) | 0xc;
  uVar2 = *(undefined4 *)(lVar3 + 0xc);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return uVar2;
}



// IOSurface::processor_data_updated(bool, bool)

undefined4 __thiscall IOSurface::processor_data_updated(IOSurface *this,byte param_1,int param_2)

{
  int *piVar1;
  long lVar2;
  
  lVar2 = *(long *)(this + 0x178);
  if (param_2 != 0) {
    piVar1 = (int *)(lVar2 + 0xc);
    *piVar1 = *piVar1 + 1;
  }
  *(uint *)(this + 0x3c8) = (uint)param_1 << 4 | *(uint *)(this + 0x3c8) | 0xc;
  return *(undefined4 *)(lVar2 + 0xc);
}



// IOSurface::invalidateProcessorCaches()

void __thiscall IOSurface::invalidateProcessorCaches(IOSurface *this)

{
  this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0x10);
  return;
}



// IOSurface::lockSurface(unsigned int, unsigned int*)

undefined8 __thiscall IOSurface::lockSurface(IOSurface *this,ulong param_2_00,uint *param_2)

{
  int *piVar1;
  uint uVar2;
  long lVar3;
  int iVar4;
  undefined8 uVar5;
  uintptr_t local_30;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if (((param_2_00 & 2) == 0) || (*(long *)(this + 0x38) == 0)) {
    if ((param_2_00 & 1) == 0) {
      iVar4 = *(int *)(this + 0x21c);
      if (iVar4 == 0) {
        _proc_selfname(this + 0x290);
        iVar4 = *(int *)(this + 0x21c);
      }
      *(int *)(this + 0x21c) = iVar4 + 1;
    }
    else {
      iVar4 = *(int *)(this + 0x218);
      if (iVar4 == 0) {
        _proc_selfname(this + 0x250);
        iVar4 = *(int *)(this + 0x218);
      }
      *(int *)(this + 0x218) = iVar4 + 1;
    }
    synchronize_device_caches(this,0,0,(param_2_00 & 1) == 0);
    if (((byte)this[0x3c8] & 0x10) != 0) {
      cleanProcessorCaches(this);
      uVar2 = *(uint *)(this + 0x3c8);
      *(uint *)(this + 0x3c8) = uVar2 & 0xffffffef;
      if ((uVar2 & 0x20) != 0) {
        *(uint *)(this + 0x3c8) = uVar2 & 0xffffffcf;
      }
    }
    lVar3 = *(long *)(this + 0x178);
    if ((param_2_00 & 1) == 0) {
      piVar1 = (int *)(lVar3 + 0xc);
      *piVar1 = *piVar1 + 1;
      this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0xc);
    }
    uVar2 = *(uint *)(lVar3 + 0xc);
    if (param_2 != (uint *)0x0) {
      *param_2 = uVar2;
    }
    local_30 = 0;
    _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_30);
    uVar5 = 0;
    _kernel_debug(0x85210010,local_30,(ulong)*(uint *)(this + 0x10),param_2_00 & 0xffffffff,
                  (ulong)uVar2,0);
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
  }
  else {
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
    uVar5 = 0xe00002cc;
  }
  return uVar5;
}



// IOSurface::synchronize_device_caches(unsigned int, unsigned int, bool)

void __thiscall
IOSurface::synchronize_device_caches(IOSurface *this,int param_1,int param_2,byte param_3)

{
  IOSurfaceDeviceCache *pIVar1;
  long *plVar2;
  int iVar3;
  long lVar4;
  long *plVar5;
  long *plVar6;
  ulong uVar7;
  ulong uVar8;
  ulong uVar9;
  long lVar10;
  ulong uVar11;
  long *plVar12;
  undefined8 *puVar13;
  long lVar14;
  uint local_160;
  long *local_150;
  long local_148;
  long local_138 [32];
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  _memset(local_138,0xaa,0x100);
  lVar4 = 0;
  do {
    local_138[lVar4] = 0;
    lVar4 = lVar4 + 1;
  } while (lVar4 != 0x20);
  if (*(int *)(this + 0x200) != 0) {
    iVar3 = *(int *)(this + 0x204);
    do {
      *(int *)(this + 0x204) = iVar3 + 1;
      _IOLockSleep_darwin14(*(undefined8 *)(this + 0x50),this,0);
      iVar3 = *(int *)(this + 0x204) + -1;
      *(int *)(this + 0x204) = iVar3;
    } while (*(int *)(this + 0x200) != 0);
  }
  pIVar1 = *(IOSurfaceDeviceCache **)(this + 0x38);
  if ((pIVar1 == (IOSurfaceDeviceCache *)0x0) ||
     ((*(int *)(pIVar1 + 0x48) == param_1 && (*(int *)(pIVar1 + 0x54) == param_2)))) {
    if ((param_3 != 0) && (plVar12 = *(long **)(this + 0x40), plVar12 != (long *)0x0)) {
      lVar10 = 0;
      plVar5 = plVar12;
      lVar4 = 0;
      do {
        lVar14 = lVar4;
        plVar5 = (long *)plVar5[6];
        lVar4 = lVar14 + 1;
        lVar10 = lVar10 + 8;
      } while (plVar5 != (long *)0x0);
      if ((uint)lVar14 < 0x20) {
        lVar4 = 0x20;
        plVar5 = (long *)0x0;
        local_150 = local_138;
      }
      else {
        plVar5 = (long *)_IOMallocTypeVarImpl
                                   (&synchronize_device_caches(unsigned_int,unsigned_int,bool)::
                                     kalloc_type_view_2928,lVar10);
        plVar12 = *(long **)(this + 0x40);
        local_150 = plVar5;
      }
      if (plVar12 == (long *)0x0) {
        _IOLockUnlock(*(undefined8 *)(this + 0x50));
        local_148 = 0;
      }
      else {
        uVar7 = (long)(local_150 + lVar4) - (long)local_150;
        if (uVar7 >> 0x20 != 0 || local_150 + lVar4 < local_150) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                    );
        }
        lVar4 = -1;
        local_148 = 0;
        uVar11 = 0;
        do {
          if (lVar4 == 0xfffffff) goto LAB_00008746;
          if ((long)uVar11 < 0) goto LAB_0000873a;
          local_160 = (uint)uVar7;
          if (local_160 < (int)(uVar11 >> 0x20) + 8U) goto LAB_0000873a;
          plVar6 = (long *)((uVar11 >> 0x20) + (long)local_150);
          uVar9 = (ulong)CARRY8(uVar11 >> 0x20,(ulong)local_150);
          uVar8 = -uVar9;
          if ((uVar9 != uVar8) || ((long)uVar8 < 0)) goto LAB_00008752;
          plVar2 = (long *)*plVar6;
          *plVar6 = (long)plVar12;
          (**(code **)(*plVar12 + 0x20))(plVar12);
          if (plVar2 != (long *)0x0) {
            (**(code **)(*plVar2 + 0x28))(plVar2);
          }
          plVar12 = (long *)plVar12[6];
          lVar4 = lVar4 + 1;
          uVar11 = uVar11 + 0x800000000;
          local_148 = local_148 + 8;
        } while (plVar12 != (long *)0x0);
        _IOLockUnlock(*(undefined8 *)(this + 0x50));
        if (local_148 == 0) {
          local_148 = 0;
        }
        else {
          lVar10 = -1;
          uVar7 = 0;
          do {
            if (lVar10 == 0xfffffff) {
LAB_00008746:
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                        );
            }
            if (((long)uVar7 < 0) || (local_160 < (int)(uVar7 >> 0x20) + 8U)) {
LAB_0000873a:
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                        );
            }
            puVar13 = (undefined8 *)((uVar7 >> 0x20) + (long)local_150);
            uVar8 = (ulong)CARRY8(uVar7 >> 0x20,(ulong)local_150);
            uVar11 = -uVar8;
            if ((uVar8 != uVar11) || ((long)uVar11 < 0)) {
LAB_00008752:
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                        );
            }
            IOSurfaceDeviceCache::wait((IOSurfaceDeviceCache *)*puVar13);
            pIVar1 = (IOSurfaceDeviceCache *)*puVar13;
            *puVar13 = 0;
            IOSurfaceDeviceCache::accelRelease(pIVar1);
            lVar10 = lVar10 + 1;
            uVar7 = uVar7 + 0x800000000;
          } while (lVar4 != lVar10);
        }
      }
      _IOLockLock(*(undefined8 *)(this + 0x50));
      if (plVar5 != (long *)0x0) {
        _IOFreeTypeVarImpl(&synchronize_device_caches(unsigned_int,unsigned_int,bool)::
                            kalloc_type_view_2950,plVar5,local_148);
      }
    }
  }
  else {
    (**(code **)(*(long *)pIVar1 + 0x20))(pIVar1);
    *(undefined8 *)(this + 0x38) = 0;
    *(int *)(this + 0x200) = *(int *)(this + 0x200) + 1;
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
    IOSurfaceDeviceCache::pageOff(pIVar1);
    IOSurfaceDeviceCache::wait(pIVar1,param_3 ^ 1);
    IOSurfaceDeviceCache::accelRelease(pIVar1);
    _IOLockLock(*(undefined8 *)(this + 0x50));
    *(int *)(this + 0x200) = *(int *)(this + 0x200) + -1;
    if (*(long *)(this + 0x38) == 0) {
      puVar13 = *(undefined8 **)(this + 0x178);
      *(undefined2 *)(puVar13 + 1) = 0;
      *puVar13 = 0;
    }
    if (*(int *)(this + 0x204) != 0) {
      _IOLockWakeup_darwin14(*(undefined8 *)(this + 0x50),this,0);
    }
  }
  lVar4 = 0xf8;
  do {
    if (*(long **)((long)local_138 + lVar4) != (long *)0x0) {
      (**(code **)(**(long **)((long)local_138 + lVar4) + 0x28))();
    }
    *(undefined8 *)((long)local_138 + lVar4) = 0;
    lVar4 = lVar4 + -8;
  } while (lVar4 != -8);
  if (*(long *)PTR____stack_chk_guard_00027088 == local_38) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurface::unlockSurface(unsigned int, unsigned int*)

undefined8 __thiscall IOSurface::unlockSurface(IOSurface *this,ulong param_2_00,undefined4 *param_2)

{
  uint uVar1;
  uintptr_t local_28;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if ((param_2_00 & 1) == 0) {
    if (*(int *)(this + 0x21c) == 0) {
LAB_00008844:
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      return 0xe00002c2;
    }
    *(int *)(this + 0x21c) = *(int *)(this + 0x21c) + -1;
    *(int *)(*(long *)(this + 0x178) + 0x10) = *(int *)(*(long *)(this + 0x178) + 0x10) + 1;
    uVar1 = *(int *)(this + 0x9c) - 0x100U >> 8;
    if ((6 < (uVar1 | *(int *)(this + 0x9c) << 0x18)) || ((0x4bU >> (uVar1 & 0x1f) & 1) == 0)) {
      this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0x20);
    }
  }
  else {
    if (*(int *)(this + 0x218) == 0) goto LAB_00008844;
    *(int *)(this + 0x218) = *(int *)(this + 0x218) + -1;
  }
  if (param_2 != (undefined4 *)0x0) {
    *param_2 = *(undefined4 *)(*(long *)(this + 0x178) + 0xc);
  }
  local_28 = 0;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_28);
  _kernel_debug(0x85210014,local_28,(ulong)*(uint *)(this + 0x10),param_2_00 & 0xffffffff,
                (ulong)*(uint *)(*(long *)(this + 0x178) + 0xc),0);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return 0;
}



// IOSurface::dirtyProcessorCaches()

void __thiscall IOSurface::dirtyProcessorCaches(IOSurface *this)

{
  this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0x20);
  return;
}



// IOSurface::purge()

void __thiscall IOSurface::purge(IOSurface *this)

{
  IOSurfaceDeviceCache *this_00;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  this[0x3c8] = (IOSurface)((byte)this[0x3c8] & 0xf3);
  for (this_00 = *(IOSurfaceDeviceCache **)(this + 0x40); this_00 != (IOSurfaceDeviceCache *)0x0;
      this_00 = *(IOSurfaceDeviceCache **)(this_00 + 0x30)) {
    IOSurfaceDeviceCache::purge(this_00);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::bind_accel(unsigned int, unsigned int)

undefined8 __thiscall IOSurface::bind_accel(IOSurface *this,int param_1,uint param_2)

{
  _IOLockLock(*(undefined8 *)(this + 0x50));
  synchronize_device_caches(this,param_1,param_2 & 7,0);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return 0;
}



// IOSurface::signalSharedEventOperation(unsigned long long, IOSurfaceSharedEvent*, unsigned long
// long)

ulong __thiscall
IOSurface::signalSharedEventOperation
          (IOSurface *this,long param_1,IOSurfaceSharedEvent *param_2,ulong param_3)

{
  IOSurfaceDeviceCache *this_00;
  int iVar1;
  ulong uVar2;
  
  uVar2 = 0xe00002c7;
  if (param_1 != 1) {
    _IOLockLock(*(undefined8 *)(this + 0x50));
    if (*(int *)(this + 0x200) != 0) {
      iVar1 = *(int *)(this + 0x204) + 1;
      do {
        *(int *)(this + 0x204) = iVar1;
        _IOLockSleep_darwin14(*(undefined8 *)(this + 0x50),this,0);
        iVar1 = *(int *)(this + 0x204);
        *(int *)(this + 0x204) = iVar1 + -1;
      } while (*(int *)(this + 0x200) != 0);
    }
    this_00 = *(IOSurfaceDeviceCache **)(this + 0x38);
    if (this_00 == (IOSurfaceDeviceCache *)0x0) {
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      IOSurfaceSharedEvent::signalCompleted(param_2,param_3);
      uVar2 = 0;
    }
    else {
      (**(code **)(*(long *)this_00 + 0x20))(this_00);
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      uVar2 = IOSurfaceDeviceCache::signalEventOperation(this_00,param_1,param_2,param_3);
      uVar2 = uVar2 & 0xffffffff;
      IOSurfaceDeviceCache::accelRelease(this_00);
    }
  }
  return uVar2;
}



// IOSurface::set_current_device_cache(IOSurfaceDeviceCache*)

int __thiscall IOSurface::set_current_device_cache(IOSurface *this,long param_1)

{
  int iVar1;
  int iVar2;
  undefined8 *puVar3;
  char *pcVar4;
  IOSurface *pIVar5;
  int iVar6;
  undefined8 local_78;
  undefined8 local_70;
  undefined8 local_68;
  undefined8 local_60;
  undefined8 local_58;
  undefined8 local_50;
  undefined8 local_48;
  undefined8 local_40;
  long local_30;
  
  local_30 = *(long *)PTR____stack_chk_guard_00027088;
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if ((*(long *)(this + 0x38) == 0) || (*(long *)(this + 0x38) == param_1)) {
    puVar3 = *(undefined8 **)(this + 0x178);
    iVar1 = *(int *)((long)puVar3 + 0xc);
    iVar2 = *(int *)(puVar3 + 2);
    *(int *)((long)puVar3 + 0xc) = iVar1 + 1;
    iVar6 = iVar2 + 1;
    *(int *)(puVar3 + 2) = iVar6;
    if (iVar1 != iVar2) {
      local_40 = 0;
      local_48 = 0;
      local_50 = 0;
      local_58 = 0;
      local_60 = 0;
      local_68 = 0;
      local_70 = 0;
      local_78 = 0;
      _proc_selfname(&local_78,0x40);
      pcVar4 = "write";
      pIVar5 = this + 0x290;
      if (*(uint *)(this + 0x21c) < *(uint *)(this + 0x218)) {
        pcVar4 = "read";
        pIVar5 = this + 0x250;
      }
      _IOLog("Warning: IOSurface %08x modified by process %s using the GPU while surface is %s locked by process %s\n"
             ,*(undefined4 *)(this + 0x10),&local_78,pcVar4,pIVar5);
      puVar3 = *(undefined8 **)(this + 0x178);
    }
    *(long *)(this + 0x38) = param_1;
    *(undefined2 *)(puVar3 + 1) = *(undefined2 *)(param_1 + 0x48);
    *puVar3 = *(undefined8 *)(param_1 + 0x60);
    *(undefined2 *)((long)puVar3 + 10) = *(undefined2 *)(param_1 + 0x54);
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] & 0xf7);
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
  }
  else {
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
    iVar6 = *(int *)(*(long *)(this + 0x178) + 0x10) + -1;
  }
  if (*(long *)PTR____stack_chk_guard_00027088 != local_30) {
                    // WARNING: Subroutine does not return
    ___stack_chk_fail();
  }
  return iVar6;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::setOwnership(task*, int, unsigned int)

undefined4 __cdecl IOSurface::setOwnership(long param_1,int param_2,uint param_3)

{
  undefined4 uVar1;
  
  _IOLockLock(*(undefined8 *)(param_1 + 0x50));
  if (*(task **)(param_1 + 0x30) == (task *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOMemoryDescriptor::setOwnership(*(task **)(param_1 + 0x30),param_2,param_3);
  }
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x50));
  return uVar1;
}



// IOSurface::setPurgeable(unsigned int, unsigned int*)

int __thiscall IOSurface::setPurgeable(IOSurface *this,uint param_1,int *param_2)

{
  long *plVar1;
  IOSurfaceDeviceCache *pIVar2;
  bool bVar3;
  int iVar4;
  long lVar5;
  long *plVar6;
  long *plVar7;
  undefined7 extraout_var;
  undefined7 extraout_var_00;
  undefined8 *puVar8;
  undefined7 extraout_var_01;
  undefined7 extraout_var_02;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  uint uVar12;
  uint uVar13;
  ulong uVar14;
  IOSurfaceDeviceCache *pIVar15;
  long lVar16;
  long *plVar17;
  uint uVar18;
  ulong uVar19;
  long lVar20;
  uint local_180;
  int local_174;
  long *local_170;
  IOSurfaceDeviceCache *local_168;
  long *local_160;
  ulong local_158;
  uint local_14c;
  IOSurfaceDeviceCache *local_148;
  IOSurface *local_140;
  long local_138 [32];
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  local_174 = 4;
  if ((((byte)this[0x3c9] & 0x80) == 0) || (*(long *)(this + 0x30) == 0)) {
    *param_2 = 0;
    iVar4 = 0;
    goto LAB_000095c7;
  }
  _IOLockLock(*(undefined8 *)(this + 0x50));
  pIVar15 = local_148;
  *param_2 = 2;
  if ((param_1 & 0xf) < 4) {
    uVar12 = 1;
    uVar19 = (ulong)local_148 >> 0x20;
    local_148 = (IOSurfaceDeviceCache *)(uVar19 << 0x20);
    pIVar2 = local_148;
    local_158 = CONCAT44(local_158._4_4_,1);
    local_14c = 0;
    local_148._4_4_ = SUB84(pIVar15,4);
    uVar18 = 2;
    switch(param_1 & 0xf) {
    case 1:
      *(undefined4 *)(this + 0x208) = 3;
      local_14c = 1;
      local_158 = CONCAT44(local_158._4_4_,3);
      if (*(long *)(this + 0x38) == 0) {
        local_148 = (IOSurfaceDeviceCache *)(uVar19 << 0x20);
        uVar12 = 3;
        pIVar2 = local_148;
      }
      else {
        uVar12 = (uint)(((byte)this[0x3c8] & 8) == 0);
        local_148 = (IOSurfaceDeviceCache *)CONCAT44(local_148._4_4_,uVar12);
        uVar12 = uVar12 + 3;
        pIVar2 = local_148;
      }
      break;
    case 2:
      uVar18 = 4;
    case 0:
      uVar12 = uVar18;
      *(uint *)(this + 0x208) = uVar12;
      local_148 = (IOSurfaceDeviceCache *)(uVar19 << 0x20);
      local_158 = CONCAT44(local_158._4_4_,uVar12);
      local_14c = 0;
      pIVar2 = local_148;
    }
    local_148 = pIVar2;
    iVar4 = (**(code **)(**(long **)(this + 0x30) + 0x120))
                      (*(long **)(this + 0x30),param_1 & 0x760 | uVar12,&local_174);
    if (((iVar4 == 0) && (uVar12 == 3)) && (local_174 == 4)) {
      iVar4 = (**(code **)(**(long **)(this + 0x30) + 0x120))(*(long **)(this + 0x30),4,0);
    }
    if (iVar4 == 0) {
      uVar18 = param_1 & 0xfffff89f;
      iVar4 = 0;
      if (local_174 != 2) {
        iVar4 = 2 - (uint)(local_174 == 3);
      }
      *param_2 = iVar4;
      local_140 = this;
      if (((uVar18 == 3) || (uVar18 == 0)) && (iVar4 == 2)) {
        if (uVar18 == 0) {
          *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffffffd3 | 0x20;
        }
        local_160 = local_138;
        _memset(local_160,0xaa,0x100);
        lVar5 = 0;
        do {
          local_138[lVar5] = 0;
          lVar5 = lVar5 + 1;
        } while (lVar5 != 0x20);
        pIVar15 = *(IOSurfaceDeviceCache **)(this + 0x38);
        if (pIVar15 != (IOSurfaceDeviceCache *)0x0) {
          (**(code **)(*(long *)pIVar15 + 0x20))(pIVar15);
        }
        plVar17 = *(long **)(this + 0x40);
        if (plVar17 != (long *)0x0) {
          plVar6 = plVar17;
          uVar12 = 0xffffffff;
          do {
            uVar13 = uVar12;
            plVar6 = (long *)plVar6[6];
            uVar12 = uVar13 + 1;
          } while (plVar6 != (long *)0x0);
          local_148 = pIVar15;
          if (uVar12 < 0x20) {
            plVar6 = (long *)0x0;
            uVar13 = 0x20;
          }
          else {
            uVar13 = uVar13 + 2;
            plVar6 = (long *)_IOMallocTypeVarImpl
                                       (&setPurgeable(unsigned_int,unsigned_int*)::
                                         kalloc_type_view_3228);
            plVar17 = *(long **)(this + 0x40);
            local_160 = plVar6;
          }
          if (plVar17 == (long *)0x0) {
            uVar19 = 0;
            pIVar15 = local_148;
          }
          else {
            uVar10 = (long)(local_160 + uVar13) - (long)local_160;
            bVar3 = uVar10 >> 0x20 != 0 || local_160 + uVar13 < local_160;
            local_168 = (IOSurfaceDeviceCache *)CONCAT71(local_168._1_7_,bVar3);
            local_14c = uVar18;
            if (bVar3) goto LAB_000095ec;
            uVar19 = 0;
            uVar14 = 0;
            lVar5 = -1;
            do {
              lVar16 = lVar5;
              if (lVar16 == 0xfffffff) goto LAB_000094c1;
              if ((long)uVar14 < 0) goto LAB_000094b5;
              local_180 = (uint)uVar10;
              if (local_180 < (int)(uVar14 >> 0x20) + 8U) goto LAB_000094b5;
              plVar7 = (long *)((uVar14 >> 0x20) + (long)local_160);
              uVar11 = (ulong)CARRY8(uVar14 >> 0x20,(ulong)local_160);
              uVar9 = -uVar11;
              if ((uVar11 != uVar9) || ((long)uVar9 < 0)) goto LAB_000094cd;
              plVar1 = (long *)*plVar7;
              *plVar7 = (long)plVar17;
              (**(code **)(*plVar17 + 0x20))(plVar17);
              if (plVar1 != (long *)0x0) {
                (**(code **)(*plVar1 + 0x28))(plVar1);
              }
              pIVar15 = local_148;
              plVar17 = (long *)plVar17[6];
              lVar5 = lVar16 + 1;
              uVar14 = uVar14 + 0x800000000;
              uVar19 = uVar19 + 8;
            } while (plVar17 != (long *)0x0);
            iVar4 = (int)(lVar16 + 2U);
            if (iVar4 == 0) {
              uVar19 = lVar16 + 2U & 0xffffffff;
            }
            else {
              local_170._0_4_ = (int)CONCAT71((int7)(uVar9 >> 8),1);
              if (iVar4 == 1) {
                local_170._0_4_ = 0;
              }
              _IOLockUnlock(*(undefined8 *)(local_140 + 0x50));
              if (pIVar15 == (IOSurfaceDeviceCache *)0x0) {
LAB_00009276:
                pIVar15 = (IOSurfaceDeviceCache *)0x0;
                local_158 = 0;
              }
              else if (local_14c == 3) {
                bVar3 = IOSurfaceDeviceCache::testpurgeable(pIVar15);
                local_158 = CONCAT71(extraout_var,bVar3);
              }
              else {
                bVar3 = IOSurfaceDeviceCache::unpurge(pIVar15,0);
                if (!bVar3) {
                  IOSurfaceDeviceCache::accelRelease(pIVar15);
                  goto LAB_00009276;
                }
                local_158 = CONCAT71(extraout_var_00,1);
                local_170 = (long *)((ulong)local_170 & 0xffffffff00000000);
              }
              local_148 = pIVar15;
              if ((char)local_168 != '\0') {
LAB_000095ec:
                    // WARNING: Subroutine does not return
                os_detail::panic_trapping_policy::trap
                          (
                          "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                          );
              }
              lVar16 = -1;
              uVar10 = 0;
              local_168 = (IOSurfaceDeviceCache *)0x0;
              do {
                if (lVar16 == 0xfffffff) goto LAB_000094c1;
                if (((long)uVar10 < 0) || (local_180 < (int)(uVar10 >> 0x20) + 8U))
                goto LAB_000094b5;
                puVar8 = (undefined8 *)((uVar10 >> 0x20) + (long)local_160);
                uVar9 = (ulong)CARRY8(uVar10 >> 0x20,(ulong)local_160);
                uVar14 = -uVar9;
                if ((uVar9 != uVar14) || ((long)uVar14 < 0)) goto LAB_000094cd;
                pIVar15 = (IOSurfaceDeviceCache *)*puVar8;
                uVar14 = local_158;
                if (local_148 != pIVar15) {
                  if (local_14c == 3) {
                    uVar14 = CONCAT71((int7)((ulong)puVar8 >> 8),1);
                    if ((local_158 & 1) == 0) {
                      bVar3 = IOSurfaceDeviceCache::testpurgeable(pIVar15);
                      uVar14 = CONCAT71(extraout_var_01,bVar3);
                    }
                  }
                  else {
                    bVar3 = IOSurfaceDeviceCache::unpurge(pIVar15,(byte)local_170 & 1);
                    uVar14 = local_158;
                    if (bVar3) {
                      local_158 = CONCAT71(extraout_var_02,1);
                      if (local_168 == (IOSurfaceDeviceCache *)0x0) {
                        if (pIVar15 != (IOSurfaceDeviceCache *)0x0) {
                          (**(code **)(*(long *)pIVar15 + 0x20))(pIVar15);
                          local_170 = (long *)((ulong)local_170 & 0xffffffff00000000);
                          local_168 = pIVar15;
                          uVar14 = local_158;
                          goto LAB_00009382;
                        }
                        local_168 = (IOSurfaceDeviceCache *)0x0;
                      }
                      local_170 = (long *)((ulong)local_170 & 0xffffffff00000000);
                      uVar14 = local_158;
                    }
                  }
                }
LAB_00009382:
                local_158 = uVar14;
                lVar16 = lVar16 + 1;
                uVar10 = uVar10 + 0x800000000;
              } while (lVar5 != lVar16);
              lVar16 = -1;
              uVar10 = 0;
              do {
                if (lVar16 == 0xfffffff) {
LAB_000094c1:
                    // WARNING: Subroutine does not return
                  os_detail::panic_trapping_policy::trap
                            (
                            "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                            );
                }
                if (((long)uVar10 < 0) || (local_180 < (int)(uVar10 >> 0x20) + 8U)) {
LAB_000094b5:
                    // WARNING: Subroutine does not return
                  os_detail::panic_trapping_policy::trap
                            (
                            "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                            );
                }
                puVar8 = (undefined8 *)((uVar10 >> 0x20) + (long)local_160);
                uVar9 = (ulong)CARRY8(uVar10 >> 0x20,(ulong)local_160);
                uVar14 = -uVar9;
                if ((uVar9 != uVar14) || ((long)uVar14 < 0)) {
LAB_000094cd:
                    // WARNING: Subroutine does not return
                  os_detail::panic_trapping_policy::trap
                            (
                            "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                            );
                }
                pIVar2 = (IOSurfaceDeviceCache *)*puVar8;
                *puVar8 = 0;
                IOSurfaceDeviceCache::accelRelease(pIVar2);
                lVar16 = lVar16 + 1;
                uVar10 = uVar10 + 0x800000000;
              } while (lVar5 != lVar16);
              _IOLockLock(*(undefined8 *)(local_140 + 0x50));
              pIVar2 = local_148;
              if ((local_158 & 1) == 0) {
                if (local_14c != 3) {
                  for (pIVar15 = *(IOSurfaceDeviceCache **)(local_140 + 0x40);
                      pIVar15 != (IOSurfaceDeviceCache *)0x0;
                      pIVar15 = *(IOSurfaceDeviceCache **)(pIVar15 + 0x30)) {
                    IOSurfaceDeviceCache::purge(pIVar15);
                  }
                }
              }
              else {
                if (local_14c != 3) {
                  if (local_148 == (IOSurfaceDeviceCache *)0x0) {
                    if ((int)lVar5 == 0) {
                      *(IOSurfaceDeviceCache **)(local_140 + 0x38) = local_168;
                      puVar8 = *(undefined8 **)(local_140 + 0x178);
                      *(undefined2 *)(puVar8 + 1) = *(undefined2 *)(local_168 + 0x48);
                      *puVar8 = *(undefined8 *)(pIVar15 + 0x60);
                      *(undefined2 *)((long)puVar8 + 10) = *(undefined2 *)(local_168 + 0x54);
                    }
                  }
                  else if (local_148 != *(IOSurfaceDeviceCache **)(local_140 + 0x38)) {
                    _IOLog("IOSurface %08x: Current device cache changed while purgeability status was changing."
                           ,*(undefined4 *)(local_140 + 0x10));
                  }
                }
                *param_2 = 1;
              }
              _IOLockUnlock(*(undefined8 *)(local_140 + 0x50));
              if (pIVar2 != (IOSurfaceDeviceCache *)0x0) {
                IOSurfaceDeviceCache::accelRelease(pIVar2);
              }
              if (local_168 != (IOSurfaceDeviceCache *)0x0) {
                IOSurfaceDeviceCache::accelRelease(local_168);
              }
              _IOLockLock(*(undefined8 *)(local_140 + 0x50));
              pIVar15 = (IOSurfaceDeviceCache *)0x0;
            }
          }
          this = local_140;
          if (plVar6 != (long *)0x0) {
            _IOFreeTypeVarImpl(&setPurgeable(unsigned_int,unsigned_int*)::kalloc_type_view_3406,
                               plVar6,uVar19);
            this = local_140;
          }
        }
        lVar5 = 0xf8;
        do {
          if (*(long **)((long)local_138 + lVar5) != (long *)0x0) {
            (**(code **)(**(long **)((long)local_138 + lVar5) + 0x28))();
          }
          *(undefined8 *)((long)local_138 + lVar5) = 0;
          lVar5 = lVar5 + -8;
        } while (lVar5 != -8);
        iVar4 = 0;
        if (pIVar15 != (IOSurfaceDeviceCache *)0x0) {
          (**(code **)(*(long *)pIVar15 + 0x28))(pIVar15);
        }
      }
      else {
        local_160 = local_138;
        _memset(local_160,0xaa,0x100);
        lVar5 = 0;
        do {
          local_138[lVar5] = 0;
          lVar5 = lVar5 + 1;
        } while (lVar5 != 0x20);
        plVar17 = *(long **)(this + 0x40);
        if (plVar17 == (long *)0x0) {
          plVar6 = (long *)0x0;
LAB_00009048:
          this = local_140;
          _IOLockUnlock(*(undefined8 *)(local_140 + 0x50));
          lVar5 = 0;
        }
        else {
          lVar16 = 0;
          plVar6 = plVar17;
          lVar5 = 0;
          do {
            lVar20 = lVar5;
            plVar6 = (long *)plVar6[6];
            lVar5 = lVar20 + 1;
            lVar16 = lVar16 + 8;
          } while (plVar6 != (long *)0x0);
          if ((uint)lVar20 < 0x20) {
            lVar5 = 0x20;
            plVar6 = (long *)0x0;
          }
          else {
            plVar6 = (long *)_IOMallocTypeVarImpl
                                       (&setPurgeable(unsigned_int,unsigned_int*)::
                                         kalloc_type_view_3448,lVar16);
            plVar17 = *(long **)(local_140 + 0x40);
            local_160 = plVar6;
          }
          if (plVar17 == (long *)0x0) goto LAB_00009048;
          uVar19 = (long)(local_160 + lVar5) - (long)local_160;
          bVar3 = uVar19 >> 0x20 != 0 || local_160 + lVar5 < local_160;
          local_168 = (IOSurfaceDeviceCache *)CONCAT71(local_168._1_7_,bVar3);
          local_170 = plVar6;
          if (bVar3) goto LAB_000095ec;
          lVar16 = -1;
          lVar5 = 0;
          uVar10 = 0;
          do {
            if (lVar16 == 0xfffffff) goto LAB_000094c1;
            if ((long)uVar10 < 0) goto LAB_000094b5;
            local_180 = (uint)uVar19;
            if (local_180 < (int)(uVar10 >> 0x20) + 8U) goto LAB_000094b5;
            plVar6 = (long *)((uVar10 >> 0x20) + (long)local_160);
            uVar9 = (ulong)CARRY8(uVar10 >> 0x20,(ulong)local_160);
            uVar14 = -uVar9;
            if ((uVar9 != uVar14) || ((long)uVar14 < 0)) goto LAB_000094cd;
            plVar7 = (long *)*plVar6;
            *plVar6 = (long)plVar17;
            (**(code **)(*plVar17 + 0x20))(plVar17);
            if (plVar7 != (long *)0x0) {
              (**(code **)(*plVar7 + 0x28))(plVar7);
            }
            this = local_140;
            plVar17 = (long *)plVar17[6];
            lVar16 = lVar16 + 1;
            uVar10 = uVar10 + 0x800000000;
            lVar5 = lVar5 + 8;
          } while (plVar17 != (long *)0x0);
          _IOLockUnlock(*(undefined8 *)(local_140 + 0x50));
          if (lVar5 == 0) {
            lVar5 = 0;
            plVar6 = local_170;
          }
          else {
            if ((char)local_168 != '\0') goto LAB_000095ec;
            local_148 = (IOSurfaceDeviceCache *)
                        CONCAT44(local_148._4_4_,
                                 CONCAT31((int3)((ulong)local_148 >> 8),
                                          (byte)local_148 & (byte)local_14c));
            lVar20 = -1;
            uVar19 = 0;
            do {
              if (lVar20 == 0xfffffff) goto LAB_000094c1;
              if (((long)uVar19 < 0) || (local_180 < (int)(uVar19 >> 0x20) + 8U)) goto LAB_000094b5;
              puVar8 = (undefined8 *)((uVar19 >> 0x20) + (long)local_160);
              uVar14 = (ulong)CARRY8(uVar19 >> 0x20,(ulong)local_160);
              uVar10 = -uVar14;
              if ((uVar14 != uVar10) || ((long)uVar10 < 0)) goto LAB_000094cd;
              iVar4 = (int)local_158;
              if ((char)local_148 != '\0') {
                iVar4 = 4 - (uint)((IOSurfaceDeviceCache *)*puVar8 ==
                                  *(IOSurfaceDeviceCache **)(local_140 + 0x38));
              }
              IOSurfaceDeviceCache::setPurgeable((IOSurfaceDeviceCache *)*puVar8,iVar4);
              pIVar15 = (IOSurfaceDeviceCache *)*puVar8;
              *puVar8 = 0;
              IOSurfaceDeviceCache::accelRelease(pIVar15);
              lVar20 = lVar20 + 1;
              uVar19 = uVar19 + 0x800000000;
              plVar6 = local_170;
              this = local_140;
            } while (lVar16 != lVar20);
          }
        }
        _IOLockLock(*(undefined8 *)(this + 0x50));
        if (plVar6 != (long *)0x0) {
          _IOFreeTypeVarImpl(&setPurgeable(unsigned_int,unsigned_int*)::kalloc_type_view_3497,plVar6
                             ,lVar5);
        }
        lVar5 = 0xf8;
        do {
          if (*(long **)((long)local_138 + lVar5) != (long *)0x0) {
            (**(code **)(**(long **)((long)local_138 + lVar5) + 0x28))();
          }
          *(undefined8 *)((long)local_138 + lVar5) = 0;
          lVar5 = lVar5 + -8;
        } while (lVar5 != -8);
        iVar4 = 0;
      }
    }
  }
  else {
    *(undefined4 *)(this + 0x208) = 0;
    iVar4 = -0x1ffffd3e;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
LAB_000095c7:
  if (*(long *)PTR____stack_chk_guard_00027088 != local_38) {
                    // WARNING: Subroutine does not return
    ___stack_chk_fail();
  }
  return iVar4;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::internal_set_memory_descriptor(IOMemoryDescriptor*)

void __cdecl IOSurface::internal_set_memory_descriptor(long param_1,long *param_2)

{
  uint uVar1;
  uintptr_t arg2;
  
  libkern::intrusive_shared_ptr<>::reset((long *)(param_1 + 0x30),param_2);
  uVar1 = *(uint *)(param_1 + 0x10);
  if (*(long *)(param_1 + 0x30) == 0) {
    arg2 = 0;
  }
  else {
    arg2 = IOMemoryDescriptor::getDescriptorID();
  }
  _kernel_debug(0x540000c,(ulong)uVar1,arg2,0,0,0);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// libkern::intrusive_shared_ptr<IOMemoryDescriptor,
// intrusive_tagged_osobject_retainer<OSCollection> >::reset(IOMemoryDescriptor*, libkern::retain_t)

long * __cdecl libkern::intrusive_shared_ptr<>::reset(long *param_1,long *param_2)

{
  long *plVar1;
  
  plVar1 = (long *)*param_1;
  *param_1 = (long)param_2;
  if (param_2 != (long *)0x0) {
    (**(code **)(*param_2 + 0x48))(param_2,*(undefined8 *)PTR_metaClass_00027008);
  }
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x50))(plVar1,*(undefined8 *)PTR_metaClass_00027008);
  }
  return param_1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::getMemoryDescriptor(IOService*)

undefined8 __cdecl IOSurface::getMemoryDescriptor(long param_1)

{
  return *(undefined8 *)(param_1 + 0x30);
}



// IOSurface::getMemoryDescriptor() const

undefined8 __thiscall IOSurface::getMemoryDescriptor(IOSurface *this)

{
  return *(undefined8 *)(this + 0x30);
}



// IOSurface::planeSize(unsigned int)

undefined8 __thiscall IOSurface::planeSize(IOSurface *this,ulong param_1)

{
  ulong uVar1;
  ulong uVar2;
  ulong uVar3;
  long lVar4;
  ulong uVar5;
  
  uVar1 = *(ulong *)(this + 0x180);
  uVar2 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
  uVar3 = uVar2 - uVar1;
  if ((uVar2 < uVar1) || (uVar3 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
              );
  }
  lVar4 = (param_1 & 0xffffffff) * 0x38;
  if ((int)lVar4 != lVar4) {
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
              );
  }
  uVar2 = (param_1 & 0xffffffff) * 0x3800000000;
  if ((-1 < (long)uVar2) && ((int)(uVar2 >> 0x20) + 0x38U <= (uint)uVar3)) {
    uVar5 = (ulong)CARRY8(uVar1,uVar2 >> 0x20);
    uVar3 = -uVar5;
    if ((uVar5 == uVar3) && (-1 < (long)uVar3)) {
      return *(undefined8 *)(uVar1 + (uVar2 >> 0x20) + 0x28);
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
            );
}



// IOSurface::pixelFormat()

undefined4 __thiscall IOSurface::pixelFormat(IOSurface *this)

{
  return *(undefined4 *)(this + 0x80);
}



// IOSurface::getIOSurfaceRoot() const

undefined8 IOSurface::getIOSurfaceRoot(void)

{
  return _gIOSurfaceRoot;
}



// IOSurface::getCurrentDeviceCache() const

undefined8 __thiscall IOSurface::getCurrentDeviceCache(IOSurface *this)

{
  return *(undefined8 *)(this + 0x38);
}



// IOSurface::isDataValid() const

byte __thiscall IOSurface::isDataValid(IOSurface *this)

{
  return ((byte)this[0x3c8] & 4) >> 2;
}



// IOSurface::prohibitsUseCount() const

byte __thiscall IOSurface::prohibitsUseCount(IOSurface *this)

{
  return ((byte)this[0x3ca] & 0x20) >> 5;
}



// IOSurface::getPixelFormat() const

undefined4 __thiscall IOSurface::getPixelFormat(IOSurface *this)

{
  return *(undefined4 *)(this + 0x80);
}



// IOSurface::getSurfaceID() const

undefined4 __thiscall IOSurface::getSurfaceID(IOSurface *this)

{
  return *(undefined4 *)(this + 0x10);
}



// IOSurface::getWidth() const

undefined8 __thiscall IOSurface::getWidth(IOSurface *this)

{
  return *(undefined8 *)(this + 0x58);
}



// IOSurface::getHeight() const

undefined8 __thiscall IOSurface::getHeight(IOSurface *this)

{
  return *(undefined8 *)(this + 0x60);
}



// IOSurface::getBaseOffset() const

undefined8 __thiscall IOSurface::getBaseOffset(IOSurface *this)

{
  return *(undefined8 *)(this + 0x78);
}



// IOSurface::getBytesPerRow() const

undefined8 __thiscall IOSurface::getBytesPerRow(IOSurface *this)

{
  return *(undefined8 *)(this + 0x68);
}



// IOSurface::getBytesPerElement() const

undefined2 __thiscall IOSurface::getBytesPerElement(IOSurface *this)

{
  return *(undefined2 *)(this + 0x70);
}



// IOSurface::getElementWidth() const

IOSurface __thiscall IOSurface::getElementWidth(IOSurface *this)

{
  return this[0x72];
}



// IOSurface::getElementHeight() const

IOSurface __thiscall IOSurface::getElementHeight(IOSurface *this)

{
  return this[0x73];
}



// IOSurface::getPlaneCount() const

undefined4 __thiscall IOSurface::getPlaneCount(IOSurface *this)

{
  return *(undefined4 *)(this + 0x98);
}



// IOSurface::getAllocSize() const

undefined8 __thiscall IOSurface::getAllocSize(IOSurface *this)

{
  return *(undefined8 *)(this + 0x90);
}



// IOSurface::getAllocOffset() const

undefined8 __thiscall IOSurface::getAllocOffset(IOSurface *this)

{
  return *(undefined8 *)(this + 0x88);
}



// IOSurface::getMemoryRegion() const

undefined8 __thiscall IOSurface::getMemoryRegion(IOSurface *this)

{
  return *(undefined8 *)(this + 0x28);
}



// IOSurface::getCacheMode() const

undefined4 __thiscall IOSurface::getCacheMode(IOSurface *this)

{
  return *(undefined4 *)(this + 0x9c);
}



// IOSurface::getClientAddress() const

undefined8 __thiscall IOSurface::getClientAddress(IOSurface *this)

{
  return *(undefined8 *)(this + 0x150);
}



// IOSurface::getClientAlignedAddress() const

undefined8 __thiscall IOSurface::getClientAlignedAddress(IOSurface *this)

{
  return *(undefined8 *)(this + 0x158);
}



// IOSurface::getClientAlignedLength() const

undefined8 __thiscall IOSurface::getClientAlignedLength(IOSurface *this)

{
  return *(undefined8 *)(this + 0x160);
}



// IOSurface::getClientAlignedOffset() const

undefined8 __thiscall IOSurface::getClientAlignedOffset(IOSurface *this)

{
  return *(undefined8 *)(this + 0x168);
}



// IOSurface::getPlaneBase(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneBase(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x78;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x10);
  }
  return *(undefined8 *)pIVar2;
}



// IOSurface::getPlaneOffset(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneOffset(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x78;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x18);
  }
  return *(undefined8 *)pIVar2;
}



// IOSurface::getPlaneSize(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneSize(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x90;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x28);
  }
  return *(undefined8 *)pIVar2;
}



// IOSurface::getPlaneWidth(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneWidth(IOSurface *this,uint param_1)

{
  IOSurface *pIVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  
  uVar4 = *(ulong *)(this + 0x180);
  if ((uVar4 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar1 = this + 0x58;
  }
  else {
    uVar2 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar4;
    uVar3 = uVar2 - uVar4;
    if ((uVar2 < uVar4) || (uVar3 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar2 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar2 < 0) || ((uint)uVar3 < (int)(uVar2 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    pIVar1 = (IOSurface *)(uVar4 + (uVar2 >> 0x20));
    uVar2 = (ulong)CARRY8(uVar4,uVar2 >> 0x20);
    uVar4 = -uVar2;
    if ((uVar2 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
  }
  return *(undefined8 *)pIVar1;
}



// IOSurface::getPlaneHeight(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneHeight(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x60;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 8);
  }
  return *(undefined8 *)pIVar2;
}



// IOSurface::getPlaneElementWidth(unsigned int) const

IOSurface __thiscall IOSurface::getPlaneElementWidth(IOSurface *this,uint param_2)

{
  ulong uVar1;
  IOSurface IVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_2)) {
    if (param_2 == 0) {
      IVar2 = this[0x72];
    }
    else {
      IVar2 = (IOSurface)0x0;
    }
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_2 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_2 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    IVar2 = *(IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x34);
  }
  return IVar2;
}



// IOSurface::getPlaneElementHeight(unsigned int) const

IOSurface __thiscall IOSurface::getPlaneElementHeight(IOSurface *this,uint param_2)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_2)) {
    if (param_2 != 0) {
      return (IOSurface)0x0;
    }
    pIVar2 = this + 0x73;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_2 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_2 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x35);
  }
  return *pIVar2;
}



// IOSurface::getPlaneBytesPerRow(unsigned int) const

undefined8 __thiscall IOSurface::getPlaneBytesPerRow(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x68;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x20);
  }
  return *(undefined8 *)pIVar2;
}



// IOSurface::getPlaneBytesPerElement(unsigned int) const

undefined2 __thiscall IOSurface::getPlaneBytesPerElement(IOSurface *this,uint param_1)

{
  ulong uVar1;
  IOSurface *pIVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    if (param_1 != 0) {
      return 0;
    }
    pIVar2 = this + 0x70;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    pIVar2 = (IOSurface *)(uVar1 + (uVar3 >> 0x20) + 0x30);
  }
  return *(undefined2 *)pIVar2;
}



// IOSurface::getPlaneAddressFormat(unsigned int) const

undefined1 __thiscall IOSurface::getPlaneAddressFormat(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x180);
  if ((uVar1 == 0) || (*(uint *)(this + 0x98) <= param_1)) {
    uVar2 = 0;
  }
  else {
    uVar3 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x38;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3800000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20) + 0x36);
  }
  return uVar2;
}



// IOSurface::getPlaneExtendedPixelsLeft(unsigned int) const

undefined4 __thiscall IOSurface::getPlaneExtendedPixelsLeft(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x330);
  uVar2 = 0;
  if ((uVar1 != 0) && (uVar2 = 0, param_1 < *(uint *)(this + 0x98))) {
    uVar3 = (ulong)*(uint *)(this + 0x338) * 0x20 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x20;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 << 0x25;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x20U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 8);
  }
  return uVar2;
}



// IOSurface::getPlaneExtendedPixelsTop(unsigned int) const

undefined4 __thiscall IOSurface::getPlaneExtendedPixelsTop(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x330);
  uVar2 = 0;
  if ((uVar1 != 0) && (uVar2 = 0, param_1 < *(uint *)(this + 0x98))) {
    uVar3 = (ulong)*(uint *)(this + 0x338) * 0x20 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x20;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 << 0x25;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x20U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0xc);
  }
  return uVar2;
}



// IOSurface::getPlaneExtendedPixelsRight(unsigned int) const

undefined4 __thiscall IOSurface::getPlaneExtendedPixelsRight(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x330);
  uVar2 = 0;
  if ((uVar1 != 0) && (uVar2 = 0, param_1 < *(uint *)(this + 0x98))) {
    uVar3 = (ulong)*(uint *)(this + 0x338) * 0x20 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x20;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 << 0x25;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x20U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20));
  }
  return uVar2;
}



// IOSurface::getPlaneExtendedPixelsBottom(unsigned int) const

undefined4 __thiscall IOSurface::getPlaneExtendedPixelsBottom(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar1 = *(ulong *)(this + 0x330);
  uVar2 = 0;
  if ((uVar1 != 0) && (uVar2 = 0, param_1 < *(uint *)(this + 0x98))) {
    uVar3 = (ulong)*(uint *)(this + 0x338) * 0x20 + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x20;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 << 0x25;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x20U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 4);
  }
  return uVar2;
}



// IOSurface::getMapCacheAttribute() const

undefined4 __thiscall IOSurface::getMapCacheAttribute(IOSurface *this)

{
  return *(undefined4 *)(this + 0x210);
}



// IOSurface::increment_use_count()

void __thiscall IOSurface::increment_use_count(IOSurface *this)

{
  increment_use_count_for_category(this,0);
  return;
}



// IOSurface::increment_use_count_for_category(unsigned int)

void __thiscall IOSurface::increment_use_count_for_category(IOSurface *this,uint param_1)

{
  ulong *puVar1;
  long lVar2;
  ulong uVar3;
  ulong uVar4;
  bool bVar5;
  
  if (param_1 < 2) {
    do {
      if (((byte)this[0x3ca] & 0x20) != 0) {
        __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                          "Attempt to change IOSurface useCount while kIOSurfaceProhibitUseCount is set, ignored."
                         );
        return;
      }
      lVar2 = *(long *)(this + 0x178);
      do {
        uVar3 = *(ulong *)(lVar2 + 0x18);
        if (param_1 == 0) {
          uVar4 = (ulong)((int)uVar3 + 1);
          if ((int)uVar3 == -1) {
            uVar4 = 0xffffffff;
          }
          uVar4 = uVar4 | uVar3 & 0xffffffff00000000;
        }
        else {
          uVar4 = (uVar3 & 0xffffffff00000000) + 0x100000000;
          if (0xfffffffeffffffff < uVar3) {
            uVar4 = 0xffffffff00000000;
          }
          uVar4 = uVar4 | uVar3 & 0xffffffff;
        }
        puVar1 = (ulong *)(lVar2 + 0x18);
        LOCK();
        bVar5 = uVar3 == *puVar1;
        if (bVar5) {
          *puVar1 = uVar4;
        }
        UNLOCK();
      } while (!bVar5);
      this = *(IOSurface **)(this + 0x358);
    } while (this != (IOSurface *)0x0);
  }
  return;
}



// IOSurface::decrement_use_count()

void __thiscall IOSurface::decrement_use_count(IOSurface *this)

{
  decrement_use_count_for_category(this,0);
  return;
}



// IOSurface::decrement_use_count_for_category(unsigned int)

void __thiscall IOSurface::decrement_use_count_for_category(IOSurface *this,uint param_1)

{
  ulong *puVar1;
  long lVar2;
  ulong uVar3;
  int iVar4;
  uint uVar5;
  ulong uVar6;
  bool bVar7;
  
  if (param_1 < 2) {
    do {
      if (((byte)this[0x3ca] & 0x20) != 0) {
        __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                          "Attempt to change IOSurface useCount while kIOSurfaceProhibitUseCount is set, ignored."
                         );
        return;
      }
      lVar2 = *(long *)(this + 0x178);
      do {
        uVar3 = *(ulong *)(lVar2 + 0x18);
        iVar4 = (int)uVar3;
        if (param_1 == 0) {
          uVar6 = (ulong)(iVar4 - 1);
          if (iVar4 == 0) {
            uVar6 = 0;
          }
          uVar6 = uVar6 | uVar3 & 0xffffffff00000000;
        }
        else {
          iVar4 = (int)(uVar3 >> 0x20);
          uVar6 = (uVar3 & 0xffffffff00000000) - 0x100000000;
          if (uVar3 >> 0x20 == 0) {
            uVar6 = 0;
          }
          uVar6 = uVar6 | uVar3 & 0xffffffff;
        }
        puVar1 = (ulong *)(lVar2 + 0x18);
        LOCK();
        bVar7 = uVar3 == *puVar1;
        if (bVar7) {
          *puVar1 = uVar6;
        }
        UNLOCK();
      } while (!bVar7);
      if ((iVar4 == 1) && (uVar6 == 0)) {
        uVar5 = *(uint *)(this + 0x3c8);
        if ((uVar5 & 0x40) != 0) {
          purge(this);
          uVar5 = *(uint *)(this + 0x3c8);
        }
        if ((uVar5 & 0x80) != 0) {
          reset_default_attachment_values(this);
        }
        IOSurfaceRoot::notifySurface(_gIOSurfaceRoot,0,(long)this);
      }
      this = *(IOSurface **)(this + 0x358);
    } while (this != (IOSurface *)0x0);
  }
  return;
}



// IOSurface::reset_default_attachment_values()

void __thiscall IOSurface::reset_default_attachment_values(IOSurface *this)

{
  long lVar1;
  char cVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if ((*(long **)(this + 0x1a8) != (long *)0x0) && (*(long *)(this + 0x1f0) != 0)) {
    cVar2 = (**(code **)(**(long **)(this + 0x1a8) + 0x218))();
    if (cVar2 == '\0') {
      if (*(long **)(this + 0x1a8) != (long *)0x0) {
        (**(code **)(**(long **)(this + 0x1a8) + 0x28))();
      }
      *(undefined8 *)(this + 0x1a8) = 0;
      init_values(this);
      *(uint *)(*(long *)(this + 0x178) + 0x20) =
           (*(uint *)(*(long *)(this + 0x178) + 0x20) | 1) + 2;
      goto LAB_0000a50d;
    }
  }
  lVar1 = *(long *)(this + 0x178);
  if (*(void **)(this + 0x240) == (void *)0x0) {
    *(undefined8 *)(lVar1 + 0x98) = 0;
    *(undefined8 *)(lVar1 + 0x90) = 0;
    *(undefined8 *)(lVar1 + 0x88) = 0;
    *(undefined8 *)(lVar1 + 0x80) = 0;
    *(undefined8 *)(lVar1 + 0x78) = 0;
    *(undefined8 *)(lVar1 + 0x70) = 0;
    *(undefined8 *)(lVar1 + 0x68) = 0;
    *(undefined8 *)(lVar1 + 0x60) = 0;
    *(undefined8 *)(lVar1 + 0x58) = 0;
    *(undefined8 *)(lVar1 + 0x50) = 0;
    *(undefined8 *)(lVar1 + 0x48) = 0;
    *(undefined8 *)(lVar1 + 0x40) = 0;
    *(undefined8 *)(lVar1 + 0x38) = 0;
    *(undefined8 *)(lVar1 + 0x30) = 0;
  }
  else {
    _memmove((undefined8 *)(lVar1 + 0x30),*(void **)(this + 0x240),0x70);
  }
LAB_0000a50d:
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::get_use_count() const

int __thiscall IOSurface::get_use_count(IOSurface *this)

{
  return (int)((ulong)*(undefined8 *)(*(long *)(this + 0x178) + 0x18) >> 0x20) +
         (int)*(undefined8 *)(*(long *)(this + 0x178) + 0x18);
}



// IOSurface::clientRetain()

void __thiscall IOSurface::clientRetain(IOSurface *this)

{
  _OSIncrementAtomic(this + 0x3b4);
  return;
}



// IOSurface::clientRelease()

bool __thiscall IOSurface::clientRelease(IOSurface *this)

{
  int iVar1;
  
  iVar1 = _OSDecrementAtomic(this + 0x3b4);
  if (iVar1 == 1) {
    purge(this);
  }
  return iVar1 == 1;
}



// IOSurface::getClientRetainCount() const

undefined4 __thiscall IOSurface::getClientRetainCount(IOSurface *this)

{
  return *(undefined4 *)(this + 0x3b4);
}



// IOSurface::prune_orphaned_device_caches()

void __thiscall IOSurface::prune_orphaned_device_caches(IOSurface *this)

{
  IOSurfaceDeviceCache *pIVar1;
  undefined8 *puVar2;
  IOSurfaceDeviceCache *pIVar3;
  IOSurfaceDeviceCache *pIVar4;
  long *plVar5;
  undefined8 uVar6;
  IOSurfaceDeviceCache *this_00;
  char *pcVar7;
  undefined8 uVar8;
  IOSurfaceDeviceCache *local_40;
  IOSurfaceDeviceCache *local_38;
  
  local_38 = (IOSurfaceDeviceCache *)&local_40;
  local_40 = (IOSurfaceDeviceCache *)0x0;
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if (*(IOSurfaceDeviceCache **)(this + 0x40) != (IOSurfaceDeviceCache *)0x0) {
    this_00 = *(IOSurfaceDeviceCache **)(this + 0x40);
    do {
      pIVar1 = *(IOSurfaceDeviceCache **)(this_00 + 0x30);
      if (this_00[0x59] != (IOSurfaceDeviceCache)0x0) {
        if (pIVar1 == (IOSurfaceDeviceCache *)0x0) {
          plVar5 = *(long **)(this_00 + 0x38);
          if ((IOSurfaceDeviceCache *)*plVar5 != this_00) {
LAB_0000a6d9:
            pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
            goto LAB_0000a704;
          }
          *(long **)(this + 0x48) = plVar5;
        }
        else {
          if (*(IOSurfaceDeviceCache **)(pIVar1 + 0x38) != this_00 + 0x30) {
            pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_0000a704:
            uVar6 = 0x1034;
            uVar8 = 0x1034;
            goto LAB_0000a719;
          }
          if ((IOSurfaceDeviceCache *)**(long **)(this_00 + 0x38) != this_00) goto LAB_0000a6d9;
          *(long **)(pIVar1 + 0x38) = *(long **)(this_00 + 0x38);
          plVar5 = *(long **)(this_00 + 0x38);
        }
        *plVar5 = (long)pIVar1;
        *(undefined8 *)(this_00 + 0x30) = 0;
        *(IOSurfaceDeviceCache **)(this_00 + 0x38) = local_38;
        *(IOSurfaceDeviceCache **)local_38 = this_00;
        local_38 = this_00 + 0x30;
        _OSIncrementAtomic(this + 0x3ac);
        if (this_00 == *(IOSurfaceDeviceCache **)(this + 0x38)) {
          *(undefined8 *)(this + 0x38) = 0;
          puVar2 = *(undefined8 **)(this + 0x178);
          *(undefined2 *)(puVar2 + 1) = 0;
          *puVar2 = 0;
        }
      }
      this_00 = pIVar1;
    } while (pIVar1 != (IOSurfaceDeviceCache *)0x0);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  if (local_40 != (IOSurfaceDeviceCache *)0x0) {
    this_00 = local_40;
    do {
      pIVar1 = *(IOSurfaceDeviceCache **)(this_00 + 0x30);
      if (pIVar1 == (IOSurfaceDeviceCache *)0x0) {
        pIVar4 = *(IOSurfaceDeviceCache **)(this_00 + 0x38);
        pIVar3 = pIVar4;
        if (*(IOSurfaceDeviceCache **)pIVar4 != this_00) {
LAB_0000a6d0:
          pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0000a6e9:
          uVar6 = 0x1044;
          uVar8 = 0x1044;
LAB_0000a719:
                    // WARNING: Subroutine does not return
          _panic(pcVar7,this_00,uVar6,"IOSurface.cpp",uVar8);
        }
      }
      else {
        if (*(IOSurfaceDeviceCache **)(pIVar1 + 0x38) != this_00 + 0x30) {
          pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
          goto LAB_0000a6e9;
        }
        if ((IOSurfaceDeviceCache *)**(long **)(this_00 + 0x38) != this_00) goto LAB_0000a6d0;
        *(long **)(pIVar1 + 0x38) = *(long **)(this_00 + 0x38);
        pIVar4 = *(IOSurfaceDeviceCache **)(this_00 + 0x38);
        pIVar3 = local_38;
      }
      local_38 = pIVar3;
      *(IOSurfaceDeviceCache **)pIVar4 = pIVar1;
      IOSurfaceDeviceCache::accelRelease(this_00);
      _OSDecrementAtomic(this + 0x3ac);
      this_00 = pIVar1;
    } while (pIVar1 != (IOSurfaceDeviceCache *)0x0);
  }
  return;
}



// IOSurface::gatherOrphanedDeviceCachesWithAccelerator(void*, IOSurfaceDeviceCacheList*)

ulong __thiscall
IOSurface::gatherOrphanedDeviceCachesWithAccelerator(IOSurface *this,long param_1,long param_2)

{
  long *plVar1;
  long *plVar2;
  undefined8 *puVar3;
  long lVar4;
  int iVar5;
  long *plVar6;
  char *pcVar7;
  ulong uVar8;
  long *plVar9;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if (*(int *)(this + 0x3ac) == 0) {
    uVar8 = CONCAT71((int7)((ulong)param_2 >> 8),1);
    plVar9 = *(long **)(this + 0x40);
    if (*(long **)(this + 0x40) != (long *)0x0) {
      do {
        plVar2 = (long *)plVar9[6];
        if (plVar9[3] == param_1) {
          if (*(char *)((long)plVar9 + 0x59) == '\0') goto LAB_0000a749;
          iVar5 = (**(code **)(*plVar9 + 0x18))(plVar9);
          if (iVar5 != 1) goto LAB_0000a749;
          plVar1 = plVar9 + 6;
          if (plVar9 == *(long **)(this + 0x38)) {
            *(undefined8 *)(this + 0x38) = 0;
            puVar3 = *(undefined8 **)(this + 0x178);
            *(undefined2 *)(puVar3 + 1) = 0;
            *puVar3 = 0;
          }
          (**(code **)(*(long *)this + 0x20))(this);
          lVar4 = *plVar1;
          if (lVar4 == 0) {
            plVar6 = (long *)plVar9[7];
            if ((long *)*plVar6 != plVar9) {
LAB_0000a824:
              pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0000a834:
                    // WARNING: Subroutine does not return
              _panic(pcVar7,plVar9,0x1071,"IOSurface.cpp",0x1071);
            }
            *(long **)(this + 0x48) = plVar6;
          }
          else {
            if (*(long **)(lVar4 + 0x38) != plVar1) {
              pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
              goto LAB_0000a834;
            }
            if (*(long **)plVar9[7] != plVar9) goto LAB_0000a824;
            *(undefined8 **)(lVar4 + 0x38) = (undefined8 *)plVar9[7];
            plVar6 = (long *)plVar9[7];
          }
          *plVar6 = lVar4;
          plVar9[6] = 0;
          puVar3 = *(undefined8 **)(param_2 + 8);
          plVar9[7] = (long)puVar3;
          *puVar3 = plVar9;
          *(long **)(param_2 + 8) = plVar1;
        }
        plVar9 = plVar2;
      } while (plVar2 != (long *)0x0);
      uVar8 = 1;
    }
  }
  else {
LAB_0000a749:
    uVar8 = 0;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return uVar8 & 0xffffffff;
}



// IOSurface::get_max_property_size() const

undefined4 __thiscall IOSurface::get_max_property_size(IOSurface *this)

{
  return *(undefined4 *)(*(long *)(this + 0x178) + 0x28);
}



// IOSurface::set_max_property_size(unsigned int)

void __thiscall IOSurface::set_max_property_size(IOSurface *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x178) + 0x28) = param_1;
  return;
}



// IOSurface::prepare()

undefined8 __thiscall IOSurface::prepare(IOSurface *this)

{
  undefined4 uVar1;
  int iVar2;
  long lVar3;
  uintptr_t local_38;
  undefined1 local_2d;
  undefined1 local_2c;
  undefined1 local_2b;
  undefined1 local_2a;
  undefined1 local_29;
  
  if (*(long *)(this + 0x30) == 0) {
    return 0xe00002bc;
  }
  _IOLockLock(*(undefined8 *)(this + 0x398));
  iVar2 = _OSIncrementAtomic(this + 0x20c);
  if (iVar2 == 0) {
    iVar2 = 0;
    if ((((byte)this[0x3c9] & 4) == 0) && ((*(ushort *)(_gIOSurfaceRoot + 0x1b4) & 0x120) != 0)) {
      iVar2 = (**(code **)(**(long **)(this + 0x30) + 0x1f0))(*(long **)(this + 0x30),0);
    }
    lVar3 = (**(code **)(**(long **)(this + 0x30) + 0x140))();
    if ((((*(byte *)(_gIOSurfaceRoot + 0x1b4) & 0x20) != 0) && (*(int *)(this + 0x3a8) == 0)) &&
       (lVar3 != *(long *)(this + 0x388))) {
      uVar1 = *(undefined4 *)(this + 0x80);
      local_2d = (undefined1)((uint)uVar1 >> 0x18);
      local_2c = (undefined1)((uint)uVar1 >> 0x10);
      local_2b = (undefined1)((uint)uVar1 >> 8);
      local_2a = (undefined1)uVar1;
      local_29 = 0;
      __os_log_internal(0,PTR___os_log_default_00027090,0);
      *(long *)(this + 0x388) = lVar3;
      *(long *)(this + 0x390) = *(long *)(this + 0x390) + 1;
    }
    if ((((byte)this[0x3c8] & 0x20) == 0) || (iVar2 != 0)) {
      if (iVar2 != 0) {
        _OSDecrementAtomic(this + 0x20c);
        goto LAB_0000a9ee;
      }
    }
    else {
      cleanProcessorCaches(this);
      this[0x3c8] = (IOSurface)((byte)this[0x3c8] & 0xdf);
    }
    local_38 = 0;
    _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_38);
    _kernel_debug(0x8521001c,local_38,(ulong)*(uint *)(this + 0x10),0,0,0);
  }
LAB_0000a9ee:
  _IOLockUnlock(*(undefined8 *)(this + 0x398));
  return 0;
}



// IOSurface::complete()

undefined8 __thiscall IOSurface::complete(IOSurface *this)

{
  uint uVar1;
  undefined4 uVar2;
  int iVar3;
  OSMetaClassBase *pOVar4;
  long *plVar5;
  uintptr_t local_28;
  undefined1 local_1d;
  undefined1 local_1c;
  undefined1 local_1b;
  undefined1 local_1a;
  undefined1 local_19;
  
  _IOLockLock(*(undefined8 *)(this + 0x398));
  iVar3 = _OSDecrementAtomic(this + 0x20c);
  if (iVar3 == 1) {
    uVar1 = *(uint *)(_gIOSurfaceRoot + 0x1b4);
    if ((uVar1 >> 8 & 1) == 0) {
      if ((uVar1 & 0x20) == 0) {
        if (((uVar1 & 0x40) != 0) && (*(int *)(this + 0x3a8) == 0)) {
          uVar2 = *(undefined4 *)(this + 0x80);
          local_1d = (undefined1)((uint)uVar2 >> 0x18);
          local_1c = (undefined1)((uint)uVar2 >> 0x10);
          local_1b = (undefined1)((uint)uVar2 >> 8);
          local_1a = (undefined1)uVar2;
          local_19 = 0;
          plVar5 = *(long **)(this + 0x1a8);
          if (plVar5 == (long *)0x0) {
            _IOLockLock(*(undefined8 *)(this + 0x50));
            init_values(this);
            _IOLockUnlock(*(undefined8 *)(this + 0x50));
            plVar5 = *(long **)(this + 0x1a8);
          }
          pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar5 + 0x208))(plVar5,"IOSurfaceName");
          plVar5 = (long *)OSMetaClassBase::safeMetaCast
                                     (pOVar4,*(OSMetaClass **)PTR_metaClass_00027058);
          if (plVar5 != (long *)0x0) {
            (**(code **)(*plVar5 + 0x148))(plVar5);
          }
          __os_log_internal(0,PTR___os_log_default_00027090,0);
        }
      }
      else {
        (**(code **)(**(long **)(this + 0x30) + 0x1f8))(*(long **)(this + 0x30),0);
      }
    }
    else {
      this[0x3c9] = (IOSurface)((byte)this[0x3c9] | 4);
    }
    local_28 = 0;
    _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_28);
    _kernel_debug(0x85210020,local_28,(ulong)*(uint *)(this + 0x10),0,0,0);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x398));
  return 0;
}



// IOSurface::ktrace_emit_debug_info(bool)

void __thiscall IOSurface::ktrace_emit_debug_info(IOSurface *this,char param_1)

{
  uint uVar1;
  char cVar2;
  int iVar3;
  uintptr_t arg2;
  ulong uVar4;
  
  if ((isDevFused != '\0') && (*(int *)PTR__kdebug_enable_000270b0 != 0)) {
    cVar2 = _kdebug_debugid_explicitly_enabled(0x5400000);
    if (cVar2 != '\0') {
      arg2 = 0;
      _kernel_debug(0x5400010,(ulong)*(uint *)(this + 0x10),(ulong)*(uint *)(this + 0x80),
                    *(uintptr_t *)(this + 0x90),
                    (ulong)(*(uint *)(this + 0x3c8) >> 9 & 1 | *(int *)(this + 0x98) << 8),0);
      _kernel_debug(0x5400014,(ulong)*(uint *)(this + 0x10),*(uintptr_t *)(this + 0x58),
                    *(uintptr_t *)(this + 0x60),
                    (ulong)*(ushort *)(this + 0x70) |
                    (long)(int)((uint)(byte)this[0x72] << 0x18) | (ulong)(byte)this[0x73] << 0x10,0)
      ;
      uVar1 = *(uint *)(this + 0x10);
      if (*(long *)(this + 0x30) != 0) {
        arg2 = IOMemoryDescriptor::getDescriptorID();
      }
      _kernel_debug(0x540000c,(ulong)uVar1,arg2,0,0,0);
      if ((*(long **)(this + 0x30) != (long *)0x0) && (param_1 != '\0')) {
        uVar4 = (**(code **)(**(long **)(this + 0x30) + 0x140))();
        if (1 < uVar4) {
          iVar3 = (**(code **)(**(long **)(this + 0x30) + 0x1f0))(*(long **)(this + 0x30),0);
          if (iVar3 == 0) {
            IOMemoryDescriptor::ktraceEmitPhysicalSegments();
                    // WARNING: Could not recover jumptable at 0x0000acd0. Too many branches
                    // WARNING: Treating indirect jump as call
            (**(code **)(**(long **)(this + 0x30) + 0x1f8))(*(long **)(this + 0x30),0);
            return;
          }
        }
      }
    }
  }
  return;
}



// IOSurface::ktrace_emit_property_info()

void __thiscall IOSurface::ktrace_emit_property_info(IOSurface *this)

{
  OSMetaClassBase *pOVar1;
  long *plVar2;
  undefined8 uVar3;
  undefined8 local_20;
  
  plVar2 = *(long **)(this + 0x1a8);
  if (plVar2 != (long *)0x0) {
    pOVar1 = (OSMetaClassBase *)(**(code **)(*plVar2 + 0x208))(plVar2,"IOSurfaceName");
    plVar2 = (long *)OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027058);
    if (plVar2 != (long *)0x0) {
      local_20 = 0;
      uVar3 = (**(code **)(*plVar2 + 0x148))(plVar2);
      _kernel_debug_string(0x5400008,&local_20,uVar3);
      _kernel_debug_filtered(0x5400008,*(undefined4 *)(this + 0x10),local_20,0,0);
    }
  }
  return;
}



// IOSurface::write_debug_info(OSDictionary*)

void __thiscall IOSurface::write_debug_info(IOSurface *this,long *param_1)

{
  write_debug_info_with_options(this,param_1,1,0);
  return;
}



// IOSurface::write_debug_info_with_options(OSDictionary*, unsigned int, unsigned long long)

void __thiscall
IOSurface::write_debug_info_with_options
          (IOSurface *this,long *param_1,int param_2,undefined8 param_3)

{
  uint3 uVar1;
  int iVar2;
  ulong uVar3;
  undefined8 uVar4;
  OSMetaClassBase *pOVar5;
  long lVar6;
  undefined8 *puVar7;
  long *plVar8;
  IOSurfaceMemoryPoolBunch *this_00;
  long *plVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  ulong uVar13;
  uint uVar14;
  bool bVar15;
  undefined1 *local_128;
  undefined8 local_120;
  undefined8 local_118;
  undefined8 local_110;
  uint local_108;
  uint local_104;
  uint local_100;
  undefined4 uStack_fc;
  long *local_f8;
  long *local_f0;
  long *local_e8;
  undefined8 local_e0;
  undefined4 local_d8;
  undefined4 local_d4;
  undefined4 local_d0;
  uint local_cc;
  undefined4 local_c8;
  undefined4 local_c4;
  undefined8 local_c0;
  undefined1 *local_b8;
  undefined1 *local_b0;
  undefined8 local_a8;
  undefined1 *local_a0;
  undefined1 *local_98;
  undefined1 *local_90;
  undefined1 *local_88;
  undefined1 *local_80;
  undefined1 *local_78;
  undefined1 *local_70;
  long *local_68;
  undefined1 *local_60;
  undefined1 *local_58;
  undefined1 *local_50;
  undefined1 *local_48;
  undefined8 local_40;
  long *local_38;
  
  local_70 = &DAT_aaaaaaaaaaaaaaaa;
  local_78 = &DAT_aaaaaaaaaaaaaaaa;
  local_80 = &DAT_aaaaaaaaaaaaaaaa;
  local_88 = &DAT_aaaaaaaaaaaaaaaa;
  local_90 = &DAT_aaaaaaaaaaaaaaaa;
  local_98 = &DAT_aaaaaaaaaaaaaaaa;
  local_a0 = &DAT_aaaaaaaaaaaaaaaa;
  local_a8 = &DAT_aaaaaaaaaaaaaaaa;
  local_b0 = &DAT_aaaaaaaaaaaaaaaa;
  local_b8 = &DAT_aaaaaaaaaaaaaaaa;
  local_c0 = &DAT_aaaaaaaaaaaaaaaa;
  local_d8 = *(undefined4 *)(this + 0x10);
  local_d4 = *(undefined4 *)(this + 0x80);
  local_d0 = (**(code **)(*(long *)this + 0x18))();
  local_cc = (uint)*(byte *)(*(long *)(this + 0x178) + 0x6a);
  local_c8 = *(undefined4 *)(this + 0x9c);
  local_c4 = *(undefined4 *)(this + 0x210);
  local_b8 = *(undefined1 **)(this + 0x88);
  local_b0 = *(undefined1 **)(this + 0x90);
  local_a8 = (undefined1 *)(CONCAT71(local_a8._1_7_,(byte)this[0x3c8] >> 1) & 0xffffffffffffff01);
  plVar8 = *(long **)(this + 0x30);
  local_a8._0_2_ = CONCAT11(plVar8 != (long *)0x0,(undefined1)local_a8);
  local_e0 = param_3;
  if (plVar8 == (long *)0x0) {
    bVar15 = false;
  }
  else {
    uVar3 = (**(code **)(*plVar8 + 0x140))();
    bVar15 = 1 < uVar3;
  }
  local_a8._0_3_ = CONCAT12(bVar15,(undefined2)local_a8);
  uVar1 = (uint3)local_a8;
  local_a8 = (undefined1 *)(ulong)(uint3)local_a8;
  if (*(long *)(this + 0x358) != 0) {
    local_a8._0_4_ = (uint)uVar1;
    local_a8 = (undefined1 *)
               CONCAT44(*(undefined4 *)(*(long *)(this + 0x358) + 0x10),(uint)local_a8);
  }
  local_a8._0_4_ = (uint)(uint3)local_a8;
  local_88 = (undefined1 *)0x0;
  local_80 = (undefined1 *)0x0;
  local_78 = *(undefined1 **)(this + 0x360);
  local_70 = (undefined1 *)0x0;
  ktrace_emit_debug_info(this,'\x01');
  _IOLockLock(*(undefined8 *)(this + 0x50));
  ktrace_emit_property_info(this);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  if (*(ulonglong **)(this + 0x30) == (ulonglong *)0x0) {
    local_c0._4_4_ = *(undefined4 *)(this + 0x208);
    local_c0._0_4_ = 0xffffffff;
  }
  else {
    local_128 = &DAT_aaaaaaaaaaaaaaaa;
    local_68 = (long *)&DAT_aaaaaaaaaaaaaaaa;
    iVar2 = IOMemoryDescriptor::getPageCounts(*(ulonglong **)(this + 0x30),(ulonglong *)&local_128);
    if (iVar2 == 0) {
      local_88 = (undefined1 *)(ulong)(uint)((int)local_128 * *(int *)PTR__page_size_000270c0);
      local_80 = (undefined1 *)(ulong)(uint)(*(int *)PTR__page_size_000270c0 * (int)local_68);
    }
    local_70 = (undefined1 *)IOMemoryDescriptor::getDescriptorID();
    plVar8 = *(long **)(this + 0x30);
    local_c0._4_4_ = *(undefined4 *)(this + 0x208);
    local_c0._0_4_ = 0xffffffff;
    if (plVar8 != (long *)0x0) {
      local_128 = (undefined1 *)CONCAT44(local_128._4_4_,2);
      iVar2 = (**(code **)(*plVar8 + 0x120))(plVar8,1);
      if (iVar2 == 0) {
        local_c0._0_4_ = (int)local_128;
      }
    }
  }
  local_a0 = *(undefined1 **)(*(long *)(this + 0x2e0) + 0x28);
  local_98 = *(undefined1 **)(*(long *)(this + 0x2e0) + 0x10);
  local_90 = *(undefined1 **)(this + 0x3a0);
  setStruct(param_1,"BasicInfo",&local_e0,0x78);
  local_128 = *(undefined1 **)(this + 0x78);
  local_120 = *(undefined8 *)(this + 0x58);
  local_118 = *(undefined8 *)(this + 0x60);
  local_110 = *(undefined8 *)(this + 0x68);
  local_108 = (uint)*(ushort *)(this + 0x70);
  local_104 = (uint)(byte)this[0x72];
  _local_100 = CONCAT44(0xaaaaaaaa,(uint)(byte)this[0x73]);
  setStruct(param_1,"Layout",&local_128,0x30);
  local_f8 = (long *)OSNumber::withNumber
                               (*(ulong *)(*(long *)(this + 0x178) + 0x18) & 0xffffffff,0x20);
  (**(code **)(*param_1 + 0x1d0))(param_1,"UseCount");
  local_f0 = (long *)OSNumber::withNumber(*(ulong *)(*(long *)(this + 0x178) + 0x18) >> 0x20,0x20);
  (**(code **)(*param_1 + 0x1d0))(param_1,"UseCount1");
  if (*(IOSurfaceMemoryRegion **)(this + 0x28) != (IOSurfaceMemoryRegion *)0x0) {
    uVar4 = IOSurfaceMemoryRegion::getRegionName(*(IOSurfaceMemoryRegion **)(this + 0x28));
    (**(code **)(*param_1 + 0x1d0))(param_1,"IOSurfaceMemoryRegion",uVar4);
  }
  _IOLockLock(*(undefined8 *)(this + 0x50));
  plVar8 = *(long **)(this + 0x1a8);
  if (plVar8 != (long *)0x0) {
    pOVar5 = (OSMetaClassBase *)(**(code **)(*plVar8 + 0x208))(plVar8,"IOSurfaceName");
    if (pOVar5 != (OSMetaClassBase *)0x0) {
      lVar6 = OSMetaClassBase::safeMetaCast(pOVar5,*(OSMetaClass **)PTR_metaClass_00027058);
      if (lVar6 != 0) {
        (**(code **)(*param_1 + 0x1d0))(param_1,"IOSurfaceName",pOVar5);
      }
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  if (param_2 != 0) {
    if (*(long *)(this + 0x248) != 0) {
      (**(code **)(*param_1 + 0x1d0))(param_1,"CreationProperties");
    }
    if (*(uint *)(this + 0x98) != 0) {
      local_38 = (long *)OSArray::withCapacity(*(uint *)(this + 0x98));
      if (local_38 != (long *)0x0) {
        local_e8 = param_1;
        if (*(int *)(this + 0x98) != 0) {
          uVar3 = 0xffffffff7fffffc8;
          uVar13 = 0;
          uVar14 = 0;
          do {
            local_40 = &DAT_aaaaaaaaaaaaaaaa;
            local_48 = &DAT_aaaaaaaaaaaaaaaa;
            local_50 = &DAT_aaaaaaaaaaaaaaaa;
            local_58 = &DAT_aaaaaaaaaaaaaaaa;
            local_60 = &DAT_aaaaaaaaaaaaaaaa;
            local_68 = (long *)&DAT_aaaaaaaaaaaaaaaa;
            uVar12 = *(ulong *)(this + 0x180);
            uVar10 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar12;
            uVar11 = uVar10 - uVar12;
            if ((uVar10 < uVar12) || (uVar11 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                        );
            }
            uVar3 = uVar3 + 0x38;
            if (uVar3 < 0xffffffff00000000) {
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                        );
            }
            if (((long)uVar13 < 0) || ((uint)uVar11 < (int)(uVar13 >> 0x20) + 0x38U)) {
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                        );
            }
            puVar7 = (undefined8 *)(uVar12 + (uVar13 >> 0x20));
            uVar10 = (ulong)CARRY8(uVar12,uVar13 >> 0x20);
            uVar12 = -uVar10;
            if ((uVar10 != uVar12) || ((long)uVar12 < 0)) {
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                        );
            }
            uVar14 = uVar14 + 1;
            local_68 = (long *)puVar7[3];
            local_60 = (undefined1 *)*puVar7;
            local_58 = (undefined1 *)puVar7[1];
            local_50 = (undefined1 *)puVar7[4];
            local_48 = (undefined1 *)
                       (ulong)CONCAT14(*(undefined1 *)((long)puVar7 + 0x34),
                                       (uint)*(ushort *)(puVar7 + 6));
            local_40 = (undefined1 *)CONCAT44(0xaaaaaaaa,(uint)*(byte *)((long)puVar7 + 0x35));
            plVar8 = (long *)OSData::withBytes(&local_68,0x30);
            if (plVar8 != (long *)0x0) {
              (**(code **)(*local_38 + 0x1b8))(local_38,plVar8);
              (**(code **)(*plVar8 + 0x28))(plVar8);
            }
            uVar13 = uVar13 + 0x3800000000;
          } while (uVar14 < *(uint *)(this + 0x98));
        }
        plVar8 = local_38;
        param_1 = local_e8;
        (**(code **)(*local_e8 + 0x1d0))(local_e8,"IOSurfacePlaneInfo",local_38);
        (**(code **)(*plVar8 + 0x28))(plVar8);
      }
    }
  }
  if ((*(long *)(this + 800) != 0) && (*(long *)(this + 0x30) != 0)) {
    this_00 = (IOSurfaceMemoryPoolBunch *)IOSurfaceRoot::getMemoryPoolBunch(_gIOSurfaceRoot);
    plVar9 = (long *)OSDictionary::withCapacity(1);
    plVar8 = *(long **)(this + 0x30);
    if (plVar8 != (long *)0x0) {
      (**(code **)(*plVar8 + 0x20))(plVar8);
    }
    if ((this_00 != (IOSurfaceMemoryPoolBunch *)0x0) && (plVar9 != (long *)0x0)) {
      (**(code **)(*plVar9 + 0x20))(plVar9);
      if (plVar8 != (long *)0x0) {
        (**(code **)(*plVar8 + 0x20))(plVar8);
      }
      uVar4 = IOSurfaceMemoryPoolBunch::write_debug_infoForDescriptor(this_00,plVar9,plVar8);
      if ((char)uVar4 != '\0') {
        local_68 = plVar9;
        (**(code **)(*plVar9 + 0x20))(plVar9);
        OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"IOSurfaceMemoryPoolInfo");
        if (local_68 != (long *)0x0) {
          (**(code **)(*local_68 + 0x28))();
        }
      }
    }
    if (plVar8 != (long *)0x0) {
      (**(code **)(*plVar8 + 0x28))(plVar8);
    }
    if (plVar9 != (long *)0x0) {
      (**(code **)(*plVar9 + 0x28))(plVar9);
    }
    if (this_00 != (IOSurfaceMemoryPoolBunch *)0x0) {
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
  }
  if (local_f0 != (long *)0x0) {
    (**(code **)(*local_f0 + 0x28))();
  }
  if (local_f8 != (long *)0x0) {
    (**(code **)(*local_f8 + 0x28))();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// setStruct(OSDictionary*, char const*, void const*, unsigned long)

void __cdecl setStruct(long *param_1,undefined8 param_2,void *param_3,uint param_4)

{
  long *plVar1;
  
  plVar1 = (long *)OSData::withBytes(param_3,param_4);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x1d0))(param_1,param_2,plVar1);
                    // WARNING: Could not recover jumptable at 0x0000b475. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::setYCbCrMatrix(unsigned int)

undefined8 __thiscall IOSurface::setYCbCrMatrix(IOSurface *this,undefined1 param_1)

{
  *(undefined1 *)(*(long *)(this + 0x178) + 0x6a) = param_1;
  return 0;
}



// IOSurface::getYCbCrMatrix() const

undefined1 __thiscall IOSurface::getYCbCrMatrix(IOSurface *this)

{
  return *(undefined1 *)(*(long *)(this + 0x178) + 0x6a);
}



// IOSurface::isTiled(bool)

void __thiscall IOSurface::isTiled(IOSurface *this,int param_1)

{
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffffdff | param_1 << 9;
  *(char *)(*(long *)(this + 0x178) + 0x14) = (char)param_1;
  return;
}



// IOSurface::setTiled(bool)

undefined8 __thiscall IOSurface::setTiled(IOSurface *this,int param_1)

{
  undefined8 uVar1;
  
  uVar1 = 0xe00002c7;
  if ((param_1 != 0) && ((*(uint *)(this + 0x3c8) >> 0xc & 1) != 0)) {
    *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) | 0x200;
    *(char *)(*(long *)(this + 0x178) + 0x14) = (char)param_1;
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurface::getTileFormat()

undefined4 __thiscall IOSurface::getTileFormat(IOSurface *this)

{
  return *(undefined4 *)(this + 0x214);
}



undefined8
____ZN9IOSurface11init_valuesEv_block_invoke(long param_1,long *param_2,undefined8 param_3)

{
  long lVar1;
  long *plVar2;
  char cVar3;
  
  lVar1 = *(long *)(param_1 + 0x20);
  cVar3 = (**(code **)(*param_2 + 0x158))(param_2,"CreationProperties");
  if (cVar3 == '\0') {
    plVar2 = *(long **)(lVar1 + 0x1a8);
    (**(code **)(*plVar2 + 0x1c0))(plVar2,param_2,param_3);
  }
  return 0;
}



// IOSurface::set_value(OSSymbol const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::set_value(IOSurface *this,long *param_1,OSMetaClassBase *param_2,int *param_3)

{
  char cVar1;
  undefined1 uVar2;
  _func_bool_OSSymbol_ptr_OSObject_ptr *p_Var3;
  int iVar4;
  undefined8 local_70;
  undefined8 *local_68;
  undefined8 local_60;
  undefined1 local_58;
  undefined8 local_50;
  undefined8 *local_48;
  undefined8 local_40;
  undefined1 local_38;
  
  local_48 = &local_50;
  local_50 = 0;
  local_40 = 0x2000000000;
  local_38 = 0;
  local_68 = &local_70;
  local_70 = 0;
  local_60 = 0x2000000000;
  local_58 = 0;
  iVar4 = (*(uint *)(*(long *)(this + 0x178) + 0x20) | 1) + 2;
  *(int *)(*(long *)(this + 0x178) + 0x20) = iVar4;
  *param_3 = iVar4;
  if (*(long *)(this + 0x1a8) == 0) {
    init_values(this);
    if (*(long *)(this + 0x1a8) == 0) {
      *(undefined1 *)(local_48 + 3) = 0;
      goto LAB_0000b6b6;
    }
  }
  if (param_1 == (long *)0x0) {
    p_Var3 = (_func_bool_OSSymbol_ptr_OSObject_ptr *)
             OSMetaClassBase::safeMetaCast(param_2,*(OSMetaClass **)PTR_metaClass_00027010);
    if (p_Var3 != (_func_bool_OSSymbol_ptr_OSObject_ptr *)0x0) {
      OSDictionary::iterateObjects(p_Var3);
    }
  }
  else {
    cVar1 = (**(code **)(*param_1 + 0x158))(param_1);
    if (cVar1 == '\0') {
      cVar1 = (**(code **)(*param_1 + 0x158))(param_1,"IOSurfaceName");
      if (cVar1 != '\0') {
        *(undefined1 *)(local_68 + 3) = 1;
      }
      uVar2 = (**(code **)(**(long **)(this + 0x1a8) + 0x1c0))
                        (*(long **)(this + 0x1a8),param_1,param_2);
      *(undefined1 *)(local_48 + 3) = uVar2;
    }
    else {
      *(undefined1 *)(local_48 + 3) = 1;
    }
  }
LAB_0000b6b6:
  ktrace_emit_debug_info(this,'\0');
  ktrace_emit_property_info(this);
  if ((*(char *)(local_68 + 3) != '\0') && (*(long *)(this + 0x30) != 0)) {
    param_2 = (OSMetaClassBase *)IOSurfaceMemoryTag::withSurface(this);
    IOMemoryDescriptor::setContext(*(OSObject **)(this + 0x30));
    if (param_2 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)param_2 + 0x28))(param_2);
    }
  }
  uVar2 = *(undefined1 *)(local_48 + 3);
  __Block_object_dispose(&local_70,8);
  __Block_object_dispose(&local_50,8);
  return CONCAT71((int7)((ulong)param_2 >> 8),uVar2) & 0xffffffff;
}



undefined8
____ZN9IOSurface9set_valueEPK8OSSymbolPK15OSMetaClassBasePj_block_invoke
          (long param_1,long *param_2,undefined8 param_3)

{
  long lVar1;
  long *plVar2;
  char cVar3;
  undefined1 uVar4;
  
  lVar1 = *(long *)(param_1 + 0x30);
  cVar3 = (**(code **)(*param_2 + 0x158))(param_2,"CreationProperties");
  if (cVar3 == '\0') {
    cVar3 = (**(code **)(*param_2 + 0x158))(param_2,"IOSurfaceName");
    if (cVar3 != '\0') {
      *(undefined1 *)(*(long *)(*(long *)(param_1 + 0x28) + 8) + 0x18) = 1;
    }
    plVar2 = *(long **)(lVar1 + 0x1a8);
    uVar4 = (**(code **)(*plVar2 + 0x1c0))(plVar2,param_2,param_3);
    *(undefined1 *)(*(long *)(*(long *)(param_1 + 0x20) + 8) + 0x18) = uVar4;
  }
  else {
    *(undefined1 *)(*(long *)(*(long *)(param_1 + 0x20) + 8) + 0x18) = 1;
  }
  lVar1 = *(long *)(*(long *)(param_1 + 0x20) + 8);
  return CONCAT71((int7)((ulong)lVar1 >> 8),*(char *)(lVar1 + 0x18) == '\0');
}



void ___copy_helper_block_8_32r40r(long param_1,long param_2)

{
  __Block_object_assign((void *)(param_1 + 0x20),*(void **)(param_2 + 0x20),8);
  __Block_object_assign((void *)(param_1 + 0x28),*(void **)(param_2 + 0x28),8);
  return;
}



void ___destroy_helper_block_8_32r40r(long param_1)

{
  __Block_object_dispose(*(void **)(param_1 + 0x28),8);
  __Block_object_dispose(*(void **)(param_1 + 0x20),8);
  return;
}



// IOSurface::copy_value(OSSymbol const*, unsigned int*) const

OSMetaClassBase * __thiscall IOSurface::copy_value(IOSurface *this,long param_1,undefined4 *param_2)

{
  OSMetaClassBase *pOVar1;
  long *plVar2;
  undefined1 auVar3 [16];
  
  *param_2 = *(undefined4 *)(*(long *)(this + 0x178) + 0x20);
  if (*(long *)(this + 0x1a8) == 0) {
    init_values(this);
  }
  plVar2 = *(long **)(this + 0x1a8);
  if (param_1 != 0) {
    pOVar1 = (OSMetaClassBase *)(**(code **)(*plVar2 + 0x1f8))(plVar2,param_1);
    if (pOVar1 == (OSMetaClassBase *)0x0) {
      pOVar1 = (OSMetaClassBase *)0x0;
    }
    else {
      auVar3 = OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027008);
      plVar2 = auVar3._0_8_;
      if (plVar2 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000b8a9. Too many branches
                    // WARNING: Treating indirect jump as call
        pOVar1 = (OSMetaClassBase *)
                 (**(code **)(*plVar2 + 0x168))(plVar2,0,auVar3._8_8_,*(code **)(*plVar2 + 0x168));
        return pOVar1;
      }
      (**(code **)(*(long *)pOVar1 + 0x20))(pOVar1);
    }
    return pOVar1;
  }
                    // WARNING: Could not recover jumptable at 0x0000b8b8. Too many branches
                    // WARNING: Treating indirect jump as call
  pOVar1 = (OSMetaClassBase *)(**(code **)(*plVar2 + 0x168))(plVar2,0);
  return pOVar1;
}



// IOSurface::remove_value(OSSymbol const*, unsigned int*)

void __thiscall IOSurface::remove_value(IOSurface *this,long *param_1,int *param_2)

{
  long *plVar1;
  char cVar2;
  int iVar3;
  
  iVar3 = (*(uint *)(*(long *)(this + 0x178) + 0x20) | 1) + 2;
  *(int *)(*(long *)(this + 0x178) + 0x20) = iVar3;
  *param_2 = iVar3;
  plVar1 = *(long **)(this + 0x1a8);
  if (param_1 == (long *)0x0) {
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))();
    }
    *(undefined8 *)(this + 0x1a8) = 0;
  }
  else if (plVar1 != (long *)0x0) {
    cVar2 = (**(code **)(*param_1 + 0x158))(param_1,"CreationProperties");
    if (cVar2 == '\0') {
                    // WARNING: Could not recover jumptable at 0x0000b932. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(**(long **)(this + 0x1a8) + 0x1d8))(*(long **)(this + 0x1a8),param_1);
      return;
    }
  }
  return;
}



// IOSurface::setValue(OSSymbol const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::setValue(IOSurface *this,long *param_1,OSMetaClassBase *param_2,int *param_3)

{
  ulong uVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  uVar1 = set_value(this,param_1,param_2,param_3);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return uVar1 & 0xffffffff;
}



// IOSurface::copyValue(OSSymbol const*, unsigned int*) const

OSMetaClassBase * __thiscall IOSurface::copyValue(IOSurface *this,long param_1,undefined4 *param_2)

{
  OSMetaClassBase *pOVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  pOVar1 = copy_value(this,param_1,param_2);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return pOVar1;
}



// IOSurface::removeValue(OSSymbol const*, unsigned int*)

void __thiscall IOSurface::removeValue(IOSurface *this,long *param_1,int *param_2)

{
  _IOLockLock(*(undefined8 *)(this + 0x50));
  remove_value(this,param_1,param_2);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::deviceLockSurface(unsigned int)

undefined8 __cdecl IOSurface::deviceLockSurface(IOSurface *param_1)

{
  uint uVar1;
  
  _IOLockLock(*(undefined8 *)(param_1 + 0x50));
  if (((byte)param_1[0x3c8] & 0x20) != 0) {
    cleanProcessorCaches(param_1);
    uVar1 = *(uint *)(param_1 + 0x3c8);
    *(uint *)(param_1 + 0x3c8) = uVar1 & 0xffffffdf;
    if ((uVar1 & 0x10) != 0) {
      *(uint *)(param_1 + 0x3c8) = uVar1 & 0xffffffcf;
    }
  }
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x50));
  return 0;
}



// IOSurface::deviceUnlockSurface(unsigned int)

undefined8 __thiscall IOSurface::deviceUnlockSurface(IOSurface *this,uint param_1)

{
  int *piVar1;
  long lVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if ((param_1 & 1) == 0) {
    lVar2 = *(long *)(this + 0x178);
    piVar1 = (int *)(lVar2 + 0xc);
    *piVar1 = *piVar1 + 1;
    this[0x3c8] = (IOSurface)((byte)this[0x3c8] | 0x1c);
    piVar1 = (int *)(lVar2 + 0x10);
    *piVar1 = *piVar1 + 1;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return 0;
}



// IOSurface::copyTimingInfo(IOSurface const*)

undefined4 __thiscall IOSurface::copyTimingInfo(IOSurface *this,IOSurface *param_1)

{
  IOSurfaceRoot IVar1;
  OSMetaClassBase *pOVar2;
  OSDictionary *pOVar3;
  OSMetaClassBase *pOVar4;
  ulong uVar5;
  undefined4 uVar6;
  int local_34;
  
  IVar1 = IOSurfaceRoot::timestampsEnabled(_gIOSurfaceRoot);
  if (IVar1 == (IOSurfaceRoot)0x0) {
    return 0;
  }
  _IOLockLock(*(undefined8 *)(this + 0x50));
  pOVar2 = copy_value(param_1,"IOSurfaceTimingInfo",&local_34);
  pOVar3 = (OSDictionary *)
           OSMetaClassBase::safeMetaCast(pOVar2,*(OSMetaClass **)PTR_metaClass_00027010);
  if (pOVar3 == (OSDictionary *)0x0) {
    uVar6 = 0;
  }
  else {
    pOVar4 = (OSMetaClassBase *)OSDictionary::withDictionary(pOVar3,0);
    if (pOVar4 != (OSMetaClassBase *)0x0) {
      uVar5 = set_value(this,"IOSurfaceTimingInfo",pOVar4,&local_34);
      uVar6 = 0xe00002bc;
      if ((char)uVar5 != '\0') {
        uVar6 = 0;
      }
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      (**(code **)(*(long *)pOVar4 + 0x28))(pOVar4);
      goto LAB_0000bb7d;
    }
    _IOLog("IOSurface::copyTimingInfo() - dictionary copy failed\n");
    uVar6 = 0xe00002bc;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
LAB_0000bb7d:
  if (pOVar2 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
  }
  return uVar6;
}



// IOSurface::copy_value(char const*, unsigned int*) const

OSMetaClassBase * __thiscall
IOSurface::copy_value(IOSurface *this,char *param_1,undefined4 *param_2)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  
  if (param_1 != (char *)0x0) {
    plVar1 = (long *)OSSymbol::withCString(param_1);
    pOVar2 = copy_value(this,(long)plVar1,param_2);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return pOVar2;
  }
  pOVar2 = copy_value(this,0,param_2);
  return pOVar2;
}



// IOSurface::set_value(char const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::set_value(IOSurface *this,char *param_1,OSMetaClassBase *param_2,int *param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (param_1 != (char *)0x0) {
    plVar1 = (long *)OSSymbol::withCString(param_1);
    uVar2 = set_value(this,plVar1,param_2,param_3);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return uVar2 & 0xffffffff;
  }
  uVar2 = set_value(this,(long *)0x0,param_2,param_3);
  return uVar2;
}



// IOSurface::setTimestamp(char const*, char const*, OSNumber*)

undefined4 __thiscall
IOSurface::setTimestamp(IOSurface *this,undefined8 param_1,undefined8 param_2,long *param_3)

{
  OSMetaClass *pOVar1;
  IOSurfaceRoot IVar2;
  char cVar3;
  uint64_t uVar4;
  OSMetaClassBase *pOVar5;
  OSMetaClassBase *pOVar6;
  long *plVar7;
  ulong uVar8;
  long *plVar9;
  char *pcVar10;
  undefined4 uVar11;
  OSMetaClassBase *pOVar12;
  int local_3c;
  OSMetaClassBase *local_38;
  
  IVar2 = IOSurfaceRoot::timestampsEnabled(_gIOSurfaceRoot);
  if (IVar2 == (IOSurfaceRoot)0x0) {
    return 0;
  }
  if (param_3 == (long *)0x0) {
    uVar4 = _mach_absolute_time();
    param_3 = (long *)OSNumber::withNumber(uVar4,0x40);
    if (param_3 == (long *)0x0) {
      _IOLog("IOSurface::setTimestamp() - timestamp create failed\n");
      return 0xe00002bc;
    }
    (**(code **)(*param_3 + 0x28))(param_3);
  }
  _IOLockLock(*(undefined8 *)(this + 0x50));
  local_38 = copy_value(this,"IOSurfaceTimingInfo",&local_3c);
  pOVar1 = *(OSMetaClass **)PTR_metaClass_00027010;
  pOVar5 = (OSMetaClassBase *)OSMetaClassBase::safeMetaCast(local_38,pOVar1);
  if (pOVar5 == (OSMetaClassBase *)0x0) {
    pOVar5 = (OSMetaClassBase *)OSDictionary::withCapacity(1);
    if (pOVar5 == (OSMetaClassBase *)0x0) {
      pcVar10 = "IOSurface::setTimestamp() - dictionary create failure\n";
      pOVar5 = (OSMetaClassBase *)0x0;
    }
    else {
      uVar8 = set_value(this,"IOSurfaceTimingInfo",pOVar5,&local_3c);
      pOVar12 = pOVar5;
      if ((char)uVar8 != '\0') goto LAB_0000bd12;
      pcVar10 = "IOSurface::setTimestamp() - setValue for timing info failed\n";
    }
LAB_0000be08:
    pOVar6 = local_38;
    _IOLog(pcVar10);
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
    uVar11 = 0xe00002bc;
    pOVar12 = pOVar5;
  }
  else {
    pOVar12 = (OSMetaClassBase *)0x0;
LAB_0000bd12:
    pOVar6 = (OSMetaClassBase *)(**(code **)(*(long *)pOVar5 + 0x208))(pOVar5,param_1);
    plVar7 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar1);
    if (plVar7 == (long *)0x0) {
      plVar7 = (long *)OSDictionary::withCapacity(1);
      if (plVar7 == (long *)0x0) {
        pcVar10 = "IOSurface::setTimestamp() - timing dictionary create failed\n";
        pOVar5 = pOVar12;
        goto LAB_0000be08;
      }
      cVar3 = (**(code **)(*(long *)pOVar5 + 0x1d0))(pOVar5,param_1,plVar7);
      plVar9 = plVar7;
      if (cVar3 != '\0') goto LAB_0000bd35;
      _IOLog("IOSurface::setTimestamp() - setValue for timing dictionary failed\n");
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      uVar11 = 0xe00002bc;
    }
    else {
      plVar9 = (long *)0x0;
LAB_0000bd35:
      cVar3 = (**(code **)(*plVar7 + 0x1d0))(plVar7,param_2,param_3);
      uVar11 = 0xe00002bc;
      if (cVar3 != '\0') {
        uVar11 = 0;
      }
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      plVar7 = plVar9;
      pOVar6 = local_38;
      if (plVar9 == (long *)0x0) goto LAB_0000be4e;
    }
    (**(code **)(*plVar7 + 0x28))(plVar7);
    pOVar6 = local_38;
  }
LAB_0000be4e:
  if (pOVar12 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)pOVar12 + 0x28))(pOVar12);
  }
  if (pOVar6 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)pOVar6 + 0x28))(pOVar6);
  }
  return uVar11;
}



// IOSurface::setBulkAttachments(IOSurfaceColorAndSpatialKeysStruct*, unsigned long)

void __thiscall IOSurface::setBulkAttachments(IOSurface *this,undefined8 *param_1,uint param_2)

{
  undefined2 uVar1;
  undefined2 uVar2;
  undefined4 uVar3;
  long lVar4;
  undefined8 uVar5;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  if ((param_2 & 1) != 0) {
    lVar4 = *(long *)(this + 0x178);
    *(undefined8 *)(lVar4 + 0x48) = param_1[3];
    *(undefined8 *)(lVar4 + 0x40) = param_1[2];
    uVar5 = *param_1;
    *(undefined8 *)(lVar4 + 0x38) = param_1[1];
    *(undefined8 *)(lVar4 + 0x30) = uVar5;
  }
  if ((param_2 & 2) != 0) {
    lVar4 = *(long *)(this + 0x178);
    uVar5 = param_1[4];
    *(undefined8 *)(lVar4 + 0x58) = param_1[5];
    *(undefined8 *)(lVar4 + 0x50) = uVar5;
  }
  if ((param_2 & 4) != 0) {
    *(undefined8 *)(*(long *)(this + 0x178) + 0x60) = param_1[6];
  }
  if ((param_2 & 8) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x68) = *(undefined1 *)(param_1 + 7);
  }
  if ((param_2 & 0x10) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x69) = *(undefined1 *)((long)param_1 + 0x39);
  }
  if ((param_2 & 0x20) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6a) = *(undefined1 *)((long)param_1 + 0x3a);
  }
  if ((param_2 & 0x40) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6b) = *(undefined1 *)((long)param_1 + 0x3b);
  }
  if ((param_2 & 0x80) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6c) = *(undefined1 *)((long)param_1 + 0x3c);
  }
  if ((param_2 >> 8 & 1) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6d) = *(undefined1 *)((long)param_1 + 0x3d);
  }
  if ((param_2 >> 9 & 1) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6e) = *(undefined1 *)((long)param_1 + 0x3e);
  }
  if ((param_2 >> 10 & 1) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x6f) = *(undefined1 *)((long)param_1 + 0x3f);
  }
  if ((param_2 >> 0xb & 1) != 0) {
    lVar4 = *(long *)(this + 0x178);
    *(undefined2 *)(lVar4 + 0x70) = *(undefined2 *)(param_1 + 8);
    *(undefined2 *)(lVar4 + 0x72) = *(undefined2 *)((long)param_1 + 0x42);
    *(undefined2 *)(lVar4 + 0x74) = *(undefined2 *)((long)param_1 + 0x44);
    *(undefined2 *)(lVar4 + 0x76) = *(undefined2 *)((long)param_1 + 0x46);
    *(undefined2 *)(lVar4 + 0x78) = *(undefined2 *)(param_1 + 9);
    *(undefined2 *)(lVar4 + 0x7a) = *(undefined2 *)((long)param_1 + 0x4a);
    *(undefined2 *)(lVar4 + 0x7c) = *(undefined2 *)((long)param_1 + 0x4c);
    *(undefined2 *)(lVar4 + 0x7e) = *(undefined2 *)((long)param_1 + 0x4e);
    *(undefined4 *)(lVar4 + 0x80) = *(undefined4 *)(param_1 + 10);
    *(undefined4 *)(lVar4 + 0x84) = *(undefined4 *)((long)param_1 + 0x54);
  }
  if ((param_2 >> 0xc & 1) != 0) {
    lVar4 = *(long *)(this + 0x178);
    *(undefined2 *)(lVar4 + 0x88) = *(undefined2 *)(param_1 + 0xb);
    *(undefined2 *)(lVar4 + 0x8a) = *(undefined2 *)((long)param_1 + 0x5a);
  }
  if ((param_2 >> 0xd & 1) != 0) {
    *(undefined8 *)(*(long *)(this + 0x178) + 0x8c) = *(undefined8 *)((long)param_1 + 0x5c);
  }
  if ((param_2 >> 0xe & 1) != 0) {
    *(undefined1 *)(*(long *)(this + 0x178) + 0x94) = *(undefined1 *)((long)param_1 + 100);
  }
  if ((param_2 >> 0xf & 1) != 0) {
    uVar3 = *(undefined4 *)(param_1 + 0xd);
    *(undefined4 *)(this + 0x380) = uVar3;
    uVar1 = *(undefined2 *)((long)param_1 + 0x6c);
    *(undefined2 *)(this + 900) = uVar1;
    uVar2 = *(undefined2 *)((long)param_1 + 0x6e);
    *(undefined2 *)(this + 0x386) = uVar2;
    lVar4 = *(long *)(this + 0x178);
    *(undefined4 *)(lVar4 + 0x98) = uVar3;
    *(undefined2 *)(lVar4 + 0x9c) = uVar1;
    *(undefined2 *)(lVar4 + 0x9e) = uVar2;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::getBulkAttachments(IOSurfaceColorAndSpatialKeysStruct*) const

void __thiscall IOSurface::getBulkAttachments(IOSurface *this,undefined8 *param_1)

{
  long lVar1;
  undefined8 uVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  lVar1 = *(long *)(this + 0x178);
  param_1[3] = *(undefined8 *)(lVar1 + 0x48);
  param_1[2] = *(undefined8 *)(lVar1 + 0x40);
  uVar2 = *(undefined8 *)(lVar1 + 0x30);
  param_1[1] = *(undefined8 *)(lVar1 + 0x38);
  *param_1 = uVar2;
  uVar2 = *(undefined8 *)(*(long *)(this + 0x178) + 0x50);
  param_1[5] = *(undefined8 *)(*(long *)(this + 0x178) + 0x58);
  param_1[4] = uVar2;
  param_1[6] = *(undefined8 *)(*(long *)(this + 0x178) + 0x60);
  lVar1 = *(long *)(this + 0x178);
  *(undefined1 *)(param_1 + 7) = *(undefined1 *)(lVar1 + 0x68);
  *(undefined1 *)((long)param_1 + 0x39) = *(undefined1 *)(lVar1 + 0x69);
  *(undefined1 *)((long)param_1 + 0x3a) = *(undefined1 *)(lVar1 + 0x6a);
  *(undefined1 *)((long)param_1 + 0x3b) = *(undefined1 *)(lVar1 + 0x6b);
  *(undefined1 *)((long)param_1 + 0x3c) = *(undefined1 *)(lVar1 + 0x6c);
  *(undefined1 *)((long)param_1 + 0x3d) = *(undefined1 *)(lVar1 + 0x6d);
  *(undefined1 *)((long)param_1 + 0x3e) = *(undefined1 *)(lVar1 + 0x6e);
  *(undefined1 *)((long)param_1 + 0x3f) = *(undefined1 *)(lVar1 + 0x6f);
  *(undefined2 *)(param_1 + 8) = *(undefined2 *)(lVar1 + 0x70);
  *(undefined2 *)((long)param_1 + 0x42) = *(undefined2 *)(lVar1 + 0x72);
  *(undefined2 *)((long)param_1 + 0x44) = *(undefined2 *)(lVar1 + 0x74);
  *(undefined2 *)((long)param_1 + 0x46) = *(undefined2 *)(lVar1 + 0x76);
  *(undefined2 *)(param_1 + 9) = *(undefined2 *)(lVar1 + 0x78);
  *(undefined2 *)((long)param_1 + 0x4a) = *(undefined2 *)(lVar1 + 0x7a);
  *(undefined2 *)((long)param_1 + 0x4c) = *(undefined2 *)(lVar1 + 0x7c);
  *(undefined2 *)((long)param_1 + 0x4e) = *(undefined2 *)(lVar1 + 0x7e);
  *(undefined4 *)(param_1 + 10) = *(undefined4 *)(lVar1 + 0x80);
  *(undefined4 *)((long)param_1 + 0x54) = *(undefined4 *)(lVar1 + 0x84);
  *(undefined2 *)(param_1 + 0xb) = *(undefined2 *)(lVar1 + 0x88);
  *(undefined2 *)((long)param_1 + 0x5a) = *(undefined2 *)(lVar1 + 0x8a);
  *(undefined8 *)((long)param_1 + 0x5c) = *(undefined8 *)(lVar1 + 0x8c);
  *(undefined1 *)((long)param_1 + 100) = *(undefined1 *)(*(long *)(this + 0x178) + 0x94);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::getBulkAttachments(IOSurfaceColorAndSpatialKeysStruct*, unsigned long*) const

void __thiscall IOSurface::getBulkAttachments(IOSurface *this,void *param_1,ulong *param_2)

{
  long lVar1;
  ulong uVar2;
  size_t sVar3;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_90;
  undefined8 local_88;
  undefined8 local_80;
  undefined8 local_78;
  undefined8 local_70;
  undefined1 local_68;
  undefined1 local_67;
  undefined1 local_66;
  undefined1 local_65;
  undefined1 local_64;
  undefined1 local_63;
  undefined1 local_62;
  undefined1 local_61;
  undefined2 local_60;
  undefined2 local_5e;
  undefined2 local_5c;
  undefined2 local_5a;
  undefined2 local_58;
  undefined2 local_56;
  undefined2 local_54;
  undefined2 local_52;
  undefined4 local_50;
  undefined4 local_4c;
  undefined2 local_48;
  undefined2 local_46;
  undefined8 local_44;
  uint local_3c;
  undefined4 local_38;
  undefined2 local_34;
  undefined2 local_32;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  lVar1 = *(long *)(this + 0x178);
  local_88 = *(undefined8 *)(lVar1 + 0x48);
  local_90 = *(undefined8 *)(lVar1 + 0x40);
  local_a0 = *(undefined8 *)(lVar1 + 0x30);
  local_98 = *(undefined8 *)(lVar1 + 0x38);
  local_80 = *(undefined8 *)(lVar1 + 0x50);
  local_78 = *(undefined8 *)(lVar1 + 0x58);
  local_70 = *(undefined8 *)(lVar1 + 0x60);
  local_68 = *(undefined1 *)(lVar1 + 0x68);
  local_67 = *(undefined1 *)(lVar1 + 0x69);
  local_66 = *(undefined1 *)(lVar1 + 0x6a);
  local_65 = *(undefined1 *)(lVar1 + 0x6b);
  local_64 = *(undefined1 *)(lVar1 + 0x6c);
  local_63 = *(undefined1 *)(lVar1 + 0x6d);
  local_62 = *(undefined1 *)(lVar1 + 0x6e);
  local_61 = *(undefined1 *)(lVar1 + 0x6f);
  local_60 = *(undefined2 *)(lVar1 + 0x70);
  local_5e = *(undefined2 *)(lVar1 + 0x72);
  local_5c = *(undefined2 *)(lVar1 + 0x74);
  local_5a = *(undefined2 *)(lVar1 + 0x76);
  local_58 = *(undefined2 *)(lVar1 + 0x78);
  local_56 = *(undefined2 *)(lVar1 + 0x7a);
  local_54 = *(undefined2 *)(lVar1 + 0x7c);
  local_52 = *(undefined2 *)(lVar1 + 0x7e);
  local_50 = *(undefined4 *)(lVar1 + 0x80);
  local_4c = *(undefined4 *)(lVar1 + 0x84);
  local_48 = *(undefined2 *)(lVar1 + 0x88);
  local_46 = *(undefined2 *)(lVar1 + 0x8a);
  local_44 = *(undefined8 *)(lVar1 + 0x8c);
  local_3c = (uint)*(byte *)(lVar1 + 0x94);
  local_38 = *(undefined4 *)(this + 0x380);
  local_34 = *(undefined2 *)(this + 900);
  local_32 = *(undefined2 *)(this + 0x386);
  uVar2 = *param_2;
  sVar3 = 0x70;
  if (uVar2 < 0x70) {
    sVar3 = uVar2;
  }
  _memcpy(param_1,&local_a0,sVar3);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  if (0 < (long)(uVar2 - sVar3)) {
    ___bzero((long)param_1 + sVar3,uVar2 - sVar3);
  }
  *param_2 = sVar3;
  return;
}



// IOSurface::copyIOAVHDRStaticMetadataDictionary() const

undefined8 __thiscall IOSurface::copyIOAVHDRStaticMetadataDictionary(IOSurface *this)

{
  short sVar1;
  long lVar2;
  long *plVar3;
  OSObject *pOVar4;
  OSSymbol *pOVar5;
  long *plVar6;
  undefined8 uVar7;
  short sVar8;
  OSSymbol *local_78;
  long *local_70;
  OSObject *local_68;
  long *local_60;
  undefined1 local_58;
  undefined1 local_57;
  undefined1 local_56;
  undefined1 local_55;
  undefined2 local_54;
  undefined2 local_52;
  undefined2 local_50;
  undefined2 local_4e;
  undefined2 local_4c;
  undefined2 local_4a;
  undefined2 local_48;
  undefined2 local_46;
  undefined2 local_44;
  undefined2 local_42;
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  _IOLockLock(*(undefined8 *)(this + 0x50));
  lVar2 = *(long *)(this + 0x178);
  sVar1 = *(short *)(lVar2 + 0x70);
  sVar8 = *(short *)(lVar2 + 0x72);
  if (sVar1 == 0 && sVar8 == 0) {
    if ((((((*(short *)(lVar2 + 0x74) == 0) && (*(short *)(lVar2 + 0x76) == 0)) &&
          (*(short *)(lVar2 + 0x78) == 0)) &&
         ((*(short *)(lVar2 + 0x7a) == 0 && (*(short *)(lVar2 + 0x7c) == 0)))) &&
        ((*(short *)(lVar2 + 0x7e) == 0 &&
         ((*(int *)(lVar2 + 0x80) == 0 && (*(int *)(lVar2 + 0x84) == 0)))))) &&
       ((*(short *)(lVar2 + 0x88) == 0 && (*(short *)(lVar2 + 0x8a) == 0)))) {
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      uVar7 = 0;
      goto LAB_0000c53c;
    }
    sVar8 = 0;
  }
  local_58 = (undefined1)sVar1;
  local_57 = (undefined1)((ushort)sVar1 >> 8);
  local_56 = (undefined1)sVar8;
  local_55 = (undefined1)((ushort)sVar8 >> 8);
  local_54 = *(undefined2 *)(lVar2 + 0x74);
  local_52 = *(undefined2 *)(lVar2 + 0x76);
  local_50 = *(undefined2 *)(lVar2 + 0x78);
  local_4e = *(undefined2 *)(lVar2 + 0x7a);
  local_4c = *(undefined2 *)(lVar2 + 0x7c);
  local_4a = *(undefined2 *)(lVar2 + 0x7e);
  local_48 = (undefined2)((ulong)*(uint *)(lVar2 + 0x80) / 10000);
  local_46 = *(undefined2 *)(lVar2 + 0x84);
  local_44 = *(undefined2 *)(lVar2 + 0x88);
  local_42 = *(undefined2 *)(lVar2 + 0x8a);
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  plVar3 = (long *)OSData::withBytes(&local_58,0x18);
  pOVar4 = (OSObject *)OSSymbol::withCString("CEA-861:Type1");
  local_68 = pOVar4;
  local_60 = plVar3;
  pOVar5 = (OSSymbol *)OSSymbol::withCString("Type");
  plVar6 = (long *)OSSymbol::withCString("Data");
  local_78 = pOVar5;
  local_70 = plVar6;
  uVar7 = OSDictionary::withObjects(&local_68,&local_78,2,0);
  if (plVar6 != (long *)0x0) {
    (**(code **)(*plVar6 + 0x28))(plVar6);
  }
  if (pOVar5 != (OSSymbol *)0x0) {
    (**(code **)(*(long *)pOVar5 + 0x28))(pOVar5);
  }
  if (pOVar4 != (OSObject *)0x0) {
    (**(code **)(*(long *)pOVar4 + 0x28))(pOVar4);
  }
  if (plVar3 != (long *)0x0) {
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
LAB_0000c53c:
  if (*(long *)PTR____stack_chk_guard_00027088 == local_38) {
    return uVar7;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurface::supportsProtectionOptions(unsigned long long) const

undefined8 __thiscall IOSurface::supportsProtectionOptions(IOSurface *this,ulong param_1)

{
  return CONCAT71((int7)(~*(ulong *)(this + 0x3a0) >> 8),(param_1 & ~*(ulong *)(this + 0x3a0)) == 0)
  ;
}



// IOSurface::fence_completed(IOFence*)

void __thiscall IOSurface::fence_completed(IOSurface *this,long *param_1)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  long *plVar4;
  uint64_t uVar5;
  IOSurface *pIVar6;
  uintptr_t local_48;
  uintptr_t local_40;
  long *local_38;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  iVar1 = *(int *)((long)param_1 + 0x4c);
  if (iVar1 != 0) goto LAB_0000c5e1;
  uVar5 = _mach_absolute_time();
  if ((*(uint *)((long)param_1 + 0x24) & 2) == 0) {
    if ((*(uint *)((long)param_1 + 0x24) & 1) != 0) {
      pIVar6 = this + 0x310;
      goto LAB_0000c5d5;
    }
  }
  else {
    pIVar6 = this + 0x318;
LAB_0000c5d5:
    *(uint64_t *)pIVar6 = uVar5;
  }
  *(undefined4 *)((long)param_1 + 0x4c) = 1;
LAB_0000c5e1:
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  uVar2 = *(uint *)(param_1 + 4);
  local_40 = (uintptr_t)*(uint *)((long)param_1 + 0x24);
  uVar3 = *(uint *)(this + 0x10);
  local_48 = 0;
  local_38 = param_1;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_48);
  _kernel_debug(0x8521000c,(ulong)uVar2,(ulong)uVar3,local_40,local_48,0);
  plVar4 = local_38;
  if (iVar1 == 0) {
    if (((byte)this[0x3ca] & 0x20) == 0) {
      decrement_use_count_for_category(this,0);
    }
    IOSurfaceRoot::fence_completed(_gIOSurfaceRoot,plVar4);
  }
  return;
}



// IOSurface::fence_track_time(IOFence*)

void __thiscall IOSurface::fence_track_time(IOSurface *this,long param_1)

{
  uint64_t uVar1;
  IOSurface *pIVar2;
  
  uVar1 = _mach_absolute_time();
  if ((*(uint *)(param_1 + 0x24) & 2) == 0) {
    if ((*(uint *)(param_1 + 0x24) & 1) == 0) {
      return;
    }
    pIVar2 = this + 0x310;
  }
  else {
    pIVar2 = this + 0x318;
  }
  *(uint64_t *)pIVar2 = uVar1;
  return;
}



// IOSurface::fence_completed_locked(IOFence*)

void __thiscall IOSurface::fence_completed_locked(IOSurface *this,long *param_1)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  uint64_t uVar4;
  IOSurface *pIVar5;
  uintptr_t local_48;
  IOSurface *local_40;
  int local_34;
  
  local_34 = *(int *)((long)param_1 + 0x4c);
  if (local_34 != 0) {
    uVar1 = *(uint *)((long)param_1 + 0x24);
    goto LAB_0000c6f8;
  }
  uVar4 = _mach_absolute_time();
  uVar1 = *(uint *)((long)param_1 + 0x24);
  if ((uVar1 & 2) == 0) {
    if ((uVar1 & 1) != 0) {
      pIVar5 = this + 0x310;
      goto LAB_0000c6ee;
    }
  }
  else {
    pIVar5 = this + 0x318;
LAB_0000c6ee:
    *(uint64_t *)pIVar5 = uVar4;
  }
  *(undefined4 *)((long)param_1 + 0x4c) = 1;
LAB_0000c6f8:
  uVar2 = *(uint *)(param_1 + 4);
  uVar3 = *(uint *)(this + 0x10);
  local_48 = 0;
  local_40 = this;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_48);
  _kernel_debug(0x8521000c,(ulong)uVar2,(ulong)uVar3,(ulong)uVar1,local_48,0);
  if (local_34 == 0) {
    if (((byte)local_40[0x3ca] & 0x20) == 0) {
      decrement_use_count_for_category(local_40,0);
    }
    IOSurfaceRoot::fence_completed(_gIOSurfaceRoot,param_1);
  }
  return;
}



// IOSurface::can_fence_be_coalesced_with_earlier_fence(IOFence*, IOFence*, bool) const

undefined8 __thiscall
IOSurface::can_fence_be_coalesced_with_earlier_fence
          (undefined8 param_1_00,long param_2,long param_3,char param_4)

{
  undefined8 in_RAX;
  undefined8 uVar1;
  
  uVar1 = CONCAT71((int7)((ulong)in_RAX >> 8),1);
  if ((((*(int *)(param_3 + 0x4c) == 0) &&
       ((((*(char *)(param_2 + 0x52) == '\0' || (*(int *)(param_2 + 0x20) == 0)) ||
         (*(int *)(param_3 + 0x20) == 0)) || (*(int *)(param_2 + 0x20) != *(int *)(param_3 + 0x20)))
       )) && ((((param_4 == '\0' || (*(int *)(param_2 + 0x20) == 0)) ||
               (*(int *)(param_2 + 0x20) != *(int *)(param_3 + 0x20))) ||
              ((*(byte *)(param_2 + 0x24) & 2) == 0)))) &&
     ((*(int *)(param_2 + 0x24) != 1 || (*(int *)(param_3 + 0x24) != 1)))) {
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurface::can_fence_be_coalesced_with_current_q(IOFence*, bool) const

undefined8 __thiscall
IOSurface::can_fence_be_coalesced_with_current_q(IOSurface *this,long param_1,char param_2)

{
  undefined8 in_RAX;
  undefined8 uVar1;
  long lVar2;
  
  lVar2 = *(long *)(this + 0x220);
  if (lVar2 == 0) {
    uVar1 = CONCAT71((int7)((ulong)in_RAX >> 8),1);
  }
  else {
    do {
      uVar1 = can_fence_be_coalesced_with_earlier_fence(this,param_1,lVar2,param_2);
      if ((char)uVar1 == '\0') {
        return uVar1;
      }
      lVar2 = *(long *)(lVar2 + 0x58);
    } while (lVar2 != 0);
  }
  return uVar1;
}



// IOSurface::trace_current_fence(IOFence*)

void __thiscall IOSurface::trace_current_fence(IOSurface *this,IOFence *param_1)

{
  uint uVar1;
  long lVar2;
  long lVar3;
  
  lVar2 = *(long *)(this + 0x340);
  if (lVar2 == 0) {
    lVar2 = _IOMallocTypeImpl(&trace_current_fence(IOFence*)::kalloc_type_view_5372);
    *(long *)(this + 0x340) = lVar2;
  }
  uVar1 = *(uint *)(lVar2 + 0x3c0);
  *(uint *)(lVar2 + 0x3c0) = uVar1 + 1;
  lVar3 = (ulong)(uVar1 & 7) * 0x78;
  *(uint *)(lVar2 + lVar3) = uVar1;
  IOFence::writeTraceData(param_1,lVar2 + lVar3);
  return;
}



// IOSurface::fence_completed_dispatch()

void __thiscall IOSurface::fence_completed_dispatch(IOSurface *this)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  IOFence *pIVar4;
  undefined8 *puVar5;
  IOFence *pIVar6;
  IOFence *pIVar7;
  undefined8 uVar8;
  IOFence *pIVar9;
  long *plVar10;
  IOSurface *pIVar11;
  char *pcVar12;
  undefined8 uVar13;
  long lVar14;
  uintptr_t local_48;
  IOFence *local_40;
  IOFence *local_38;
  
  local_38 = (IOFence *)&local_40;
  local_40 = (IOFence *)0x0;
  _IOLockLock(*(undefined8 *)(this + 0x50));
  pIVar4 = *(IOFence **)(this + 0x220);
  while (pIVar7 = pIVar4, pIVar7 != (IOFence *)0x0) {
    pIVar4 = *(IOFence **)(pIVar7 + 0x58);
    if (*(int *)(pIVar7 + 0x4c) != 0) {
      if (pIVar4 == (IOFence *)0x0) {
        plVar10 = *(long **)(pIVar7 + 0x60);
        if ((IOFence *)*plVar10 != pIVar7) {
LAB_0000cb71:
          pcVar12 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
          goto LAB_0000cba8;
        }
        *(long **)(this + 0x228) = plVar10;
      }
      else {
        if (*(IOFence **)(pIVar4 + 0x60) != pIVar7 + 0x58) {
          pcVar12 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_0000cba8:
          uVar8 = 0x1532;
          uVar13 = 0x1532;
          goto LAB_0000cbd5;
        }
        if ((IOFence *)**(long **)(pIVar7 + 0x60) != pIVar7) goto LAB_0000cb71;
        *(long **)(pIVar4 + 0x60) = *(long **)(pIVar7 + 0x60);
        plVar10 = *(long **)(pIVar7 + 0x60);
      }
      *plVar10 = (long)pIVar4;
      *(undefined8 *)(pIVar7 + 0x58) = 0x1533;
      *(undefined8 *)(pIVar7 + 0x60) = 0xcafecafe;
    }
  }
  pIVar7 = *(IOFence **)(this + 0x230);
  if (pIVar7 != (IOFence *)0x0) {
    do {
      pIVar4 = *(IOFence **)(pIVar7 + 0x58);
      if (*(int *)(pIVar7 + 0x4c) != 0) {
        if (pIVar4 == (IOFence *)0x0) {
          plVar10 = *(long **)(pIVar7 + 0x60);
          if ((IOFence *)*plVar10 != pIVar7) {
LAB_0000cb7a:
            pcVar12 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
            goto LAB_0000cbc3;
          }
          *(long **)(this + 0x238) = plVar10;
        }
        else {
          if (*(IOFence **)(pIVar4 + 0x60) != pIVar7 + 0x58) {
            pcVar12 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_0000cbc3:
            uVar8 = 0x153b;
            uVar13 = 0x153b;
            goto LAB_0000cbd5;
          }
          if ((IOFence *)**(long **)(pIVar7 + 0x60) != pIVar7) goto LAB_0000cb7a;
          *(long **)(pIVar4 + 0x60) = *(long **)(pIVar7 + 0x60);
          plVar10 = *(long **)(pIVar7 + 0x60);
        }
        *plVar10 = (long)pIVar4;
        *(undefined8 *)(pIVar7 + 0x58) = 0x153c;
        *(undefined8 *)(pIVar7 + 0x60) = 0xcafecafe;
        if (*(int *)(pIVar7 + 0x48) == 0) {
          *(undefined8 *)(pIVar7 + 0x68) = 0;
          *(IOFence **)(pIVar7 + 0x70) = local_38;
          *(IOFence **)local_38 = pIVar7;
          local_38 = pIVar7 + 0x68;
        }
      }
      pIVar7 = pIVar4;
    } while (pIVar4 != (IOFence *)0x0);
    pIVar7 = *(IOFence **)(this + 0x230);
    pIVar11 = this;
    while (pIVar7 != (IOFence *)0x0) {
      pIVar4 = *(IOFence **)(pIVar7 + 0x58);
      for (lVar14 = *(long *)(this + 0x220); lVar14 != 0; lVar14 = *(long *)(lVar14 + 0x58)) {
        uVar8 = can_fence_be_coalesced_with_earlier_fence(pIVar11,(long)pIVar7,lVar14,'\0');
        if ((char)uVar8 == '\0') goto LAB_0000ca70;
      }
      if (pIVar4 == (IOFence *)0x0) {
        plVar10 = *(long **)(pIVar7 + 0x60);
        if ((IOFence *)*plVar10 != pIVar7) {
LAB_0000cbdc:
          pcVar12 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
          goto LAB_0000cbec;
        }
        *(long **)(this + 0x238) = plVar10;
      }
      else {
        if (*(IOFence **)(pIVar4 + 0x60) != pIVar7 + 0x58) {
          pcVar12 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_0000cbec:
          uVar8 = 0x1558;
          uVar13 = 0x1558;
          goto LAB_0000cbd5;
        }
        if ((IOFence *)**(long **)(pIVar7 + 0x60) != pIVar7) goto LAB_0000cbdc;
        *(long **)(pIVar4 + 0x60) = *(long **)(pIVar7 + 0x60);
        plVar10 = *(long **)(pIVar7 + 0x60);
      }
      *plVar10 = (long)pIVar4;
      *(undefined8 *)(pIVar7 + 0x68) = 0;
      *(IOFence **)(pIVar7 + 0x70) = local_38;
      *(IOFence **)local_38 = pIVar7;
      *(undefined8 *)(pIVar7 + 0x58) = 0;
      puVar5 = *(undefined8 **)(this + 0x228);
      *(undefined8 **)(pIVar7 + 0x60) = puVar5;
      *puVar5 = pIVar7;
      *(IOFence **)(this + 0x228) = pIVar7 + 0x58;
      pIVar7[0x53] = (IOFence)0x1;
      pIVar11 = this;
      local_38 = pIVar7 + 0x68;
      trace_current_fence(this,pIVar7);
      pIVar7[0x51] = (IOFence)0x1;
      pIVar7 = pIVar4;
    }
  }
LAB_0000ca70:
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  pIVar7 = local_40;
  do {
    if (pIVar7 == (IOFence *)0x0) {
      return;
    }
    pIVar4 = *(IOFence **)(pIVar7 + 0x68);
    if (pIVar4 == (IOFence *)0x0) {
      pIVar9 = *(IOFence **)(pIVar7 + 0x70);
      pIVar6 = pIVar9;
      if (*(IOFence **)pIVar9 != pIVar7) {
LAB_0000cb68:
        pcVar12 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0000cb8a:
        uVar8 = 0x156b;
        uVar13 = 0x156b;
LAB_0000cbd5:
                    // WARNING: Subroutine does not return
        _panic(pcVar12,pIVar7,uVar8,"IOSurface.cpp",uVar13);
      }
    }
    else {
      if (*(IOFence **)(pIVar4 + 0x70) != pIVar7 + 0x68) {
        pcVar12 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_0000cb8a;
      }
      if ((IOFence *)**(long **)(pIVar7 + 0x70) != pIVar7) goto LAB_0000cb68;
      *(long **)(pIVar4 + 0x70) = *(long **)(pIVar7 + 0x70);
      pIVar9 = *(IOFence **)(pIVar7 + 0x70);
      pIVar6 = local_38;
    }
    local_38 = pIVar6;
    *(IOFence **)pIVar9 = pIVar4;
    *(undefined8 *)(pIVar7 + 0x68) = 0x156c;
    *(undefined8 *)(pIVar7 + 0x70) = 0xcafecafe;
    uVar1 = *(uint *)(pIVar7 + 0x20);
    uVar2 = *(uint *)(pIVar7 + 0x24);
    uVar3 = *(uint *)(this + 0x10);
    local_48 = 0;
    _vm_kernel_addrhide(*(undefined8 *)(this + 0x30),&local_48);
    _kernel_debug(0x85210008,(ulong)uVar1,(ulong)uVar3,(ulong)uVar2,local_48,0);
    pIVar7[0x50] = (IOFence)0x1;
    if (*(code **)(pIVar7 + 0x28) == (code *)0x0) {
      IOSurfaceRoot::wakeFence(_gIOSurfaceRoot,pIVar7);
      pIVar7 = pIVar4;
    }
    else {
      (**(code **)(pIVar7 + 0x28))
                (*(undefined8 *)(pIVar7 + 0x30),*(undefined8 *)(pIVar7 + 0x38),this,
                 *(undefined4 *)(pIVar7 + 0x48));
      pIVar7 = pIVar4;
    }
  } while( true );
}



// IOSurface::createFence(unsigned int, unsigned int)

long __thiscall IOSurface::createFence(IOSurface *this,uint param_1,uint param_2)

{
  long local_18;
  
  local_18 = 0;
  createFenceWithTransaction(this,(IOFenceTransaction *)0x0,&local_18,param_1,param_2,0,0,0,0);
  return local_18;
}



// IOSurface::createFence(OSSharedPtr<IOFence>&, unsigned int, unsigned int, void (*)(void*, void*,
// IOSurface*, int), void*, void*, unsigned int)

void __thiscall
IOSurface::createFence
          (IOSurface *this,long *param_1,uint param_2,uint param_3,long param_4,undefined8 param_5,
          undefined8 param_6,uint param_7)

{
  createFenceWithTransaction
            (this,(IOFenceTransaction *)0x0,param_1,param_2,param_3,param_4,param_5,param_6,param_7)
  ;
  return;
}



// IOSurface::createFence(IOFence**, unsigned int, unsigned int, void (*)(void*, void*, IOSurface*,
// int), void*, void*, unsigned int)

void __thiscall
IOSurface::createFence
          (IOSurface *this,long *param_1,uint param_2,uint param_3,long param_4,undefined8 param_5,
          undefined8 param_6,uint param_7)

{
  long local_20;
  
  local_20 = 0;
  createFenceWithTransaction
            (this,(IOFenceTransaction *)0x0,&local_20,param_2,param_3,param_4,param_5,param_6,
             param_7);
  *param_1 = local_20;
  return;
}



// IOSurface::createFenceWithTransaction(OSSharedPtr<IOFenceTransaction>, OSSharedPtr<IOFence>&,
// unsigned int, unsigned int, void (*)(void*, void*, IOSurface*, int), void*, void*, unsigned int)

undefined8 __thiscall
IOSurface::createFenceWithTransaction
          (IOSurface *this,IOFenceTransaction *param_1,long *param_2,uint param_3,uint param_4,
          long param_5,undefined8 param_6,undefined8 param_7,uint param_8)

{
  IOFence *pIVar1;
  IOFence *this_00;
  undefined8 *puVar2;
  long lVar3;
  bool bVar4;
  uintptr_t arg2;
  IOFenceTransaction *this_01;
  int iVar5;
  IOFence *this_02;
  uint64_t uVar6;
  undefined8 uVar7;
  IOFence *pIVar8;
  ulong uVar9;
  IOFence *pIVar10;
  long *plVar11;
  uint uVar12;
  uint uVar13;
  undefined8 uVar14;
  char *pcVar15;
  IOSurface *this_03;
  IOFence *pIVar16;
  uintptr_t local_80;
  long *local_78;
  long local_70;
  ulong local_68;
  uint local_5c;
  IOSurface *local_58;
  uintptr_t local_50;
  IOFenceTransaction *local_48;
  IOFence *local_40;
  uint local_34;
  
  local_70 = param_5;
  local_34 = param_3;
  this_02 = (IOFence *)(**(code **)(IOFence::gMetaClass + 0x88))();
  if (this_02 == (IOFence *)0x0) {
    uVar14 = 0;
    _IOLog("IOSurface::createWriteFence: WARNING: IOFence new failure!\n");
    goto LAB_0000d22b;
  }
  local_78 = param_2;
  local_48 = param_1;
  local_40 = this_02;
  (**(code **)(*(long *)this_02 + 0x88))(this_02);
  if (((byte)this[0x3ca] & 0x20) == 0) {
    increment_use_count_for_category(this,0);
  }
  plVar11 = *(long **)(this_02 + 0x10);
  *(IOSurface **)(this_02 + 0x10) = this;
  local_58 = this;
  (**(code **)(*(long *)this + 0x20))();
  if (plVar11 != (long *)0x0) {
    (**(code **)(*plVar11 + 0x28))(plVar11);
  }
  *(uint *)(this_02 + 0x20) = param_4;
  *(uint *)(this_02 + 0x24) = local_34;
  *(long *)(this_02 + 0x28) = local_70;
  *(undefined8 *)(this_02 + 0x30) = param_6;
  *(undefined8 *)(this_02 + 0x38) = param_7;
  *(undefined2 *)(this_02 + 0x50) = 0;
  *(undefined4 *)(this_02 + 0x4c) = 0;
  uVar6 = _mach_absolute_time();
  this_01 = local_48;
  *(uint64_t *)(this_02 + 0x90) = uVar6;
  plVar11 = *(long **)(this_02 + 0x18);
  *(IOFenceTransaction **)(this_02 + 0x18) = local_48;
  if (local_48 != (IOFenceTransaction *)0x0) {
    (**(code **)(*(long *)local_48 + 0x20))(local_48);
  }
  local_5c = param_8;
  if (plVar11 != (long *)0x0) {
    (**(code **)(*plVar11 + 0x28))(plVar11);
  }
  _OSBacktrace((void **)(local_40 + 0x98),8);
  this_03 = local_58;
  if ((param_8 & 4) != 0) {
    this_02[0x52] = (IOFence)0x1;
  }
  *(undefined8 *)(this_02 + 0x60) = 0;
  *(undefined8 *)(this_02 + 0x58) = 0;
  *(undefined8 *)(this_02 + 0x68) = 0;
  *(undefined8 *)(this_02 + 0x70) = 0;
  *(undefined8 *)(this_02 + 0x78) = 0;
  *(undefined8 *)(this_02 + 0x80) = 0;
  _IOLockLock(*(undefined8 *)(local_58 + 0x50));
  if (this_01 != (IOFenceTransaction *)0x0) {
    IOFenceTransaction::add_fence(this_01,this_02);
  }
  local_50 = (uintptr_t)*(uint *)(this_03 + 0x10);
  uVar9 = (ulong)local_34;
  local_80 = 0;
  _vm_kernel_addrhide(*(undefined8 *)(this_03 + 0x30),&local_80);
  arg2 = local_50;
  uVar14 = 0x85210000;
  local_68 = (ulong)param_4;
  local_50 = uVar9;
  _kernel_debug(0x85210000,(ulong)param_4,arg2,uVar9,local_80,0);
  if ((param_8 & 1) != 0) {
    this_03[0x3c9] = (IOSurface)((byte)this_03[0x3c9] | 0x20);
  }
  pIVar1 = *(IOFence **)(this_03 + 0x220);
  for (pIVar16 = pIVar1; pIVar16 != (IOFence *)0x0; pIVar16 = *(IOFence **)(pIVar16 + 0x58)) {
    if (*(int *)(pIVar16 + 0x4c) == 0) goto LAB_0000ce99;
  }
  pIVar16 = (IOFence *)0x0;
LAB_0000ce99:
  pIVar10 = local_40 + 0x58;
  this_00 = *(IOFence **)(this_03 + 0x230);
  for (pIVar8 = this_00; pIVar8 != (IOFence *)0x0; pIVar8 = *(IOFence **)(pIVar8 + 0x58)) {
    if (*(int *)(pIVar8 + 0x4c) == 0) {
      bVar4 = true;
      local_40 = pIVar10;
      if (pIVar16 != (IOFence *)0x0) goto LAB_0000cf5d;
      uVar12 = *(uint *)(this_03 + 0x3c8) & 0x2000;
      uVar13 = local_34 & 2;
      bVar4 = true;
      goto LAB_0000cfdb;
    }
  }
  if (pIVar16 == (IOFence *)0x0) {
    *(undefined8 *)(this_02 + 0x58) = 0;
    puVar2 = *(undefined8 **)(this_03 + 0x228);
    *(undefined8 **)(this_02 + 0x60) = puVar2;
    *puVar2 = this_02;
    *(IOFence **)(this_03 + 0x228) = pIVar10;
  }
  else {
    pIVar8 = pIVar1;
    local_40 = pIVar10;
    if (pIVar1 != (IOFence *)0x0) {
LAB_0000cecc:
      uVar7 = can_fence_be_coalesced_with_earlier_fence(uVar14,(long)this_02,(long)pIVar8,'\x01');
      if ((char)uVar7 != '\0') goto code_r0x0000cee0;
      bVar4 = false;
      pIVar8 = (IOFence *)0x0;
      this_03 = local_58;
LAB_0000cf5d:
      param_1 = local_48;
      uVar12 = *(uint *)(this_03 + 0x3c8) & 0x2000;
      uVar13 = local_34 & 2;
      if (((uVar13 != 0) && (uVar12 != 0)) && (((byte)pIVar16[0x24] & 1) != 0)) {
        while (pIVar1 != (IOFence *)0x0) {
          pIVar16 = *(IOFence **)(pIVar1 + 0x58);
          IOFence::complete_locked(pIVar1,0);
          pIVar1 = pIVar16;
        }
        *(undefined8 *)(this_02 + 0x58) = 0;
        goto LAB_0000d08c;
      }
      if ((((local_34 & 1) == 0) || (uVar12 == 0)) || (((byte)pIVar16[0x24] & 2) == 0)) {
LAB_0000cfdb:
        param_1 = local_48;
        if (((uVar13 != 0) && (bVar4)) && ((uVar12 != 0 && (((byte)pIVar8[0x24] & 1) != 0)))) {
          while (this_00 != (IOFence *)0x0) {
            pIVar1 = *(IOFence **)(this_00 + 0x58);
            IOFence::complete_locked(this_00,0);
            this_00 = pIVar1;
          }
        }
        if ((param_8 & 2) == 0) {
          bVar4 = false;
          _kernel_debug(0x85210004,local_68,(ulong)*(uint *)(this_03 + 0x10),local_50,0,0);
          *(undefined8 *)(this_02 + 0x58) = 0;
          puVar2 = *(undefined8 **)(this_03 + 0x238);
          *(undefined8 **)(this_02 + 0x60) = puVar2;
          *puVar2 = this_02;
          *(IOFence **)(this_03 + 0x238) = local_40;
        }
        else {
          *(undefined4 *)(this_02 + 0x4c) = 1;
          (**(code **)(*(long *)this_02 + 0x28))(this_02);
          this_02 = (IOFence *)0x0;
          bVar4 = false;
        }
      }
      else {
        IOFence::complete_locked(this_02,0);
        *(undefined8 *)(this_02 + 0x58) = 0;
        puVar2 = *(undefined8 **)(this_03 + 0x228);
        *(undefined8 **)(this_02 + 0x60) = puVar2;
        *puVar2 = this_02;
        *(IOFence **)(this_03 + 0x228) = local_40;
        this_02[0x53] = (IOFence)0x1;
        trace_current_fence(this_03,this_02);
        bVar4 = true;
      }
      goto LAB_0000d0bb;
    }
LAB_0000cee9:
    *(undefined8 *)(this_02 + 0x58) = 0;
    this_03 = local_58;
LAB_0000d08c:
    puVar2 = *(undefined8 **)(this_03 + 0x228);
    *(undefined8 **)(this_02 + 0x60) = puVar2;
    *puVar2 = this_02;
    *(IOFence **)(this_03 + 0x228) = local_40;
  }
  this_02[0x53] = (IOFence)0x1;
  trace_current_fence(this_03,this_02);
  bVar4 = true;
  param_1 = local_48;
LAB_0000d0bb:
  _IOLockUnlock(*(undefined8 *)(this_03 + 0x50));
  if (((local_70 != 0) || (bVar4)) || (local_5c = local_5c & 2, local_5c != 0)) {
LAB_0000d17d:
    if (bVar4) goto LAB_0000d181;
    if ((param_1 == (IOFenceTransaction *)0x0) ||
       (iVar5 = IOSurfaceRoot::deadlockCheckLimit(_gIOSurfaceRoot), iVar5 == 0)) {
LAB_0000d1f5:
      uVar14 = 0;
    }
    else {
      uVar14 = 0;
      uVar9 = IOFenceTransaction::runTransactionDeadlockCheck(param_1,param_1,0,0);
      if ((char)uVar9 != '\0') {
        if (((byte)_gIOSurfaceRoot[0x1b5] & 4) == 0) goto LAB_0000d1f5;
        uVar14 = 0;
        __os_log_internal(0,PTR___os_log_default_00027090,0x11,"Breaking IOFence deadlock\n");
        _printf("Breaking IOFence deadlock\n");
        IOFence::complete(this_02,0);
      }
    }
  }
  else {
    iVar5 = IOSurfaceRoot::waitForFence(_gIOSurfaceRoot,this_02);
    if (iVar5 != 0) {
      if (iVar5 == -0x1ffffd2a) {
        fence_debug(this_03);
      }
      _IOLockLock(*(undefined8 *)(this_03 + 0x50));
      bVar4 = true;
      if (this_02[0x51] == (IOFence)0x0) {
        lVar3 = *(long *)(this_02 + 0x58);
        if (lVar3 == 0) {
          plVar11 = *(long **)(this_02 + 0x60);
          if ((IOFence *)*plVar11 != this_02) {
LAB_0000d28b:
            pcVar15 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0000d29b:
                    // WARNING: Subroutine does not return
            _panic(pcVar15,this_02,0x1677,"IOSurface.cpp",0x1677);
          }
          *(long **)(this_03 + 0x238) = plVar11;
        }
        else {
          if (*(IOFence **)(lVar3 + 0x60) != this_02 + 0x58) {
            pcVar15 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
            goto LAB_0000d29b;
          }
          if ((IOFence *)**(long **)(this_02 + 0x60) != this_02) goto LAB_0000d28b;
          *(long **)(lVar3 + 0x60) = *(long **)(this_02 + 0x60);
          plVar11 = *(long **)(this_02 + 0x60);
        }
        *plVar11 = lVar3;
        *(undefined4 *)(this_02 + 0x4c) = 1;
        (**(code **)(*(long *)this_02 + 0x28))(this_02);
        this_02 = (IOFence *)0x0;
        bVar4 = false;
      }
      _IOLockUnlock(*(undefined8 *)(this_03 + 0x50));
      goto LAB_0000d17d;
    }
LAB_0000d181:
    uVar12 = *(uint *)(this_03 + 0x10);
    local_80 = 0;
    _vm_kernel_addrhide(*(undefined8 *)(this_03 + 0x30),&local_80);
    _kernel_debug(0x85210008,local_68,(ulong)uVar12,local_50,local_80,0);
    uVar14 = CONCAT71((uint7)(uint3)(uVar12 >> 8),1);
  }
  plVar11 = (long *)*local_78;
  *local_78 = (long)this_02;
  if (this_02 != (IOFence *)0x0) {
    (**(code **)(*(long *)this_02 + 0x20))(this_02);
  }
  if (plVar11 != (long *)0x0) {
    (**(code **)(*plVar11 + 0x28))(plVar11);
  }
  if (this_02 != (IOFence *)0x0) {
    (**(code **)(*(long *)this_02 + 0x28))(this_02);
  }
LAB_0000d22b:
  if (param_1 != (IOFenceTransaction *)0x0) {
    (**(code **)(*(long *)param_1 + 0x28))(param_1);
  }
  return uVar14;
code_r0x0000cee0:
  pIVar10 = pIVar8 + 0x58;
  pIVar8 = *(IOFence **)pIVar10;
  if (*(IOFence **)pIVar10 == (IOFence *)0x0) goto LAB_0000cee9;
  goto LAB_0000cecc;
}



// IOSurface::createFenceWithTransaction(IOFenceTransaction*, IOFence**, unsigned int, unsigned int,
// void (*)(void*, void*, IOSurface*, int), void*, void*, unsigned int)

ulong __thiscall
IOSurface::createFenceWithTransaction
          (IOSurface *this,IOFenceTransaction *param_1,long *param_2,uint param_3,uint param_4,
          long param_5,undefined8 param_6,undefined8 param_7,uint param_8)

{
  ulong uVar1;
  long local_40;
  long *local_38;
  
  local_40 = 0;
  local_38 = param_2;
  if (param_1 != (IOFenceTransaction *)0x0) {
    (**(code **)(*(long *)param_1 + 0x20))(param_1);
    (**(code **)(*(long *)param_1 + 0x20))(param_1);
  }
  uVar1 = createFenceWithTransaction
                    (this,param_1,&local_40,param_3,param_4,param_5,param_6,param_7,param_8);
  *local_38 = local_40;
  if (param_1 != (IOFenceTransaction *)0x0) {
    (**(code **)(*(long *)param_1 + 0x28))(param_1);
  }
  return uVar1 & 0xffffffff;
}



// IOSurface::fence_debug()

void __thiscall IOSurface::fence_debug(IOSurface *this)

{
  long lVar1;
  long lVar2;
  char *pcVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  _IOLog("IOSurface fence debug: surface: %p id: %d\n",this,*(undefined4 *)(this + 0x10));
  pcVar3 = "Current Fences:\n";
  _IOLog();
  lVar2 = *(long *)(this + 0x220);
  while (lVar2 != 0) {
    lVar1 = *(long *)(lVar2 + 0x58);
    fence_print(pcVar3,lVar2);
    lVar2 = lVar1;
  }
  pcVar3 = "Waiting Fences:\n";
  _IOLog();
  lVar2 = *(long *)(this + 0x230);
  while (lVar2 != 0) {
    lVar1 = *(long *)(lVar2 + 0x58);
    fence_print(pcVar3,lVar2);
    lVar2 = lVar1;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::isTearingAllowed() const

byte __thiscall IOSurface::isTearingAllowed(IOSurface *this)

{
  return ((byte)this[0x3c9] & 0x20) >> 5;
}



// IOSurface::dumpQ()

void __thiscall IOSurface::dumpQ(IOSurface *this)

{
  void *pvVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  for (pvVar1 = *(void **)(this + 0x220); pvVar1 != (void *)0x0;
      pvVar1 = *(void **)((long)pvVar1 + 0x58)) {
    _printf("\tcurrent: %p t: %p\n",pvVar1,*(void **)((long)pvVar1 + 0x18));
  }
  for (pvVar1 = *(void **)(this + 0x230); pvVar1 != (void *)0x0;
      pvVar1 = *(void **)((long)pvVar1 + 0x58)) {
    _printf("\twaitQ:   %p t: %p\n",pvVar1,*(void **)((long)pvVar1 + 0x18));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::gather_dependent_transactions(IOFence*, OSSharedPtr<OSSet>)

void __thiscall
IOSurface::gather_dependent_transactions(IOSurface *this,long param_1,OSSharedPtr *param_2)

{
  long *plVar1;
  long *plVar2;
  undefined8 uVar3;
  undefined8 uVar4;
  long lVar5;
  
  plVar1 = *(long **)(param_1 + 0x18);
  if (plVar1 != (long *)0x0) {
    uVar4 = *(undefined8 *)(this + 0x50);
    _IOLockLock();
    if ((*(char *)(param_1 + 0x53) == '\0') && (lVar5 = param_1, *(int *)(param_1 + 0x4c) == 0)) {
      do {
        lVar5 = **(long **)(*(long *)(lVar5 + 0x60) + 8);
        if ((lVar5 == 0) || (*(int *)(lVar5 + 0x4c) != 0)) goto LAB_0000d53e;
        uVar3 = can_fence_be_coalesced_with_earlier_fence(uVar4,param_1,lVar5,'\0');
      } while ((char)uVar3 != '\0');
      do {
        plVar2 = *(long **)(lVar5 + 0x18);
        if (plVar2 != plVar1) {
          if (plVar2 != (long *)0x0) {
            (**(code **)(*plVar2 + 0x20))();
          }
          OSSet::setObject(param_2);
          if (plVar2 != (long *)0x0) {
            (**(code **)(*plVar2 + 0x28))();
          }
        }
        lVar5 = **(long **)(*(long *)(lVar5 + 0x60) + 8);
      } while (lVar5 != 0);
LAB_0000d53e:
      for (lVar5 = **(long **)(*(long *)(this + 0x228) + 8); lVar5 != 0;
          lVar5 = **(long **)(*(long *)(lVar5 + 0x60) + 8)) {
        plVar2 = *(long **)(lVar5 + 0x18);
        if (plVar2 != plVar1) {
          if (plVar2 != (long *)0x0) {
            (**(code **)(*plVar2 + 0x20))();
          }
          OSSet::setObject(param_2);
          if (plVar2 != (long *)0x0) {
            (**(code **)(*plVar2 + 0x28))();
          }
        }
      }
    }
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
  }
  if (param_2 != (OSSharedPtr *)0x0) {
    (**(code **)(*(long *)param_2 + 0x28))(param_2);
  }
  return;
}



// IOSurface::fence_print(IOFence*)

void __thiscall IOSurface::fence_print(undefined8 param_1_00,long param_2)

{
  char *pcVar1;
  
  pcVar1 = "write";
  if (*(int *)(param_2 + 0x24) == 1) {
    pcVar1 = "read";
  }
  _IOLog("\t%p: surf: %p dir: %s accelerator: %d callback: %p target: %p ref: %p notified: %d completed: %d\n"
         ,param_2,*(undefined8 *)(param_2 + 0x10),pcVar1,*(undefined4 *)(param_2 + 0x20),
         *(undefined8 *)(param_2 + 0x28),*(undefined8 *)(param_2 + 0x30),
         *(undefined8 *)(param_2 + 0x38),*(undefined1 *)(param_2 + 0x50),
         *(undefined4 *)(param_2 + 0x4c));
  return;
}



// IOSurface::createFenceDebugDictionary()

long * __thiscall IOSurface::createFenceDebugDictionary(IOSurface *this)

{
  IOSurface *pIVar1;
  long *plVar2;
  long *plVar3;
  long *plVar4;
  IOFence *pIVar5;
  int iVar6;
  ulong uVar7;
  IOFence *pIVar8;
  undefined8 local_e0;
  undefined8 local_d8;
  undefined8 local_d0;
  undefined8 local_c8;
  undefined8 local_c0;
  undefined8 local_b8;
  undefined8 local_b0;
  ulonglong local_a8 [9];
  long *local_60;
  long *local_58;
  IOSurface *local_50;
  IOFence *local_48;
  long *local_40;
  int local_34;
  
  plVar2 = (long *)OSDictionary::withCapacity(3);
  if (plVar2 != (long *)0x0) {
    setUInt32InDict(plVar2,"iosurface_id",*(uint *)(this + 0x10));
    _IOLockLock(*(undefined8 *)(this + 0x50));
    plVar3 = (long *)OSArray::withCapacity(1);
    local_58 = plVar2;
    local_50 = this;
    local_40 = plVar3;
    if (plVar3 != (long *)0x0) {
      if (*(IOFence **)(this + 0x220) != (IOFence *)0x0) {
        iVar6 = 0;
        pIVar8 = *(IOFence **)(this + 0x220);
        do {
          pIVar5 = *(IOFence **)(pIVar8 + 0x58);
          plVar2 = (long *)OSDictionary::withCapacity(3);
          if (plVar2 != (long *)0x0) {
            local_a8[7] = 0;
            local_a8[6] = 0;
            local_a8[5] = 0;
            local_a8[4] = 0;
            local_a8[3] = 0;
            local_a8[2] = 0;
            local_a8[1] = 0;
            local_a8[0] = 0;
            local_b0 = 0;
            local_b8 = 0;
            local_c0 = 0;
            local_c8 = 0;
            local_d0 = 0;
            local_d8 = 0;
            local_e0 = 0;
            local_48 = pIVar5;
            local_34 = iVar6;
            IOFence::writeTraceData(pIVar8,(long)&local_e0);
            setUInt32InDict(plVar2,"iofence_acceleratorid",local_e0._4_4_);
            setUInt32InDict(plVar2,"iofence_direction",(uint)local_d8);
            plVar3 = (long *)OSArray::withCapacity(8);
            uVar7 = 0;
            do {
              plVar4 = (long *)OSNumber::withNumber(local_a8[uVar7],0x40);
              if (plVar4 != (long *)0x0) {
                (**(code **)(*plVar3 + 0x1c0))(plVar3,uVar7 & 0xffffffff,plVar4);
                (**(code **)(*plVar4 + 0x28))(plVar4);
              }
              uVar7 = uVar7 + 1;
            } while (uVar7 != 8);
            if (plVar3 != (long *)0x0) {
              (**(code **)(*plVar2 + 0x1d0))(plVar2,"iofence_backtrace",plVar3);
            }
            iVar6 = local_34;
            (**(code **)(*local_40 + 0x1c0))(local_40,local_34,plVar2);
            pIVar5 = local_48;
            if (plVar3 != (long *)0x0) {
              (**(code **)(*plVar3 + 0x28))(plVar3);
            }
            iVar6 = iVar6 + 1;
            (**(code **)(*plVar2 + 0x28))(plVar2);
          }
          pIVar8 = pIVar5;
        } while (pIVar5 != (IOFence *)0x0);
      }
      plVar3 = local_40;
      plVar2 = local_58;
      (**(code **)(*local_58 + 0x1d0))(local_58,"iofence_current_queue",local_40);
    }
    pIVar1 = local_50;
    local_60 = (long *)OSArray::withCapacity(1);
    if (local_60 == (long *)0x0) {
      _IOLockUnlock(*(undefined8 *)(pIVar1 + 0x50));
    }
    else {
      pIVar8 = *(IOFence **)(pIVar1 + 0x230);
      if (pIVar8 != (IOFence *)0x0) {
        iVar6 = 0;
        do {
          pIVar5 = *(IOFence **)(pIVar8 + 0x58);
          plVar2 = (long *)OSDictionary::withCapacity(3);
          if (plVar2 != (long *)0x0) {
            local_a8[7] = 0;
            local_a8[6] = 0;
            local_a8[5] = 0;
            local_a8[4] = 0;
            local_a8[3] = 0;
            local_a8[2] = 0;
            local_a8[1] = 0;
            local_a8[0] = 0;
            local_b0 = 0;
            local_b8 = 0;
            local_c0 = 0;
            local_c8 = 0;
            local_d0 = 0;
            local_d8 = 0;
            local_e0 = 0;
            local_48 = pIVar5;
            local_34 = iVar6;
            IOFence::writeTraceData(pIVar8,(long)&local_e0);
            setUInt32InDict(plVar2,"iofence_acceleratorid",local_e0._4_4_);
            setUInt32InDict(plVar2,"iofence_direction",(uint)local_d8);
            plVar3 = (long *)OSArray::withCapacity(8);
            uVar7 = 0;
            do {
              local_a8[8] = 0;
              _vm_kernel_addrhide(local_a8[uVar7],local_a8 + 8);
              plVar4 = (long *)OSNumber::withNumber(local_a8[8],0x40);
              if (plVar4 != (long *)0x0) {
                (**(code **)(*plVar3 + 0x1c0))(plVar3,uVar7 & 0xffffffff,plVar4);
                (**(code **)(*plVar4 + 0x28))(plVar4);
              }
              uVar7 = uVar7 + 1;
            } while (uVar7 != 8);
            if (plVar3 != (long *)0x0) {
              (**(code **)(*plVar2 + 0x1d0))(plVar2,"iofence_backtrace",plVar3);
            }
            iVar6 = local_34;
            (**(code **)(*local_60 + 0x1c0))(local_60,local_34,plVar2);
            pIVar5 = local_48;
            if (plVar3 != (long *)0x0) {
              (**(code **)(*plVar3 + 0x28))(plVar3);
            }
            iVar6 = iVar6 + 1;
            (**(code **)(*plVar2 + 0x28))(plVar2);
          }
          pIVar8 = pIVar5;
        } while (pIVar5 != (IOFence *)0x0);
      }
      plVar2 = local_58;
      plVar3 = local_60;
      (**(code **)(*local_58 + 0x1d0))(local_58,"iofence_waiting_queue",local_60);
      _IOLockUnlock(*(undefined8 *)(local_50 + 0x50));
      (**(code **)(*plVar3 + 0x28))(plVar3);
      plVar3 = local_40;
    }
    if (plVar3 != (long *)0x0) {
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
  }
  return plVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// setUInt32InDict(OSDictionary*, char const*, unsigned int)

void __cdecl setUInt32InDict(long *param_1,undefined8 param_2,uint param_3)

{
  long *plVar1;
  
  plVar1 = (long *)OSNumber::withNumber((ulong)param_3,0x20);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x1d0))(param_1,param_2,plVar1);
                    // WARNING: Could not recover jumptable at 0x0000da66. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::setValue(OSString const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::setValue(IOSurface *this,OSString *param_1,OSMetaClassBase *param_2,int *param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (param_1 != (OSString *)0x0) {
    plVar1 = (long *)OSSymbol::withString(param_1);
    uVar2 = setValue(this,plVar1,param_2,param_3);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return uVar2 & 0xffffffff;
  }
  uVar2 = setValue(this,(long *)0x0,param_2,param_3);
  return uVar2;
}



// IOSurface::setValue(char const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::setValue(IOSurface *this,char *param_1,OSMetaClassBase *param_2,int *param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (param_1 != (char *)0x0) {
    plVar1 = (long *)OSSymbol::withCString(param_1);
    uVar2 = setValue(this,plVar1,param_2,param_3);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return uVar2 & 0xffffffff;
  }
  uVar2 = setValue(this,(long *)0x0,param_2,param_3);
  return uVar2;
}



// IOSurface::copyValue(OSString const*, unsigned int*) const

OSMetaClassBase * __thiscall
IOSurface::copyValue(IOSurface *this,OSString *param_1,undefined4 *param_2)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  
  if (param_1 != (OSString *)0x0) {
    plVar1 = (long *)OSSymbol::withString(param_1);
    pOVar2 = copyValue(this,(long)plVar1,param_2);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return pOVar2;
  }
  pOVar2 = copyValue(this,0,param_2);
  return pOVar2;
}



// IOSurface::copyValue(char const*, unsigned int*) const

OSMetaClassBase * __thiscall IOSurface::copyValue(IOSurface *this,char *param_1,undefined4 *param_2)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  
  if (param_1 != (char *)0x0) {
    plVar1 = (long *)OSSymbol::withCString(param_1);
    pOVar2 = copyValue(this,(long)plVar1,param_2);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return pOVar2;
  }
  pOVar2 = copyValue(this,0,param_2);
  return pOVar2;
}



// IOSurface::removeValue(OSString const*, unsigned int*)

void __thiscall IOSurface::removeValue(IOSurface *this,OSString *param_1,int *param_2)

{
  long *plVar1;
  
  if (param_1 == (OSString *)0x0) {
    removeValue(this,(long *)0x0,param_2);
    return;
  }
  plVar1 = (long *)OSSymbol::withString(param_1);
  removeValue(this,plVar1,param_2);
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000dc4f. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::removeValue(char const*, unsigned int*)

void __thiscall IOSurface::removeValue(IOSurface *this,char *param_1,int *param_2)

{
  long *plVar1;
  
  if (param_1 == (char *)0x0) {
    removeValue(this,(long *)0x0,param_2);
    return;
  }
  plVar1 = (long *)OSSymbol::withCString(param_1);
  removeValue(this,plVar1,param_2);
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000dcb7. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::set_value(OSString const*, OSMetaClassBase const*, unsigned int*)

ulong __thiscall
IOSurface::set_value(IOSurface *this,OSString *param_1,OSMetaClassBase *param_2,int *param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (param_1 != (OSString *)0x0) {
    plVar1 = (long *)OSSymbol::withString(param_1);
    uVar2 = set_value(this,plVar1,param_2,param_3);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return uVar2 & 0xffffffff;
  }
  uVar2 = set_value(this,(long *)0x0,param_2,param_3);
  return uVar2;
}



// IOSurface::copy_value(OSString const*, unsigned int*) const

OSMetaClassBase * __thiscall
IOSurface::copy_value(IOSurface *this,OSString *param_1,undefined4 *param_2)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  
  if (param_1 != (OSString *)0x0) {
    plVar1 = (long *)OSSymbol::withString(param_1);
    pOVar2 = copy_value(this,(long)plVar1,param_2);
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    return pOVar2;
  }
  pOVar2 = copy_value(this,0,param_2);
  return pOVar2;
}



// IOSurface::remove_value(OSString const*, unsigned int*)

void __thiscall IOSurface::remove_value(IOSurface *this,OSString *param_1,int *param_2)

{
  long *plVar1;
  
  if (param_1 == (OSString *)0x0) {
    remove_value(this,(long *)0x0,param_2);
    return;
  }
  plVar1 = (long *)OSSymbol::withString(param_1);
  remove_value(this,plVar1,param_2);
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000ddeb. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::remove_value(char const*, unsigned int*)

void __thiscall IOSurface::remove_value(IOSurface *this,char *param_1,int *param_2)

{
  long *plVar1;
  
  if (param_1 == (char *)0x0) {
    remove_value(this,(long *)0x0,param_2);
    return;
  }
  plVar1 = (long *)OSSymbol::withCString(param_1);
  remove_value(this,plVar1,param_2);
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000de53. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::setIndexedTimestamp(unsigned long long, unsigned long long)

undefined8 __thiscall
IOSurface::setIndexedTimestamp(IOSurface *this,ulong param_1,undefined8 param_2)

{
  undefined8 uVar1;
  
  uVar1 = 0xe00002c2;
  if (param_1 < 5) {
    *(undefined8 *)(*(long *)(this + 0x2e0) + param_1 * 8) = param_2;
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurface::getIndexedTimestamp(unsigned long long) const

undefined8 __thiscall IOSurface::getIndexedTimestamp(IOSurface *this,ulong param_1)

{
  if (param_1 < 5) {
    return *(undefined8 *)(*(long *)(this + 0x2e0) + param_1 * 8);
  }
                    // WARNING: Subroutine does not return
  _panic("\"%s called with invalid index: %lld\" @%s:%d",
         "uint64_t IOSurface::getIndexedTimestamp(uint64_t) const",param_1,"IOSurface.cpp",0x1820);
}



// IOSurface::setDetachModeReservedCode(unsigned long long)

void __thiscall IOSurface::setDetachModeReservedCode(IOSurface *this,ulong param_1)

{
  *(ulong *)(*(long *)(this + 0x2e0) + 0x28) =
       *(ulong *)(*(long *)(this + 0x2e0) + 0x28) & 0xffffffffffff | param_1;
  return;
}



// IOSurface::isSysMemOnly() const

byte __thiscall IOSurface::isSysMemOnly(IOSurface *this)

{
  return ((byte)this[0x3ca] & 4) >> 2;
}



// IOSurface::setCompressedTileDataRegionMemoryUsedOfPlane(unsigned int, unsigned int)

undefined8 __thiscall
IOSurface::setCompressedTileDataRegionMemoryUsedOfPlane
          (IOSurface *this,uint param_1,undefined4 param_2)

{
  undefined8 uVar1;
  
  uVar1 = 0xe00002c2;
  if ((param_1 < 5) && (param_1 < *(uint *)(this + 0x98))) {
    *(undefined4 *)(*(long *)(this + 0x178) + 0xa0 + (ulong)param_1 * 4) = param_2;
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurface::getCompressedPlaneInfo(unsigned int) const

long __thiscall IOSurface::getCompressedPlaneInfo(IOSurface *this,uint param_1)

{
  ulong uVar1;
  ulong uVar2;
  ulong uVar3;
  long lVar4;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar3 = *(ulong *)(this + 0x2e8), uVar3 != 0)) {
    uVar1 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar3;
    uVar2 = uVar1 - uVar3;
    if ((uVar1 < uVar3) || (uVar2 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar4 = (ulong)param_1 * 0x3c;
    if ((int)lVar4 != lVar4) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar1 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar1 < 0) || ((uint)uVar2 < (int)(uVar1 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    lVar4 = uVar3 + (uVar1 >> 0x20);
    uVar1 = (ulong)CARRY8(uVar3,uVar1 >> 0x20);
    uVar3 = -uVar1;
    if ((uVar1 != uVar3) || ((long)uVar3 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
  }
  else {
    lVar4 = 0;
  }
  return lVar4;
}



// IOSurface::getTileWidthOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getTileWidthOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar2 = 0;
  if ((param_1 < *(uint *)(this + 0x98)) &&
     (uVar1 = *(ulong *)(this + 0x2e8), uVar2 = 0, uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20));
  }
  return uVar2;
}



// IOSurface::getTileHeightOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getTileHeightOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  uVar2 = 0;
  if ((param_1 < *(uint *)(this + 0x98)) &&
     (uVar1 = *(ulong *)(this + 0x2e8), uVar2 = 0, uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 4);
  }
  return uVar2;
}



// IOSurface::getBytesPerTileDataOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getBytesPerTileDataOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x2c);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getBytesPerTileHeaderOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getBytesPerTileHeaderOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x10);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getWidthInTilesOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getWidthInTilesOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x14);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getHeightInTilesOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getHeightInTilesOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x18);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getBytesPerRowOfTileDataOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getBytesPerRowOfTileDataOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x30);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getBytesPerRowOfTileHeaderGroupsOfPlane(unsigned int) const

undefined4 __thiscall
IOSurface::getBytesPerRowOfTileHeaderGroupsOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x1c);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getTileDataRegionOffsetOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getTileDataRegionOffsetOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0xc);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getTileHeaderRegionOffsetOfPlane(unsigned int) const

undefined4 __thiscall IOSurface::getTileHeaderRegionOffsetOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 8);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getHorizontalPixelOffsetWithinTileArrayOfPlane(unsigned int) const

undefined2 __thiscall
IOSurface::getHorizontalPixelOffsetWithinTileArrayOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined2 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined2 *)(uVar1 + (uVar3 >> 0x20) + 0x24);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getVerticalPixelOffsetWithinTileArrayOfPlane(unsigned int) const

undefined2 __thiscall
IOSurface::getVerticalPixelOffsetWithinTileArrayOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined2 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined2 *)(uVar1 + (uVar3 >> 0x20) + 0x26);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getCompressionTypeOfPlane(unsigned int) const

undefined1 __thiscall IOSurface::getCompressionTypeOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20) + 0x20);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getCompressionFootprintOfPlane(unsigned int) const

undefined1 __thiscall IOSurface::getCompressionFootprintOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20) + 0x28);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getHTPCPredictionSelectorOfPlane(unsigned int) const

undefined1 __thiscall IOSurface::getHTPCPredictionSelectorOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20) + 0x21);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getHTPCVerticalHeaderGroupingModeOfPlane(unsigned int) const

undefined1 __thiscall
IOSurface::getHTPCVerticalHeaderGroupingModeOfPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20) + 0x22);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getSliceCount() const

int __thiscall IOSurface::getSliceCount(IOSurface *this)

{
  int iVar1;
  
  iVar1 = 1;
  if (*(int *)(this + 0x3bc) != 0) {
    iVar1 = *(int *)(this + 0x3bc);
  }
  return iVar1;
}



// IOSurface::getTileDataRegionBytesPerSliceForPlane(unsigned int) const

undefined4 __thiscall
IOSurface::getTileDataRegionBytesPerSliceForPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x34);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getTileHeaderRegionBytesPerSliceForPlane(unsigned int) const

undefined4 __thiscall
IOSurface::getTileHeaderRegionBytesPerSliceForPlane(IOSurface *this,uint param_1)

{
  ulong uVar1;
  undefined4 uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  
  if ((param_1 < *(uint *)(this + 0x98)) && (uVar1 = *(ulong *)(this + 0x2e8), uVar1 != 0)) {
    uVar3 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar1;
    uVar4 = uVar3 - uVar1;
    if ((uVar3 < uVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar5 = (ulong)param_1 * 0x3c;
    if ((int)lVar5 != lVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (ulong)param_1 * 0x3c00000000;
    if (((long)uVar3 < 0) || ((uint)uVar4 < (int)(uVar3 >> 0x20) + 0x3cU)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar6 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar6;
    if ((uVar6 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined4 *)(uVar1 + (uVar3 >> 0x20) + 0x38);
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getNumberOfComponentsOfPlane(unsigned int) const

undefined1 __thiscall IOSurface::getNumberOfComponentsOfPlane(IOSurface *this,ulong param_1)

{
  ulong uVar1;
  undefined1 uVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar3 = param_1 & 0xffffffff;
  if ((uVar3 < *(ulong *)(this + 0x308)) && (uVar1 = *(ulong *)(this + 0x2f8), uVar1 != 0)) {
    uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
    uVar5 = uVar4 - uVar1;
    if ((uVar4 < uVar1) || (uVar5 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    if ((long)(int)(uVar3 * 0x18) != uVar3 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar3 = (uVar3 << 0x23) * 3;
    if (((long)uVar3 < 0) || ((uint)uVar5 < (int)(uVar3 >> 0x20) + 0x18U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar5 = (ulong)CARRY8(uVar1,uVar3 >> 0x20);
    uVar4 = -uVar5;
    if ((uVar5 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar2 = *(undefined1 *)(uVar1 + (uVar3 >> 0x20));
  }
  else {
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurface::getBitDepthOfComponentOfPlane(unsigned int, unsigned int) const

undefined1 __thiscall
IOSurface::getBitDepthOfComponentOfPlane(IOSurface *this,ulong param_2_00,uint param_2)

{
  ulong uVar1;
  byte bVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar5 = param_2_00 & 0xffffffff;
  if ((*(ulong *)(this + 0x308) <= uVar5) ||
     (bVar2 = getNumberOfComponentsOfPlane(this,param_2_00), bVar2 <= param_2)) {
    return 0;
  }
  uVar1 = *(ulong *)(this + 0x2f8);
  uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
  uVar3 = uVar4 - uVar1;
  if ((uVar1 <= uVar4) && (uVar3 >> 0x20 == 0)) {
    if ((long)(int)(uVar5 * 0x18) != uVar5 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar5 = (uVar5 << 0x23) * 3;
    if ((-1 < (long)uVar5) && ((int)(uVar5 >> 0x20) + 0x18U <= (uint)uVar3)) {
      uVar3 = (ulong)CARRY8(uVar1,uVar5 >> 0x20);
      uVar4 = -uVar3;
      if ((uVar3 == uVar4) && (-1 < (long)uVar4)) {
        return *(undefined1 *)(uVar1 + (uVar5 >> 0x20) + 4 + (ulong)param_2);
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// IOSurface::getBitOffsetOfComponentOfPlane(unsigned int, unsigned int) const

undefined1 __thiscall
IOSurface::getBitOffsetOfComponentOfPlane(IOSurface *this,ulong param_2_00,uint param_2)

{
  ulong uVar1;
  byte bVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar5 = param_2_00 & 0xffffffff;
  if ((*(ulong *)(this + 0x308) <= uVar5) ||
     (bVar2 = getNumberOfComponentsOfPlane(this,param_2_00), bVar2 <= param_2)) {
    return 0;
  }
  uVar1 = *(ulong *)(this + 0x2f8);
  uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
  uVar3 = uVar4 - uVar1;
  if ((uVar1 <= uVar4) && (uVar3 >> 0x20 == 0)) {
    if ((long)(int)(uVar5 * 0x18) != uVar5 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar5 = (uVar5 << 0x23) * 3;
    if ((-1 < (long)uVar5) && ((int)(uVar5 >> 0x20) + 0x18U <= (uint)uVar3)) {
      uVar3 = (ulong)CARRY8(uVar1,uVar5 >> 0x20);
      uVar4 = -uVar3;
      if ((uVar3 == uVar4) && (-1 < (long)uVar4)) {
        return *(undefined1 *)(uVar1 + (uVar5 >> 0x20) + 8 + (ulong)param_2);
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// IOSurface::getNameOfComponentOfPlane(unsigned int, unsigned int) const

undefined1 __thiscall
IOSurface::getNameOfComponentOfPlane(IOSurface *this,ulong param_2_00,uint param_2)

{
  ulong uVar1;
  byte bVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar5 = param_2_00 & 0xffffffff;
  if ((*(ulong *)(this + 0x308) <= uVar5) ||
     (bVar2 = getNumberOfComponentsOfPlane(this,param_2_00), bVar2 <= param_2)) {
    return 0;
  }
  uVar1 = *(ulong *)(this + 0x2f8);
  uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
  uVar3 = uVar4 - uVar1;
  if ((uVar1 <= uVar4) && (uVar3 >> 0x20 == 0)) {
    if ((long)(int)(uVar5 * 0x18) != uVar5 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar5 = (uVar5 << 0x23) * 3;
    if ((-1 < (long)uVar5) && ((int)(uVar5 >> 0x20) + 0x18U <= (uint)uVar3)) {
      uVar3 = (ulong)CARRY8(uVar1,uVar5 >> 0x20);
      uVar4 = -uVar3;
      if ((uVar3 == uVar4) && (-1 < (long)uVar4)) {
        return *(undefined1 *)(uVar1 + (uVar5 >> 0x20) + 0xc + (ulong)param_2);
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// IOSurface::getTypeOfComponentOfPlane(unsigned int, unsigned int) const

undefined1 __thiscall
IOSurface::getTypeOfComponentOfPlane(IOSurface *this,ulong param_2_00,uint param_2)

{
  ulong uVar1;
  byte bVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar5 = param_2_00 & 0xffffffff;
  if ((*(ulong *)(this + 0x308) <= uVar5) ||
     (bVar2 = getNumberOfComponentsOfPlane(this,param_2_00), bVar2 <= param_2)) {
    return 0;
  }
  uVar1 = *(ulong *)(this + 0x2f8);
  uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
  uVar3 = uVar4 - uVar1;
  if ((uVar1 <= uVar4) && (uVar3 >> 0x20 == 0)) {
    if ((long)(int)(uVar5 * 0x18) != uVar5 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar5 = (uVar5 << 0x23) * 3;
    if ((-1 < (long)uVar5) && ((int)(uVar5 >> 0x20) + 0x18U <= (uint)uVar3)) {
      uVar3 = (ulong)CARRY8(uVar1,uVar5 >> 0x20);
      uVar4 = -uVar3;
      if ((uVar3 == uVar4) && (-1 < (long)uVar4)) {
        return *(undefined1 *)(uVar1 + (uVar5 >> 0x20) + 0x10 + (ulong)param_2);
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// IOSurface::getRangeOfComponentOfPlane(unsigned int, unsigned int) const

undefined1 __thiscall
IOSurface::getRangeOfComponentOfPlane(IOSurface *this,ulong param_2_00,uint param_2)

{
  ulong uVar1;
  byte bVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  uVar5 = param_2_00 & 0xffffffff;
  if ((*(ulong *)(this + 0x308) <= uVar5) ||
     (bVar2 = getNumberOfComponentsOfPlane(this,param_2_00), bVar2 <= param_2)) {
    return 0;
  }
  uVar1 = *(ulong *)(this + 0x2f8);
  uVar4 = uVar1 + (ulong)*(uint *)(this + 0x300) * 0x18;
  uVar3 = uVar4 - uVar1;
  if ((uVar1 <= uVar4) && (uVar3 >> 0x20 == 0)) {
    if ((long)(int)(uVar5 * 0x18) != uVar5 * 0x18) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar5 = (uVar5 << 0x23) * 3;
    if ((-1 < (long)uVar5) && ((int)(uVar5 >> 0x20) + 0x18U <= (uint)uVar3)) {
      uVar3 = (ulong)CARRY8(uVar1,uVar5 >> 0x20);
      uVar4 = -uVar3;
      if ((uVar3 == uVar4) && (-1 < (long)uVar4)) {
        return *(undefined1 *)(uVar1 + (uVar5 >> 0x20) + 0x14 + (ulong)param_2);
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
              );
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// IOSurface::setLayoutFromDescriptor(IOSurfaceDescriptor const*)

undefined8 __thiscall
IOSurface::setLayoutFromDescriptor(IOSurface *this,IOSurfaceDescriptor *param_1)

{
  undefined1 uVar1;
  undefined4 uVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  undefined8 uVar6;
  long lVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  undefined8 extraout_RAX;
  ulong uVar11;
  ulong uVar12;
  ulong uVar13;
  ulong *puVar14;
  undefined4 *puVar15;
  long local_40;
  
  uVar2 = IOSurfaceDescriptor::getPixelFormat(param_1);
  *(undefined4 *)(this + 0x80) = uVar2;
  uVar2 = IOSurfaceDescriptor::getPlaneCount(param_1);
  *(undefined4 *)(this + 0x98) = uVar2;
  uVar6 = IOSurfaceDescriptor::getIsTiled(param_1);
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffffdff | ((uint)uVar6 & 0xff) << 9;
  uVar6 = IOSurfaceDescriptor::getIsTiled(param_1);
  *(char *)(*(long *)(this + 0x178) + 0x14) = (char)uVar6;
  uVar6 = IOSurfaceDescriptor::getDisableMapping(param_1);
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xffbfffff | ((uint)uVar6 & 0xff) << 0x16;
  uVar3 = IOSurfaceDescriptor::getAllocSize(param_1);
  *(ulong *)(this + 0x90) = (ulong)uVar3;
  uVar3 = IOSurfaceDescriptor::getWidth(param_1);
  *(ulong *)(this + 0x58) = (ulong)uVar3;
  uVar3 = IOSurfaceDescriptor::getHeight(param_1);
  *(ulong *)(this + 0x60) = (ulong)uVar3;
  uVar3 = IOSurfaceDescriptor::getBufferOffset(param_1);
  *(ulong *)(this + 0x78) = (ulong)uVar3;
  uVar2 = IOSurfaceDescriptor::getElementWidth(param_1);
  this[0x72] = SUB41(uVar2,0);
  uVar2 = IOSurfaceDescriptor::getElementHeight(param_1);
  this[0x73] = SUB41(uVar2,0);
  uVar3 = IOSurfaceDescriptor::getBytesPerRow(param_1);
  *(ulong *)(this + 0x68) = (ulong)uVar3;
  uVar2 = IOSurfaceDescriptor::getBytesPerElement(param_1);
  *(short *)(this + 0x70) = (short)uVar2;
  iVar4 = IOSurfaceDescriptor::getSliceCount(param_1);
  *(int *)(this + 0x3bc) = iVar4;
  if (*(uint *)(this + 0x98) == 0) {
    uVar3 = 0;
  }
  else {
    if (3 < *(uint *)(this + 0x98)) {
      return 0;
    }
    *(IOSurface **)(this + 0x180) = this + 0xa8;
    *(undefined4 *)(this + 0x188) = 3;
    uVar3 = 0;
    iVar4 = IOSurfaceDescriptor::getPlaneCompressionType(param_1,0);
    uVar5 = *(uint *)(this + 0x98);
    if (iVar4 != 0) {
      lVar7 = _IOMallocZeroData((ulong)uVar5 * 0x3c);
      uVar5 = *(uint *)(this + 0x98);
      *(long *)(this + 0x2e8) = lVar7;
      *(uint *)(this + 0x2f0) = uVar5;
      if (lVar7 == 0) {
        return 0;
      }
    }
    if (uVar5 != 0) {
      uVar12 = 0xffffffff7fffffc8;
      uVar13 = 0;
      uVar11 = 0;
      local_40 = 0;
      uVar3 = 0;
      do {
        uVar10 = *(ulong *)(this + 0x180);
        uVar8 = (ulong)*(uint *)(this + 0x188) * 0x38 + uVar10;
        uVar9 = uVar8 - uVar10;
        if ((uVar8 < uVar10) || (uVar9 >> 0x20 != 0)) {
LAB_0000f663:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                    );
        }
        uVar12 = uVar12 + 0x38;
        if (uVar12 < 0xffffffff00000000) {
LAB_0000f66f:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        if (((long)uVar13 < 0) || ((uint)uVar9 < (int)(uVar13 >> 0x20) + 0x38U)) {
LAB_0000f657:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        puVar14 = (ulong *)(uVar10 + (uVar13 >> 0x20));
        uVar8 = (ulong)CARRY8(uVar10,uVar13 >> 0x20);
        uVar10 = -uVar8;
        if ((uVar8 != uVar10) || ((long)uVar10 < 0)) {
LAB_0000f67b:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        uVar5 = IOSurfaceDescriptor::getPlaneWidth(param_1,uVar3);
        *puVar14 = (ulong)uVar5;
        uVar5 = IOSurfaceDescriptor::getPlaneHeight(param_1,uVar3);
        puVar14[1] = (ulong)uVar5;
        uVar2 = IOSurfaceDescriptor::getPlaneElementWidth(param_1,uVar3);
        *(char *)((long)puVar14 + 0x34) = (char)uVar2;
        uVar2 = IOSurfaceDescriptor::getPlaneElementHeight(param_1,uVar3);
        *(char *)((long)puVar14 + 0x35) = (char)uVar2;
        uVar5 = IOSurfaceDescriptor::getPlaneBase(param_1,uVar3);
        puVar14[2] = (ulong)uVar5;
        uVar5 = IOSurfaceDescriptor::getPlaneOffset(param_1,uVar3);
        puVar14[3] = (ulong)uVar5;
        uVar5 = IOSurfaceDescriptor::getPlaneSize(param_1,uVar3);
        puVar14[5] = (ulong)uVar5;
        uVar5 = IOSurfaceDescriptor::getPlaneBytesPerRow(param_1,uVar3);
        puVar14[4] = (ulong)uVar5;
        uVar2 = IOSurfaceDescriptor::getPlaneBytesPerElement(param_1,uVar3);
        *(short *)(puVar14 + 6) = (short)uVar2;
        uVar2 = IOSurfaceDescriptor::getPlaneAddressFormat(param_1,uVar3);
        *(char *)((long)puVar14 + 0x36) = (char)uVar2;
        uVar10 = *(ulong *)(this + 0x2e8);
        if (uVar10 != 0) {
          uVar8 = (ulong)*(uint *)(this + 0x2f0) * 0x3c + uVar10;
          uVar9 = uVar8 - uVar10;
          if ((uVar8 < uVar10) || (uVar9 >> 0x20 != 0)) goto LAB_0000f663;
          if (uVar11 - 0x80000000 < 0xffffffff00000000) goto LAB_0000f66f;
          if ((local_40 < 0) || ((uint)uVar9 < (int)uVar11 + 0x3cU)) goto LAB_0000f657;
          puVar15 = (undefined4 *)(uVar10 + uVar11);
          uVar8 = -(ulong)CARRY8(uVar10,uVar11);
          if ((CARRY8(uVar10,uVar11) != uVar8) || ((long)uVar8 < 0)) goto LAB_0000f67b;
          uVar2 = IOSurfaceDescriptor::getPlaneWidthInCompressedTiles(param_1,uVar3);
          puVar15[5] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneHeightInCompressedTiles(param_1,uVar3);
          puVar15[6] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneCompressedTileWidth(param_1,uVar3);
          *puVar15 = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneCompressedTileHeight(param_1,uVar3);
          puVar15[1] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneCompressionType(param_1,uVar3);
          *(char *)(puVar15 + 8) = (char)uVar2;
          uVar1 = IOSurfaceDescriptor::getPlaneCompressionFootprint(param_1,uVar3);
          *(undefined1 *)(puVar15 + 10) = uVar1;
          uVar2 = IOSurfaceDescriptor::getPlaneCompressedTileDataRegionOffset(param_1,uVar3);
          puVar15[3] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneCompressedTileHeaderRegionOffset(param_1,uVar3);
          puVar15[2] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneBytesPerCompressedTileHeader(param_1,uVar3);
          puVar15[4] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneBytesPerTileData(param_1,uVar3);
          puVar15[0xb] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneBytesPerRowOfTileData(param_1,uVar3);
          puVar15[0xc] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneBytesPerRowOfCompressedTileHeaderGroups
                            (param_1,uVar3);
          puVar15[7] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneDataRegionBytesPerSliceForPlane(param_1,uVar3);
          puVar15[0xd] = uVar2;
          uVar2 = IOSurfaceDescriptor::getPlaneHeaderRegionBytesPerSliceForPlane(param_1,uVar3);
          puVar15[0xe] = uVar2;
        }
        local_40 = local_40 + 0x3c00000000;
        uVar11 = uVar11 + 0x3c;
        uVar13 = uVar13 + 0x3800000000;
        uVar3 = uVar3 + 1;
      } while (uVar3 < *(uint *)(this + 0x98));
      uVar3 = *(uint *)(this + 0x98) << 8;
    }
  }
  _kernel_debug(0x5400010,(ulong)*(uint *)(this + 0x10),(ulong)*(uint *)(this + 0x80),
                *(uintptr_t *)(this + 0x90),(ulong)(*(uint *)(this + 0x3c8) >> 9 & 1 | uVar3),0);
  _kernel_debug(0x5400014,(ulong)*(uint *)(this + 0x10),*(uintptr_t *)(this + 0x58),
                *(uintptr_t *)(this + 0x60),
                (ulong)*(ushort *)(this + 0x70) |
                (long)(int)((uint)(byte)this[0x72] << 0x18) | (ulong)(byte)this[0x73] << 0x10,0);
  return CONCAT71((int7)((ulong)extraout_RAX >> 8),1);
}



// IOSurface::setMemoryRegion(IOSurfaceMemoryRegion*)

void __thiscall IOSurface::setMemoryRegion(IOSurface *this,long *param_1)

{
  long *plVar1;
  
  plVar1 = *(long **)(this + 0x28);
  *(long **)(this + 0x28) = param_1;
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0000f6b5. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurface::setMemoryDescriptor(IOMemoryDescriptor*)

void __thiscall IOSurface::setMemoryDescriptor(IOSurface *this,long *param_1)

{
  uint uVar1;
  long *plVar2;
  uintptr_t arg2;
  
  plVar2 = *(long **)(this + 0x30);
  if ((plVar2 != (long *)0x0) && ((*(uint *)(this + 0x3c8) >> 10 & 1) != 0)) {
    *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffffbff;
    (**(code **)(*plVar2 + 0x1f8))(plVar2,0);
  }
  libkern::intrusive_shared_ptr<>::reset((long *)(this + 0x30),param_1);
  uVar1 = *(uint *)(this + 0x10);
  if (*(long *)(this + 0x30) == 0) {
    arg2 = 0;
  }
  else {
    arg2 = IOMemoryDescriptor::getDescriptorID();
  }
  _kernel_debug(0x540000c,(ulong)uVar1,arg2,0,0,0);
  return;
}



// IOSurface::resetLayout()

void __thiscall IOSurface::resetLayout(IOSurface *this)

{
  long *plVar1;
  
  plVar1 = *(long **)(this + 0x30);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x50))(plVar1,*(undefined8 *)PTR_metaClass_00027008);
  }
  *(undefined8 *)(this + 0x30) = 0;
  _kernel_debug(0x540000c,(ulong)*(uint *)(this + 0x10),0,0,0,0);
  if (*(long *)(this + 0x2e8) != 0) {
    _IOFreeData(*(long *)(this + 0x2e8),(ulong)*(uint *)(this + 0x98) * 0x3c);
    *(undefined8 *)(this + 0x2e8) = 0;
    *(undefined4 *)(this + 0x2f0) = 0;
    *(undefined4 *)(this + 0x3bc) = 0;
  }
  *(undefined8 *)(this + 0x180) = 0;
  *(undefined4 *)(this + 0x188) = 0;
  *(undefined4 *)(this + 0x98) = 0;
  *(undefined8 *)(this + 0x58) = 0;
  *(undefined8 *)(this + 0x60) = 0;
  *(undefined8 *)(this + 0x68) = 0;
  *(undefined8 *)(this + 0x90) = 0;
  _kernel_debug(0x5400010,(ulong)*(uint *)(this + 0x10),(ulong)*(uint *)(this + 0x80),0,
                (ulong)(*(uint *)(this + 0x3c8) >> 9 & 1),0);
  _kernel_debug(0x5400014,(ulong)*(uint *)(this + 0x10),*(uintptr_t *)(this + 0x58),
                *(uintptr_t *)(this + 0x60),
                (ulong)*(ushort *)(this + 0x70) |
                (long)(int)((uint)(byte)this[0x72] << 0x18) | (ulong)(byte)this[0x73] << 0x10,0);
  return;
}



// IOSurface::setDetachModeCode(unsigned long long, unsigned long long, unsigned long long)

void __thiscall
IOSurface::setDetachModeCode(IOSurface *this,ulong param_1,ulong param_2,long param_3)

{
  long lVar1;
  
  lVar1 = *(long *)(this + 0x2e0);
  if (param_3 != 0) {
    *(long *)(lVar1 + 0x10) = param_3;
  }
  *(ulong *)(lVar1 + 0x28) =
       (param_2 ^ *(ulong *)(lVar1 + 0x28)) & param_1 ^ *(ulong *)(lVar1 + 0x28);
  return;
}



// IOSurface::getDetachModeCode() const

undefined8 __thiscall IOSurface::getDetachModeCode(IOSurface *this)

{
  return *(undefined8 *)(*(long *)(this + 0x2e0) + 0x28);
}



// IOSurface::setPixelFormat(unsigned int)

void __thiscall IOSurface::setPixelFormat(IOSurface *this,undefined4 param_1)

{
  *(undefined4 *)(this + 0x80) = param_1;
  return;
}



// IOSurface::setAllocSize(unsigned int)

void __thiscall IOSurface::setAllocSize(IOSurface *this,uint param_1)

{
  *(ulong *)(this + 0x90) = (ulong)param_1;
  return;
}



// IOSurface::setIsAllocated(bool)

void __thiscall IOSurface::setIsAllocated(IOSurface *this,int param_1)

{
  *(uint *)(this + 0x3c8) = *(uint *)(this + 0x3c8) & 0xfffffeff | param_1 << 8;
  return;
}



// IOSurface::isDisplayable() const

byte __thiscall IOSurface::isDisplayable(IOSurface *this)

{
  return ((byte)this[0x3ca] & 0x10) >> 4;
}



// IOSurface::isPixelCastingAllowed() const

byte __thiscall IOSurface::isPixelCastingAllowed(IOSurface *this)

{
  return (byte)this[0x3ca] & 1;
}



// IOSurface::isPixelSizeCastingAllowed() const

byte __thiscall IOSurface::isPixelSizeCastingAllowed(IOSurface *this)

{
  return (byte)this[0x3ca] & 1;
}



// IOSurface::getLockSeed() const

undefined4 __thiscall IOSurface::getLockSeed(IOSurface *this)

{
  return *(undefined4 *)(*(long *)(this + 0x178) + 0xc);
}



// IOSurface::getUnlockSeed() const

undefined4 __thiscall IOSurface::getUnlockSeed(IOSurface *this)

{
  return *(undefined4 *)(*(long *)(this + 0x178) + 0x10);
}



// IOSurface::getLastReadFenceTime() const

undefined8 __thiscall IOSurface::getLastReadFenceTime(IOSurface *this)

{
  return *(undefined8 *)(this + 0x310);
}



// IOSurface::getLastWriteFenceTime() const

undefined8 __thiscall IOSurface::getLastWriteFenceTime(IOSurface *this)

{
  return *(undefined8 *)(this + 0x318);
}



// IOSurface::getPreallocPages() const

byte __thiscall IOSurface::getPreallocPages(IOSurface *this)

{
  return ((byte)this[0x3c9] & 8) >> 3;
}



// IOSurface::lock()

void __thiscall IOSurface::lock(IOSurface *this)

{
  _IOLockLock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::unlock()

void __thiscall IOSurface::unlock(IOSurface *this)

{
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// IOSurface::isTiled()

byte __thiscall IOSurface::isTiled(IOSurface *this)

{
  return ((byte)this[0x3c9] & 2) >> 1;
}



// IOSurface::getTraceID() const

undefined8 __thiscall IOSurface::getTraceID(IOSurface *this)

{
  return *(undefined8 *)(this + 0x360);
}



// IOSurface::set_image_origin_and_extents(unsigned int, unsigned int, unsigned int, unsigned int,
// unsigned int, unsigned int)

void __thiscall
IOSurface::set_image_origin_and_extents
          (IOSurface *this,undefined4 param_1,undefined4 param_2,undefined4 param_3,
          undefined4 param_4,undefined4 param_5,undefined4 param_6)

{
  _IOLockLock(*(undefined8 *)(this + 0x50));
  *(undefined4 *)(this + 0x368) = param_1;
  *(undefined4 *)(this + 0x36c) = param_2;
  *(undefined4 *)(this + 0x370) = param_3;
  *(undefined4 *)(this + 0x374) = param_4;
  *(undefined4 *)(this + 0x378) = param_5;
  *(undefined4 *)(this + 0x37c) = param_6;
  _IOLockUnlock(*(undefined8 *)(this + 0x50));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurface::getImageOriginAndExtents()

undefined8 * __cdecl IOSurface::getImageOriginAndExtents(undefined8 *param_1,long param_2)

{
  undefined8 uVar1;
  
  _IOLockLock(*(undefined8 *)(param_2 + 0x50));
  param_1[2] = *(undefined8 *)(param_2 + 0x378);
  uVar1 = *(undefined8 *)(param_2 + 0x368);
  param_1[1] = *(undefined8 *)(param_2 + 0x370);
  *param_1 = uVar1;
  _IOLockUnlock(*(undefined8 *)(param_2 + 0x50));
  return param_1;
}



// IOSurface::setDataProperty(unsigned long long, unsigned long, void const*)

undefined8 __thiscall
IOSurface::setDataProperty(IOSurface *this,ulong param_1,ulong param_2,void *param_3)

{
  IOSurface *pIVar1;
  ulong uVar2;
  void *pvVar3;
  ulong uVar4;
  IOSurface *pIVar5;
  undefined8 uVar6;
  
  uVar6 = 0xe00002c2;
  if (((param_1 < 4) && (param_2 < 0x401)) && ((param_2 == 0 || (param_3 != (void *)0x0)))) {
    _IOLockLock(*(undefined8 *)(this + 0x50));
    pIVar1 = this + 0x1b0;
    uVar2 = (long)(this + 0x1f0) - (long)pIVar1;
    if ((this + 0x1f0 < pIVar1) || (uVar2 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar4 = param_1 * 0x10;
    if (0x7fffffffffffffffU - ((long)param_1 >> 0x3f) < uVar4) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Calculating the number of bytes to add to the offset (n * sizeof(T)) would trigger an overflow"
                );
    }
    if ((uint)uVar2 < (int)uVar4 + 0x10U) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    pIVar5 = pIVar1 + uVar4;
    uVar2 = -(ulong)CARRY8((ulong)pIVar1,uVar4);
    if ((CARRY8((ulong)pIVar1,uVar4) != uVar2) || ((long)uVar2 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    if ((*(long *)pIVar5 != 0) && (*(long *)(pIVar5 + 8) != 0)) {
      _IOFreeData();
      *(long *)pIVar5 = 0;
      *(long *)(pIVar5 + 8) = 0;
    }
    uVar6 = 0;
    if (param_2 != 0) {
      pvVar3 = (void *)_IOMallocData(param_2);
      *(void **)pIVar5 = pvVar3;
      if (pvVar3 == (void *)0x0) {
        uVar6 = 0xe00002bd;
      }
      else {
        *(ulong *)(pIVar5 + 8) = param_2;
        _memmove(pvVar3,param_3,param_2);
        *(byte *)(*(long *)(this + 0x178) + 0x2f) =
             *(byte *)(*(long *)(this + 0x178) + 0x2f) | (byte)(1 << ((byte)param_1 & 0x1f));
      }
    }
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
  }
  return uVar6;
}



// IOSurface::getDataProperty(unsigned long long, unsigned long, unsigned long*, void*)

undefined8 __thiscall
IOSurface::getDataProperty
          (IOSurface *this,ulong param_1,ulong param_2,size_t *param_3,void *param_4)

{
  IOSurface *pIVar1;
  void *pvVar2;
  size_t sVar3;
  ulong uVar4;
  ulong uVar5;
  undefined8 uVar6;
  
  uVar6 = 0xe00002c2;
  if ((param_1 < 4) && ((param_2 == 0 || (param_4 != (void *)0x0)))) {
    _IOLockLock(*(undefined8 *)(this + 0x50));
    pIVar1 = this + 0x1b0;
    uVar4 = (long)(this + 0x1f0) - (long)pIVar1;
    if ((this + 0x1f0 < pIVar1) || (uVar4 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar5 = param_1 * 0x10;
    if (0x7fffffffffffffffU - ((long)param_1 >> 0x3f) < uVar5) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Calculating the number of bytes to add to the offset (n * sizeof(T)) would trigger an overflow"
                );
    }
    if ((uint)uVar4 < (int)uVar5 + 0x10U) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar4 = -(ulong)CARRY8((ulong)pIVar1,uVar5);
    if ((CARRY8((ulong)pIVar1,uVar5) != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    uVar6 = 0;
    pvVar2 = *(void **)(pIVar1 + uVar5);
    sVar3 = *(size_t *)(pIVar1 + uVar5 + 8);
    *param_3 = sVar3;
    if ((((param_2 != 0) && (pvVar2 != (void *)0x0)) && (sVar3 != 0)) &&
       (uVar6 = 0xe00002e8, sVar3 <= param_2)) {
      _memmove(param_4,pvVar2,sVar3);
      uVar6 = 0;
    }
    _IOLockUnlock(*(undefined8 *)(this + 0x50));
  }
  return uVar6;
}



// IOSurface::clearDataProperties()

undefined8 __thiscall IOSurface::clearDataProperties(IOSurface *this)

{
  IOSurface *pIVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  IOSurface *pIVar5;
  ulong uVar6;
  
  _IOLockLock(*(undefined8 *)(this + 0x50));
  pIVar1 = this + 0x1b0;
  uVar6 = (long)(this + 0x1f0) - (long)pIVar1;
  if ((this + 0x1f0 < pIVar1) || (uVar6 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
              );
  }
  uVar4 = 0;
  while( true ) {
    pIVar5 = pIVar1 + (uVar4 & 0xffffffff);
    uVar3 = (ulong)CARRY8(uVar4 & 0xffffffff,(ulong)pIVar1);
    uVar2 = -uVar3;
    if ((uVar3 != uVar2) || ((long)uVar2 < 0)) break;
    if (*(long *)pIVar5 != 0) {
      if ((uint)uVar6 < (int)uVar4 + 0x10U) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                  );
      }
      if (*(long *)(pIVar5 + 8) != 0) {
        _IOFreeData();
        *(long *)pIVar5 = 0;
        uVar2 = -(ulong)CARRY8((ulong)pIVar1,uVar4);
        if ((CARRY8((ulong)pIVar1,uVar4) != uVar2) || ((long)uVar2 < 0)) break;
        *(undefined8 *)(pIVar1 + uVar4 + 8) = 0;
      }
    }
    uVar4 = uVar4 + 0x10;
    if (uVar4 == 0x40) {
      *(undefined1 *)(*(long *)(this + 0x178) + 0x2f) = 0;
      _IOLockUnlock(*(undefined8 *)(this + 0x50));
      return 0;
    }
  }
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
            );
}



// IOSurface::MetaClass::~MetaClass()

void __thiscall IOSurface::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// getObject(OSDictionary*, char const*)

void __cdecl getObject(long *param_1)

{
                    // WARNING: Could not recover jumptable at 0x0000fe08. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x208))();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// validateAdditionalPlaneComponentInfo(IOSurfaceAdditionalPlaneInfo*, OSDictionary*, char const*,
// unsigned char*)

ulong __cdecl
validateAdditionalPlaneComponentInfo(byte *param_1,long *param_2,undefined8 param_3,long param_4)

{
  OSMetaClass *pOVar1;
  byte bVar2;
  uint uVar3;
  int iVar4;
  long *plVar5;
  OSMetaClassBase *pOVar6;
  long *plVar7;
  ulong uVar8;
  undefined8 unaff_RBX;
  ulong uVar9;
  char *pcVar10;
  ulong uVar11;
  
  plVar5 = (long *)getArrayProperty(param_2);
  uVar9 = CONCAT71((int7)((ulong)unaff_RBX >> 8),1);
  if (plVar5 != (long *)0x0) {
    uVar3 = (**(code **)(*plVar5 + 0x130))(plVar5);
    if (uVar3 < 5) {
      iVar4 = (**(code **)(*plVar5 + 0x130))(plVar5);
      if (iVar4 == 0) {
        pcVar10 = "IOSurface: %s component count is too small.\n";
      }
      else {
        bVar2 = *param_1;
        if ((bVar2 == 0) || (uVar3 = (**(code **)(*plVar5 + 0x130))(plVar5), uVar3 == bVar2)) {
          bVar2 = (**(code **)(*plVar5 + 0x130))(plVar5);
          *param_1 = bVar2;
          if (bVar2 != 0) {
            pOVar1 = *(OSMetaClass **)PTR_metaClass_00027040;
            uVar11 = 0;
            do {
              pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar5 + 0x1e8))(plVar5,uVar11 & 0xffffffff)
              ;
              plVar7 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar1);
              if (plVar7 != (long *)0x0) {
                uVar8 = (**(code **)(*plVar7 + 0x150))(plVar7);
                if (0xff < uVar8) {
                  uVar9 = 0;
                  break;
                }
                *(char *)(param_4 + uVar11) = (char)uVar8;
              }
              uVar11 = uVar11 + 1;
            } while (uVar11 < *param_1);
          }
          goto LAB_0000ff0f;
        }
        pcVar10 = "IOSurface: %s component count mismatch.\n";
      }
    }
    else {
      pcVar10 = "IOSurface: %s component count is too large.\n";
    }
    uVar9 = 0;
    _IOLog(pcVar10,param_3);
  }
LAB_0000ff0f:
  return uVar9 & 0xffffffff;
}



void __GLOBAL__sub_I_IOSurface_cpp(void)

{
  int iVar1;
  
  iVar1 = _PE_i_can_has_debugger(0);
  isDevFused = iVar1 != 0;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurface::gMetaClass,"IOSurface",PTR_gMetaClass_00027048,0x3d0,
             &IOSurface_zone,"iokit.IOSurface",0x2000000);
  IOSurface::gMetaClass = &PTR__MetaClass_000283a8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurface::gMetaClass);
  return;
}



// IOSurfaceClient::MetaClass::MetaClass()

void __thiscall IOSurfaceClient::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceClient",(OSMetaClass *)PTR_gMetaClass_00027048,0x98);
  *(undefined ***)this = &PTR__MetaClass_00028628;
  return;
}



// IOSurfaceClient::MetaClass::~MetaClass()

void __thiscall IOSurfaceClient::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceClient::IOSurfaceClient(OSMetaClass const*)

void __thiscall IOSurfaceClient::IOSurfaceClient(IOSurfaceClient *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  return;
}



// IOSurfaceClient::IOSurfaceClient(OSMetaClass const*)

void __thiscall IOSurfaceClient::IOSurfaceClient(IOSurfaceClient *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  return;
}



// IOSurfaceClient::~IOSurfaceClient()

void __thiscall IOSurfaceClient::~IOSurfaceClient(IOSurfaceClient *this)

{
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  if (*(long **)(this + 0x48) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x48) + 0x28))();
  }
  *(undefined8 *)(this + 0x48) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceClient::~IOSurfaceClient()

void __thiscall IOSurfaceClient::~IOSurfaceClient(IOSurfaceClient *this)

{
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  if (*(long **)(this + 0x48) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x48) + 0x28))();
  }
  *(undefined8 *)(this + 0x48) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceClient::~IOSurfaceClient()

void __thiscall IOSurfaceClient::~IOSurfaceClient(IOSurfaceClient *this)

{
  ~IOSurfaceClient(this);
  _OSObject_typed_operator_delete(&IOSurfaceClient_ktv,this,0x98);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceClient::operator delete(void*, unsigned long)

void __cdecl IOSurfaceClient::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceClient_ktv,param_1,param_2);
  return;
}



// IOSurfaceClient::getMetaClass() const

undefined8 * IOSurfaceClient::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceClient::MetaClass::MetaClass()

void __thiscall IOSurfaceClient::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceClient",(OSMetaClass *)PTR_gMetaClass_00027048,0x98);
  *(undefined ***)this = &PTR__MetaClass_00028628;
  return;
}



// IOSurfaceClient::MetaClass::alloc() const

OSObject * IOSurfaceClient::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceClient_ktv,0x98);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceClient::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceClient::operator new(unsigned long)

void * __thiscall IOSurfaceClient::operator_new(IOSurfaceClient *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceClient_ktv,this);
  return pvVar1;
}



// IOSurfaceClient::IOSurfaceClient()

void __thiscall IOSurfaceClient::IOSurfaceClient(IOSurfaceClient *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceClient::IOSurfaceClient()

void __thiscall IOSurfaceClient::IOSurfaceClient(IOSurfaceClient *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceClient_000284f0;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceClient::withBuffer(IOSurfaceShared*, IOSurface*, bool)

long * __cdecl IOSurfaceClient::withBuffer(undefined8 param_1,undefined8 param_2,undefined1 param_3)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x118))(plVar2,param_1,param_2,param_3);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOSurfaceClient::init(IOSurfaceShared*, IOSurface*, bool)

undefined8 __thiscall
IOSurfaceClient::init
          (IOSurfaceClient *this,long *param_2,IOSurface *param_3,IOSurfaceClient param_4)

{
  uint uVar1;
  long *plVar2;
  undefined8 *puVar3;
  IOSurface *this_00;
  byte bVar4;
  int iVar5;
  undefined8 uVar6;
  IOSurfaceClient *pIVar7;
  ulonglong uVar8;
  long lVar9;
  ulong uVar10;
  uint uVar11;
  
  *(IOSurface **)(this + 0x40) = param_3;
  (**(code **)(*(long *)param_3 + 0x20))(param_3);
  IOSurface::clientRetain(param_3);
  *(undefined4 *)(this + 0x38) = 0;
  plVar2 = *(long **)(this + 0x10);
  *(long **)(this + 0x10) = param_2;
  if (param_2 != (long *)0x0) {
    (**(code **)(*param_2 + 0x20))(param_2);
  }
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  *(undefined8 *)(this + 0x68) = 0;
  this[0x70] = param_4;
  uVar11 = *(uint *)(param_3 + 0x10);
  *(uint *)(this + 0x38) = uVar11;
  uVar6 = IOSurfaceShared::map_surface_client_shared
                    (*(IOSurfaceShared **)(this + 0x10),(ulong)uVar11,(long *)(this + 0x58),
                     (long *)(this + 0x60));
  if ((char)uVar6 != '\0') {
    uVar10 = (ulong)*(uint *)(param_3 + 0x98);
    if (uVar10 != 0) {
      if (*(uint *)(param_3 + 0x98) < 4) {
        pIVar7 = this + 0x78;
        *(IOSurfaceClient **)(this + 0x68) = pIVar7;
      }
      else {
        pIVar7 = (IOSurfaceClient *)
                 _IOMallocTypeVarImpl
                           (&init(IOSurfaceShared*,IOSurface*,bool)::kalloc_type_view_58,uVar10 << 3
                           );
        *(IOSurfaceClient **)(this + 0x68) = pIVar7;
        if (pIVar7 == (IOSurfaceClient *)0x0) {
          return 0;
        }
        uVar10 = (ulong)*(uint *)(param_3 + 0x98);
      }
      ___bzero(pIVar7,uVar10 << 3);
    }
    lVar9 = *(long *)(this + 0x40);
    if (*(long **)(lVar9 + 0x30) == (long *)0x0) {
      uVar11 = 1;
    }
    else {
      iVar5 = (**(code **)(**(long **)(lVar9 + 0x30) + 0x1c0))();
      uVar11 = (uint)(iVar5 == 2) << 0xc | 1;
      lVar9 = *(long *)(this + 0x40);
    }
    uVar1 = *(uint *)(lVar9 + 0x9c);
    uVar8 = IOSurfaceShared::getOwningTask(*(IOSurfaceShared **)(this + 0x10));
    lVar9 = IOSurface::getProtectionOptions(*(IOSurface **)(this + 0x40));
    bVar4 = 1;
    if ((lVar9 == 0) && ((*(uint *)(*(long *)(this + 0x40) + 0x3c8) >> 0x16 & 1) == 0)) {
      bVar4 = (byte)(*(uint *)(*(long *)(this + 0x40) + 0x3c8) >> 0x18) & 1;
    }
    uVar6 = mapInTask(this,uVar8,uVar11 | uVar1,bVar4);
    if ((char)uVar6 != '\0') {
      IOSurface::lock(*(IOSurface **)(this + 0x40));
      *(undefined8 *)(this + 0x28) = 0;
      puVar3 = *(undefined8 **)(*(long *)(this + 0x40) + 0x2d8);
      *(undefined8 **)(this + 0x30) = puVar3;
      *puVar3 = this;
      this_00 = *(IOSurface **)(this + 0x40);
      *(IOSurfaceClient **)(this_00 + 0x2d8) = this + 0x28;
      uVar6 = IOSurface::unlock(this_00);
      return CONCAT71((int7)((ulong)uVar6 >> 8),1);
    }
  }
  return 0;
}



// IOSurfaceClient::mapInTask(task*, unsigned int, bool)

undefined8 __thiscall
IOSurfaceClient::mapInTask(IOSurfaceClient *this,ulonglong param_1,uint param_2,char param_3)

{
  IOSurface *this_00;
  task *ptVar1;
  long *plVar2;
  long lVar3;
  long lVar4;
  
  this_00 = *(IOSurface **)(this + 0x40);
  if (this_00 == (IOSurface *)0x0) {
    return 0;
  }
  if (param_3 == '\0') {
    lVar4 = *(long *)(this_00 + 0x150);
    if ((lVar4 == 0) || (*(ulonglong *)(this_00 + 0x170) != param_1)) {
      if (*(long *)(this + 0x48) != 0) {
        return CONCAT71((int7)((ulong)lVar4 >> 8),1);
      }
      ptVar1 = (task *)IOSurface::getMemoryDescriptor(this_00);
      if (ptVar1 != (task *)0x0) {
        plVar2 = (long *)IOMemoryDescriptor::createMappingInTask(ptVar1,param_1,0,(ulong)param_2,0);
        if (*(long **)(this + 0x48) != (long *)0x0) {
          (**(code **)(**(long **)(this + 0x48) + 0x28))();
        }
        *(long **)(this + 0x48) = plVar2;
        if (plVar2 != (long *)0x0) {
          lVar3 = (**(code **)(*plVar2 + 0x118))(plVar2);
          lVar4 = IOSurface::getClientAlignedOffset(*(IOSurface **)(this + 0x40));
          lVar4 = lVar4 + lVar3;
          goto LAB_00010448;
        }
      }
      return 0;
    }
  }
  else {
    lVar4 = 0;
  }
LAB_00010448:
  *(long *)(this + 0x50) = lVar4;
  return CONCAT71((int7)((ulong)lVar4 >> 8),1);
}



// IOSurfaceClient::free()

void __thiscall IOSurfaceClient::free(IOSurfaceClient *this)

{
  uint uVar1;
  long lVar2;
  IOSurfaceClient *pIVar3;
  bool bVar4;
  long *plVar5;
  IOSurface *this_00;
  char *pcVar6;
  
  this_00 = *(IOSurface **)(this + 0x40);
  if (this_00 == (IOSurface *)0x0) goto LAB_000105fc;
  if (*(long *)(this + 0x30) != 0) {
    IOSurface::lock(this_00);
    lVar2 = *(long *)(this + 0x28);
    if (lVar2 == 0) {
      plVar5 = *(long **)(this + 0x30);
      if ((IOSurfaceClient *)*plVar5 != this) {
LAB_00010627:
        pcVar6 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00010637:
                    // WARNING: Subroutine does not return
        _panic(pcVar6,this,0x62,"IOSurfaceClient.cpp",0x62);
      }
      *(long **)(*(long *)(this + 0x40) + 0x2d8) = plVar5;
    }
    else {
      if (*(IOSurfaceClient **)(lVar2 + 0x30) != this + 0x28) {
        pcVar6 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_00010637;
      }
      if ((IOSurfaceClient *)**(long **)(this + 0x30) != this) goto LAB_00010627;
      *(long **)(lVar2 + 0x30) = *(long **)(this + 0x30);
      plVar5 = *(long **)(this + 0x30);
    }
    *plVar5 = lVar2;
    IOSurface::unlock(*(IOSurface **)(this + 0x40));
    *(undefined8 *)(this + 0x28) = 0;
    *(undefined8 *)(this + 0x30) = 0;
    this_00 = *(IOSurface **)(this + 0x40);
    if (this_00 == (IOSurface *)0x0) goto LAB_000105fc;
  }
  uVar1 = *(uint *)(this_00 + 0x98);
  if (((ulong)uVar1 != 0) && (pIVar3 = *(IOSurfaceClient **)(this + 0x68), pIVar3 != this + 0x78)) {
    *(undefined8 *)(this + 0x68) = 0;
    _IOFreeTypeVarImpl(&free()::kalloc_type_view_106,pIVar3,(ulong)uVar1 << 3);
    *(undefined8 *)(this + 0x68) = 0;
    this_00 = *(IOSurface **)(this + 0x40);
    if (this_00 == (IOSurface *)0x0) goto LAB_000105fc;
  }
  if ((int)*(undefined8 *)(this + 0x90) != 0) {
    IOSurface::decrement_use_count_for_category(this_00,0);
  }
  if (*(ulong *)(this + 0x90) >> 0x20 != 0) {
    IOSurface::decrement_use_count_for_category(*(IOSurface **)(this + 0x40),1);
  }
  bVar4 = IOSurface::clientRelease(*(IOSurface **)(this + 0x40));
  if (bVar4) {
    IOSurface::prune_orphaned_device_caches(*(IOSurface **)(this + 0x40));
  }
  (**(code **)(**(long **)(this + 0x40) + 0x28))();
  *(undefined8 *)(this + 0x40) = 0;
LAB_000105fc:
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
                    // WARNING: Could not recover jumptable at 0x00010621. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceClient::get_client_use_count_for_category(unsigned int)

ulong __thiscall
IOSurfaceClient::get_client_use_count_for_category(IOSurfaceClient *this,uint param_1)

{
  ulong uVar1;
  
  uVar1 = 0;
  if (param_1 < 2) {
    uVar1 = *(ulong *)(this + 0x90) >> 0x20;
    if (param_1 == 0) {
      uVar1 = *(ulong *)(this + 0x90);
    }
    uVar1 = uVar1 & 0xffffffff;
  }
  return uVar1;
}



// IOSurfaceClient::unmap()

void __thiscall IOSurfaceClient::unmap(IOSurfaceClient *this)

{
  if (*(long **)(this + 0x48) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x48) + 0x28))();
  }
  *(undefined8 *)(this + 0x48) = 0;
  return;
}



// IOSurfaceClient::getLockResult(IOSurfaceLockResult*)

void __thiscall IOSurfaceClient::getLockResult(IOSurfaceClient *this,undefined8 *param_1)

{
  undefined8 *puVar1;
  int iVar2;
  IOSurface *this_00;
  byte *pbVar3;
  undefined4 uVar4;
  undefined8 uVar5;
  undefined8 *puVar6;
  ulong uVar7;
  undefined4 *puVar8;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  ulong uVar13;
  ulong uVar14;
  int iVar15;
  ulong uVar16;
  long lVar17;
  ulong uVar18;
  long lVar19;
  ulong uVar20;
  ulong uVar21;
  undefined8 *puVar22;
  uint uVar23;
  ulong uVar24;
  uint local_a8;
  ulong local_78;
  long local_68;
  undefined8 *local_60;
  
  this_00 = *(IOSurface **)(this + 0x40);
  iVar2 = *(int *)(this_00 + 0x98);
  ___bzero(param_1,0xc68);
  iVar15 = 0x14;
  if (*(uint *)(this_00 + 0x98) < 0x15) {
    iVar15 = iVar2;
  }
  *(undefined4 *)(param_1 + 3) = *(undefined4 *)(this + 0x38);
  *param_1 = *(undefined8 *)(this + 0x50);
  uVar5 = *(undefined8 *)(this_00 + 0x90);
  param_1[4] = uVar5;
  param_1[5] = *(undefined8 *)(this_00 + 0x58);
  param_1[6] = *(undefined8 *)(this_00 + 0x60);
  *(undefined4 *)(param_1 + 9) = *(undefined4 *)(this_00 + 0x80);
  param_1[7] = *(undefined8 *)(this_00 + 0x68);
  *(undefined2 *)(param_1 + 0xc) = *(undefined2 *)(this_00 + 0x70);
  *(IOSurface *)((long)param_1 + 0x62) = this_00[0x72];
  *(IOSurface *)((long)param_1 + 99) = this_00[0x73];
  param_1[10] = uVar5;
  lVar17 = *(long *)(this_00 + 0x178);
  *(undefined4 *)(param_1 + 0xd) = *(undefined4 *)(lVar17 + 0xc);
  *(uint *)((long)param_1 + 0x5c) = (uint)*(byte *)(lVar17 + 0x6a);
  *(undefined4 *)((long)param_1 + 100) = *(undefined4 *)(this_00 + 0x9c);
  *(int *)(param_1 + 0xb) = iVar15;
  param_1[1] = *(undefined8 *)(this + 0x58);
  param_1[2] = *(undefined8 *)(this + 0x60);
  *(IOSurface *)((long)param_1 + 0x6c) = this_00[0x3b0];
  if (*(long *)(this_00 + 0x358) == 0) {
    uVar4 = 0;
  }
  else {
    uVar4 = *(undefined4 *)(*(long *)(this_00 + 0x358) + 0x10);
  }
  *(undefined4 *)(param_1 + 0xe) = uVar4;
  param_1[0xf] = *(undefined8 *)(this_00 + 0x360);
  *(byte *)((long)param_1 + 0x6d) = (byte)(*(uint *)(this_00 + 0x3c8) >> 0x15) & 1;
  uVar5 = IOSurface::getProtectionOptions(this_00);
  param_1[0x10] = uVar5;
  param_1[8] = *(undefined8 *)(this_00 + 0x78);
  puVar1 = param_1 + 0x11;
  if (iVar15 == 0) {
    pbVar3 = *(byte **)(this_00 + 0x2f8);
    uVar9 = (long)(pbVar3 + (ulong)*(uint *)(this_00 + 0x300) * 0x18) - (long)pbVar3;
    if ((pbVar3 <= pbVar3 + (ulong)*(uint *)(this_00 + 0x300) * 0x18) && (uVar9 >> 0x20 == 0)) {
      if (0x17 < (uint)uVar9) {
        fillAdditionalPlaneInfo((long)puVar1,(long)pbVar3,(uint)*pbVar3);
        puVar8 = *(undefined4 **)(this_00 + 0x330);
        uVar9 = (long)(puVar8 + (ulong)*(uint *)(this_00 + 0x338) * 8) - (long)puVar8;
        if ((puVar8 + (ulong)*(uint *)(this_00 + 0x338) * 8 < puVar8) || (uVar9 >> 0x20 != 0))
        goto LAB_00010dff;
        if ((uVar9 & 0xffffffe0) != 0) {
          *(undefined4 *)(param_1 + 0x23) = puVar8[2];
          *(undefined4 *)(param_1 + 0x22) = *puVar8;
          *(undefined4 *)((long)param_1 + 0x11c) = puVar8[3];
          *(undefined4 *)((long)param_1 + 0x114) = puVar8[1];
          return;
        }
      }
LAB_00010de7:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
  }
  else {
    uVar9 = (long)(param_1 + 0x18d) - (long)puVar1;
    uVar20 = 0;
    local_78 = 0xffffffff7fffffc8;
    uVar21 = 0xffffffff80000000;
    uVar13 = 0;
    uVar16 = 0;
    local_68 = 0;
    uVar14 = 0;
    lVar17 = 0;
    uVar24 = 0;
    lVar19 = 0;
    uVar18 = 0;
    local_60 = puVar1;
    while( true ) {
      uVar12 = *(ulong *)(this_00 + 0x180);
      uVar10 = (ulong)*(uint *)(this_00 + 0x188) * 0x38 + uVar12;
      uVar11 = uVar10 - uVar12;
      if ((uVar10 < uVar12) || (uVar11 >> 0x20 != 0)) break;
      local_78 = local_78 + 0x38;
      if (local_78 < 0xffffffff00000000) {
LAB_00010e0b:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                  );
      }
      if ((long)uVar20 < 0) goto LAB_00010de7;
      uVar10 = uVar20 >> 0x20;
      uVar23 = (int)(uVar20 >> 0x20) + 0x38;
      if ((uint)uVar11 < uVar23) goto LAB_00010de7;
      puVar6 = (undefined8 *)(uVar12 + uVar10);
      uVar11 = -(ulong)CARRY8(uVar12,uVar10);
      if ((CARRY8(uVar12,uVar10) != uVar11) || ((long)uVar11 < 0)) goto LAB_00010df3;
      if (uVar9 >> 0x20 != 0 || param_1 + 0x18d < puVar1) break;
      if (uVar21 < 0xffffffff00000000) goto LAB_00010e0b;
      if ((long)uVar13 < 0) goto LAB_00010de7;
      local_a8 = (uint)uVar9;
      if (local_a8 < (int)(uVar13 >> 0x20) + 0x98U) goto LAB_00010de7;
      puVar22 = (undefined8 *)((uVar13 >> 0x20) + (long)puVar1);
      uVar11 = (ulong)CARRY8(uVar13 >> 0x20,(ulong)puVar1);
      uVar12 = -uVar11;
      if ((uVar11 != uVar12) || ((long)uVar12 < 0)) {
LAB_00010df3:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                  );
      }
      *puVar22 = *puVar6;
      puVar22[1] = puVar6[1];
      puVar22[2] = puVar6[2];
      puVar22[3] = puVar6[3];
      puVar22[4] = puVar6[4];
      *(undefined2 *)(puVar22 + 6) = *(undefined2 *)(puVar6 + 6);
      *(undefined1 *)((long)puVar22 + 0x32) = *(undefined1 *)((long)puVar6 + 0x34);
      *(undefined1 *)((long)puVar22 + 0x33) = *(undefined1 *)((long)puVar6 + 0x35);
      puVar22[5] = puVar6[5];
      *(undefined2 *)((long)puVar22 + 0x35) = 0;
      *(undefined1 *)((long)puVar22 + 0x37) = 0;
      if (uVar18 < *(ulong *)(this_00 + 0x308)) {
        uVar11 = *(ulong *)(this_00 + 0x2f8);
        uVar12 = uVar11 + (ulong)*(uint *)(this_00 + 0x300) * 0x18;
        uVar7 = uVar12 - uVar11;
        if ((uVar12 < uVar11) || (uVar7 >> 0x20 != 0)) break;
        if (uVar24 - 0x80000000 < 0xffffffff00000000) goto LAB_00010e0b;
        if ((lVar19 < 0) || ((uint)uVar7 < (int)uVar24 + 0x18U)) goto LAB_00010de7;
        uVar12 = -(ulong)CARRY8(uVar11,uVar24);
        if ((CARRY8(uVar11,uVar24) != uVar12) || ((long)uVar12 < 0)) goto LAB_00010df3;
        fillAdditionalPlaneInfo
                  ((long)local_60,(long)(uVar11 + uVar24),(uint)*(byte *)(uVar11 + uVar24));
      }
      uVar12 = *(ulong *)(this_00 + 0x180);
      uVar11 = (ulong)*(uint *)(this_00 + 0x188) * 0x38 + uVar12;
      uVar7 = uVar11 - uVar12;
      if ((uVar11 < uVar12) || (uVar7 >> 0x20 != 0)) break;
      if ((uint)uVar7 < uVar23) goto LAB_00010de7;
      uVar11 = -(ulong)CARRY8(uVar12,uVar10);
      if ((CARRY8(uVar12,uVar10) != uVar11) || ((long)uVar11 < 0)) goto LAB_00010df3;
      *(undefined1 *)((long)puVar22 + 0x35) = *(undefined1 *)(uVar12 + uVar10 + 0x36);
      uVar12 = *(ulong *)(this_00 + 0x2e8);
      if (uVar12 == 0) {
        uVar4 = 0;
        *(undefined8 *)((long)puVar22 + 0x7c) = 0;
        *(undefined8 *)((long)puVar22 + 0x74) = 0;
        *(undefined8 *)((long)puVar22 + 0x6c) = 0;
        *(undefined8 *)((long)puVar22 + 100) = 0;
        *(undefined8 *)((long)puVar22 + 0x5c) = 0;
        *(undefined8 *)((long)puVar22 + 0x54) = 0;
        *(undefined8 *)((long)puVar22 + 0x4c) = 0;
        *(undefined4 *)((long)puVar22 + 0x84) = 0;
      }
      else {
        uVar10 = (ulong)*(uint *)(this_00 + 0x2f0) * 0x3c + uVar12;
        uVar11 = uVar10 - uVar12;
        if ((uVar10 < uVar12) || (uVar11 >> 0x20 != 0)) break;
        if (uVar16 - 0x80000000 < 0xffffffff00000000) goto LAB_00010e0b;
        if ((local_68 < 0) || ((uint)uVar11 < (int)uVar16 + 0x3cU)) goto LAB_00010de7;
        puVar6 = (undefined8 *)(uVar12 + uVar16);
        uVar10 = -(ulong)CARRY8(uVar12,uVar16);
        if ((CARRY8(uVar12,uVar16) != uVar10) || ((long)uVar10 < 0)) goto LAB_00010df3;
        *(undefined4 *)((long)puVar22 + 0x84) = *(undefined4 *)(puVar6 + 7);
        *(undefined8 *)((long)puVar22 + 0x7c) = puVar6[6];
        *(undefined8 *)((long)puVar22 + 0x74) = puVar6[5];
        *(undefined8 *)((long)puVar22 + 0x6c) = puVar6[4];
        *(undefined8 *)((long)puVar22 + 100) = puVar6[3];
        *(undefined8 *)((long)puVar22 + 0x5c) = puVar6[2];
        uVar5 = *puVar6;
        *(undefined8 *)((long)puVar22 + 0x54) = puVar6[1];
        *(undefined8 *)((long)puVar22 + 0x4c) = uVar5;
        uVar4 = *(undefined4 *)(this_00 + 0x3bc);
      }
      *(undefined4 *)((long)param_1 + 0x74) = uVar4;
      if (uVar18 < *(ulong *)(this_00 + 0x328) >> 5) {
        uVar12 = *(ulong *)(this_00 + 0x330);
        uVar10 = (ulong)*(uint *)(this_00 + 0x338) * 0x20 + uVar12;
        uVar11 = uVar10 - uVar12;
        if ((uVar10 < uVar12) || (uVar11 >> 0x20 != 0)) break;
        if (uVar14 - 0x80000000 < 0xffffffff00000000) goto LAB_00010e0b;
        if ((lVar17 < 0) || ((uint)uVar11 < (int)uVar14 + 0x20U)) goto LAB_00010de7;
        puVar8 = (undefined4 *)(uVar12 + uVar14);
        uVar10 = -(ulong)CARRY8(uVar12,uVar14);
        if ((CARRY8(uVar12,uVar14) != uVar10) || ((long)uVar10 < 0)) goto LAB_00010df3;
        *(undefined4 *)(puVar22 + 0x12) = puVar8[2];
        *(undefined4 *)(puVar22 + 0x11) = *puVar8;
        *(undefined4 *)((long)puVar22 + 0x94) = puVar8[3];
        *(undefined4 *)((long)puVar22 + 0x8c) = puVar8[1];
      }
      uVar18 = uVar18 + 1;
      lVar19 = lVar19 + 0x1800000000;
      uVar24 = uVar24 + 0x18;
      lVar17 = lVar17 + 0x2000000000;
      uVar14 = uVar14 + 0x20;
      local_68 = local_68 + 0x3c00000000;
      uVar16 = uVar16 + 0x3c;
      uVar13 = uVar13 + 0x9800000000;
      uVar20 = uVar20 + 0x3800000000;
      uVar21 = uVar21 + 0x98;
      local_60 = local_60 + 0x13;
      if (iVar15 == (int)uVar18) {
        return;
      }
    }
  }
LAB_00010dff:
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
            );
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// fillAdditionalPlaneInfo(IOSurfaceLockResultPlaneInfo*, IOSurfaceAdditionalPlaneInfo*, unsigned
// int)

void __cdecl fillAdditionalPlaneInfo(long param_1,long param_2,uint param_3)

{
  uint uVar1;
  ulong uVar2;
  
  uVar1 = 4;
  if (param_3 < 4) {
    uVar1 = param_3;
  }
  *(char *)(param_1 + 0x34) = (char)uVar1;
  if (uVar1 == 0) {
    uVar1 = 0;
  }
  else {
    uVar2 = 0;
    do {
      *(undefined1 *)(param_1 + 0x38 + uVar2) = *(undefined1 *)(param_2 + 4 + uVar2);
      *(undefined1 *)(param_1 + 0x3c + uVar2) = *(undefined1 *)(param_2 + 8 + uVar2);
      *(undefined1 *)(param_1 + 0x40 + uVar2) = *(undefined1 *)(param_2 + 0xc + uVar2);
      *(undefined1 *)(param_1 + 0x44 + uVar2) = *(undefined1 *)(param_2 + 0x10 + uVar2);
      *(undefined1 *)(param_1 + 0x48 + uVar2) = *(undefined1 *)(param_2 + 0x14 + uVar2);
      uVar2 = uVar2 + 1;
    } while (uVar1 != uVar2);
    if (3 < param_3) {
      return;
    }
  }
  uVar2 = (ulong)uVar1;
  do {
    *(undefined1 *)(param_1 + 0x38 + uVar2) = 0;
    *(undefined1 *)(param_1 + 0x3c + uVar2) = 0;
    *(undefined1 *)(param_1 + 0x40 + uVar2) = 0;
    *(undefined1 *)(param_1 + 0x44 + uVar2) = 0;
    *(undefined1 *)(param_1 + 0x48 + uVar2) = 0;
    uVar2 = uVar2 + 1;
  } while (uVar2 != 4);
  return;
}



// IOSurfaceClient::write_debug_info(OSDictionary*)

void __thiscall IOSurfaceClient::write_debug_info(IOSurfaceClient *this,long *param_1)

{
  IOSurface::write_debug_info(*(IOSurface **)(this + 0x40),param_1);
  return;
}



// IOSurfaceClient::write_debug_info_with_options(OSDictionary*, unsigned int)

void __thiscall
IOSurfaceClient::write_debug_info_with_options(IOSurfaceClient *this,long *param_1,int param_2)

{
  long *plVar1;
  long *plVar2;
  
  IOSurface::write_debug_info_with_options
            (*(IOSurface **)(this + 0x40),param_1,param_2,*(undefined8 *)(this + 0x50));
  plVar1 = (long *)OSNumber::withNumber(*(ulong *)(this + 0x90) & 0xffffffff,0x20);
  (**(code **)(*param_1 + 0x1d0))(param_1,"UseCount",plVar1);
  plVar2 = (long *)OSNumber::withNumber(*(ulong *)(this + 0x90) >> 0x20,0x20);
  (**(code **)(*param_1 + 0x1d0))(param_1,"UseCount1",plVar2);
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x00010f40. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurfaceClient::increment_use_count_for_category(unsigned int)

undefined8 __thiscall
IOSurfaceClient::increment_use_count_for_category(IOSurfaceClient *this,uint param_1)

{
  ulong uVar1;
  ulong uVar2;
  int iVar3;
  ulong uVar4;
  bool bVar5;
  
  if (param_1 < 2) {
    do {
      uVar1 = *(ulong *)(this + 0x90);
      if (param_1 == 0) {
        iVar3 = (int)uVar1;
        uVar4 = (ulong)(iVar3 + 1);
        if (iVar3 == -1) {
          uVar4 = 0xffffffff;
        }
        uVar4 = uVar4 | uVar1 & 0xffffffff00000000;
      }
      else {
        iVar3 = (int)(uVar1 >> 0x20);
        uVar4 = (uVar1 & 0xffffffff00000000) + 0x100000000;
        if (iVar3 == -1) {
          uVar4 = 0xffffffff00000000;
        }
        uVar4 = uVar4 | uVar1 & 0xffffffff;
      }
      LOCK();
      uVar2 = *(ulong *)(this + 0x90);
      bVar5 = uVar1 == uVar2;
      if (bVar5) {
        *(ulong *)(this + 0x90) = uVar4;
        uVar2 = uVar1;
      }
      UNLOCK();
    } while (!bVar5);
    return CONCAT71((int7)(uVar2 >> 8),iVar3 == 0);
  }
  return 0;
}



// IOSurfaceClient::decrement_use_count_for_category(unsigned int)

undefined8 __thiscall
IOSurfaceClient::decrement_use_count_for_category(IOSurfaceClient *this,uint param_1)

{
  ulong uVar1;
  int iVar2;
  ulong uVar3;
  ulong uVar4;
  bool bVar5;
  
  if (param_1 < 2) {
    do {
      uVar1 = *(ulong *)(this + 0x90);
      iVar2 = (int)uVar1;
      if (param_1 == 0) {
        uVar4 = (ulong)(iVar2 - 1);
        if (iVar2 == 0) {
          uVar4 = 0;
        }
        uVar4 = uVar4 | uVar1 & 0xffffffff00000000;
      }
      else {
        iVar2 = (int)(uVar1 >> 0x20);
        uVar4 = (uVar1 & 0xffffffff00000000) - 0x100000000;
        if (uVar1 >> 0x20 == 0) {
          uVar4 = 0;
        }
        uVar4 = uVar4 | uVar1 & 0xffffffff;
      }
      LOCK();
      uVar3 = *(ulong *)(this + 0x90);
      bVar5 = uVar1 == uVar3;
      if (bVar5) {
        *(ulong *)(this + 0x90) = uVar4;
        uVar3 = uVar1;
      }
      UNLOCK();
    } while (!bVar5);
    return CONCAT71((int7)(uVar3 >> 8),iVar2 == 1);
  }
  return 0;
}



// IOSurfaceClient::MetaClass::~MetaClass()

void __thiscall IOSurfaceClient::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



void __GLOBAL__sub_I_IOSurfaceClient_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceClient::gMetaClass,"IOSurfaceClient",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x98);
  IOSurfaceClient::gMetaClass = &PTR__MetaClass_00028628;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceClient::gMetaClass);
  return;
}



// IOSurfaceMemoryTag::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryTag::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryTag",(OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  *(undefined ***)this = &PTR__MetaClass_00028858;
  return;
}



// IOSurfaceMemoryTag::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryTag::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryTag::IOSurfaceMemoryTag(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryTag::IOSurfaceMemoryTag(IOSurfaceMemoryTag *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceMemoryTag::IOSurfaceMemoryTag(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryTag::IOSurfaceMemoryTag(IOSurfaceMemoryTag *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceMemoryTag::~IOSurfaceMemoryTag()

void __thiscall IOSurfaceMemoryTag::~IOSurfaceMemoryTag(IOSurfaceMemoryTag *this)

{
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryTag::~IOSurfaceMemoryTag()

void __thiscall IOSurfaceMemoryTag::~IOSurfaceMemoryTag(IOSurfaceMemoryTag *this)

{
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryTag::~IOSurfaceMemoryTag()

void __thiscall IOSurfaceMemoryTag::~IOSurfaceMemoryTag(IOSurfaceMemoryTag *this)

{
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceMemoryTag_ktv,this,0x38);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryTag::operator delete(void*, unsigned long)

void __cdecl IOSurfaceMemoryTag::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceMemoryTag_ktv,param_1,param_2);
  return;
}



// IOSurfaceMemoryTag::getMetaClass() const

undefined8 * IOSurfaceMemoryTag::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceMemoryTag::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryTag::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryTag",(OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  *(undefined ***)this = &PTR__MetaClass_00028858;
  return;
}



// IOSurfaceMemoryTag::MetaClass::alloc() const

OSObject * IOSurfaceMemoryTag::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceMemoryTag_ktv,0x38);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceMemoryTag::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceMemoryTag::operator new(unsigned long)

void * __thiscall IOSurfaceMemoryTag::operator_new(IOSurfaceMemoryTag *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceMemoryTag_ktv,this);
  return pvVar1;
}



// IOSurfaceMemoryTag::IOSurfaceMemoryTag()

void __thiscall IOSurfaceMemoryTag::IOSurfaceMemoryTag(IOSurfaceMemoryTag *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryTag::IOSurfaceMemoryTag()

void __thiscall IOSurfaceMemoryTag::IOSurfaceMemoryTag(IOSurfaceMemoryTag *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryTag_00028720;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryTag::__OSFinalClass()

void IOSurfaceMemoryTag::__OSFinalClass(void)

{
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryTag::withSurface(IOSurface*)

long * __cdecl IOSurfaceMemoryTag::withSurface(undefined8 param_1)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x118))(plVar2,param_1);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOSurfaceMemoryTag::init(IOSurface*)

undefined1 __thiscall IOSurfaceMemoryTag::init(IOSurfaceMemoryTag *this,IOSurface *param_1)

{
  char cVar1;
  undefined1 uVar2;
  undefined4 uVar3;
  undefined8 in_RAX;
  undefined8 uVar4;
  OSMetaClassBase *pOVar5;
  long lVar6;
  OSMetaClassBase *pOVar7;
  undefined8 local_38;
  
  local_38 = in_RAX;
  cVar1 = (**(code **)(PTR_vtable_00027078 + 0x98))();
  uVar2 = 0;
  if (cVar1 != '\0') {
    local_38 = CONCAT17(cVar1,(undefined7)local_38);
    uVar3 = IOSurface::getPixelFormat(param_1);
    *(undefined4 *)(this + 0xc) = uVar3;
    uVar4 = IOSurface::getAllocSize(param_1);
    *(int *)(this + 0x30) = (int)uVar4;
    uVar4 = IOSurface::getWidth(param_1);
    *(short *)(this + 0x34) = (short)uVar4;
    uVar4 = IOSurface::getHeight(param_1);
    *(short *)(this + 0x36) = (short)uVar4;
    local_38 = CONCAT44(local_38._4_4_,0xaaaaaaaa);
    pOVar5 = IOSurface::copy_value(param_1,"IOSurfaceName",(undefined4 *)&local_38);
    lVar6 = OSMetaClassBase::safeMetaCast(pOVar5,*(OSMetaClass **)PTR_metaClass_00027058);
    pOVar7 = (OSMetaClassBase *)0x0;
    if (lVar6 == 0) {
      pOVar7 = pOVar5;
    }
    if (*(long **)(this + 0x20) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x20) + 0x28))();
    }
    *(long *)(this + 0x20) = lVar6;
    if (pOVar7 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)pOVar7 + 0x28))(pOVar7);
    }
    uVar4 = IOSurface::getMemoryDescriptor(param_1);
    *(undefined8 *)(this + 0x28) = uVar4;
    IOSurfaceRoot::add_memory_tag(_gIOSurfaceRoot,(long)this);
    uVar2 = local_38._7_1_;
  }
  return uVar2;
}



// IOSurfaceMemoryTag::free()

void __thiscall IOSurfaceMemoryTag::free(IOSurfaceMemoryTag *this)

{
  if ((*(long *)(this + 0x10) != 0) || (*(long *)(this + 0x18) != 0)) {
    IOSurfaceRoot::remove_memory_tag(_gIOSurfaceRoot,(long)this);
  }
                    // WARNING: Could not recover jumptable at 0x00011480. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceMemoryTag::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryTag::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceMemoryTag_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceMemoryTag::gMetaClass,"IOSurfaceMemoryTag",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x38);
  IOSurfaceMemoryTag::gMetaClass = &PTR__MetaClass_00028858;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceMemoryTag::gMetaClass);
  return;
}



// IOSurfaceDeviceCache::MetaClass::MetaClass()

void __thiscall IOSurfaceDeviceCache::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDeviceCache",(OSMetaClass *)PTR_gMetaClass_00027048,0x68)
  ;
  *(undefined ***)this = &PTR__MetaClass_00028ac0;
  return;
}



// IOSurfaceDeviceCache::MetaClass::~MetaClass()

void __thiscall IOSurfaceDeviceCache::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDeviceCache::IOSurfaceDeviceCache(OSMetaClass const*)

void __thiscall
IOSurfaceDeviceCache::IOSurfaceDeviceCache(IOSurfaceDeviceCache *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDeviceCache_00028950;
  return;
}



// IOSurfaceDeviceCache::IOSurfaceDeviceCache(OSMetaClass const*)

void __thiscall
IOSurfaceDeviceCache::IOSurfaceDeviceCache(IOSurfaceDeviceCache *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDeviceCache_00028950;
  return;
}



// IOSurfaceDeviceCache::~IOSurfaceDeviceCache()

void __thiscall IOSurfaceDeviceCache::~IOSurfaceDeviceCache(IOSurfaceDeviceCache *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDeviceCache::~IOSurfaceDeviceCache()

void __thiscall IOSurfaceDeviceCache::~IOSurfaceDeviceCache(IOSurfaceDeviceCache *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDeviceCache::~IOSurfaceDeviceCache()

void __thiscall IOSurfaceDeviceCache::~IOSurfaceDeviceCache(IOSurfaceDeviceCache *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceDeviceCache_ktv,this,0x68);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDeviceCache::operator delete(void*, unsigned long)

void __cdecl IOSurfaceDeviceCache::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceDeviceCache_ktv,param_1,param_2);
  return;
}



// IOSurfaceDeviceCache::getMetaClass() const

undefined8 * IOSurfaceDeviceCache::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceDeviceCache::MetaClass::MetaClass()

void __thiscall IOSurfaceDeviceCache::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDeviceCache",(OSMetaClass *)PTR_gMetaClass_00027048,0x68)
  ;
  *(undefined ***)this = &PTR__MetaClass_00028ac0;
  return;
}



// IOSurfaceDeviceCache::MetaClass::alloc() const

OSObject * IOSurfaceDeviceCache::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceDeviceCache_ktv,0x68);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceDeviceCache::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceCache_00028950;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceDeviceCache::operator new(unsigned long)

void * __thiscall IOSurfaceDeviceCache::operator_new(IOSurfaceDeviceCache *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceDeviceCache_ktv,this);
  return pvVar1;
}



// IOSurfaceDeviceCache::IOSurfaceDeviceCache()

void __thiscall IOSurfaceDeviceCache::IOSurfaceDeviceCache(IOSurfaceDeviceCache *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceCache_00028950;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDeviceCache::IOSurfaceDeviceCache()

void __thiscall IOSurfaceDeviceCache::IOSurfaceDeviceCache(IOSurfaceDeviceCache *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceCache_00028950;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDeviceCache::withSurfaceBufferOnAccelerator(IOSurface*, void*, unsigned int, unsigned
// int, IOSurfaceDeviceCacheList*)

long * __cdecl
IOSurfaceDeviceCache::withSurfaceBufferOnAccelerator
          (undefined8 param_1,undefined8 param_2,undefined4 param_3,undefined4 param_4,
          undefined8 param_5)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x118))(plVar2,param_1,param_2,param_3,param_4,0,0,param_5);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDeviceCache::withSurfaceBufferOnAcceleratorPlane(IOSurface*, void*, unsigned int,
// unsigned int, unsigned int, IOSurfaceDeviceCacheList*)

long * __cdecl
IOSurfaceDeviceCache::withSurfaceBufferOnAcceleratorPlane
          (undefined8 param_1,undefined8 param_2,undefined4 param_3,undefined4 param_4,
          undefined4 param_5,undefined8 param_6)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x118))(plVar2,param_1,param_2,param_3,param_4,param_5,1,param_6)
    ;
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOSurfaceDeviceCache::init(IOSurface*, void*, unsigned int, unsigned int, unsigned int, bool,
// IOSurfaceDeviceCacheList*)

undefined8 __thiscall
IOSurfaceDeviceCache::init
          (IOSurfaceDeviceCache *this,long *param_1,OSMetaClassBase *param_2,undefined4 param_3,
          undefined4 param_4,undefined8 param_6_00,undefined8 param_6,undefined8 param_7)

{
  int iVar1;
  long lVar2;
  undefined8 uVar3;
  
  *(long **)(this + 0x10) = param_1;
  (**(code **)(*param_1 + 0x20))(param_1);
  *(OSMetaClassBase **)(this + 0x18) = param_2;
  lVar2 = OSMetaClassBase::safeMetaCast(param_2,*(OSMetaClass **)PTR_metaClass_00027018);
  if (lVar2 != 0) {
    uVar3 = IORegistryEntry::getRegistryEntryID();
    *(undefined8 *)(this + 0x60) = uVar3;
  }
  *(undefined4 *)(this + 0x48) = param_3;
  *(undefined8 *)(this + 0x40) = param_7;
  *(undefined8 *)(this + 0x20) = 0;
  this[0x58] = (IOSurfaceDeviceCache)0x0;
  *(undefined4 *)(this + 0x4c) = 0;
  *(undefined4 *)(this + 0x54) = param_4;
  *(undefined2 *)(this + 0x59) = 0;
  iVar1 = IOSurface::getUnlockSeed(*(IOSurface **)(this + 0x10));
  *(int *)(this + 0x50) = iVar1 + -1;
  return CONCAT71((uint7)(uint3)((uint)(iVar1 + -1) >> 8),1);
}



// IOSurfaceDeviceCache::release()

void __thiscall IOSurfaceDeviceCache::release(IOSurfaceDeviceCache *this)

{
                    // WARNING: Could not recover jumptable at 0x00011846. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x28))();
  return;
}



// IOSurfaceDeviceCache::release() const

void __thiscall IOSurfaceDeviceCache::release(IOSurfaceDeviceCache *this)

{
  IOSurface *this_00;
  int iVar1;
  undefined8 *puVar2;
  
  this_00 = *(IOSurface **)(this + 0x10);
  if (this_00 != (IOSurface *)0x0) {
    (**(code **)(*(long *)this_00 + 0x20))(this_00);
  }
  IOSurface::lock(this_00);
  puVar2 = (undefined8 *)(PTR_vtable_00027078 + 0x38);
  if ((this[0x5a] != (IOSurfaceDeviceCache)0x0) && (this[0x59] == (IOSurfaceDeviceCache)0x0)) {
    iVar1 = IOSurface::getClientRetainCount(this_00);
    if (iVar1 != 0) {
      iVar1 = (**(code **)(*(long *)this + 0x18))(this);
      if (iVar1 == 1) {
        IOSurface::orphan_device_cache(*(undefined8 *)(this + 0x10),(long)this);
        this = *(IOSurfaceDeviceCache **)(this + 0x10);
        puVar2 = (undefined8 *)(*(long *)this + 0x28);
      }
    }
  }
  (*(code *)*puVar2)(this);
  IOSurface::unlock(this_00);
  if (this_00 != (IOSurface *)0x0) {
                    // WARNING: Could not recover jumptable at 0x000118ad. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::free()

void __thiscall IOSurfaceDeviceCache::free(IOSurfaceDeviceCache *this)

{
  if (*(long *)(this + 0x10) != 0) {
    if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
       (*(long *)(this + 0x20) != 0)) {
      (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,4,0,0);
    }
    if (this[0x59] == (IOSurfaceDeviceCache)0x0) {
      IOSurface::remove_device_cache(*(IOSurface **)(this + 0x10),(long)this);
      (**(code **)(**(long **)(this + 0x10) + 0x28))();
    }
  }
                    // WARNING: Could not recover jumptable at 0x00011952. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceDeviceCache::pageOff()

void __thiscall IOSurfaceDeviceCache::pageOff(IOSurfaceDeviceCache *this)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x00011980. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,0,0,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::wait()

void __thiscall IOSurfaceDeviceCache::wait(IOSurfaceDeviceCache *this)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x000119af. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,2,0,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::wait(bool)

void __thiscall IOSurfaceDeviceCache::wait(IOSurfaceDeviceCache *this,undefined1 param_1)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x000119e4. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,2,param_1,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::accelRelease()

void __thiscall IOSurfaceDeviceCache::accelRelease(IOSurfaceDeviceCache *this)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x00011a15. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,3,0,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::purge()

void __thiscall IOSurfaceDeviceCache::purge(IOSurfaceDeviceCache *this)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x00011a45. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,5,0,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::unpurge(bool)

bool __thiscall IOSurfaceDeviceCache::unpurge(IOSurfaceDeviceCache *this,undefined1 param_1)

{
  ulong in_RAX;
  bool bVar1;
  undefined8 uStack_18;
  
  uStack_18 = in_RAX & 0xffffffffffffff;
  if (((*(long *)(this + 0x18) == 0) || (*(code **)(this + 0x28) == (code *)0x0)) ||
     (*(long *)(this + 0x20) == 0)) {
    bVar1 = false;
  }
  else {
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,6,param_1,(long)&uStack_18 + 7);
    bVar1 = uStack_18._7_1_ != '\0';
  }
  return bVar1;
}



// IOSurfaceDeviceCache::testpurgeable()

bool __thiscall IOSurfaceDeviceCache::testpurgeable(IOSurfaceDeviceCache *this)

{
  ulong in_RAX;
  bool bVar1;
  undefined8 uStack_18;
  
  uStack_18 = in_RAX & 0xffffffffffffff;
  if (((*(long *)(this + 0x18) == 0) || (*(code **)(this + 0x28) == (code *)0x0)) ||
     (*(long *)(this + 0x20) == 0)) {
    bVar1 = false;
  }
  else {
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,8,0,(long)&uStack_18 + 7);
    bVar1 = uStack_18._7_1_ != '\0';
  }
  return bVar1;
}



// IOSurfaceDeviceCache::setPurgeable(unsigned int)

void __thiscall IOSurfaceDeviceCache::setPurgeable(IOSurfaceDeviceCache *this,undefined4 param_1)

{
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
                    // WARNING: Could not recover jumptable at 0x00011b0e. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,7,param_1,0);
    return;
  }
  return;
}



// IOSurfaceDeviceCache::signalEventOperation(unsigned long long, IOSurfaceSharedEvent*, unsigned
// long long)

ulong __thiscall
IOSurfaceDeviceCache::signalEventOperation
          (IOSurfaceDeviceCache *this,undefined8 param_1,undefined8 param_2,undefined8 param_3)

{
  ulong uVar1;
  undefined8 local_30;
  undefined8 local_28;
  undefined8 local_20;
  ulong local_18;
  
  local_18 = 0xaaaaaaaae00002c7;
  uVar1 = 0xe00002c7;
  if (((*(long *)(this + 0x18) != 0) && (*(code **)(this + 0x28) != (code *)0x0)) &&
     (*(long *)(this + 0x20) != 0)) {
    local_30 = param_1;
    local_28 = param_3;
    local_20 = param_2;
    (**(code **)(this + 0x28))(*(long *)(this + 0x18),this,9,&local_30,0);
    uVar1 = local_18 & 0xffffffff;
  }
  return uVar1;
}



// IOSurfaceDeviceCache::setControlFunc(void*, void (*)(void*, IOSurfaceDeviceCache*, unsigned int,
// unsigned long long, unsigned long long))

void __thiscall
IOSurfaceDeviceCache::setControlFunc
          (IOSurfaceDeviceCache *this,undefined8 param_1,undefined8 param_2)

{
  *(undefined8 *)(this + 0x20) = param_1;
  *(undefined8 *)(this + 0x28) = param_2;
  return;
}



// IOSurfaceDeviceCache::flushSurfaceProcessorCaches()

void __thiscall IOSurfaceDeviceCache::flushSurfaceProcessorCaches(IOSurfaceDeviceCache *this)

{
  IOSurface::flushProcessorCaches(*(IOSurface **)(this + 0x10));
  return;
}



// IOSurfaceDeviceCache::setCurrent()

void __thiscall IOSurfaceDeviceCache::setCurrent(IOSurfaceDeviceCache *this)

{
  int iVar1;
  
  iVar1 = IOSurface::set_current_device_cache(*(IOSurface **)(this + 0x10),(long)this);
  *(int *)(this + 0x50) = iVar1;
  return;
}



// IOSurfaceDeviceCache::processorDataUpdated(bool)

void __thiscall IOSurfaceDeviceCache::processorDataUpdated(IOSurfaceDeviceCache *this,uint param_1)

{
  IOSurface::processorDataUpdated(*(IOSurface **)(this + 0x10),param_1,0);
  if (param_1 != 0) {
    IOSurface::flushProcessorCaches(*(IOSurface **)(this + 0x10));
    return;
  }
  return;
}



// IOSurfaceDeviceCache::sync()

undefined4 __thiscall IOSurfaceDeviceCache::sync(IOSurfaceDeviceCache *this)

{
  int iVar1;
  int iVar2;
  IOSurfaceDeviceCache *pIVar3;
  
  iVar2 = IOSurface::getUnlockSeed(*(IOSurface **)(this + 0x10));
  pIVar3 = (IOSurfaceDeviceCache *)IOSurface::getCurrentDeviceCache(*(IOSurface **)(this + 0x10));
  iVar2 = iVar2 - (uint)(pIVar3 != this && pIVar3 != (IOSurfaceDeviceCache *)0x0);
  iVar1 = *(int *)(this + 0x50);
  if (iVar2 != iVar1) {
    *(int *)(this + 0x50) = iVar2;
  }
  return CONCAT31((int3)((uint)iVar1 >> 8),iVar2 != iVar1);
}



// IOSurfaceDeviceCache::dataValid()

void __thiscall IOSurfaceDeviceCache::dataValid(IOSurfaceDeviceCache *this)

{
  IOSurface::isDataValid(*(IOSurface **)(this + 0x10));
  return;
}



// IOSurfaceDeviceCache::MetaClass::~MetaClass()

void __thiscall IOSurfaceDeviceCache::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceDeviceCache_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceDeviceCache::gMetaClass,"IOSurfaceDeviceCache",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x68);
  IOSurfaceDeviceCache::gMetaClass = &PTR__MetaClass_00028ac0;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceDeviceCache::gMetaClass);
  return;
}



// IOSurfaceDescriptor::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptor::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptor",(OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_00028ce8;
  return;
}



// IOSurfaceDescriptor::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptor::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDescriptor::IOSurfaceDescriptor(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptor::IOSurfaceDescriptor(IOSurfaceDescriptor *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptor_00028bb8;
  return;
}



// IOSurfaceDescriptor::IOSurfaceDescriptor(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptor::IOSurfaceDescriptor(IOSurfaceDescriptor *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptor_00028bb8;
  return;
}



// IOSurfaceDescriptor::~IOSurfaceDescriptor()

void __thiscall IOSurfaceDescriptor::~IOSurfaceDescriptor(IOSurfaceDescriptor *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptor::~IOSurfaceDescriptor()

void __thiscall IOSurfaceDescriptor::~IOSurfaceDescriptor(IOSurfaceDescriptor *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptor::~IOSurfaceDescriptor()

void __thiscall IOSurfaceDescriptor::~IOSurfaceDescriptor(IOSurfaceDescriptor *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceDescriptor_ktv,this,0x18);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDescriptor::operator delete(void*, unsigned long)

void __cdecl IOSurfaceDescriptor::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceDescriptor_ktv,param_1,param_2);
  return;
}



// IOSurfaceDescriptor::getMetaClass() const

undefined8 * IOSurfaceDescriptor::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceDescriptor::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptor::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptor",(OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_00028ce8;
  return;
}



// IOSurfaceDescriptor::MetaClass::alloc() const

OSObject * IOSurfaceDescriptor::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceDescriptor_ktv,0x18);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceDescriptor::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptor_00028bb8;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceDescriptor::operator new(unsigned long)

void * __thiscall IOSurfaceDescriptor::operator_new(IOSurfaceDescriptor *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceDescriptor_ktv,this);
  return pvVar1;
}



// IOSurfaceDescriptor::IOSurfaceDescriptor()

void __thiscall IOSurfaceDescriptor::IOSurfaceDescriptor(IOSurfaceDescriptor *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptor_00028bb8;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptor::IOSurfaceDescriptor()

void __thiscall IOSurfaceDescriptor::IOSurfaceDescriptor(IOSurfaceDescriptor *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptor_00028bb8;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptor::__OSFinalClass()

void IOSurfaceDescriptor::__OSFinalClass(void)

{
  return;
}



// IOSurfaceDescriptor::newSurfaceDescriptor()

long * IOSurfaceDescriptor::newSurfaceDescriptor(void)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x88))(plVar2);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOSurfaceDescriptor::init()

undefined8 __thiscall IOSurfaceDescriptor::init(IOSurfaceDescriptor *this)

{
  long lVar1;
  undefined8 uVar2;
  long lVar3;
  
  lVar1 = _IOMallocTypeImpl(&init()::kalloc_type_view_34);
  *(long *)(this + 0x10) = lVar1;
  if (lVar1 != 0) {
    ___bzero(lVar1,0x150);
    lVar1 = *(long *)(this + 0x10);
    *(undefined8 *)(lVar1 + 8) = 0x100000001;
    lVar3 = 0x3c;
    do {
      *(undefined8 *)(lVar1 + -4 + lVar3) = 0x100000001;
      lVar3 = lVar3 + 0x60;
    } while (lVar3 != 0x15c);
                    // WARNING: Could not recover jumptable at 0x00011f0e. Too many branches
                    // WARNING: Treating indirect jump as call
    uVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))(this);
    return uVar2;
  }
  return 0;
}



// IOSurfaceDescriptor::free()

void __thiscall IOSurfaceDescriptor::free(IOSurfaceDescriptor *this)

{
  if (*(long *)(this + 0x10) != 0) {
    *(undefined8 *)(this + 0x10) = 0;
    _IOFreeTypeImpl(&free()::kalloc_type_view_57);
    *(undefined8 *)(this + 0x10) = 0;
  }
                    // WARNING: Could not recover jumptable at 0x00011f56. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceDescriptor::setPixelFormat(unsigned int)

void __thiscall IOSurfaceDescriptor::setPixelFormat(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x10) = param_1;
  return;
}



// IOSurfaceDescriptor::setWidth(unsigned int)

void __thiscall IOSurfaceDescriptor::setWidth(IOSurfaceDescriptor *this,undefined4 param_1)

{
  **(undefined4 **)(this + 0x10) = param_1;
  return;
}



// IOSurfaceDescriptor::setHeight(unsigned int)

void __thiscall IOSurfaceDescriptor::setHeight(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 4) = param_1;
  return;
}



// IOSurfaceDescriptor::setElementWidth(unsigned int)

void __thiscall IOSurfaceDescriptor::setElementWidth(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 8) = param_1;
  return;
}



// IOSurfaceDescriptor::setElementHeight(unsigned int)

void __thiscall IOSurfaceDescriptor::setElementHeight(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0xc) = param_1;
  return;
}



// IOSurfaceDescriptor::setAllocSize(unsigned int)

void __thiscall IOSurfaceDescriptor::setAllocSize(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x20) = param_1;
  return;
}



// IOSurfaceDescriptor::setIsTiled(bool)

void __thiscall IOSurfaceDescriptor::setIsTiled(IOSurfaceDescriptor *this,undefined1 param_1)

{
  *(undefined1 *)(*(long *)(this + 0x10) + 0x2c) = param_1;
  return;
}



// IOSurfaceDescriptor::setDisableMapping(bool)

void __thiscall IOSurfaceDescriptor::setDisableMapping(IOSurfaceDescriptor *this,undefined1 param_1)

{
  *(undefined1 *)(*(long *)(this + 0x10) + 0x2d) = param_1;
  return;
}



// IOSurfaceDescriptor::setPlaneCount(unsigned int)

void __thiscall IOSurfaceDescriptor::setPlaneCount(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x1c) = param_1;
  return;
}



// IOSurfaceDescriptor::setBufferOffset(unsigned int)

void __thiscall IOSurfaceDescriptor::setBufferOffset(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x24) = param_1;
  return;
}



// IOSurfaceDescriptor::setBytesPerRow(unsigned int)

void __thiscall IOSurfaceDescriptor::setBytesPerRow(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x14) = param_1;
  return;
}



// IOSurfaceDescriptor::setBytesPerElement(unsigned int)

void __thiscall
IOSurfaceDescriptor::setBytesPerElement(IOSurfaceDescriptor *this,undefined4 param_1)

{
  *(undefined4 *)(*(long *)(this + 0x10) + 0x18) = param_1;
  return;
}



// IOSurfaceDescriptor::setPlaneWidth(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneWidth(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x30 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneHeight(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneHeight(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x34 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneElementWidth(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneElementWidth(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x38 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneElementHeight(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneElementHeight
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x3c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBase(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBase(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x40 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneOffset(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneOffset(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x44 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerRow(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerRow(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x48 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerElement(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerElement
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x4c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneSize(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneSize(IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x50 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneAddressFormat(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneAddressFormat
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x54 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressionType(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressionType
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x58 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressionFootprint(unsigned int, unsigned char)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressionFootprint
          (IOSurfaceDescriptor *this,uint param_1,byte param_2)

{
  if (param_1 < 3) {
    *(uint *)(*(long *)(this + 0x10) + 0x84 + (ulong)param_1 * 0x60) = (uint)param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressedTileDataRegionOffset(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressedTileDataRegionOffset
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x5c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressedTileHeaderRegionOffset(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressedTileHeaderRegionOffset
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x60 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressedTileWidth(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressedTileWidth
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 100 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneCompressedTileHeight(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneCompressedTileHeight
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x68 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneWidthInCompressedTiles(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneWidthInCompressedTiles
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x6c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneHeightInCompressedTiles(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneHeightInCompressedTiles
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x70 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerCompressedTileHeader(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerCompressedTileHeader
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x74 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerTileData(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerTileData
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x78 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerRowOfTileData(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerRowOfTileData
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x80 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneBytesPerRowOfCompressedTileHeaderGroups(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneBytesPerRowOfCompressedTileHeaderGroups
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x7c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setSliceCount(unsigned int)

void __thiscall IOSurfaceDescriptor::setSliceCount(IOSurfaceDescriptor *this,int param_1)

{
  if (param_1 - 2U < 0xfffffffd) {
    *(int *)(*(long *)(this + 0x10) + 0x28) = param_1;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneDataRegionBytesPerSliceForPlane(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneDataRegionBytesPerSliceForPlane
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x88 + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::setPlaneHeaderRegionBytesPerSliceForPlane(unsigned int, unsigned int)

void __thiscall
IOSurfaceDescriptor::setPlaneHeaderRegionBytesPerSliceForPlane
          (IOSurfaceDescriptor *this,uint param_1,undefined4 param_2)

{
  if (param_1 < 3) {
    *(undefined4 *)(*(long *)(this + 0x10) + 0x8c + (ulong)param_1 * 0x60) = param_2;
  }
  return;
}



// IOSurfaceDescriptor::getPixelFormat() const

undefined4 __thiscall IOSurfaceDescriptor::getPixelFormat(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x10);
}



// IOSurfaceDescriptor::getWidth() const

undefined4 __thiscall IOSurfaceDescriptor::getWidth(IOSurfaceDescriptor *this)

{
  return **(undefined4 **)(this + 0x10);
}



// IOSurfaceDescriptor::getHeight() const

undefined4 __thiscall IOSurfaceDescriptor::getHeight(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 4);
}



// IOSurfaceDescriptor::getElementWidth() const

undefined4 __thiscall IOSurfaceDescriptor::getElementWidth(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 8);
}



// IOSurfaceDescriptor::getElementHeight() const

undefined4 __thiscall IOSurfaceDescriptor::getElementHeight(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0xc);
}



// IOSurfaceDescriptor::getAllocSize() const

undefined4 __thiscall IOSurfaceDescriptor::getAllocSize(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x20);
}



// IOSurfaceDescriptor::getIsTiled() const

undefined8 __thiscall IOSurfaceDescriptor::getIsTiled(IOSurfaceDescriptor *this)

{
  return CONCAT71((int7)((ulong)*(long *)(this + 0x10) >> 8),
                  *(undefined1 *)(*(long *)(this + 0x10) + 0x2c));
}



// IOSurfaceDescriptor::getDisableMapping() const

undefined8 __thiscall IOSurfaceDescriptor::getDisableMapping(IOSurfaceDescriptor *this)

{
  return CONCAT71((int7)((ulong)*(long *)(this + 0x10) >> 8),
                  *(undefined1 *)(*(long *)(this + 0x10) + 0x2d));
}



// IOSurfaceDescriptor::getBytesPerRow() const

undefined4 __thiscall IOSurfaceDescriptor::getBytesPerRow(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x14);
}



// IOSurfaceDescriptor::getBytesPerElement() const

undefined4 __thiscall IOSurfaceDescriptor::getBytesPerElement(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x18);
}



// IOSurfaceDescriptor::getPlaneCount() const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneCount(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x1c);
}



// IOSurfaceDescriptor::getBufferOffset() const

undefined4 __thiscall IOSurfaceDescriptor::getBufferOffset(IOSurfaceDescriptor *this)

{
  return *(undefined4 *)(*(long *)(this + 0x10) + 0x24);
}



// IOSurfaceDescriptor::getPlaneWidth(unsigned int) const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneWidth(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x30 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneHeight(unsigned int) const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneHeight(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x34 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneElementWidth(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneElementWidth(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x38 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneElementHeight(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneElementHeight(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x3c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBase(unsigned int) const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneBase(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x40 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneOffset(unsigned int) const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneOffset(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x44 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerRow(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerRow(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x48 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerElement(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerElement(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x4c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneSize(unsigned int) const

undefined4 __thiscall IOSurfaceDescriptor::getPlaneSize(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x50 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneAddressFormat(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneAddressFormat(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x54 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressionType(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneCompressionType(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x58 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressionFootprint(unsigned int) const

undefined1 __thiscall
IOSurfaceDescriptor::getPlaneCompressionFootprint(IOSurfaceDescriptor *this,uint param_1)

{
  undefined1 uVar1;
  
  if (param_1 < 3) {
    uVar1 = *(undefined1 *)(*(long *)(this + 0x10) + 0x84 + (ulong)param_1 * 0x60);
  }
  else {
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressedTileDataRegionOffset(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneCompressedTileDataRegionOffset(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x5c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressedTileHeaderRegionOffset(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneCompressedTileHeaderRegionOffset
          (IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x60 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressedTileWidth(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneCompressedTileWidth(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 100 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneCompressedTileHeight(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneCompressedTileHeight(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x68 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneWidthInCompressedTiles(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneWidthInCompressedTiles(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x6c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneHeightInCompressedTiles(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneHeightInCompressedTiles(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x70 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerCompressedTileHeader(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerCompressedTileHeader(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x74 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerTileData(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerTileData(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x78 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerRowOfTileData(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerRowOfTileData(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x80 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneBytesPerRowOfCompressedTileHeaderGroups(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneBytesPerRowOfCompressedTileHeaderGroups
          (IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x7c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getSliceCount() const

int __thiscall IOSurfaceDescriptor::getSliceCount(IOSurfaceDescriptor *this)

{
  int iVar1;
  
  iVar1 = 1;
  if (*(int *)(*(long *)(this + 0x10) + 0x28) != 0) {
    iVar1 = *(int *)(*(long *)(this + 0x10) + 0x28);
  }
  return iVar1;
}



// IOSurfaceDescriptor::getPlaneDataRegionBytesPerSliceForPlane(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneDataRegionBytesPerSliceForPlane(IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x88 + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::getPlaneHeaderRegionBytesPerSliceForPlane(unsigned int) const

undefined4 __thiscall
IOSurfaceDescriptor::getPlaneHeaderRegionBytesPerSliceForPlane
          (IOSurfaceDescriptor *this,uint param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_1 < 3) {
    uVar1 = *(undefined4 *)(*(long *)(this + 0x10) + 0x8c + (ulong)param_1 * 0x60);
  }
  return uVar1;
}



// IOSurfaceDescriptor::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptor::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceDescriptor_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceDescriptor::gMetaClass,"IOSurfaceDescriptor",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  IOSurfaceDescriptor::gMetaClass = &PTR__MetaClass_00028ce8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceDescriptor::gMetaClass);
  return;
}



// IOSurfaceDeviceMemoryRegion::MetaClass::MetaClass()

void __thiscall IOSurfaceDeviceMemoryRegion::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDeviceMemoryRegion",
             (OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass,0x60);
  *(undefined ***)this = &PTR__MetaClass_00028f70;
  return;
}



// IOSurfaceDeviceMemoryRegion::MetaClass::~MetaClass()

void __thiscall IOSurfaceDeviceMemoryRegion::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion(OSMetaClass const*)

void __thiscall
IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion
          (IOSurfaceDeviceMemoryRegion *this,OSMetaClass *param_1)

{
  IOSurfaceMemoryRegion::IOSurfaceMemoryRegion((IOSurfaceMemoryRegion *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  return;
}



// IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion(OSMetaClass const*)

void __thiscall
IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion
          (IOSurfaceDeviceMemoryRegion *this,OSMetaClass *param_1)

{
  IOSurfaceMemoryRegion::IOSurfaceMemoryRegion((IOSurfaceMemoryRegion *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  return;
}



// IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion()

void __thiscall
IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion(IOSurfaceDeviceMemoryRegion *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x30) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x30) + 0x28))();
  }
  *(undefined8 *)(this + 0x30) = 0;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion((IOSurfaceMemoryRegion *)this);
  return;
}



// IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion()

void __thiscall
IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion(IOSurfaceDeviceMemoryRegion *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x30) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x30) + 0x28))();
  }
  *(undefined8 *)(this + 0x30) = 0;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion((IOSurfaceMemoryRegion *)this);
  return;
}



// IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion()

void __thiscall
IOSurfaceDeviceMemoryRegion::~IOSurfaceDeviceMemoryRegion(IOSurfaceDeviceMemoryRegion *this)

{
  ~IOSurfaceDeviceMemoryRegion(this);
  _OSObject_typed_operator_delete(&IOSurfaceDeviceMemoryRegion_ktv,this,0x60);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDeviceMemoryRegion::operator delete(void*, unsigned long)

void __cdecl IOSurfaceDeviceMemoryRegion::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceDeviceMemoryRegion_ktv,param_1,param_2);
  return;
}



// IOSurfaceDeviceMemoryRegion::getMetaClass() const

undefined8 * IOSurfaceDeviceMemoryRegion::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceDeviceMemoryRegion::MetaClass::MetaClass()

void __thiscall IOSurfaceDeviceMemoryRegion::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDeviceMemoryRegion",
             (OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass,0x60);
  *(undefined ***)this = &PTR__MetaClass_00028f70;
  return;
}



// IOSurfaceDeviceMemoryRegion::MetaClass::alloc() const

IOSurfaceMemoryRegion * IOSurfaceDeviceMemoryRegion::MetaClass::alloc(void)

{
  IOSurfaceMemoryRegion *this;
  
  this = (IOSurfaceMemoryRegion *)
         _OSObject_typed_operator_new(&IOSurfaceDeviceMemoryRegion_ktv,0x60);
  IOSurfaceMemoryRegion::IOSurfaceMemoryRegion
            (this,(OSMetaClass *)&IOSurfaceDeviceMemoryRegion::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceDeviceMemoryRegion::operator new(unsigned long)

void * __thiscall IOSurfaceDeviceMemoryRegion::operator_new(IOSurfaceDeviceMemoryRegion *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceDeviceMemoryRegion_ktv,this);
  return pvVar1;
}



// IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion()

void __thiscall
IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion(IOSurfaceDeviceMemoryRegion *this)

{
  IOSurfaceMemoryRegion::IOSurfaceMemoryRegion
            ((IOSurfaceMemoryRegion *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion()

void __thiscall
IOSurfaceDeviceMemoryRegion::IOSurfaceDeviceMemoryRegion(IOSurfaceDeviceMemoryRegion *this)

{
  IOSurfaceMemoryRegion::IOSurfaceMemoryRegion
            ((IOSurfaceMemoryRegion *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDeviceMemoryRegion_00028de0;
  *(undefined8 *)(this + 0x28) = 0;
  *(undefined8 *)(this + 0x30) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDeviceMemoryRegion::init(IOSurfaceRoot*, OSDictionary*, char const*, unsigned int,
// unsigned int)

ulong __thiscall
IOSurfaceDeviceMemoryRegion::init
          (IOSurfaceDeviceMemoryRegion *this,long *param_1,long *param_2,char *param_3,
          undefined4 param_4,uint param_5)

{
  bool bVar1;
  OSDictionary *pOVar2;
  long *plVar3;
  undefined8 uVar4;
  long lVar5;
  ulong uVar6;
  
  bVar1 = IOSurfaceMemoryRegion::init((IOSurfaceMemoryRegion *)this,param_1,param_2);
  if (!bVar1) {
    uVar6 = 0;
    goto LAB_00012b05;
  }
  pOVar2 = (OSDictionary *)IOService::nameMatching(param_3,(OSDictionary *)0x0);
  plVar3 = (long *)IOService::waitForMatchingService(pOVar2,0xffffffffffffffff);
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(long **)(this + 0x28) = plVar3;
  if (plVar3 == (long *)0x0) {
LAB_00012af4:
    uVar6 = 0;
  }
  else {
    plVar3 = (long *)(**(code **)(*plVar3 + 0x6d8))(plVar3,param_4);
    *(long **)(this + 0x38) = plVar3;
    if (plVar3 == (long *)0x0) goto LAB_00012af4;
    *(uint *)(this + 0x58) = param_5 & 0xf00;
    uVar4 = (**(code **)(*plVar3 + 0x1c8))(plVar3);
    *(undefined8 *)(this + 0x48) = uVar4;
    plVar3 = (long *)(**(code **)(**(long **)(this + 0x38) + 0x200))
                               (*(long **)(this + 0x38),*(undefined4 *)(this + 0x58));
    if (*(long **)(this + 0x40) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x40) + 0x28))();
    }
    *(long **)(this + 0x40) = plVar3;
    if (plVar3 == (long *)0x0) goto LAB_00012af4;
    uVar4 = (**(code **)(*plVar3 + 0x118))(plVar3);
    *(undefined8 *)(this + 0x50) = uVar4;
    lVar5 = IORangeAllocator::withRange
                      (*(long *)(this + 0x48) - 1,*(ulonglong *)PTR__page_size_000270c0,0,0);
    if (*(long **)(this + 0x30) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x30) + 0x28))();
    }
    *(long *)(this + 0x30) = lVar5;
    uVar6 = CONCAT71((int7)((ulong)this >> 8),lVar5 != 0);
  }
  if (pOVar2 != (OSDictionary *)0x0) {
    (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
  }
LAB_00012b05:
  return uVar6 & 0xffffffff;
}



// IOSurfaceDeviceMemoryRegion::free()

void __thiscall IOSurfaceDeviceMemoryRegion::free(IOSurfaceDeviceMemoryRegion *this)

{
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x148))();
  }
  if (*(long *)(this + 0x18) != 0) {
    _IOLockFree();
  }
                    // WARNING: Could not recover jumptable at 0x000131ff. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceDeviceMemoryRegion::allocateSurfaceBuffer(IOSurface*)

undefined4 __thiscall
IOSurfaceDeviceMemoryRegion::allocateSurfaceBuffer(IOSurfaceDeviceMemoryRegion *this,long param_1)

{
  undefined4 uVar1;
  undefined1 *local_28;
  
  local_28 = &DAT_aaaaaaaaaaaaaaaa;
  _IOLockLock(*(undefined8 *)(this + 0x18));
  uVar1 = (**(code **)(**(long **)(this + 0x30) + 0x150))
                    (*(long **)(this + 0x30),*(undefined8 *)(param_1 + 0x90),&local_28,0);
  if ((char)uVar1 != '\0') {
    *(ulong *)(param_1 + 0x88) = (ulong)local_28 & 0xffffffff;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x18));
  return uVar1;
}



// IOSurfaceDeviceMemoryRegion::deallocateSurfaceBuffer(IOSurface*)

void __thiscall
IOSurfaceDeviceMemoryRegion::deallocateSurfaceBuffer(IOSurfaceDeviceMemoryRegion *this,long param_1)

{
  _IOLockLock(*(undefined8 *)(this + 0x18));
  (**(code **)(**(long **)(this + 0x30) + 0x160))
            (*(long **)(this + 0x30),*(undefined8 *)(param_1 + 0x88),*(undefined8 *)(param_1 + 0x90)
            );
  *(undefined8 *)(param_1 + 0x88) = 0;
  _IOLockUnlock(*(undefined8 *)(this + 0x18));
  return;
}



// IOSurfaceDeviceMemoryRegion::reserveSurfaceBuffer(IOSurface*)

undefined4 __thiscall
IOSurfaceDeviceMemoryRegion::reserveSurfaceBuffer(IOSurfaceDeviceMemoryRegion *this,long param_1)

{
  undefined4 uVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x18));
  uVar1 = (**(code **)(**(long **)(this + 0x30) + 0x158))
                    (*(long **)(this + 0x30),*(undefined8 *)(param_1 + 0x88),
                     *(undefined8 *)(param_1 + 0x90));
  _IOLockUnlock(*(undefined8 *)(this + 0x18));
  return uVar1;
}



// IOSurfaceDeviceMemoryRegion::getMemoryDescriptor()

undefined8 __thiscall
IOSurfaceDeviceMemoryRegion::getMemoryDescriptor(IOSurfaceDeviceMemoryRegion *this)

{
  return *(undefined8 *)(this + 0x38);
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDeviceMemoryRegion::write_debug_info(OSDictionary*)

void __cdecl
IOSurfaceDeviceMemoryRegion::write_debug_info(IOSurfaceMemoryRegion *param_1,long *param_2)

{
  long lVar1;
  char cVar2;
  long lVar3;
  ulonglong uVar4;
  ulong uVar5;
  uint uVar6;
  undefined1 *local_38;
  
  local_38 = &DAT_aaaaaaaaaaaaaaaa;
  IOSurfaceMemoryRegion::write_debug_info(param_1,param_2);
  _IOLockLock(*(undefined8 *)(param_1 + 0x18));
  setNumber(param_2,"Size",*(ulonglong *)(param_1 + 0x48));
  lVar1 = *(long *)(param_1 + 0x48);
  lVar3 = (**(code **)(**(long **)(param_1 + 0x30) + 0x148))();
  setNumber(param_2,"Allocated",lVar1 - lVar3);
  uVar4 = (**(code **)(**(long **)(param_1 + 0x30) + 0x148))();
  setNumber(param_2,"Free",uVar4);
  uVar4 = 0;
  if (*(ulong *)PTR__page_size_000270c0 < 0x80000001) {
    uVar6 = 0;
    uVar5 = 0x80000000;
    do {
      uVar4 = (ulonglong)((uint)uVar5 | uVar6);
      cVar2 = (**(code **)(**(long **)(param_1 + 0x30) + 0x150))
                        (*(long **)(param_1 + 0x30),uVar4,&local_38,0);
      if (cVar2 == '\0') {
        uVar4 = (ulonglong)(uVar6 & ~(uint)uVar5);
      }
      else {
        (**(code **)(**(long **)(param_1 + 0x30) + 0x160))
                  (*(long **)(param_1 + 0x30),local_38,uVar4);
      }
      uVar5 = uVar5 >> 1;
      uVar6 = (uint)uVar4;
    } while (*(ulong *)PTR__page_size_000270c0 <= uVar5);
  }
  setNumber(param_2,"LargestFree",uVar4);
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x18));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// setNumber(OSDictionary*, char const*, unsigned long long, unsigned int)

void __cdecl setNumber(long *param_1,undefined8 param_2,ulonglong param_3)

{
  long *plVar1;
  
  plVar1 = (long *)OSNumber::withNumber(param_3,0x20);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x1d0))(param_1,param_2,plVar1);
                    // WARNING: Could not recover jumptable at 0x00012dca. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurfaceDeviceMemoryRegion::getRegionVirtualAddress()

undefined8 __thiscall
IOSurfaceDeviceMemoryRegion::getRegionVirtualAddress(IOSurfaceDeviceMemoryRegion *this)

{
  return *(undefined8 *)(this + 0x50);
}



// IOSurfaceDeviceMemoryRegion::getRegionPhysicalAddress()

void IOSurfaceDeviceMemoryRegion::getRegionPhysicalAddress(void)

{
  IOMemoryMap::getPhysicalAddress();
  return;
}



// IOSurfaceDeviceMemoryRegion::getRegionSize()

undefined8 __thiscall IOSurfaceDeviceMemoryRegion::getRegionSize(IOSurfaceDeviceMemoryRegion *this)

{
  return *(undefined8 *)(this + 0x48);
}



// IOSurfaceDeviceMemoryRegion::getCacheMode()

undefined4 __thiscall IOSurfaceDeviceMemoryRegion::getCacheMode(IOSurfaceDeviceMemoryRegion *this)

{
  return *(undefined4 *)(this + 0x58);
}



// IOSurfaceDeviceMemoryRegion::readSubregion(void*, unsigned long, unsigned long)

undefined8 __thiscall
IOSurfaceDeviceMemoryRegion::readSubregion
          (IOSurfaceDeviceMemoryRegion *this,void *param_1,ulong param_2,ulong param_3)

{
  undefined8 uVar1;
  
  if ((CARRY8(param_2,param_3)) || (*(ulong *)(this + 0x48) < param_2 + param_3)) {
    uVar1 = 0;
  }
  else {
    _IOLockLock(*(undefined8 *)(this + 0x18));
    _memmove(param_1,(void *)(param_2 + *(long *)(this + 0x50)),param_3);
    uVar1 = _IOLockUnlock(*(undefined8 *)(this + 0x18));
    uVar1 = CONCAT71((int7)((ulong)uVar1 >> 8),1);
  }
  return uVar1;
}



// IOSurfaceDeviceMemoryRegion::MetaClass::~MetaClass()

void __thiscall IOSurfaceDeviceMemoryRegion::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceDeviceMemoryRegion_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceDeviceMemoryRegion::gMetaClass,"IOSurfaceDeviceMemoryRegion",
             (OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass,0x60);
  IOSurfaceDeviceMemoryRegion::gMetaClass = &PTR__MetaClass_00028f70;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceDeviceMemoryRegion::gMetaClass);
  return;
}



// IOSurfaceMemoryRegion::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryRegion::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryRegion",(OSMetaClass *)PTR_gMetaClass_00027048,0x28
            );
  *(undefined ***)this = &PTR__MetaClass_000291f0;
  return;
}



// IOSurfaceMemoryRegion::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryRegion::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion()

void __thiscall IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this)

{
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion()

void __thiscall IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this)

{
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion()

void __thiscall IOSurfaceMemoryRegion::~IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this)

{
  ~IOSurfaceMemoryRegion(this);
  _OSObject_typed_operator_delete(&IOSurfaceMemoryRegion_ktv,this,0x28);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryRegion::operator delete(void*, unsigned long)

void __cdecl IOSurfaceMemoryRegion::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceMemoryRegion_ktv,param_1,param_2);
  return;
}



// IOSurfaceMemoryRegion::getMetaClass() const

undefined ** IOSurfaceMemoryRegion::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceMemoryRegion::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryRegion::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryRegion",(OSMetaClass *)PTR_gMetaClass_00027048,0x28
            );
  *(undefined ***)this = &PTR__MetaClass_000291f0;
  return;
}



// IOSurfaceMemoryRegion::MetaClass::alloc() const

OSObject * IOSurfaceMemoryRegion::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceMemoryRegion_ktv,0x28);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceMemoryRegion::operator new(unsigned long)

void * __thiscall IOSurfaceMemoryRegion::operator_new(IOSurfaceMemoryRegion *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceMemoryRegion_ktv,this);
  return pvVar1;
}



// IOSurfaceMemoryRegion::IOSurfaceMemoryRegion()

void __thiscall IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryRegion::IOSurfaceMemoryRegion()

void __thiscall IOSurfaceMemoryRegion::IOSurfaceMemoryRegion(IOSurfaceMemoryRegion *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryRegion_00029068;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryRegion::init(IOSurfaceRoot*, OSDictionary*)

bool __thiscall IOSurfaceMemoryRegion::init(IOSurfaceMemoryRegion *this,long *param_1,long *param_2)

{
  long *plVar1;
  long lVar2;
  OSMetaClassBase *pOVar3;
  long *plVar4;
  
  plVar1 = *(long **)(this + 0x10);
  *(long **)(this + 0x10) = param_1;
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  lVar2 = _IOLockAlloc();
  *(long *)(this + 0x18) = lVar2;
  if ((param_2 != (long *)0x0) && (lVar2 != 0)) {
    pOVar3 = (OSMetaClassBase *)(**(code **)(*param_2 + 0x208))(param_2,"IOSurfaceMemoryRegion");
    plVar4 = (long *)OSMetaClassBase::safeMetaCast(pOVar3,*(OSMetaClass **)PTR_metaClass_00027058);
    plVar1 = *(long **)(this + 0x20);
    *(long **)(this + 0x20) = plVar4;
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x20))(plVar4);
    }
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  return lVar2 != 0;
}



// IOSurfaceMemoryRegion::free()

void __thiscall IOSurfaceMemoryRegion::free(IOSurfaceMemoryRegion *this)

{
  if (*(long *)(this + 0x18) != 0) {
    _IOLockFree();
  }
                    // WARNING: Could not recover jumptable at 0x000131ff. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceMemoryRegion::allocateSurfaceBuffer(IOSurface*)

undefined8 IOSurfaceMemoryRegion::allocateSurfaceBuffer(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::deallocateSurfaceBuffer(IOSurface*)

void IOSurfaceMemoryRegion::deallocateSurfaceBuffer(void)

{
  return;
}



// IOSurfaceMemoryRegion::reserveSurfaceBuffer(IOSurface*)

undefined8 IOSurfaceMemoryRegion::reserveSurfaceBuffer(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::getRegionName()

undefined8 __thiscall IOSurfaceMemoryRegion::getRegionName(IOSurfaceMemoryRegion *this)

{
  return *(undefined8 *)(this + 0x20);
}



// IOSurfaceMemoryRegion::getMemoryDescriptor()

undefined8 IOSurfaceMemoryRegion::getMemoryDescriptor(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::write_debug_info(OSDictionary*)

void __thiscall IOSurfaceMemoryRegion::write_debug_info(IOSurfaceMemoryRegion *this,long *param_1)

{
  if (*(long *)(this + 0x20) != 0) {
                    // WARNING: Could not recover jumptable at 0x00013253. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*param_1 + 0x1d0))
              (param_1,"Name",*(long *)(this + 0x20),*(code **)(*param_1 + 0x1d0));
    return;
  }
  return;
}



// IOSurfaceMemoryRegion::getRegionVirtualAddress()

undefined8 IOSurfaceMemoryRegion::getRegionVirtualAddress(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::getRegionPhysicalAddress()

undefined8 IOSurfaceMemoryRegion::getRegionPhysicalAddress(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::getRegionSize()

undefined8 IOSurfaceMemoryRegion::getRegionSize(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::getCacheMode()

undefined8 IOSurfaceMemoryRegion::getCacheMode(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::readSubregion(void*, unsigned long, unsigned long)

undefined8 IOSurfaceMemoryRegion::readSubregion(void)

{
  return 0;
}



// IOSurfaceMemoryRegion::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryRegion::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceMemoryRegion_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass,"IOSurfaceMemoryRegion",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x28);
  IOSurfaceMemoryRegion::gMetaClass = (undefined *)&PTR__MetaClass_000291f0;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass);
  return;
}



// IOSurfaceRootParavirtMapperInterface::MetaClass::MetaClass()

void __thiscall IOSurfaceRootParavirtMapperInterface::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRootParavirtMapperInterface",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x10);
  *(undefined ***)this = &PTR__MetaClass_00029428;
  return;
}



// IOSurfaceRootParavirtMapperInterface::MetaClass::~MetaClass()

void __thiscall IOSurfaceRootParavirtMapperInterface::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceRootParavirtMapperInterface::IOSurfaceRootParavirtMapperInterface(OSMetaClass const*)

void __thiscall
IOSurfaceRootParavirtMapperInterface::IOSurfaceRootParavirtMapperInterface
          (IOSurfaceRootParavirtMapperInterface *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceRootParavirtMapperInterface_000292e8;
  return;
}



// IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface()

void __thiscall
IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface
          (IOSurfaceRootParavirtMapperInterface *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface()

void __thiscall IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface(void)

{
  code *pcVar1;
  
                    // WARNING: Does not return
  pcVar1 = (code *)invalidInstructionException();
  (*pcVar1)();
}



// IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface()

void __thiscall IOSurfaceRootParavirtMapperInterface::~IOSurfaceRootParavirtMapperInterface(void)

{
  code *pcVar1;
  
                    // WARNING: Does not return
  pcVar1 = (code *)invalidInstructionException();
  (*pcVar1)();
}



// IOSurfaceRootParavirtMapperInterface::getMetaClass() const

undefined ** IOSurfaceRootParavirtMapperInterface::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceRootParavirtMapperInterface::MetaClass::MetaClass()

void __thiscall IOSurfaceRootParavirtMapperInterface::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRootParavirtMapperInterface",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x10);
  *(undefined ***)this = &PTR__MetaClass_00029428;
  return;
}



// IOSurfaceRootParavirtMapperInterface::MetaClass::alloc() const

undefined8 IOSurfaceRootParavirtMapperInterface::MetaClass::alloc(void)

{
  return 0;
}



// IOSurfaceRootParavirtMapperInterface::operator new(unsigned long)

void * __thiscall
IOSurfaceRootParavirtMapperInterface::operator_new(IOSurfaceRootParavirtMapperInterface *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceRootParavirtMapperInterface_ktv,this);
  return pvVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootParavirtMapperInterface::operator delete(void*, unsigned long)

void __cdecl
IOSurfaceRootParavirtMapperInterface::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceRootParavirtMapperInterface_ktv,param_1,param_2);
  return;
}



// IOSurfaceRoot::MetaClass::MetaClass()

void __thiscall IOSurfaceRoot::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRoot",(OSMetaClass *)PTR_gMetaClass_00027060,0x4a0);
  *(undefined ***)this = &PTR__MetaClass_00029d88;
  return;
}



// IOSurfaceRoot::MetaClass::~MetaClass()

void __thiscall IOSurfaceRoot::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceRoot::IOSurfaceRoot(OSMetaClass const*)

void __thiscall IOSurfaceRoot::IOSurfaceRoot(IOSurfaceRoot *this,OSMetaClass *param_1)

{
  IOService::IOService((IOService *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceRoot_00029520;
  *(undefined8 *)(this + 0xd0) = 0;
  *(undefined4 *)(this + 0xd8) = 0;
  *(undefined8 *)(this + 0xe8) = 0;
  *(undefined4 *)(this + 0xf0) = 0;
  *(undefined8 *)(this + 0x108) = 0;
  *(undefined4 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x118) = 0;
  *(undefined4 *)(this + 0x120) = 0;
  *(undefined8 *)(this + 0x150) = 0;
  *(undefined8 *)(this + 0x1c0) = 0;
  *(undefined8 *)(this + 0x1c8) = 0;
  *(undefined8 *)(this + 0x1d0) = 0;
  *(undefined8 *)(this + 0x1f8) = 0;
  *(undefined8 *)(this + 0x208) = 0;
  *(undefined8 *)(this + 0x228) = 0;
  *(undefined8 *)(this + 0x230) = 0;
  *(undefined8 *)(this + 0x448) = 0;
  return;
}



// IOSurfaceRoot::IOSurfaceRoot(OSMetaClass const*)

void __thiscall IOSurfaceRoot::IOSurfaceRoot(IOSurfaceRoot *this,OSMetaClass *param_1)

{
  IOSurfaceRoot(this,param_1);
  return;
}



// IOSurfaceRoot::~IOSurfaceRoot()

void __thiscall IOSurfaceRoot::~IOSurfaceRoot(IOSurfaceRoot *this)

{
  *(undefined ***)this = &PTR__IOSurfaceRoot_00029520;
  if (*(long **)(this + 0x448) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x448) + 0x28))();
  }
  *(undefined8 *)(this + 0x448) = 0;
  if (*(long **)(this + 0x230) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x230) + 0x28))();
  }
  *(undefined8 *)(this + 0x230) = 0;
  if (*(long **)(this + 0x228) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x228) + 0x28))();
  }
  *(undefined8 *)(this + 0x228) = 0;
  if (*(long **)(this + 0x208) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x208) + 0x28))();
  }
  *(undefined8 *)(this + 0x208) = 0;
  if (*(long **)(this + 0x1f8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1f8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1f8) = 0;
  if (*(long **)(this + 0x1d0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1d0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1d0) = 0;
  if (*(long **)(this + 0x1c8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1c8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1c8) = 0;
  if (*(long **)(this + 0x1c0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1c0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1c0) = 0;
  if (*(long **)(this + 0x150) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x150) + 0x28))();
  }
  *(undefined8 *)(this + 0x150) = 0;
  IOService::~IOService((IOService *)this);
  return;
}



// IOSurfaceRoot::~IOSurfaceRoot()

void __thiscall IOSurfaceRoot::~IOSurfaceRoot(IOSurfaceRoot *this)

{
  *(undefined ***)this = &PTR__IOSurfaceRoot_00029520;
  if (*(long **)(this + 0x448) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x448) + 0x28))();
  }
  *(undefined8 *)(this + 0x448) = 0;
  if (*(long **)(this + 0x230) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x230) + 0x28))();
  }
  *(undefined8 *)(this + 0x230) = 0;
  if (*(long **)(this + 0x228) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x228) + 0x28))();
  }
  *(undefined8 *)(this + 0x228) = 0;
  if (*(long **)(this + 0x208) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x208) + 0x28))();
  }
  *(undefined8 *)(this + 0x208) = 0;
  if (*(long **)(this + 0x1f8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1f8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1f8) = 0;
  if (*(long **)(this + 0x1d0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1d0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1d0) = 0;
  if (*(long **)(this + 0x1c8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1c8) + 0x28))();
  }
  *(undefined8 *)(this + 0x1c8) = 0;
  if (*(long **)(this + 0x1c0) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x1c0) + 0x28))();
  }
  *(undefined8 *)(this + 0x1c0) = 0;
  if (*(long **)(this + 0x150) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x150) + 0x28))();
  }
  *(undefined8 *)(this + 0x150) = 0;
  IOService::~IOService((IOService *)this);
  return;
}



// IOSurfaceRoot::~IOSurfaceRoot()

void __thiscall IOSurfaceRoot::~IOSurfaceRoot(IOSurfaceRoot *this)

{
  ~IOSurfaceRoot(this);
  _OSObject_typed_operator_delete(&IOSurfaceRoot_ktv,this,0x4a0);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::operator delete(void*, unsigned long)

void __cdecl IOSurfaceRoot::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceRoot_ktv,param_1,param_2);
  return;
}



// IOSurfaceRoot::getMetaClass() const

undefined ** IOSurfaceRoot::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceRoot::MetaClass::MetaClass()

void __thiscall IOSurfaceRoot::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRoot",(OSMetaClass *)PTR_gMetaClass_00027060,0x4a0);
  *(undefined ***)this = &PTR__MetaClass_00029d88;
  return;
}



// IOSurfaceRoot::MetaClass::alloc() const

IOSurfaceRoot * IOSurfaceRoot::MetaClass::alloc(void)

{
  IOSurfaceRoot *this;
  
  this = (IOSurfaceRoot *)_OSObject_typed_operator_new(&IOSurfaceRoot_ktv,0x4a0);
  IOSurfaceRoot(this);
  return this;
}



// IOSurfaceRoot::operator new(unsigned long)

void * __thiscall IOSurfaceRoot::operator_new(IOSurfaceRoot *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceRoot_ktv,this);
  return pvVar1;
}



// IOSurfaceRoot::IOSurfaceRoot()

void __thiscall IOSurfaceRoot::IOSurfaceRoot(IOSurfaceRoot *this)

{
  IOSurfaceRoot(this);
  return;
}



// IOSurfaceRoot::IOSurfaceRoot()

void __thiscall IOSurfaceRoot::IOSurfaceRoot(IOSurfaceRoot *this)

{
  IOService::IOService((IOService *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceRoot_00029520;
  *(undefined8 *)(this + 0xd0) = 0;
  *(undefined4 *)(this + 0xd8) = 0;
  *(undefined8 *)(this + 0xe8) = 0;
  *(undefined4 *)(this + 0xf0) = 0;
  *(undefined8 *)(this + 0x108) = 0;
  *(undefined4 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x118) = 0;
  *(undefined4 *)(this + 0x120) = 0;
  *(undefined8 *)(this + 0x150) = 0;
  *(undefined8 *)(this + 0x1c0) = 0;
  *(undefined8 *)(this + 0x1c8) = 0;
  *(undefined8 *)(this + 0x1d0) = 0;
  *(undefined8 *)(this + 0x1f8) = 0;
  *(undefined8 *)(this + 0x208) = 0;
  *(undefined8 *)(this + 0x228) = 0;
  *(undefined8 *)(this + 0x230) = 0;
  *(undefined8 *)(this + 0x448) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::init(OSDictionary*)

undefined4 __cdecl IOSurfaceRoot::init(long param_1)

{
  undefined4 uVar1;
  uint64_t uVar2;
  undefined8 uVar3;
  
  uVar1 = (**(code **)(PTR_vtable_00027080 + 600))();
  uVar2 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x450) = uVar2;
  LOCK();
  sNextGlobalTraceID = 0x100000000000000;
  UNLOCK();
  _gIOSurfaceRoot = param_1;
  uVar3 = OSArray::withCapacity(4);
  if (*(long **)(param_1 + 0x230) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x230) + 0x28))();
  }
  *(undefined8 *)(param_1 + 0x230) = uVar3;
  uVar3 = _IOLockAlloc();
  *(undefined8 *)(param_1 + 0x238) = uVar3;
  uVar3 = _IOLockAlloc();
  *(undefined8 *)(param_1 + 0x148) = uVar3;
  uVar3 = _IOLockAlloc();
  *(undefined8 *)(param_1 + 0x240) = uVar3;
  uVar3 = _IOLockAlloc();
  *(undefined8 *)(param_1 + 0x400) = uVar3;
  _sysctl_register_oid(&_sysctl__debug_iosurface);
  _sysctl_register_oid(&_sysctl__debug_iosurface_iofence_ddd);
  uVar3 = _IOMallocTypeVarImpl(&init(OSDictionary*)::kalloc_type_view_110,0x200);
  *(undefined8 *)(param_1 + 0x440) = uVar3;
  *(undefined8 *)(param_1 + 0x438) = 0x20;
  uVar2 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x458) = uVar2;
  return uVar1;
}



// IOSurfaceRoot::root()

undefined8 IOSurfaceRoot::root(void)

{
  return _gIOSurfaceRoot;
}



// IOSurfaceRoot::debugBits()

undefined4 IOSurfaceRoot::debugBits(void)

{
  return *(undefined4 *)(_gIOSurfaceRoot + 0x1b4);
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::gpuWritableContentProtectionOptions(unsigned long long)

undefined8 __cdecl IOSurfaceRoot::gpuWritableContentProtectionOptions(undefined8 param_1)

{
  return param_1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::msrWritableContentProtectionOptions(unsigned long long)

undefined8 __cdecl IOSurfaceRoot::msrWritableContentProtectionOptions(undefined8 param_1)

{
  return param_1;
}



// IOSurfaceRoot::free()

void __thiscall IOSurfaceRoot::free(IOSurfaceRoot *this)

{
  undefined8 uVar1;
  long lVar2;
  
  _gIOSurfaceRoot = 0;
  if (*(long **)(this + 0x228) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x228) + 0x28))();
    *(undefined8 *)(this + 0x228) = 0;
  }
  _sysctl_unregister_oid(&_sysctl__debug_iosurface_iofence_ddd);
  _sysctl_unregister_oid(&_sysctl__debug_iosurface);
  if (*(long *)(this + 0x238) != 0) {
    _IOLockFree();
  }
  if (*(long *)(this + 0x240) != 0) {
    _IOLockFree();
  }
  if (*(long *)(this + 0x400) != 0) {
    _IOLockFree();
  }
  if (*(long *)(this + 0x148) != 0) {
    _IOLockFree();
  }
  uVar1 = *(undefined8 *)(this + 0x440);
  lVar2 = *(ulong *)(this + 0x438) << 4;
  if (lVar2 < 0) {
    lVar2 = -0x8000000000000000;
  }
  if (*(ulong *)(this + 0x438) >> 0x3c != 0) {
    lVar2 = -0x8000000000000000;
  }
  *(undefined8 *)(this + 0x440) = 0;
  _IOFreeTypeVarImpl(&free()::kalloc_type_view_178,uVar1,lVar2);
                    // WARNING: Could not recover jumptable at 0x00013a4c. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027080 + 0xa0))(this);
  return;
}



// IOSurfaceRoot::probe(IOService*, int*)

void IOSurfaceRoot::probe(void)

{
                    // WARNING: Could not recover jumptable at 0x00013a5e. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027080 + 0x5c8))();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::start(IOService*)

undefined4 __cdecl IOSurfaceRoot::start(IOSurfaceRoot *param_1)

{
  IOSurfaceRoot *pIVar1;
  undefined *puVar2;
  char cVar3;
  undefined4 uVar4;
  int iVar5;
  boolean_t bVar6;
  uint uVar7;
  uint64_t uVar8;
  long lVar9;
  undefined8 uVar10;
  ulong uVar11;
  long *plVar12;
  long *plVar13;
  undefined1 *puVar14;
  undefined4 uVar15;
  char *fmt;
  size_t local_50;
  undefined1 *local_48;
  uint local_3c;
  undefined1 *local_38;
  
  uVar4 = (**(code **)(PTR_vtable_00027080 + 0x5d0))();
  uVar8 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x460) = uVar8;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x138) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x140) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  *(undefined8 *)(param_1 + 0x90) = 0;
  *(IOSurfaceRoot **)(param_1 + 0x98) = param_1 + 0x90;
  *(undefined8 *)(param_1 + 0x198) = 0;
  *(IOSurfaceRoot **)(param_1 + 0x1a0) = param_1 + 0x198;
  *(undefined8 *)(param_1 + 0x3a8) = 0;
  *(IOSurfaceRoot **)(param_1 + 0x3b0) = param_1 + 0x3a8;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x3b8) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  lVar9 = OSDictionary::withCapacity(1);
  if (*(long **)(param_1 + 0x150) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x150) + 0x28))();
  }
  *(long *)(param_1 + 0x150) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  *(undefined8 *)(param_1 + 0x3f0) = 0;
  *(IOSurfaceRoot **)(param_1 + 0x3f8) = param_1 + 0x3f0;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x3c8) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x3d0) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  lVar9 = _thread_call_allocate_with_priority(signal_event_clients_thread,param_1,1);
  *(long *)(param_1 + 0x3c0) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  param_1[0x88] = (IOSurfaceRoot)0x1;
  lVar9 = _IOLockAlloc();
  *(long *)(param_1 + 0x200) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  uVar10 = OSArray::withCapacity(1);
  if (*(long **)(param_1 + 0x208) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x208) + 0x28))();
  }
  *(undefined8 *)(param_1 + 0x208) = uVar10;
  lVar9 = _thread_call_allocate_with_priority(async_release_thread,param_1,1);
  *(long *)(param_1 + 0x210) = lVar9;
  if (lVar9 == 0) goto LAB_00013eff;
  local_38 = &DAT_aaaaaaaaaaaaaaaa;
  local_50 = 8;
  iVar5 = _sysctlbyname("hw.cachelinesize",&local_38,&local_50,(void *)0x0,0);
  puVar14 = (undefined1 *)0x20;
  if ((iVar5 == 0) && (puVar14 = local_38, local_38 == (undefined1 *)0x0)) {
    local_38 = (undefined1 *)0x80;
    puVar14 = (undefined1 *)0x80;
  }
  *(int *)(param_1 + 0xa8) = (int)puVar14;
  iVar5 = (int)puVar14 + -1;
  *(int *)(param_1 + 0xac) = iVar5;
  *(int *)(param_1 + 0xb0) = iVar5;
  *(undefined8 *)(param_1 + 0xb8) = 0x7fffffff;
  *(undefined8 *)(param_1 + 0xc0) = 0x7fffffff;
  *(undefined8 *)(param_1 + 200) = 0x7fffffff;
  *(undefined8 *)(param_1 + 0xe0) = 0;
  alloc_handles(param_1);
  local_3c = 0xaaaaaaaa;
  local_48 = &DAT_aaaaaaaaaaaaaaaa;
  uVar11 = alloc_event_shared(param_1,0,&local_3c,(long *)&local_48);
  if ((char)uVar11 == '\0') {
    __os_log_internal(0,PTR___os_log_default_00027090,0x11);
  }
  param_1[0x89] = (IOSurfaceRoot)0x1;
  uVar8 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x468) = uVar8;
  puVar2 = PTR__gIODTPlane_00027098;
  plVar12 = (long *)IORegistryEntry::fromPath
                              ("/",*(IORegistryPlane **)PTR__gIODTPlane_00027098,(char *)0x0,
                               (int *)0x0,(IORegistryEntry *)0x0);
  cVar3 = IORegistryEntry::propertyExists
                    ((char *)plVar12,(IORegistryPlane *)"non-coherent",(uint)*(undefined8 *)puVar2);
  if (cVar3 != '\0') {
    param_1[0x89] = (IOSurfaceRoot)0x0;
    (**(code **)(*(long *)param_1 + 0x278))(param_1,"iosurface-non-coherent",1);
  }
  *(undefined8 *)(param_1 + 0x180) = 0;
  cVar3 = IORegistryEntry::propertyExists
                    ((char *)plVar12,(IORegistryPlane *)"display-carveout-inhibitcache",
                     (uint)*(undefined8 *)puVar2);
  plVar13 = (long *)IORegistryEntry::fromPath
                              ("/vram",*(IORegistryPlane **)puVar2,(char *)0x0,(int *)0x0,
                               (IORegistryEntry *)0x0);
  if (plVar13 != (long *)0x0) {
    (**(code **)(*plVar13 + 0x28))(plVar13);
    uVar11 = (ulong)*(uint *)(param_1 + 0x180);
    *(char **)(param_1 + uVar11 * 8 + 0x158) = "vram";
    *(char **)(param_1 + uVar11 * 8 + 0x168) = "PurpleGfxMem";
    uVar15 = 0x400;
    if (cVar3 != '\0') {
      uVar15 = 0x100;
    }
    *(undefined4 *)(param_1 + uVar11 * 4 + 0x178) = uVar15;
    *(int *)(param_1 + 0x180) = *(int *)(param_1 + 0x180) + 1;
  }
  *(code **)(param_1 + 0x188) = installMemoryRegions;
  uVar10 = _thread_call_allocate();
  *(undefined8 *)(param_1 + 400) = uVar10;
  _thread_call_enter(uVar10);
  uVar8 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x470) = uVar8;
  *(undefined8 *)(param_1 + 0x1e0) = 0;
  *(IOSurfaceRoot **)(param_1 + 0x1e8) = param_1 + 0x1e0;
  lVar9 = IOWorkLoop::workLoop();
  if (*(long **)(param_1 + 0x1c0) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x1c0) + 0x28))();
  }
  *(long *)(param_1 + 0x1c0) = lVar9;
  if (lVar9 == 0) {
LAB_00013eee:
    uVar4 = 0;
  }
  else {
    lVar9 = IOCommandGate::commandGate
                      ((OSObject *)param_1,
                       (_func_int_OSObject_ptr_void_ptr_void_ptr_void_ptr_void_ptr *)0x0);
    if (*(long **)(param_1 + 0x1c8) != (long *)0x0) {
      (**(code **)(**(long **)(param_1 + 0x1c8) + 0x28))();
    }
    *(long *)(param_1 + 0x1c8) = lVar9;
    if (lVar9 == 0) goto LAB_00013eee;
    lVar9 = _IOLockAlloc();
    *(long *)(param_1 + 0x1d8) = lVar9;
    if (lVar9 == 0) goto LAB_00013eee;
    lVar9 = IOInterruptEventSource::interruptEventSource
                      ((OSObject *)param_1,fenceDispatch,(IOService *)0x0,0);
    if (*(long **)(param_1 + 0x1d0) != (long *)0x0) {
      (**(code **)(**(long **)(param_1 + 0x1d0) + 0x28))();
    }
    *(long *)(param_1 + 0x1d0) = lVar9;
    if (((lVar9 == 0) ||
        (iVar5 = (**(code **)(**(long **)(param_1 + 0x1c0) + 0x140))
                           (*(long **)(param_1 + 0x1c0),lVar9), iVar5 != 0)) ||
       (iVar5 = (**(code **)(**(long **)(param_1 + 0x1c0) + 0x140))
                          (*(long **)(param_1 + 0x1c0),*(undefined8 *)(param_1 + 0x1c8)), iVar5 != 0
       )) goto LAB_00013eee;
    (**(code **)(**(long **)(param_1 + 0x1d0) + 0x150))();
    (**(code **)(**(long **)(param_1 + 0x1c8) + 0x150))();
    uVar8 = _mach_absolute_time();
    *(uint64_t *)(param_1 + 0x478) = uVar8;
    pIVar1 = param_1 + 0x3a0;
    bVar6 = _PE_parse_boot_argn("iofence_ddd",pIVar1,4);
    if ((bVar6 != 0) && (0x10 < *(uint *)pIVar1)) {
      *(uint *)pIVar1 = 0x10;
    }
    pIVar1 = param_1 + 0x1b4;
    bVar6 = _PE_parse_boot_argn("iosurface_debug",pIVar1,4);
    if (bVar6 == 0) {
      *(uint *)pIVar1 = 0x14;
      fmt = "IOSurface allowing global lookups (with warnings)\n";
    }
    else {
      uVar7 = *(uint *)pIVar1;
      if ((uVar7 & 2) != 0) {
        _kprintf("IOSurface disallowing pixel size casting by default\n");
        uVar7 = *(uint *)pIVar1;
      }
      fmt = "IOSurface allowing global lookups (with warnings)\n";
      if ((uVar7 & 4) == 0) {
        fmt = "IOSurface disallowing global lookups\n";
      }
    }
    _kprintf(fmt);
    if (((byte)*pIVar1 & 8) != 0) {
      param_1[0x1b8] = (IOSurfaceRoot)((byte)param_1[0x1b8] | 0x20);
      _kprintf("IOSurface using pageable shmems\n");
    }
    uVar8 = _mach_absolute_time();
    *(uint64_t *)(param_1 + 0x480) = uVar8;
    uVar10 = IOBufferMemoryDescriptor::withOptions
                       (*(uint *)(param_1 + 0x1b8) | 0x10000,*(ulong *)PTR__page_size_000270c0,
                        *(ulong *)PTR__page_size_000270c0);
    if (*(long **)(param_1 + 0x1f8) != (long *)0x0) {
      (**(code **)(**(long **)(param_1 + 0x1f8) + 0x28))();
    }
    *(undefined8 *)(param_1 + 0x1f8) = uVar10;
    (**(code **)(*(long *)param_1 + 0x3b0))(param_1,"IOSurfaceRoot",0);
    uVar8 = _mach_absolute_time();
    *(uint64_t *)(param_1 + 0x488) = uVar8;
    (**(code **)(*(long *)param_1 + 0x5b0))(param_1,0);
    uVar8 = _mach_absolute_time();
    *(uint64_t *)(param_1 + 0x490) = uVar8;
  }
  if (plVar12 != (long *)0x0) {
    (**(code **)(*plVar12 + 0x28))(plVar12);
  }
LAB_00013eff:
  uVar8 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x498) = uVar8;
  return uVar4;
}



// IOSurfaceRoot::signal_event_clients_thread()

void __thiscall IOSurfaceRoot::signal_event_clients_thread(IOSurfaceRoot *this)

{
  _IOLockLock(*(undefined8 *)(this + 0x3c8));
  signal_event_clients_loop(this);
  this[1000] = (IOSurfaceRoot)0x0;
  _IOLockUnlock(*(undefined8 *)(this + 0x3c8));
                    // WARNING: Could not recover jumptable at 0x000140ba. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x28))(this);
  return;
}



// IOSurfaceRoot::async_release_thread()

void __thiscall IOSurfaceRoot::async_release_thread(IOSurfaceRoot *this)

{
  IOSurfaceRoot *pIVar1;
  int iVar2;
  uint uVar3;
  uint64_t uVar4;
  IOSurface *this_00;
  
  _clock_interval_to_deadline(0x7d,1000000);
  _IOLockLock(*(undefined8 *)(this + 0x200));
  pIVar1 = this + 0x208;
  while( true ) {
    iVar2 = (**(code **)(**(long **)(this + 0x208) + 0x130))();
    if (iVar2 == 0) break;
    uVar4 = _mach_absolute_time();
    if (0xaaaaaaaaaaaaaaa9 < uVar4) break;
    this_00 = (IOSurface *)(**(code **)(**(long **)pIVar1 + 0x1e8))(*(long **)pIVar1,0);
    if (this_00 != (IOSurface *)0x0) {
      (**(code **)(*(long *)this_00 + 0x20))(this_00);
    }
    (**(code **)(**(long **)(this + 0x208) + 0x1d8))();
    if (*(long *)(this + 0x220) != 0) {
      uVar3 = (**(code **)(**(long **)pIVar1 + 0x130))();
      if (uVar3 < 0x80) {
        _IOLockWakeup_darwin14(*(undefined8 *)(this + 0x200),pIVar1,0);
      }
    }
    _IOLockUnlock(*(undefined8 *)(this + 0x200));
    IOSurface::clientRelease(this_00);
    iVar2 = IOSurface::getClientRetainCount(this_00);
    if (iVar2 == 0) {
      IOSurface::prune_orphaned_device_caches(this_00);
    }
    if (this_00 != (IOSurface *)0x0) {
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
    _IOLockLock(*(undefined8 *)(this + 0x200));
  }
  iVar2 = (**(code **)(**(long **)pIVar1 + 0x130))();
  if (iVar2 == 0) {
    this[0x218] = (IOSurfaceRoot)0x0;
  }
  else {
    (**(code **)(*(long *)this + 0x20))(this);
    _thread_call_enter(*(undefined8 *)(this + 0x210));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x200));
  (**(code **)(*(long *)this + 0x28))(this);
  return;
}



// IOSurfaceRoot::alloc_handles()

ulong __thiscall IOSurfaceRoot::alloc_handles(IOSurfaceRoot *this)

{
  uint uVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  undefined8 uVar6;
  undefined8 *puVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  uint uVar13;
  ulong uVar14;
  ulong uVar15;
  ulong uVar16;
  
  uVar13 = *(uint *)(this + 0xd8);
  uVar9 = (ulong)uVar13;
  if (uVar9 == 0) {
    uVar10 = 0x200;
  }
  else {
    if (0xffff < uVar13) {
      uVar9 = 0;
      goto LAB_00014541;
    }
    uVar10 = uVar9 * 2;
  }
  uVar16 = uVar10 >> 6;
  uVar8 = uVar16 * 8;
  uVar2 = *(ulong *)(this + 0xd0);
  uVar3 = *(ulong *)(this + 0xe8);
  uVar1 = *(uint *)(this + 0xf0);
  uVar5 = (ulong)uVar1;
  uVar6 = _IOMallocTypeVarImpl(&alloc_handles()::kalloc_type_view_1530);
  *(undefined8 *)(this + 0xd0) = uVar6;
  *(int *)(this + 0xd8) = (int)uVar10;
  puVar7 = (undefined8 *)_IOMallocZeroData(uVar8);
  *(undefined8 **)(this + 0xe8) = puVar7;
  *(int *)(this + 0xf0) = (int)uVar16;
  if ((*(long *)(this + 0xd0) == 0) || (puVar7 == (undefined8 *)0x0)) {
    uVar9 = 0;
    _IOLog("IOMalloc failed to alloc handles");
    *(ulong *)(this + 0xd0) = uVar2;
    *(uint *)(this + 0xd8) = uVar13;
    *(ulong *)(this + 0xe8) = uVar3;
    *(uint *)(this + 0xf0) = uVar1;
  }
  else {
    if (uVar2 == 0) {
      uVar9 = (long)(puVar7 + uVar16) - (long)puVar7;
      if ((puVar7 + uVar16 < puVar7) || (uVar9 >> 0x20 != 0)) {
LAB_00014577:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      if ((uVar9 & 0xfffffff8) == 0) {
LAB_00014553:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                  );
      }
      *puVar7 = 1;
    }
    else {
      if (uVar13 != 0) {
        uVar10 = uVar2 + uVar9 * 8;
        uVar8 = uVar10 - uVar2;
        if ((uVar10 < uVar2) || (uVar8 >> 0x20 != 0)) goto LAB_00014577;
        uVar10 = 0;
        uVar11 = 0;
        do {
          if (uVar11 == 0x10000000) goto LAB_0001456b;
          if ((long)uVar10 < 0) goto LAB_00014553;
          uVar12 = uVar10 >> 0x20;
          uVar13 = (int)(uVar10 >> 0x20) + 8;
          if ((uint)uVar8 < uVar13) goto LAB_00014553;
          uVar14 = -(ulong)CARRY8(uVar2,uVar12);
          if ((CARRY8(uVar2,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_0001455f;
          uVar4 = *(ulong *)(this + 0xd0);
          uVar14 = uVar4 + (ulong)*(uint *)(this + 0xd8) * 8;
          uVar15 = uVar14 - uVar4;
          if ((uVar14 < uVar4) || (uVar15 >> 0x20 != 0)) goto LAB_00014577;
          if ((uint)uVar15 < uVar13) goto LAB_00014553;
          uVar14 = -(ulong)CARRY8(uVar4,uVar12);
          if ((CARRY8(uVar4,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_0001455f;
          *(undefined8 *)(uVar4 + uVar12) = *(undefined8 *)(uVar2 + uVar12);
          uVar11 = uVar11 + 1;
          uVar10 = uVar10 + 0x800000000;
        } while (uVar9 != uVar11);
      }
      if (uVar1 != 0) {
        uVar10 = uVar5 * 8 + uVar3;
        uVar8 = uVar10 - uVar3;
        if ((uVar10 < uVar3) || (uVar8 >> 0x20 != 0)) goto LAB_00014577;
        uVar10 = 0;
        uVar11 = 0;
        do {
          if (uVar11 == 0x10000000) {
LAB_0001456b:
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                      );
          }
          if ((long)uVar10 < 0) goto LAB_00014553;
          uVar12 = uVar10 >> 0x20;
          uVar13 = (int)(uVar10 >> 0x20) + 8;
          if ((uint)uVar8 < uVar13) goto LAB_00014553;
          uVar14 = -(ulong)CARRY8(uVar3,uVar12);
          if ((CARRY8(uVar3,uVar12) != uVar14) || ((long)uVar14 < 0)) {
LAB_0001455f:
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                      );
          }
          uVar4 = *(ulong *)(this + 0xe8);
          uVar14 = uVar4 + uVar16 * 8;
          uVar15 = uVar14 - uVar4;
          if ((uVar14 < uVar4) || (uVar15 >> 0x20 != 0)) goto LAB_00014577;
          if ((uint)uVar15 < uVar13) goto LAB_00014553;
          uVar14 = -(ulong)CARRY8(uVar4,uVar12);
          if ((CARRY8(uVar4,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_0001455f;
          *(undefined8 *)(uVar4 + uVar12) = *(undefined8 *)(uVar3 + uVar12);
          uVar11 = uVar11 + 1;
          uVar10 = uVar10 + 0x800000000;
        } while (uVar5 != uVar11);
      }
      _IOFreeTypeVarImpl(&alloc_handles()::kalloc_type_view_1549,uVar2,uVar9 << 3);
      _IOFreeData(uVar3,uVar5 * 8);
      uVar8 = uVar3;
    }
    uVar9 = CONCAT71((int7)(uVar8 >> 8),1);
  }
LAB_00014541:
  return uVar9 & 0xffffffff;
}



// IOSurfaceRoot::alloc_event_shared(unsigned int, unsigned int*, unsigned long long**)

ulong __thiscall
IOSurfaceRoot::alloc_event_shared(IOSurfaceRoot *this,uint param_1,uint *param_2,long *param_3)

{
  ulong uVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x140));
  uVar1 = alloc_shared((undefined8 *)(this + 0x130),param_1,8,*(uint *)(this + 0x1b8),param_2,
                       param_3);
  if ((char)uVar1 == '\0') {
    _IOLog("IOSurfaceSharedRO alloc failed");
  }
  else {
    *(undefined8 *)*param_3 = 0;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x140));
  return uVar1 & 0xffffffff;
}



// IOSurfaceRoot::installMemoryRegions()

undefined8 __thiscall IOSurfaceRoot::installMemoryRegions(IOSurfaceRoot *this)

{
  char cVar1;
  IOSurfaceMemoryRegion *pIVar2;
  long *plVar3;
  long *plVar4;
  ulong uVar5;
  
  _kprintf("IOSurfaceRoot::installMemoryRegions()\n");
  if (*(int *)(this + 0x180) != 0) {
    uVar5 = 0;
    do {
      pIVar2 = (IOSurfaceMemoryRegion *)
               (**(code **)(IOSurfaceDeviceMemoryRegion::gMetaClass + 0x88))();
      if (pIVar2 != (IOSurfaceMemoryRegion *)0x0) {
        plVar3 = (long *)OSDictionary::withCapacity(1);
        plVar4 = (long *)OSString::withCString(*(char **)(this + uVar5 * 8 + 0x168));
        (**(code **)(*plVar3 + 0x1d0))(plVar3,"IOSurfaceMemoryRegion",plVar4);
        cVar1 = (**(code **)(*(long *)pIVar2 + 0x170))
                          (pIVar2,this,plVar3,*(undefined8 *)(this + uVar5 * 8 + 0x158),0,
                           *(undefined4 *)(this + uVar5 * 4 + 0x178));
        if (cVar1 != '\0') {
          addMemoryRegion(this,pIVar2);
        }
        if (plVar4 != (long *)0x0) {
          (**(code **)(*plVar4 + 0x28))(plVar4);
        }
        (**(code **)(*plVar3 + 0x28))(plVar3);
        (**(code **)(*(long *)pIVar2 + 0x28))(pIVar2);
      }
      uVar5 = uVar5 + 1;
    } while (uVar5 < *(uint *)(this + 0x180));
  }
  return 0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::fenceDispatch(IOInterruptEventSource*, int)

void __cdecl IOSurfaceRoot::fenceDispatch(long param_1)

{
  long *plVar1;
  long **pplVar2;
  long **pplVar3;
  undefined8 uVar4;
  long *plVar5;
  long *plVar6;
  char *pcVar7;
  undefined8 uVar8;
  long *local_28;
  long **local_20;
  
  local_20 = &local_28;
  local_28 = (long *)0x0;
  _IOLockLock(*(undefined8 *)(param_1 + 0x1d8));
  plVar5 = *(long **)(param_1 + 0x1e0);
  while (plVar5 != (long *)0x0) {
    pplVar2 = (long **)(plVar5 + 0xf);
    plVar1 = (long *)plVar5[0xf];
    if (plVar1 == (long *)0x0) {
      plVar6 = (long *)plVar5[0x10];
      if ((long *)*plVar6 != plVar5) {
LAB_0001483b:
        pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
        goto LAB_00014854;
      }
      *(long **)(param_1 + 0x1e8) = plVar6;
    }
    else {
      if ((long **)plVar1[0x10] != pplVar2) {
        pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
LAB_00014854:
        uVar4 = 0x800;
        uVar8 = 0x800;
        goto LAB_00014884;
      }
      if (*(long **)plVar5[0x10] != plVar5) goto LAB_0001483b;
      plVar1[0x10] = (long)plVar5[0x10];
      plVar6 = (long *)plVar5[0x10];
    }
    *plVar6 = (long)plVar1;
    plVar5[0x10] = 0;
    *pplVar2 = (long *)0x0;
    plVar5[0x10] = (long)local_20;
    *local_20 = plVar5;
    plVar5 = plVar1;
    local_20 = pplVar2;
  }
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x1d8));
  plVar5 = local_28;
  pplVar2 = local_20;
  do {
    if (plVar5 == (long *)0x0) {
      return;
    }
    plVar1 = (long *)plVar5[0xf];
    if (plVar1 == (long *)0x0) {
      pplVar3 = (long **)plVar5[0x10];
      local_20 = pplVar3;
      if (*pplVar3 != plVar5) {
LAB_00014844:
        pcVar7 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0001486f:
        uVar4 = 0x80a;
        uVar8 = 0x80a;
        local_20 = pplVar2;
LAB_00014884:
                    // WARNING: Subroutine does not return
        _panic(pcVar7,plVar5,uVar4,"IOSurfaceRoot.cpp",uVar8);
      }
    }
    else {
      if ((long *)plVar1[0x10] != plVar5 + 0xf) {
        pcVar7 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_0001486f;
      }
      if (*(long **)plVar5[0x10] != plVar5) goto LAB_00014844;
      plVar1[0x10] = (long)plVar5[0x10];
      pplVar3 = (long **)plVar5[0x10];
      local_20 = pplVar2;
    }
    *pplVar3 = plVar1;
    IOSurface::fence_completed_dispatch((IOSurface *)plVar5[2]);
    (**(code **)(*plVar5 + 0x28))(plVar5);
    plVar5 = plVar1;
    pplVar2 = local_20;
  } while( true );
}



// IOSurfaceRoot::stop(IOService*)

void __thiscall IOSurfaceRoot::stop(IOSurfaceRoot *this,undefined8 param_1)

{
  _thread_call_free(*(undefined8 *)(this + 400));
  if (*(long **)(this + 0x150) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x150) + 0x28))();
  }
  *(undefined8 *)(this + 0x150) = 0;
  if (*(long **)(this + 0x1c0) != (long *)0x0) {
    if (*(long *)(this + 0x1c8) != 0) {
      (**(code **)(**(long **)(this + 0x1c0) + 0x148))();
      if (*(long **)(this + 0x1c8) != (long *)0x0) {
        (**(code **)(**(long **)(this + 0x1c8) + 0x28))();
      }
      *(undefined8 *)(this + 0x1c8) = 0;
    }
    if (*(long *)(this + 0x1d0) != 0) {
      (**(code **)(**(long **)(this + 0x1c0) + 0x148))();
      if (*(long **)(this + 0x1d0) != (long *)0x0) {
        (**(code **)(**(long **)(this + 0x1d0) + 0x28))();
      }
      *(undefined8 *)(this + 0x1d0) = 0;
    }
    if (*(long *)(this + 0x1d8) != 0) {
      _IOLockFree();
      *(undefined8 *)(this + 0x1d8) = 0;
    }
    (**(code **)(**(long **)(this + 0x1c0) + 0x158))();
    if (*(long **)(this + 0x1c0) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x1c0) + 0x28))();
    }
    *(undefined8 *)(this + 0x1c0) = 0;
  }
  if (*(long *)(this + 0x140) != 0) {
    _IOLockFree();
    *(undefined8 *)(this + 0x140) = 0;
  }
  if (*(long *)(this + 0x138) != 0) {
    _IOLockFree();
    *(undefined8 *)(this + 0x138) = 0;
  }
  free_shared_event_handles(this);
  free_handles(this);
  free_shared(this);
                    // WARNING: Could not recover jumptable at 0x000149e7. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027080 + 0x5d8))(this,param_1);
  return;
}



// IOSurfaceRoot::free_shared_event_handles()

void __thiscall IOSurfaceRoot::free_shared_event_handles(IOSurfaceRoot *this)

{
  uint uVar1;
  undefined8 uVar2;
  
  uVar2 = *(undefined8 *)(this + 0x118);
  uVar1 = *(uint *)(this + 0x120);
  _IOFreeTypeVarImpl(&free_shared_event_handles()::kalloc_type_view_1736,
                     *(undefined8 *)(this + 0x108),(ulong)*(uint *)(this + 0x110) << 3);
  _IOFreeData(uVar2,(ulong)uVar1 << 3);
  *(undefined8 *)(this + 0x108) = 0;
  *(undefined4 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x118) = 0;
  *(undefined4 *)(this + 0x120) = 0;
  return;
}



// IOSurfaceRoot::free_handles()

void __thiscall IOSurfaceRoot::free_handles(IOSurfaceRoot *this)

{
  uint uVar1;
  undefined8 uVar2;
  
  uVar2 = *(undefined8 *)(this + 0xe8);
  uVar1 = *(uint *)(this + 0xf0);
  _IOFreeTypeVarImpl(&free_handles()::kalloc_type_view_1568,*(undefined8 *)(this + 0xd0),
                     (ulong)*(uint *)(this + 0xd8) << 3);
  _IOFreeData(uVar2,(ulong)uVar1 << 3);
  *(undefined8 *)(this + 0xd0) = 0;
  *(undefined4 *)(this + 0xd8) = 0;
  *(undefined8 *)(this + 0xe8) = 0;
  *(undefined4 *)(this + 0xf0) = 0;
  return;
}



// IOSurfaceRoot::free_shared()

void __thiscall IOSurfaceRoot::free_shared(IOSurfaceRoot *this)

{
  undefined8 *puVar1;
  undefined8 *puVar2;
  
  puVar2 = *(undefined8 **)(this + 0xf8);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[2] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[2] + 0x28))();
    }
    puVar2[2] = 0;
    _IOFreeTypeImpl(&free_shared()::kalloc_type_view_2006,puVar2);
    puVar2 = puVar1;
  }
  puVar2 = *(undefined8 **)(this + 0x100);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[2] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[2] + 0x28))();
    }
    puVar2[2] = 0;
    if ((long *)puVar2[1] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[1] + 0x28))();
    }
    puVar2[1] = 0;
    _IOFreeTypeImpl(&free_shared()::kalloc_type_view_2017,puVar2);
    puVar2 = puVar1;
  }
  puVar2 = *(undefined8 **)(this + 0x130);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[2] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[2] + 0x28))();
    }
    puVar2[2] = 0;
    if ((long *)puVar2[1] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[1] + 0x28))();
    }
    puVar2[1] = 0;
    _IOFreeTypeImpl(&free_shared()::kalloc_type_view_2028,puVar2);
    puVar2 = puVar1;
  }
  return;
}



// IOSurfaceRoot::newUserClient(task*, void*, unsigned int, IOUserClient**)

undefined8 __thiscall
IOSurfaceRoot::newUserClient
          (IOSurfaceRoot *this,undefined8 param_1,undefined8 param_3_00,int param_3,
          undefined8 *param_4)

{
  char cVar1;
  long *plVar2;
  
  *param_4 = 0;
  if ((param_3 == 0) &&
     (plVar2 = (long *)(**(code **)(IOSurfaceRootUserClient::gMetaClass + 0x88))(),
     plVar2 != (long *)0x0)) {
    cVar1 = (**(code **)(*plVar2 + 0x988))(plVar2,this,param_1,0);
    if ((cVar1 != '\0') && (cVar1 = (**(code **)(*plVar2 + 0x670))(plVar2,this), cVar1 != '\0')) {
      cVar1 = (**(code **)(*plVar2 + 0x5c0))(plVar2,this);
      if (cVar1 != '\0') {
        *param_4 = plVar2;
        return 0;
      }
      (**(code **)(*plVar2 + 0x678))(plVar2,this);
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return 0xe00002c9;
}



// IOSurfaceRoot::add_surface_buffer(IOSurface*)

void __thiscall IOSurfaceRoot::add_surface_buffer(IOSurfaceRoot *this,long param_1)

{
  int iVar1;
  IOSurfaceRoot *pIVar2;
  int iVar3;
  long lVar4;
  
  pIVar2 = this + 0x90;
  lVar4 = *(long *)(this + 0x90);
  if (lVar4 == 0) {
    *(undefined8 *)(param_1 + 0x18) = 0;
    *(long *)(this + 0x98) = param_1 + 0x18;
  }
  else {
    if (*(IOSurfaceRoot **)(lVar4 + 0x20) != pIVar2) {
                    // WARNING: Subroutine does not return
      _panic("\"Bad tailq head %p first->prev != head @%u\" @%s:%d",pIVar2,0x23a,"IOSurfaceRoot.cpp"
             ,0x23a);
    }
    *(long *)(param_1 + 0x18) = lVar4;
    *(long *)(lVar4 + 0x20) = param_1 + 0x18;
  }
  *(long *)(this + 0x90) = param_1;
  *(IOSurfaceRoot **)(param_1 + 0x20) = pIVar2;
  iVar3 = *(int *)(this + 500);
  iVar1 = iVar3 + 1;
  *(int *)(this + 500) = iVar1;
  if ((iVar3 - 0xfdffU < 0x201) && (this[0x1f0] == (IOSurfaceRoot)0x0)) {
    __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                      "IOSurface count of %d approaching limit of %d",iVar1,0x10000);
    _IOLog("IOSurface count of %d approaching limit of %d\n",*(undefined4 *)(this + 500),0x10000);
    log_client_surface_creation_counts(this);
    this[0x1f0] = (IOSurfaceRoot)0x1;
  }
  return;
}



// IOSurfaceRoot::log_client_surface_creation_counts()

void __thiscall IOSurfaceRoot::log_client_surface_creation_counts(IOSurfaceRoot *this)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  IOSurfaceRootUserClient *this_00;
  
  plVar1 = (long *)(**(code **)(*(long *)this + 0x6a8))();
  if (plVar1 != (long *)0x0) {
    pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar1 + 0x128))(plVar1);
    while (pOVar2 != (OSMetaClassBase *)0x0) {
      this_00 = (IOSurfaceRootUserClient *)
                OSMetaClassBase::safeMetaCast
                          (pOVar2,(OSMetaClass *)&IOSurfaceRootUserClient::gMetaClass);
      if (this_00 != (IOSurfaceRootUserClient *)0x0) {
        IOSurfaceRootUserClient::log_surface_creation_count(this_00);
      }
      pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar1 + 0x128))(plVar1);
    }
                    // WARNING: Could not recover jumptable at 0x00014de0. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x28))(plVar1);
    return;
  }
  return;
}



// IOSurfaceRoot::remove_surface_buffer(IOSurface*)

void __thiscall IOSurfaceRoot::remove_surface_buffer(IOSurfaceRoot *this,long param_1)

{
  int iVar1;
  long lVar2;
  long *plVar3;
  char *pcVar4;
  
  lVar2 = *(long *)(param_1 + 0x18);
  if (lVar2 == 0) {
    plVar3 = *(long **)(param_1 + 0x20);
    if (*plVar3 == param_1) {
      *(long **)(this + 0x98) = plVar3;
LAB_00014e22:
      *plVar3 = lVar2;
      iVar1 = *(int *)(this + 500);
      *(uint *)(this + 500) = iVar1 - 1U;
      if ((iVar1 - 1U < 0x4001) && (this[0x1f0] != (IOSurfaceRoot)0x0)) {
        this[0x1f0] = (IOSurfaceRoot)0x0;
      }
      return;
    }
  }
  else {
    if (*(long *)(lVar2 + 0x20) != param_1 + 0x18) {
      pcVar4 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_00014e5c;
    }
    if (**(long **)(param_1 + 0x20) == param_1) {
      *(long **)(lVar2 + 0x20) = *(long **)(param_1 + 0x20);
      plVar3 = *(long **)(param_1 + 0x20);
      goto LAB_00014e22;
    }
  }
  pcVar4 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00014e5c:
                    // WARNING: Subroutine does not return
  _panic(pcVar4,param_1,0x24c,"IOSurfaceRoot.cpp",0x24c);
}



// IOSurfaceRoot::find_surface(unsigned int, task*, IOSurfaceRootUserClient*)

long __thiscall
IOSurfaceRoot::find_surface
          (IOSurfaceRoot *this,ulong param_2_00,long param_2,IOSurfaceRootUserClient *param_3)

{
  long lVar1;
  ulong uVar2;
  char cVar3;
  uint uVar4;
  ulong uVar5;
  ulong uVar6;
  ulong uVar7;
  
  uVar4 = (uint)param_2_00;
  if ((uVar4 != 0) && (uVar4 < *(uint *)(this + 0xd8))) {
    uVar2 = *(ulong *)(this + 0xd0);
    uVar6 = uVar2 + (ulong)*(uint *)(this + 0xd8) * 8;
    uVar5 = uVar6 - uVar2;
    if ((uVar6 < uVar2) || (uVar5 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar1 = (param_2_00 & 0xffffffff) * 8;
    if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar6 = (param_2_00 & 0xffffffff) << 0x23;
    if (((long)uVar6 < 0) || ((uint)uVar5 < (int)(uVar6 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar7 = (ulong)CARRY8(uVar2,uVar6 >> 0x20);
    uVar5 = -uVar7;
    if ((uVar7 != uVar5) || ((long)uVar5 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    lVar1 = *(long *)(uVar2 + (uVar6 >> 0x20));
    if (lVar1 != 0) {
      if (*(uint *)(lVar1 + 0x10) != uVar4) {
                    // WARNING: Subroutine does not return
        _panic("\"IOSurface in slot %08x has a mismatched surface ID of %08x\\n\" @%s:%d",param_2_00
               ,(ulong)*(uint *)(lVar1 + 0x10),"IOSurfaceRoot.cpp",0x2a3);
      }
      if (*(long *)(lVar1 + 0x170) == param_2) {
        return lVar1;
      }
      if ((param_3 != (IOSurfaceRootUserClient *)0x0) &&
         (cVar3 = IOSurfaceRootUserClient::knows_surface(param_3,lVar1), cVar3 != '\0')) {
        return lVar1;
      }
      if ((*(uint *)(lVar1 + 0x3c8) & 0x80002) == 2) {
        return lVar1;
      }
    }
  }
  return 0;
}



// IOSurfaceRoot::lookupSurface(unsigned int, task*)

IOSurface * __thiscall IOSurfaceRoot::lookupSurface(IOSurfaceRoot *this,uint param_1,long param_2)

{
  char cVar1;
  IOSurfaceRootUserClient *pIVar2;
  IOSurface *this_00;
  IOSurface *pIVar3;
  
  pIVar2 = (IOSurfaceRootUserClient *)userClientForTask(this,param_2);
  if (pIVar2 != (IOSurfaceRootUserClient *)0x0) {
    _IOLockLock(*(undefined8 *)(pIVar2 + 0xd8));
  }
  _IOLockLock(*(undefined8 *)(this + 0x138));
  this_00 = (IOSurface *)find_surface(this,(ulong)param_1,param_2,pIVar2);
  if (this_00 == (IOSurface *)0x0) {
    pIVar3 = (IOSurface *)0x0;
  }
  else {
    cVar1 = IOSurface::tryRetain(this_00);
    pIVar3 = (IOSurface *)0x0;
    if (cVar1 != '\0') {
      pIVar3 = this_00;
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  if (pIVar2 != (IOSurfaceRootUserClient *)0x0) {
    _IOLockUnlock(*(undefined8 *)(pIVar2 + 0xd8));
    (**(code **)(*(long *)pIVar2 + 0x28))(pIVar2);
  }
  return pIVar3;
}



// IOSurfaceRoot::userClientForTask(task*)

long * __thiscall IOSurfaceRoot::userClientForTask(IOSurfaceRoot *this,long param_1)

{
  long lVar1;
  bool bVar2;
  bool bVar3;
  long lVar4;
  long *plVar5;
  long *plVar6;
  
  _IOLockLock(*(undefined8 *)(this + 0x400));
  lVar4 = 0;
  bVar2 = true;
  do {
    bVar3 = bVar2;
    if (*(long *)(this + lVar4 * 0x10 + 0x418) == param_1) {
      plVar6 = *(long **)(this + lVar4 * 0x10 + 0x420);
      goto LAB_000150cc;
    }
    lVar4 = 1;
    bVar2 = false;
  } while (bVar3);
  lVar4 = *(long *)(this + 0x408);
  if (lVar4 == 0) {
LAB_000150dc:
    plVar6 = (long *)0x0;
  }
  else {
    plVar5 = *(long **)(this + 0x440);
    plVar6 = (long *)0x0;
    do {
      if (*plVar5 == param_1) {
        lVar4 = *plVar5;
        plVar6 = (long *)plVar5[1];
        lVar1 = *(long *)(this + 0x410);
        *(long **)(this + lVar1 * 0x10 + 0x420) = plVar6;
        *(long *)(this + lVar1 * 0x10 + 0x418) = lVar4;
        *(ulong *)(this + 0x410) = (ulong)(~*(uint *)(this + 0x410) & 1);
LAB_000150cc:
        if (plVar6 != (long *)0x0) {
          (**(code **)(*plVar6 + 0x20))(plVar6);
          break;
        }
        goto LAB_000150dc;
      }
      plVar5 = plVar5 + 2;
      lVar4 = lVar4 + -1;
    } while (lVar4 != 0);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x400));
  return plVar6;
}



// IOSurfaceRoot::lookupSurfaceFromClient(unsigned int, task*, IOSurfaceRootUserClient*)

IOSurface * __thiscall
IOSurfaceRoot::lookupSurfaceFromClient
          (IOSurfaceRoot *this,ulong param_2_00,long param_2,IOSurfaceRootUserClient *param_3)

{
  char cVar1;
  IOSurface *this_00;
  IOSurface *pIVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  this_00 = (IOSurface *)find_surface(this,param_2_00 & 0xffffffff,param_2,param_3);
  if (this_00 == (IOSurface *)0x0) {
    pIVar2 = (IOSurface *)0x0;
  }
  else {
    cVar1 = IOSurface::tryRetain(this_00);
    pIVar2 = (IOSurface *)0x0;
    if (cVar1 != '\0') {
      pIVar2 = this_00;
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return pIVar2;
}



// IOSurfaceRoot::copyPortNameForSurfaceInTask(task*, IOSurface*, unsigned int*)

void __thiscall
IOSurfaceRoot::copyPortNameForSurfaceInTask
          (IOSurfaceRoot *this,task *param_1,undefined8 param_2,uint *param_3)

{
  copyPortNameForSurfaceInTaskWithOptions(this,param_1,param_2,0,param_3);
  return;
}



// IOSurfaceRoot::copyPortNameForSurfaceInTaskWithOptions(task*, IOSurface*, unsigned long long,
// unsigned int*)

undefined4 __thiscall
IOSurfaceRoot::copyPortNameForSurfaceInTaskWithOptions
          (IOSurfaceRoot *this,task *param_1,undefined8 param_2,ulong param_3,uint *param_4)

{
  undefined4 uVar1;
  OSObject *pOVar2;
  
  if ((param_3 & 1) == 0) {
    pOVar2 = (OSObject *)IOSurfaceSendRight::withSurface(this,param_2,param_3);
  }
  else {
    pOVar2 = (OSObject *)IOSurfaceWiredSendRight::withSurface(this,param_2,param_3);
  }
  if (pOVar2 == (OSObject *)0x0) {
    uVar1 = 0xe00002bd;
  }
  else {
    uVar1 = IOUserClient::copyPortNameForObjectInTask(param_1,pOVar2,param_4);
    (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
  }
  return uVar1;
}



// IOSurfaceRoot::createSurfacePtr(task*, OSSharedPtr<OSDictionary>, IOSurface*)

IOSurface * __thiscall
IOSurfaceRoot::createSurfacePtr(IOSurfaceRoot *this,long param_1,long *param_2,long *param_3)

{
  IOSurface *pIVar1;
  
  pIVar1 = createSurface(this,param_1,param_2,param_3);
  if (param_2 != (long *)0x0) {
    (**(code **)(*param_2 + 0x28))(param_2);
  }
  return pIVar1;
}



// IOSurfaceRoot::createSurface(task*, OSDictionary*, IOSurface*)

IOSurface * __thiscall
IOSurfaceRoot::createSurface(IOSurfaceRoot *this,long param_1,long *param_2,long *param_3)

{
  IOSurface *pIVar1;
  ulong uVar2;
  
  pIVar1 = create_surface_internal(this,param_1,param_2,param_3);
  if (pIVar1 != (IOSurface *)0x0) {
    uVar2 = set_surfaceid_with_handle(this,(long)pIVar1,*(uint *)(pIVar1 + 0x10));
    if ((char)uVar2 != '\0') {
      return pIVar1;
    }
    (**(code **)(*(long *)pIVar1 + 0x28))(pIVar1);
  }
  return (IOSurface *)0x0;
}



// IOSurfaceRoot::createSurface(task*, OSDictionary*)

void __thiscall IOSurfaceRoot::createSurface(IOSurfaceRoot *this,long param_1,long *param_2)

{
  createSurface(this,param_1,param_2,(long *)0x0);
  return;
}



// IOSurfaceRoot::create_surface_internal(task*, OSDictionary*, IOSurface*)

IOSurface * __thiscall
IOSurfaceRoot::create_surface_internal(IOSurfaceRoot *this,long param_1,long *param_2,long *param_3)

{
  long *plVar1;
  bool bVar2;
  int iVar3;
  IOSurface *this_00;
  
  if (param_2 == (long *)0x0) {
    return (IOSurface *)0x0;
  }
  this_00 = (IOSurface *)(**(code **)(IOSurface::gMetaClass + 0x88))();
  if (this_00 != (IOSurface *)0x0) {
    bVar2 = IOSurface::init(this_00,this,param_1,param_2,param_3);
    if (bVar2) {
      plVar1 = *(long **)(this_00 + 0x30);
      if (((plVar1 != (long *)0x0) && (((byte)this_00[0x3c9] & 8) != 0)) &&
         (iVar3 = (**(code **)(*plVar1 + 0x1f0))(plVar1,0), iVar3 == 0)) {
        (**(code **)(**(long **)(this_00 + 0x30) + 0x1f8))(*(long **)(this_00 + 0x30),0);
      }
      IOSurface::register_surface(this_00);
      goto LAB_000152de;
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  this_00 = (IOSurface *)0x0;
LAB_000152de:
  wait_for_async_surface_releases(this);
  return this_00;
}



// IOSurfaceRoot::set_surfaceid_with_handle(IOSurface*, unsigned int)

ulong __thiscall
IOSurfaceRoot::set_surfaceid_with_handle(IOSurfaceRoot *this,long param_1,uint param_2)

{
  long lVar1;
  long *plVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  if ((param_2 == 0) || (*(uint *)(this + 0xd8) <= param_2)) {
    uVar4 = 0;
    _IOLog("trying to use apparently bogus surface handle %d",param_2);
  }
  else {
    uVar5 = *(ulong *)(this + 0xd0);
    uVar4 = uVar5 + (ulong)*(uint *)(this + 0xd8) * 8;
    uVar3 = uVar4 - uVar5;
    if ((uVar4 < uVar5) || (uVar3 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar1 = (ulong)param_2 * 8;
    if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar4 = (ulong)param_2 << 0x23;
    if (((long)uVar4 < 0) || ((uint)uVar3 < (int)(uVar4 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    plVar2 = (long *)(uVar5 + (uVar4 >> 0x20));
    uVar5 = (ulong)CARRY8(uVar5,uVar4 >> 0x20);
    uVar4 = -uVar5;
    if ((uVar5 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    if (*plVar2 == 0) {
      *plVar2 = param_1;
      uVar4 = CONCAT71((int7)((ulong)param_1 >> 8),1);
    }
    else {
      uVar4 = 0;
      _IOLog("Entry for handle %d is not NULL (%p)",param_2);
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return uVar4 & 0xffffffff;
}



// IOSurfaceRoot::wait_for_async_surface_releases()

void __thiscall IOSurfaceRoot::wait_for_async_surface_releases(IOSurfaceRoot *this)

{
  uint uVar1;
  int iVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x200));
  uVar1 = (**(code **)(**(long **)(this + 0x208) + 0x130))();
  if (0x7f < uVar1) {
    do {
      *(long *)(this + 0x220) = *(long *)(this + 0x220) + 1;
      iVar2 = _IOLockSleep_darwin14(*(undefined8 *)(this + 0x200),this + 0x208,1);
      *(long *)(this + 0x220) = *(long *)(this + 0x220) + -1;
      if (iVar2 == 2) break;
      uVar1 = (**(code **)(**(long **)(this + 0x208) + 0x130))();
    } while (0x7f < uVar1);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x200));
  return;
}



// IOSurfaceRoot::addMemoryRegion(IOSurfaceMemoryRegion*)

void __thiscall IOSurfaceRoot::addMemoryRegion(IOSurfaceRoot *this,IOSurfaceMemoryRegion *param_1)

{
  long *plVar1;
  undefined8 uVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  plVar1 = *(long **)(this + 0x150);
  if (plVar1 != (long *)0x0) {
    uVar2 = IOSurfaceMemoryRegion::getRegionName(param_1);
    (**(code **)(*plVar1 + 0x1c8))(plVar1,uVar2,param_1);
  }
  *(int *)(this + 0x184) = *(int *)(this + 0x184) + 1;
  _IOLockWakeup_darwin14(*(undefined8 *)(this + 0x138),this + 0x184,0);
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return;
}



// IOSurfaceRoot::removeMemoryRegion(IOSurfaceMemoryRegion*)

void __thiscall
IOSurfaceRoot::removeMemoryRegion(IOSurfaceRoot *this,IOSurfaceMemoryRegion *param_1)

{
  long *plVar1;
  undefined8 uVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  plVar1 = *(long **)(this + 0x150);
  if (plVar1 != (long *)0x0) {
    uVar2 = IOSurfaceMemoryRegion::getRegionName(param_1);
    (**(code **)(*plVar1 + 0x1e0))(plVar1,uVar2);
  }
  *(int *)(this + 0x184) = *(int *)(this + 0x184) + -1;
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return;
}



// IOSurfaceRoot::lookupMemoryRegion(OSString*)

long * __thiscall IOSurfaceRoot::lookupMemoryRegion(IOSurfaceRoot *this,undefined8 param_1)

{
  int iVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  plVar3 = (long *)0x0;
  do {
    if (*(int *)(this + 0x180) == *(int *)(this + 0x184)) {
      plVar3 = *(long **)(this + 0x150);
      if (plVar3 != (long *)0x0) {
        pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x200))(plVar3,param_1);
        plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                   (pOVar2,(OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass);
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x20))(plVar3);
          break;
        }
      }
      plVar3 = (long *)0x0;
      break;
    }
    iVar1 = _IOLockSleep_darwin14(*(undefined8 *)(this + 0x138),this + 0x184,1);
  } while (iVar1 != 2);
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return plVar3;
}



// IOSurfaceRoot::lookupMemoryRegion(char const*)

long * __thiscall IOSurfaceRoot::lookupMemoryRegion(IOSurfaceRoot *this,undefined8 param_1)

{
  int iVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  plVar3 = (long *)0x0;
  do {
    if (*(int *)(this + 0x180) == *(int *)(this + 0x184)) {
      plVar3 = *(long **)(this + 0x150);
      if (plVar3 != (long *)0x0) {
        pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x208))(plVar3,param_1);
        plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                   (pOVar2,(OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass);
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x20))(plVar3);
          break;
        }
      }
      plVar3 = (long *)0x0;
      break;
    }
    iVar1 = _IOLockSleep_darwin14(*(undefined8 *)(this + 0x138),this + 0x184,1);
  } while (iVar1 != 2);
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return plVar3;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::generateUniqueAcceleratorID(void*)

int __cdecl IOSurfaceRoot::generateUniqueAcceleratorID(long param_1)

{
  int iVar1;
  
  _IOLockLock(*(undefined8 *)(param_1 + 0x138));
  iVar1 = *(int *)(param_1 + 0xa4) + 1;
  *(int *)(param_1 + 0xa4) = iVar1;
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x138));
  return iVar1;
}



// IOSurfaceRoot::updateLimits(unsigned int, unsigned int, unsigned int, unsigned int, unsigned int)

void __thiscall
IOSurfaceRoot::updateLimits
          (IOSurfaceRoot *this,uint param_1,uint param_2,uint param_3,uint param_4,uint param_5)

{
  _IOLockLock(*(undefined8 *)(this + 0x138));
  *(uint *)(this + 0xac) = *(uint *)(this + 0xac) | param_1;
  *(uint *)(this + 0xb0) = *(uint *)(this + 0xb0) | param_2;
  if ((ulong)param_3 < *(ulong *)(this + 0xb8)) {
    *(ulong *)(this + 0xb8) = (ulong)param_3;
  }
  if ((ulong)param_4 < *(ulong *)(this + 0xc0)) {
    *(ulong *)(this + 0xc0) = (ulong)param_4;
  }
  if ((ulong)param_5 < *(ulong *)(this + 200)) {
    *(ulong *)(this + 200) = (ulong)param_5;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return;
}



// IOSurfaceRoot::clientTaskStopped(task*)

void __thiscall IOSurfaceRoot::clientTaskStopped(IOSurfaceRoot *this,long param_1)

{
  long lVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  for (lVar1 = *(long *)(this + 0x90); lVar1 != 0; lVar1 = *(long *)(lVar1 + 0x18)) {
    if (*(long *)(lVar1 + 0x170) == param_1) {
      *(undefined8 *)(lVar1 + 0x170) = 0;
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return;
}



// IOSurfaceRoot::terminateDeviceCachesWithAccelerator(void*)

void __thiscall
IOSurfaceRoot::terminateDeviceCachesWithAccelerator(IOSurfaceRoot *this,long param_1)

{
  long *plVar1;
  IOSurfaceDeviceCache *pIVar2;
  bool bVar3;
  IOSurfaceDeviceCache *this_00;
  IOSurfaceRoot *pIVar4;
  IOSurfaceDeviceCache **ppIVar5;
  ulong uVar6;
  IOSurfaceDeviceCache **ppIVar7;
  char *pcVar8;
  IOSurface *this_01;
  int iVar9;
  IOSurfaceDeviceCache *local_48;
  IOSurfaceDeviceCache **local_40;
  IOSurfaceRoot *local_38;
  
  local_38 = this;
  _IOLockLock(*(undefined8 *)(this + 0x138));
  local_48 = (IOSurfaceDeviceCache *)0x0;
  iVar9 = 0;
  local_40 = &local_48;
  do {
    bVar3 = true;
    for (this_01 = *(IOSurface **)(local_38 + 0x90); this_01 != (IOSurface *)0x0;
        this_01 = *(IOSurface **)(this_01 + 0x18)) {
      uVar6 = IOSurface::gatherOrphanedDeviceCachesWithAccelerator(this_01,param_1,(long)&local_48);
      pIVar4 = local_38;
      if ((char)uVar6 == '\0') {
        _IOLockUnlock(*(undefined8 *)(local_38 + 0x138));
        _IOSleep(0xfa);
        _IOLockLock(*(undefined8 *)(pIVar4 + 0x138));
        bVar3 = false;
        break;
      }
    }
    if (iVar9 == 0xf0) {
      terminateDeviceCachesWithAccelerator();
      return;
    }
    iVar9 = iVar9 + 1;
  } while (!bVar3);
  _IOLockUnlock(*(undefined8 *)(local_38 + 0x138));
  this_00 = local_48;
  do {
    if (this_00 == (IOSurfaceDeviceCache *)0x0) {
      return;
    }
    plVar1 = *(long **)(this_00 + 0x10);
    pIVar2 = *(IOSurfaceDeviceCache **)(this_00 + 0x30);
    if (pIVar2 == (IOSurfaceDeviceCache *)0x0) {
      ppIVar7 = *(IOSurfaceDeviceCache ***)(this_00 + 0x38);
      ppIVar5 = ppIVar7;
      if (*ppIVar7 != this_00) {
LAB_000158f0:
        pcVar8 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00015900:
                    // WARNING: Subroutine does not return
        _panic(pcVar8,this_00,0x420,"IOSurfaceRoot.cpp",0x420);
      }
    }
    else {
      if (*(IOSurfaceDeviceCache **)(pIVar2 + 0x38) != this_00 + 0x30) {
        pcVar8 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_00015900;
      }
      if ((IOSurfaceDeviceCache *)**(long **)(this_00 + 0x38) != this_00) goto LAB_000158f0;
      *(long **)(pIVar2 + 0x38) = *(long **)(this_00 + 0x38);
      ppIVar7 = *(IOSurfaceDeviceCache ***)(this_00 + 0x38);
      ppIVar5 = local_40;
    }
    local_40 = ppIVar5;
    *ppIVar7 = pIVar2;
    IOSurfaceDeviceCache::accelRelease(this_00);
    this_00 = pIVar2;
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  } while( true );
}



// IOSurfaceRoot::describeAllocations(void*, void (*)(void*, IOMemoryDescriptor*, unsigned int,
// int*, int))

void __thiscall
IOSurfaceRoot::describeAllocations(IOSurfaceRoot *this,undefined8 param_1,undefined *param_2)

{
  undefined4 uVar1;
  undefined8 uVar2;
  long lVar3;
  long lVar4;
  IOSurface *this_00;
  int iVar5;
  undefined4 local_138 [64];
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  _IOLockLock(*(undefined8 *)(this + 0x138));
  this_00 = *(IOSurface **)(this + 0x90);
  if (this_00 != (IOSurface *)0x0) {
    do {
      if (*(long *)(this_00 + 0x30) != 0) {
        _memset(local_138,0xaa,0x100);
        IOSurface::lock(this_00);
        iVar5 = 0;
        for (lVar4 = *(long *)(this_00 + 0x2d0); lVar4 != 0; lVar4 = *(long *)(lVar4 + 0x28)) {
          if (iVar5 < 0x40) {
            uVar2 = IOSurfaceShared::getOwningTask(*(IOSurfaceShared **)(lVar4 + 0x10));
            lVar3 = _get_bsdtask_info(uVar2);
            if (lVar3 != 0) {
              uVar1 = _proc_pid(lVar3);
              lVar3 = (long)iVar5;
              iVar5 = iVar5 + 1;
              local_138[lVar3] = uVar1;
            }
          }
        }
        IOSurface::unlock(this_00);
        (*(code *)param_2)(param_1,*(undefined8 *)(this_00 + 0x30),*(undefined4 *)(this_00 + 0x10),
                           local_138,iVar5);
      }
      this_00 = *(IOSurface **)(this_00 + 0x18);
    } while (this_00 != (IOSurface *)0x0);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  if (*(long *)PTR____stack_chk_guard_00027088 == local_38) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceRoot::write_debug_info(OSDictionary*)

void __thiscall IOSurfaceRoot::write_debug_info(IOSurfaceRoot *this,long *param_1)

{
  write_debug_info_with_options(this,param_1,1);
  return;
}



// IOSurfaceRoot::write_debug_info_with_options(OSDictionary*, unsigned int)

void __thiscall
IOSurfaceRoot::write_debug_info_with_options(IOSurfaceRoot *this,long *param_1,undefined4 param_2)

{
  IOSurfaceMemoryPoolBunch *this_00;
  char cVar1;
  _func_bool_OSObject_ptr *p_Var2;
  _func_bool_OSSymbol_ptr_OSObject_ptr *p_Var3;
  long *plVar4;
  long *plVar5;
  long *plVar6;
  OSMetaClassBase *pOVar7;
  IOSurfaceRootUserClient *this_01;
  long *plVar8;
  IOSurface *this_02;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  p_Var2 = (_func_bool_OSObject_ptr *)OSArray::withCapacity(*(uint *)(this + 500));
  if (p_Var2 != (_func_bool_OSObject_ptr *)0x0) {
    for (this_02 = *(IOSurface **)(this + 0x90); this_02 != (IOSurface *)0x0;
        this_02 = *(IOSurface **)(this_02 + 0x18)) {
      cVar1 = IOSurface::tryRetain(this_02);
      if (cVar1 != '\0') {
        (**(code **)(*(long *)p_Var2 + 0x1b8))(p_Var2);
        (**(code **)(*(long *)this_02 + 0x28))(this_02);
      }
    }
  }
  p_Var3 = (_func_bool_OSSymbol_ptr_OSObject_ptr *)
           OSDictionary::withDictionary(*(OSDictionary **)(this + 0x150),0);
  this_00 = *(IOSurfaceMemoryPoolBunch **)(this + 0x228);
  if (this_00 != (IOSurfaceMemoryPoolBunch *)0x0) {
    (**(code **)(*(long *)this_00 + 0x20))(this_00);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  plVar4 = (long *)OSArray::withCapacity(1);
  if (plVar4 == (long *)0x0) {
    plVar5 = (long *)OSArray::withCapacity(1);
  }
  else {
    (**(code **)(*plVar4 + 0x20))(plVar4);
    OSCollection::iterateObjects(p_Var2);
    (**(code **)(*param_1 + 0x1d0))(param_1,"Kernel Surfaces",plVar4);
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x28))();
    }
    plVar5 = (long *)OSArray::withCapacity(1);
    (**(code **)(*plVar4 + 0x28))(plVar4);
  }
  if (plVar5 != (long *)0x0) {
    (**(code **)(*plVar5 + 0x20))(plVar5);
    OSDictionary::iterateObjects(p_Var3);
    (**(code **)(*param_1 + 0x1d0))(param_1,"Memory Regions",plVar5);
    if (plVar5 != (long *)0x0) {
      (**(code **)(*plVar5 + 0x28))();
    }
  }
  if ((this_00 != (IOSurfaceMemoryPoolBunch *)0x0) &&
     (plVar4 = (long *)OSDictionary::withCapacity(1), plVar4 != (long *)0x0)) {
    (**(code **)(*plVar4 + 0x20))(plVar4);
    IOSurfaceMemoryPoolBunch::write_debug_info(this_00,plVar4);
    (**(code **)(*plVar4 + 0x20))(plVar4);
    OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Memory Pools");
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x28))();
    }
    (**(code **)(*plVar4 + 0x28))(plVar4);
  }
  plVar4 = (long *)OSArray::withCapacity(1);
  if (plVar4 != (long *)0x0) {
    plVar6 = (long *)(**(code **)(*(long *)this + 0x6a8))(this);
    if (plVar6 == (long *)0x0) {
      (**(code **)(*param_1 + 0x1d0))(param_1,"User Clients",plVar4);
    }
    else {
      pOVar7 = (OSMetaClassBase *)(**(code **)(*plVar6 + 0x128))(plVar6);
      while (pOVar7 != (OSMetaClassBase *)0x0) {
        this_01 = (IOSurfaceRootUserClient *)
                  OSMetaClassBase::safeMetaCast
                            (pOVar7,(OSMetaClass *)&IOSurfaceRootUserClient::gMetaClass);
        if (this_01 != (IOSurfaceRootUserClient *)0x0) {
          plVar8 = (long *)OSDictionary::withCapacity(1);
          IOSurfaceRootUserClient::write_debug_info_with_options(this_01,plVar8,param_2);
          (**(code **)(*plVar4 + 0x1b8))(plVar4,plVar8);
          if (plVar8 != (long *)0x0) {
            (**(code **)(*plVar8 + 0x28))(plVar8);
          }
        }
        pOVar7 = (OSMetaClassBase *)(**(code **)(*plVar6 + 0x128))(plVar6);
      }
      (**(code **)(*param_1 + 0x1d0))(param_1,"User Clients",plVar4);
      (**(code **)(*plVar6 + 0x28))(plVar6);
    }
    (**(code **)(*plVar4 + 0x28))(plVar4);
  }
  if (plVar5 != (long *)0x0) {
    (**(code **)(*plVar5 + 0x28))();
  }
  if (this_00 != (IOSurfaceMemoryPoolBunch *)0x0) {
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  if (p_Var3 != (_func_bool_OSSymbol_ptr_OSObject_ptr *)0x0) {
    (**(code **)(*(long *)p_Var3 + 0x28))();
  }
  if (p_Var2 != (_func_bool_OSObject_ptr *)0x0) {
    (**(code **)(*(long *)p_Var2 + 0x28))(p_Var2);
  }
  return;
}



undefined8
____ZN13IOSurfaceRoot29write_debug_info_with_optionsEP12OSDictionaryj_block_invoke
          (long param_1,IOSurface *param_2)

{
  uint uVar1;
  long *plVar2;
  long *plVar3;
  void *pvVar4;
  long *plVar5;
  
  plVar2 = (long *)OSDictionary::withCapacity(1);
  if (plVar2 != (long *)0x0) {
    IOSurface::write_debug_info_with_options(param_2,plVar2,*(int *)(param_1 + 0x28),0);
    plVar3 = (long *)OSSerialize::binaryWithCapacity
                               (*(uint *)(param_1 + 0x2c),(void *)0x0,(void *)0x0);
    if (plVar3 != (long *)0x0) {
      (**(code **)(*plVar3 + 0x120))(plVar3);
      (**(code **)(*plVar2 + 0x30))(plVar2,plVar3);
      pvVar4 = (void *)(**(code **)(*plVar3 + 0x118))(plVar3);
      uVar1 = (**(code **)(*plVar3 + 0x158))(plVar3);
      plVar5 = (long *)OSData::withBytes(pvVar4,uVar1);
      if (plVar5 != (long *)0x0) {
        (**(code **)(**(long **)(param_1 + 0x20) + 0x1b8))(*(long **)(param_1 + 0x20),plVar5);
        (**(code **)(*plVar5 + 0x28))(plVar5);
      }
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return 0;
}



void ___copy_helper_block_8_32c27_ZTS11OSSharedPtrI7OSArrayE(long param_1,long param_2)

{
  long *plVar1;
  
  plVar1 = *(long **)(param_2 + 0x20);
  *(long **)(param_1 + 0x20) = plVar1;
  if (plVar1 != (long *)0x0) {
                    // WARNING: Could not recover jumptable at 0x00015eea. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*plVar1 + 0x20))();
    return;
  }
  return;
}



void ___destroy_helper_block_8_32c27_ZTS11OSSharedPtrI7OSArrayE(long param_1)

{
  if (*(long **)(param_1 + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x20) + 0x28))();
  }
  *(undefined8 *)(param_1 + 0x20) = 0;
  return;
}



undefined8
____ZN13IOSurfaceRoot29write_debug_info_with_optionsEP12OSDictionaryj_block_invoke_40
          (long param_1,undefined8 param_2,OSMetaClassBase *param_3)

{
  long *plVar1;
  long *plVar2;
  
  plVar1 = (long *)OSMetaClassBase::safeMetaCast
                             (param_3,(OSMetaClass *)&IOSurfaceMemoryRegion::gMetaClass);
  if (plVar1 != (long *)0x0) {
    plVar2 = (long *)OSDictionary::withCapacity(1);
    if (plVar2 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x138))(plVar1,plVar2);
      (**(code **)(**(long **)(param_1 + 0x20) + 0x1b8))(*(long **)(param_1 + 0x20),plVar2);
      (**(code **)(*plVar2 + 0x28))(plVar2);
    }
  }
  return 0;
}



// IOSurfaceRoot::get_pid_gpu_policy_dict(unsigned long long, OSSerialize*)

undefined8 __thiscall
IOSurfaceRoot::get_pid_gpu_policy_dict(IOSurfaceRoot *this,long param_1,undefined8 param_2)

{
  long *plVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  long lVar4;
  undefined8 uVar5;
  
  plVar1 = (long *)(**(code **)(*(long *)this + 0x6a8))();
  if (plVar1 == (long *)0x0) {
    uVar5 = 0xe00002f0;
  }
  else {
    pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar1 + 0x128))(plVar1);
    uVar5 = 0xe00002f0;
    while (pOVar2 != (OSMetaClassBase *)0x0) {
      plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                 (pOVar2,(OSMetaClass *)&IOSurfaceRootUserClient::gMetaClass);
      if (((plVar3 != (long *)0x0) && (lVar4 = _get_bsdtask_info(plVar3[0x1e]), lVar4 != 0)) &&
         (lVar4 = _proc_uniqueid(lVar4), lVar4 == param_1)) {
        plVar3 = (long *)(**(code **)(*plVar3 + 0x2e8))(plVar3,"gpu-policies");
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x30))(plVar3,param_2);
          (**(code **)(*plVar3 + 0x28))(plVar3);
          uVar5 = 0;
        }
        break;
      }
      pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar1 + 0x128))(plVar1);
    }
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  return uVar5;
}



// IOSurfaceRoot::setSurfaceNotify(unsigned long long*, IOSurfaceNotifyArgs*,
// IOSurfaceRootUserClient*)

undefined8 __thiscall
IOSurfaceRoot::setSurfaceNotify
          (IOSurfaceRoot *this,undefined8 *param_1,ulonglong *param_2,long param_3)

{
  IOSurfaceRoot *pIVar1;
  long lVar2;
  long *plVar3;
  IOSurfaceRoot *pIVar4;
  undefined8 uVar5;
  
  _IOLockLock(*(undefined8 *)(this + 0x148));
  plVar3 = *(long **)(this + 0x198);
  if (plVar3 != (long *)0x0) {
    do {
      if ((plVar3[4] == param_2[1]) && (plVar3[0xb] == param_3)) {
        uVar5 = 0xe00002c9;
        goto LAB_0001613e;
      }
      plVar3 = (long *)*plVar3;
    } while (plVar3 != (long *)0x0);
  }
  plVar3 = (long *)_IOMallocTypeImpl(&setSurfaceNotify(unsigned_long_long*,IOSurfaceNotifyArgs*,IOSurfaceRootUserClient*)
                                      ::kalloc_type_view_1293);
  if (plVar3 == (long *)0x0) {
    uVar5 = 0xe00002bd;
  }
  else {
    pIVar1 = this + 0x198;
    IOUserClient::setAsyncReference64
              ((ulonglong *)(plVar3 + 2),(ipc_port *)*param_1,*param_2,param_2[1]);
    plVar3[0xb] = param_3;
    plVar3[10] = param_2[2];
    lVar2 = *(long *)pIVar1;
    if (lVar2 == 0) {
      *plVar3 = 0;
      pIVar4 = this + 0x1a0;
    }
    else {
      if (*(IOSurfaceRoot **)(lVar2 + 8) != pIVar1) {
                    // WARNING: Subroutine does not return
        _panic("\"Bad tailq head %p first->prev != head @%u\" @%s:%d",pIVar1,0x515,
               "IOSurfaceRoot.cpp",0x515);
      }
      *plVar3 = lVar2;
      pIVar4 = (IOSurfaceRoot *)(lVar2 + 8);
    }
    *(long **)pIVar4 = plVar3;
    *(long **)pIVar1 = plVar3;
    plVar3[1] = (long)pIVar1;
    uVar5 = 0;
  }
LAB_0001613e:
  _IOLockUnlock(*(undefined8 *)(this + 0x148));
  return uVar5;
}



// IOSurfaceRoot::removeSurfaceNotify(IOSurfaceNotifyArgs*, IOSurfaceRootUserClient*)

undefined8 __thiscall
IOSurfaceRoot::removeSurfaceNotify(IOSurfaceRoot *this,long param_1,long param_2)

{
  long lVar1;
  long *plVar2;
  char *pcVar3;
  long *plVar4;
  undefined8 uVar5;
  
  _IOLockLock(*(undefined8 *)(this + 0x148));
  plVar4 = *(long **)(this + 0x198);
  uVar5 = 0xe00002c2;
  if (plVar4 != (long *)0x0) {
    do {
      if ((plVar4[4] == *(long *)(param_1 + 8)) && (plVar4[0xb] == param_2)) {
        lVar1 = *plVar4;
        if (lVar1 == 0) {
          plVar2 = (long *)plVar4[1];
          if ((long *)*plVar2 != plVar4) {
LAB_0001623c:
            pcVar3 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0001624c:
                    // WARNING: Subroutine does not return
            _panic(pcVar3,plVar4,0x535,"IOSurfaceRoot.cpp",0x535);
          }
          *(long **)(this + 0x1a0) = plVar2;
        }
        else {
          if (*(long **)(lVar1 + 8) != plVar4) {
            pcVar3 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
            goto LAB_0001624c;
          }
          if (*(long **)plVar4[1] != plVar4) goto LAB_0001623c;
          *(undefined8 **)(lVar1 + 8) = (undefined8 *)plVar4[1];
          plVar2 = (long *)plVar4[1];
        }
        *plVar2 = lVar1;
        IOUserClient::releaseAsyncReference64((ulonglong *)(plVar4 + 2));
        _IOFreeTypeImpl(&removeSurfaceNotify(IOSurfaceNotifyArgs*,IOSurfaceRootUserClient*)::
                         kalloc_type_view_1339,plVar4);
        uVar5 = 0;
        break;
      }
      plVar4 = (long *)*plVar4;
    } while (plVar4 != (long *)0x0);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x148));
  return uVar5;
}



// IOSurfaceRoot::notifySurface(unsigned int, IOSurface*)

void __thiscall IOSurfaceRoot::notifySurface(IOSurfaceRoot *this,ulong param_2_00,long param_2)

{
  undefined8 *puVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x148));
  for (puVar1 = *(undefined8 **)(this + 0x198); puVar1 != (undefined8 *)0x0;
      puVar1 = (undefined8 *)*puVar1) {
    IOSurfaceRootUserClient::notify_surface
              ((IOSurfaceRootUserClient *)puVar1[0xb],(long)puVar1,param_2_00 & 0xffffffff,
               *(uint *)(param_2 + 0x10));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x148));
  return;
}



// IOSurfaceRoot::removeSurfaceNotifications(IOSurfaceRootUserClient*)

void __thiscall IOSurfaceRoot::removeSurfaceNotifications(IOSurfaceRoot *this,long param_1)

{
  long *plVar1;
  long *plVar2;
  long *plVar3;
  char *pcVar4;
  
  _IOLockLock(*(undefined8 *)(this + 0x148));
  plVar1 = *(long **)(this + 0x198);
  do {
    do {
      plVar2 = plVar1;
      if (plVar2 == (long *)0x0) {
        _IOLockUnlock(*(undefined8 *)(this + 0x148));
        return;
      }
      plVar1 = (long *)*plVar2;
    } while (plVar2[0xb] != param_1);
    if (plVar1 == (long *)0x0) {
      plVar3 = (long *)plVar2[1];
      if ((long *)*plVar3 != plVar2) {
LAB_00016365:
        pcVar4 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00016375:
                    // WARNING: Subroutine does not return
        _panic(pcVar4,plVar2,0x565,"IOSurfaceRoot.cpp",0x565);
      }
      *(long **)(this + 0x1a0) = plVar3;
    }
    else {
      if ((long *)plVar1[1] != plVar2) {
        pcVar4 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
        goto LAB_00016375;
      }
      if (*(long **)plVar2[1] != plVar2) goto LAB_00016365;
      plVar1[1] = (long)plVar2[1];
      plVar3 = (long *)plVar2[1];
    }
    *plVar3 = (long)plVar1;
    IOUserClient::releaseAsyncReference64((ulonglong *)(plVar2 + 2));
    _IOFreeTypeImpl(&removeSurfaceNotifications(IOSurfaceRootUserClient*)::kalloc_type_view_1387,
                    plVar2);
  } while( true );
}



// IOSurfaceRoot::flushMemory(void const*, unsigned int)

void __thiscall IOSurfaceRoot::flushMemory(IOSurfaceRoot *this,ulong param_1,uint param_2)

{
  undefined1 *puVar1;
  
  for (puVar1 = (undefined1 *)((long)-*(int *)(this + 0xa8) & param_1);
      puVar1 < (undefined1 *)(param_2 + param_1); puVar1 = puVar1 + *(int *)(this + 0xa8)) {
    clflush(*puVar1);
  }
  return;
}



// IOSurfaceRoot::alloc_surfaceid(unsigned int*)

ulong __thiscall IOSurfaceRoot::alloc_surfaceid(IOSurfaceRoot *this,undefined4 *param_1)

{
  ulong uVar1;
  ulong uVar2;
  ulong uVar3;
  ulong *puVar4;
  ulong uVar5;
  ulong uVar6;
  long lVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  ulong unaff_R15;
  bool bVar11;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  uVar5 = *(ulong *)(this + 0xe0) >> 6;
  do {
    uVar3 = (ulong)*(uint *)(this + 0xf0);
    if (uVar5 < uVar3) {
      uVar9 = *(ulong *)(this + 0xe8);
      uVar2 = uVar9 + uVar3 * 8;
      uVar6 = uVar2 - uVar9;
      if ((uVar2 < uVar9) || (uVar6 >> 0x20 != 0)) {
LAB_00016611:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      uVar1 = uVar5 << 6;
      uVar2 = uVar5 + 1;
      uVar10 = uVar5 << 0x23;
      unaff_R15 = CONCAT71((int7)(unaff_R15 >> 8),1);
      lVar7 = uVar5 * 8;
      do {
        if (lVar7 < 0) goto LAB_000165ed;
        if (lVar7 - 0x80000000U < 0xffffffff00000000) goto LAB_000165f9;
        if (((long)uVar10 < 0) || ((uint)uVar6 < (int)(uVar10 >> 0x20) + 8U)) goto LAB_000165e1;
        puVar4 = (ulong *)((uVar10 >> 0x20) + uVar9);
        uVar5 = (ulong)CARRY8(uVar10 >> 0x20,uVar9);
        uVar8 = -uVar5;
        if ((uVar5 != uVar8) || ((long)uVar8 < 0)) goto LAB_00016605;
        if (*puVar4 != 0xffffffffffffffff) {
          uVar3 = *(ulong *)(this + 0xd0);
          uVar5 = uVar3 + (ulong)*(uint *)(this + 0xd8) * 8;
          uVar2 = uVar5 - uVar3;
          if ((uVar5 < uVar3) || (uVar2 >> 0x20 != 0)) goto LAB_00016611;
          uVar9 = ~*puVar4;
          uVar5 = 0;
          if (uVar9 != 0) {
            for (; (uVar9 >> uVar5 & 1) == 0; uVar5 = uVar5 + 1) {
            }
          }
          uVar1 = uVar1 | uVar5;
          if ((uVar1 >> 0x3d == 0) && (-1 < (long)(uVar1 * 8))) {
            if (0xfffffffeffffffff < uVar1 * 8 - 0x80000000) {
              uVar9 = uVar1 << 0x23;
              if ((-1 < (long)uVar9) && ((int)(uVar9 >> 0x20) + 8U <= (uint)uVar2)) {
                uVar6 = (ulong)CARRY8(uVar3,uVar9 >> 0x20);
                uVar2 = -uVar6;
                if ((uVar6 == uVar2) && (-1 < (long)uVar2)) {
                  if (*(long *)(uVar3 + (uVar9 >> 0x20)) != 0) {
                    alloc_surfaceid();
                    return 0;
                  }
                  *(ulong *)(this + 0xe0) = uVar1 + 1;
                  *puVar4 = *puVar4 | 1L << ((byte)uVar5 & 0x3f);
                  *param_1 = (int)uVar1;
                  goto LAB_000165b6;
                }
LAB_00016605:
                    // WARNING: Subroutine does not return
                os_detail::panic_trapping_policy::trap
                          (
                          "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                          );
              }
LAB_000165e1:
                    // WARNING: Subroutine does not return
              os_detail::panic_trapping_policy::trap
                        (
                        "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                        );
            }
LAB_000165f9:
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                      );
          }
LAB_000165ed:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Calculating the number of bytes to add to the offset (n * sizeof(T)) would trigger an overflow"
                    );
        }
        uVar1 = uVar1 + 0x40;
        uVar10 = uVar10 + 0x800000000;
        bVar11 = uVar2 < uVar3;
        uVar2 = uVar2 + 1;
        unaff_R15 = CONCAT71((int7)(unaff_R15 >> 8),bVar11);
        lVar7 = lVar7 + 8;
      } while (uVar2 - uVar3 != 1);
    }
    else {
      unaff_R15 = 0;
      uVar3 = uVar5;
    }
    uVar2 = alloc_handles(this);
    uVar5 = uVar3;
    if ((char)uVar2 == '\0') {
LAB_000165b6:
      _IOLockUnlock(*(undefined8 *)(this + 0x138));
      return unaff_R15 & 0xffffff01;
    }
  } while( true );
}



// IOSurfaceRoot::free_surface_handle(IOSurface*, unsigned int)

void __thiscall IOSurfaceRoot::free_surface_handle(IOSurfaceRoot *this,long param_1,uint param_2)

{
  long lVar1;
  byte bVar2;
  long *plVar3;
  ulong *puVar4;
  ulong uVar5;
  ulong uVar6;
  ulong uVar7;
  ulong uVar8;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  if ((param_2 == 0) || (*(uint *)(this + 0xd8) <= param_2)) {
    _IOLog("trying to free apparently bogus surface handle %d",param_2);
  }
  else {
    uVar6 = *(ulong *)(this + 0xd0);
    uVar7 = uVar6 + (ulong)*(uint *)(this + 0xd8) * 8;
    uVar5 = uVar7 - uVar6;
    if ((uVar7 < uVar6) || (uVar5 >> 0x20 != 0)) {
LAB_0001679b:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar7 = (ulong)param_2;
    if ((long)(int)(uVar7 * 8) != uVar7 * 8) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar8 = uVar7 << 0x23;
    if (((long)uVar8 < 0) || ((uint)uVar5 < (int)(uVar8 >> 0x20) + 8U)) {
LAB_0001678f:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    plVar3 = (long *)(uVar6 + (uVar8 >> 0x20));
    uVar5 = (ulong)CARRY8(uVar6,uVar8 >> 0x20);
    uVar6 = -uVar5;
    if ((uVar5 != uVar6) || ((long)uVar6 < 0)) {
LAB_000167a7:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    lVar1 = *plVar3;
    if ((lVar1 == 0) || (lVar1 == param_1)) {
      if (uVar7 < *(ulong *)(this + 0xe0)) {
        *(ulong *)(this + 0xe0) = uVar7;
      }
      *plVar3 = 0;
      bVar2 = (byte)param_2 & 0x3f;
      uVar6 = *(ulong *)(this + 0xe8);
      uVar7 = uVar6 + (ulong)*(uint *)(this + 0xf0) * 8;
      uVar5 = uVar7 - uVar6;
      if ((uVar7 < uVar6) || (uVar5 >> 0x20 != 0)) goto LAB_0001679b;
      if ((uint)uVar5 < (param_2 >> 6) * 8 + 8) goto LAB_0001678f;
      uVar7 = (ulong)((param_2 >> 6) << 3);
      puVar4 = (ulong *)(uVar6 + uVar7);
      uVar6 = (ulong)CARRY8(uVar6,uVar7);
      uVar7 = -uVar6;
      if ((uVar6 != uVar7) || ((long)uVar7 < 0)) goto LAB_000167a7;
      *puVar4 = *puVar4 & (-2L << bVar2 | 0xfffffffffffffffeU >> 0x40 - bVar2);
    }
    else {
      _IOLog("Entry for surface handle %d %p is not equal to %p",param_2,lVar1,param_1);
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return;
}



// IOSurfaceRoot::alloc_shared_event_handles()

ulong __thiscall IOSurfaceRoot::alloc_shared_event_handles(IOSurfaceRoot *this)

{
  uint uVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  undefined8 uVar6;
  undefined8 *puVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  uint uVar13;
  ulong uVar14;
  ulong uVar15;
  ulong uVar16;
  
  uVar13 = *(uint *)(this + 0x110);
  uVar9 = (ulong)uVar13;
  if (uVar9 == 0) {
    uVar10 = 0x200;
  }
  else {
    if (0xffff < uVar13) {
      uVar9 = 0;
      goto LAB_00016ae9;
    }
    uVar10 = uVar9 * 2;
  }
  uVar16 = uVar10 >> 6;
  uVar8 = uVar16 * 8;
  uVar2 = *(ulong *)(this + 0x108);
  uVar3 = *(ulong *)(this + 0x118);
  uVar1 = *(uint *)(this + 0x120);
  uVar5 = (ulong)uVar1;
  uVar6 = _IOMallocTypeVarImpl(&alloc_shared_event_handles()::kalloc_type_view_1698);
  *(undefined8 *)(this + 0x108) = uVar6;
  *(int *)(this + 0x110) = (int)uVar10;
  puVar7 = (undefined8 *)_IOMallocZeroData(uVar8);
  *(undefined8 **)(this + 0x118) = puVar7;
  *(int *)(this + 0x120) = (int)uVar16;
  if ((*(long *)(this + 0x108) == 0) || (puVar7 == (undefined8 *)0x0)) {
    uVar9 = 0;
    _IOLog("IOMalloc failed to alloc handles");
    *(ulong *)(this + 0x108) = uVar2;
    *(uint *)(this + 0x110) = uVar13;
    *(ulong *)(this + 0x118) = uVar3;
    *(uint *)(this + 0x120) = uVar1;
  }
  else {
    if (uVar2 == 0) {
      uVar9 = (long)(puVar7 + uVar16) - (long)puVar7;
      if ((puVar7 + uVar16 < puVar7) || (uVar9 >> 0x20 != 0)) {
LAB_00016b1f:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      if ((uVar9 & 0xfffffff8) == 0) {
LAB_00016afb:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                  );
      }
      *puVar7 = 1;
    }
    else {
      if (uVar13 != 0) {
        uVar10 = uVar2 + uVar9 * 8;
        uVar8 = uVar10 - uVar2;
        if ((uVar10 < uVar2) || (uVar8 >> 0x20 != 0)) goto LAB_00016b1f;
        uVar10 = 0;
        uVar11 = 0;
        do {
          if (uVar11 == 0x10000000) goto LAB_00016b13;
          if ((long)uVar10 < 0) goto LAB_00016afb;
          uVar12 = uVar10 >> 0x20;
          uVar13 = (int)(uVar10 >> 0x20) + 8;
          if ((uint)uVar8 < uVar13) goto LAB_00016afb;
          uVar14 = -(ulong)CARRY8(uVar2,uVar12);
          if ((CARRY8(uVar2,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_00016b07;
          uVar4 = *(ulong *)(this + 0x108);
          uVar14 = uVar4 + (ulong)*(uint *)(this + 0x110) * 8;
          uVar15 = uVar14 - uVar4;
          if ((uVar14 < uVar4) || (uVar15 >> 0x20 != 0)) goto LAB_00016b1f;
          if ((uint)uVar15 < uVar13) goto LAB_00016afb;
          uVar14 = -(ulong)CARRY8(uVar4,uVar12);
          if ((CARRY8(uVar4,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_00016b07;
          *(undefined8 *)(uVar4 + uVar12) = *(undefined8 *)(uVar2 + uVar12);
          uVar11 = uVar11 + 1;
          uVar10 = uVar10 + 0x800000000;
        } while (uVar9 != uVar11);
      }
      if (uVar1 != 0) {
        uVar10 = uVar5 * 8 + uVar3;
        uVar8 = uVar10 - uVar3;
        if ((uVar10 < uVar3) || (uVar8 >> 0x20 != 0)) goto LAB_00016b1f;
        uVar10 = 0;
        uVar11 = 0;
        do {
          if (uVar11 == 0x10000000) {
LAB_00016b13:
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                      );
          }
          if ((long)uVar10 < 0) goto LAB_00016afb;
          uVar12 = uVar10 >> 0x20;
          uVar13 = (int)(uVar10 >> 0x20) + 8;
          if ((uint)uVar8 < uVar13) goto LAB_00016afb;
          uVar14 = -(ulong)CARRY8(uVar3,uVar12);
          if ((CARRY8(uVar3,uVar12) != uVar14) || ((long)uVar14 < 0)) {
LAB_00016b07:
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                      );
          }
          uVar4 = *(ulong *)(this + 0x118);
          uVar14 = uVar4 + uVar16 * 8;
          uVar15 = uVar14 - uVar4;
          if ((uVar14 < uVar4) || (uVar15 >> 0x20 != 0)) goto LAB_00016b1f;
          if ((uint)uVar15 < uVar13) goto LAB_00016afb;
          uVar14 = -(ulong)CARRY8(uVar4,uVar12);
          if ((CARRY8(uVar4,uVar12) != uVar14) || ((long)uVar14 < 0)) goto LAB_00016b07;
          *(undefined8 *)(uVar4 + uVar12) = *(undefined8 *)(uVar3 + uVar12);
          uVar11 = uVar11 + 1;
          uVar10 = uVar10 + 0x800000000;
        } while (uVar5 != uVar11);
      }
      _IOFreeTypeVarImpl(&alloc_shared_event_handles()::kalloc_type_view_1717,uVar2,uVar9 << 3);
      _IOFreeData(uVar3,uVar5 * 8);
      uVar8 = uVar3;
    }
    uVar9 = CONCAT71((int7)(uVar8 >> 8),1);
  }
LAB_00016ae9:
  return uVar9 & 0xffffffff;
}



// IOSurfaceRoot::alloc_shared_event_handle(unsigned int*)

ulong __thiscall IOSurfaceRoot::alloc_shared_event_handle(IOSurfaceRoot *this,undefined4 *param_1)

{
  ulong uVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  long lVar6;
  ulong *puVar7;
  ulong uVar8;
  ulong uVar9;
  ulong uVar10;
  ulong unaff_R15;
  bool bVar11;
  
  _IOLockLock(*(undefined8 *)(this + 0x140));
  uVar4 = *(ulong *)(this + 0x128) >> 6;
  do {
    uVar9 = (ulong)*(uint *)(this + 0x120);
    if (uVar4 < uVar9) {
      uVar1 = *(ulong *)(this + 0x118);
      uVar2 = uVar1 + uVar9 * 8;
      uVar5 = uVar2 - uVar1;
      if ((uVar2 < uVar1) || (uVar5 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      uVar3 = uVar4 << 6;
      uVar2 = uVar4 + 1;
      uVar10 = uVar4 << 0x23;
      unaff_R15 = CONCAT71((int7)(unaff_R15 >> 8),1);
      lVar6 = uVar4 * 8;
      do {
        if (lVar6 < 0) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Calculating the number of bytes to add to the offset (n * sizeof(T)) would trigger an overflow"
                    );
        }
        if (lVar6 - 0x80000000U < 0xffffffff00000000) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        if (((long)uVar10 < 0) || ((uint)uVar5 < (int)(uVar10 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        puVar7 = (ulong *)((uVar10 >> 0x20) + uVar1);
        uVar4 = (ulong)CARRY8(uVar10 >> 0x20,uVar1);
        uVar8 = -uVar4;
        if ((uVar4 != uVar8) || ((long)uVar8 < 0)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        if (*puVar7 != 0xffffffffffffffff) {
          uVar9 = ~*puVar7;
          uVar4 = 0;
          if (uVar9 != 0) {
            for (; (uVar9 >> uVar4 & 1) == 0; uVar4 = uVar4 + 1) {
            }
          }
          *(ulong *)(this + 0x128) = (uVar3 | uVar4) + 1;
          *puVar7 = *puVar7 | 1L << ((byte)uVar4 & 0x3f);
          *param_1 = (int)(uVar3 | uVar4);
          goto LAB_00016c93;
        }
        uVar3 = uVar3 + 0x40;
        uVar10 = uVar10 + 0x800000000;
        bVar11 = uVar2 < uVar9;
        uVar2 = uVar2 + 1;
        unaff_R15 = CONCAT71((int7)(unaff_R15 >> 8),bVar11);
        lVar6 = lVar6 + 8;
      } while (uVar2 - uVar9 != 1);
    }
    else {
      unaff_R15 = 0;
      uVar9 = uVar4;
    }
    uVar2 = alloc_shared_event_handles(this);
    uVar4 = uVar9;
    if ((char)uVar2 == '\0') {
LAB_00016c93:
      _IOLockUnlock(*(undefined8 *)(this + 0x140));
      return unaff_R15 & 0xffffff01;
    }
  } while( true );
}



// IOSurfaceRoot::set_shared_event_with_handle(IOSurfaceSharedEvent*, unsigned int)

ulong __thiscall
IOSurfaceRoot::set_shared_event_with_handle(IOSurfaceRoot *this,long param_1,uint param_2)

{
  long lVar1;
  long *plVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  if ((param_2 == 0) || (*(uint *)(this + 0x110) <= param_2)) {
    uVar4 = 0;
    _IOLog("trying to use apparently bogus event handle %d",param_2);
  }
  else {
    uVar5 = *(ulong *)(this + 0x108);
    uVar4 = uVar5 + (ulong)*(uint *)(this + 0x110) * 8;
    uVar3 = uVar4 - uVar5;
    if ((uVar4 < uVar5) || (uVar3 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar1 = (ulong)param_2 * 8;
    if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar4 = (ulong)param_2 << 0x23;
    if (((long)uVar4 < 0) || ((uint)uVar3 < (int)(uVar4 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    plVar2 = (long *)(uVar5 + (uVar4 >> 0x20));
    uVar5 = (ulong)CARRY8(uVar5,uVar4 >> 0x20);
    uVar4 = -uVar5;
    if ((uVar5 != uVar4) || ((long)uVar4 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    if (*plVar2 == 0) {
      *plVar2 = param_1;
      uVar4 = CONCAT71((int7)((ulong)param_1 >> 8),1);
    }
    else {
      uVar4 = 0;
      _IOLog("Entry for shared event handle %d is not NULL (%p)",param_2);
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return uVar4 & 0xffffffff;
}



// IOSurfaceRoot::free_shared_event_handle(IOSurfaceSharedEvent*, unsigned int)

void __thiscall
IOSurfaceRoot::free_shared_event_handle(IOSurfaceRoot *this,long param_1,uint param_2)

{
  long lVar1;
  byte bVar2;
  long *plVar3;
  ulong *puVar4;
  ulong uVar5;
  ulong uVar6;
  ulong uVar7;
  ulong uVar8;
  IOSurfaceRoot *pIVar9;
  
  pIVar9 = this + 0x140;
  _IOLockLock(*(undefined8 *)(this + 0x140));
  if (param_2 < *(uint *)(this + 0x110)) {
    uVar6 = *(ulong *)(this + 0x108);
    uVar7 = uVar6 + (ulong)*(uint *)(this + 0x110) * 8;
    uVar5 = uVar7 - uVar6;
    if ((uVar7 < uVar6) || (uVar5 >> 0x20 != 0)) {
LAB_00016f89:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    uVar7 = (ulong)param_2;
    if ((long)(int)(uVar7 * 8) != uVar7 * 8) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar8 = uVar7 << 0x23;
    if (((long)uVar8 < 0) || ((uint)uVar5 < (int)(uVar8 >> 0x20) + 8U)) {
LAB_00016f7d:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    plVar3 = (long *)(uVar6 + (uVar8 >> 0x20));
    uVar5 = (ulong)CARRY8(uVar6,uVar8 >> 0x20);
    uVar6 = -uVar5;
    if ((uVar5 != uVar6) || ((long)uVar6 < 0)) {
LAB_00016f95:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    lVar1 = *plVar3;
    if ((lVar1 == 0) || (lVar1 == param_1)) {
      if (uVar7 < *(ulong *)(this + 0x128)) {
        *(ulong *)(this + 0x128) = uVar7;
      }
      *plVar3 = 0;
      bVar2 = (byte)param_2 & 0x3f;
      uVar6 = *(ulong *)(this + 0x118);
      uVar7 = uVar6 + (ulong)*(uint *)(this + 0x120) * 8;
      uVar5 = uVar7 - uVar6;
      if ((uVar7 < uVar6) || (uVar5 >> 0x20 != 0)) goto LAB_00016f89;
      if ((uint)uVar5 < (param_2 >> 6) * 8 + 8) goto LAB_00016f7d;
      uVar7 = (ulong)((param_2 >> 6) << 3);
      puVar4 = (ulong *)(uVar6 + uVar7);
      uVar6 = (ulong)CARRY8(uVar6,uVar7);
      uVar7 = -uVar6;
      if ((uVar6 != uVar7) || ((long)uVar7 < 0)) goto LAB_00016f95;
      *puVar4 = *puVar4 & (-2L << bVar2 | 0xfffffffffffffffeU >> 0x40 - bVar2);
    }
    else {
      _IOLog("Entry for shared event handle %d %p is not equal to %p",param_2,lVar1,param_1);
      pIVar9 = this + 0x138;
    }
  }
  else {
    _IOLog("trying to free apparently bogus event handle %d",param_2);
  }
  _IOLockUnlock(*(undefined8 *)pIVar9);
  return;
}



// IOSurfaceRoot::signalEventID(unsigned int)

void __thiscall IOSurfaceRoot::signalEventID(IOSurfaceRoot *this,uint param_1)

{
  long lVar1;
  ulong uVar2;
  IOSurfaceSharedEvent *this_00;
  char cVar3;
  ulong uVar4;
  ulong uVar5;
  ulong uVar6;
  uint uVar7;
  
  _IOLockLock(*(undefined8 *)(this + 0x140));
  if (*(uint *)(this + 0x110) <= param_1) goto LAB_000170cc;
  uVar2 = *(ulong *)(this + 0x108);
  uVar5 = uVar2 + (ulong)*(uint *)(this + 0x110) * 8;
  uVar4 = uVar5 - uVar2;
  if ((uVar5 < uVar2) || (uVar4 >> 0x20 != 0)) {
LAB_000170f9:
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
              );
  }
  lVar1 = (ulong)param_1 * 8;
  if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
              );
  }
  uVar5 = (ulong)param_1 << 0x23;
  if (-1 < (long)uVar5) {
    uVar6 = uVar5 >> 0x20;
    uVar7 = (int)(uVar5 >> 0x20) + 8;
    if (uVar7 <= (uint)uVar4) {
      uVar5 = -(ulong)CARRY8(uVar2,uVar6);
      if ((CARRY8(uVar2,uVar6) == uVar5) && (-1 < (long)uVar5)) {
        if (*(IOSurfaceSharedEvent **)(uVar2 + uVar6) != (IOSurfaceSharedEvent *)0x0) {
          cVar3 = IOSurfaceSharedEvent::tryRetain(*(IOSurfaceSharedEvent **)(uVar2 + uVar6));
          if (cVar3 != '\0') {
            uVar2 = *(ulong *)(this + 0x108);
            uVar5 = uVar2 + (ulong)*(uint *)(this + 0x110) * 8;
            uVar4 = uVar5 - uVar2;
            if ((uVar5 < uVar2) || (uVar4 >> 0x20 != 0)) goto LAB_000170f9;
            if ((uint)uVar4 < uVar7) goto LAB_000170ed;
            uVar5 = -(ulong)CARRY8(uVar2,uVar6);
            if ((CARRY8(uVar2,uVar6) == uVar5) && (-1 < (long)uVar5)) {
              this_00 = *(IOSurfaceSharedEvent **)(uVar2 + uVar6);
              _IOLockUnlock(*(undefined8 *)(this + 0x140));
              if (this_00 != (IOSurfaceSharedEvent *)0x0) {
                IOSurfaceSharedEvent::signal(this_00);
                    // WARNING: Could not recover jumptable at 0x000170c9. Too many branches
                    // WARNING: Treating indirect jump as call
                (**(code **)(*(long *)this_00 + 0x28))(this_00);
                return;
              }
              return;
            }
            goto LAB_00017105;
          }
        }
LAB_000170cc:
        _IOLockUnlock(*(undefined8 *)(this + 0x140));
        return;
      }
LAB_00017105:
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
  }
LAB_000170ed:
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
            );
}



// IOSurfaceRoot::numSignalsPerSharedEventMemory()

undefined8 IOSurfaceRoot::numSignalsPerSharedEventMemory(void)

{
  return 0x800;
}



// IOSurfaceRoot::alloc_surface_shared(unsigned int, IOSurfaceSharedRO**, IOSurfaceSharedRW**)

ulong __thiscall
IOSurfaceRoot::alloc_surface_shared(IOSurfaceRoot *this,uint param_1,long *param_2,long *param_3)

{
  long lVar1;
  ulong uVar2;
  char *pcVar3;
  ulong uVar4;
  uint local_2c;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  uVar2 = alloc_shared((undefined8 *)(this + 0xf8),param_1,0xb8,*(uint *)(this + 0x1b8),&local_2c,
                       param_2);
  if ((char)uVar2 == '\0') {
    pcVar3 = "IOSurfaceSharedRO alloc failed";
  }
  else {
    ___bzero(*param_2,0xb8);
    lVar1 = *param_2;
    *(undefined4 *)(lVar1 + 0x28) = 0x1000;
    *(undefined4 *)(lVar1 + 0x20) = 1;
    uVar2 = alloc_shared((undefined8 *)(this + 0x100),param_1,0x40,*(uint *)(this + 0x1b8),&local_2c
                         ,param_3);
    uVar4 = CONCAT71((int7)((ulong)param_3 >> 8),1);
    if ((char)uVar2 != '\0') goto LAB_000171d8;
    pcVar3 = "IOSurfaceSharedRW alloc failed";
  }
  uVar4 = 0;
  _IOLog(pcVar3);
LAB_000171d8:
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  return uVar4 & 0xffffffff;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// alloc_shared(_IOSurfaceSharedListEntry**, unsigned int, unsigned long, unsigned int, unsigned
// int*, void**)

ulong __cdecl
alloc_shared(undefined8 *param_1,uint param_2,ulong param_3,uint param_4,uint *param_5,long *param_6
            )

{
  undefined1 auVar1 [16];
  undefined8 *puVar2;
  uint uVar3;
  undefined8 *puVar4;
  long *plVar5;
  undefined8 uVar6;
  undefined8 *puVar7;
  ulong uVar8;
  uint uVar9;
  
  puVar4 = param_1;
  puVar2 = (undefined8 *)0x0;
  do {
    uVar9 = param_2;
    puVar7 = puVar2;
    puVar4 = (undefined8 *)*puVar4;
    if (puVar4 == (undefined8 *)0x0) {
      puVar4 = (undefined8 *)
               _IOMallocTypeImpl(&alloc_shared(_IOSurfaceSharedListEntry**,unsigned_int,unsigned_long,unsigned_int,unsigned_int*,void**)
                                  ::kalloc_type_view_1871);
      if (puVar4 == (undefined8 *)0x0) {
        uVar8 = 0;
        _IOLog("IONewZero failed to alloc IOSurfaceSharedListEntry");
        goto LAB_00017385;
      }
      plVar5 = (long *)IOBufferMemoryDescriptor::withOptions
                                 (param_4 | 0x10003,0x4000,*(ulong *)PTR__page_size_000270c0);
      if ((long *)puVar4[1] != (long *)0x0) {
        (**(code **)(*(long *)puVar4[1] + 0x28))();
      }
      puVar4[1] = plVar5;
      if (plVar5 == (long *)0x0) {
        uVar8 = 0;
        _IOLog(
              "IOBufferMemoryDescriptor::inTaskWithOptions failed to allocate a surface shared block."
              );
        _IOFreeTypeImpl(&alloc_shared(_IOSurfaceSharedListEntry**,unsigned_int,unsigned_long,unsigned_int,unsigned_int*,void**)
                         ::kalloc_type_view_1886,puVar4);
        goto LAB_00017385;
      }
      plVar5 = (long *)(**(code **)(*plVar5 + 0x200))(plVar5,1);
      if ((long *)puVar4[2] != (long *)0x0) {
        (**(code **)(*(long *)puVar4[2] + 0x28))();
      }
      puVar4[2] = plVar5;
      if (plVar5 == (long *)0x0) {
        if ((long *)puVar4[1] != (long *)0x0) {
          (**(code **)(*(long *)puVar4[1] + 0x28))();
        }
        puVar4[1] = 0;
        _IOFreeTypeImpl(&alloc_shared(_IOSurfaceSharedListEntry**,unsigned_int,unsigned_long,unsigned_int,unsigned_int*,void**)
                         ::kalloc_type_view_1895,puVar4);
        uVar8 = 0;
        goto LAB_00017385;
      }
      uVar6 = (**(code **)(*plVar5 + 0x118))(plVar5);
      puVar4[3] = uVar6;
      *puVar4 = 0;
      auVar1._8_8_ = 0;
      auVar1._0_8_ = param_3;
      uVar3 = SUB164((ZEXT816(0) << 0x40 | ZEXT816(0x4000)) / auVar1,0);
      *(uint *)(puVar4 + 4) = uVar3;
      if (puVar7 == (undefined8 *)0x0) {
        *param_1 = puVar4;
      }
      else {
        *puVar7 = puVar4;
      }
    }
    else {
      uVar3 = *(uint *)(puVar4 + 4);
    }
    puVar2 = puVar4;
    param_2 = uVar9 - uVar3;
    if (uVar9 < uVar3) {
      *param_5 = uVar9;
      *param_6 = uVar9 * param_3 + puVar4[3];
      ___bzero();
      uVar8 = CONCAT71((int7)((ulong)puVar7 >> 8),1);
LAB_00017385:
      return uVar8 & 0xffffffff;
    }
  } while( true );
}



// IOSurfaceRoot::copySharedEventMemory(unsigned int, unsigned int*)

long * __thiscall
IOSurfaceRoot::copySharedEventMemory(IOSurfaceRoot *this,uint param_1,uint *param_2)

{
  uint uVar1;
  undefined8 *puVar2;
  long *plVar3;
  bool bVar4;
  
  *param_2 = 0;
  _IOLockLock(*(undefined8 *)(this + 0x140));
  puVar2 = *(undefined8 **)(this + 0x130);
  plVar3 = (long *)0x0;
  do {
    if (puVar2 == (undefined8 *)0x0) {
LAB_000173f8:
      _IOLockUnlock(*(undefined8 *)(this + 0x140));
      return plVar3;
    }
    uVar1 = *(uint *)(puVar2 + 4);
    bVar4 = param_1 < uVar1;
    param_1 = param_1 - uVar1;
    if (bVar4) {
      plVar3 = (long *)puVar2[1];
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x20))(plVar3);
        uVar1 = *(uint *)(puVar2 + 4);
      }
      *param_2 = uVar1;
      goto LAB_000173f8;
    }
    puVar2 = (undefined8 *)*puVar2;
  } while( true );
}



// IOSurfaceRoot::fence_completed(IOFence*)

void __thiscall IOSurfaceRoot::fence_completed(IOSurfaceRoot *this,long *param_1)

{
  undefined8 *puVar1;
  
  (**(code **)(*param_1 + 0x20))(param_1);
  _IOLockLock(*(undefined8 *)(this + 0x1d8));
  param_1[0xf] = 0;
  puVar1 = *(undefined8 **)(this + 0x1e8);
  param_1[0x10] = (long)puVar1;
  *puVar1 = param_1;
  *(long **)(this + 0x1e8) = param_1 + 0xf;
  _IOLockUnlock(*(undefined8 *)(this + 0x1d8));
                    // WARNING: Could not recover jumptable at 0x00017483. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(**(long **)(this + 0x1d0) + 0x1d8))(*(long **)(this + 0x1d0),0,0,0);
  return;
}



// IOSurfaceRoot::waitForFence_gated(IOFence*)

undefined8 __thiscall IOSurfaceRoot::waitForFence_gated(IOSurfaceRoot *this,long param_1)

{
  int iVar1;
  undefined8 uVar2;
  undefined1 *local_30;
  
  uVar2 = 0;
  if (*(char *)(param_1 + 0x50) == '\0') {
    local_30 = &DAT_aaaaaaaaaaaaaaaa;
    _clock_interval_to_deadline(1,1000000000,&local_30);
    iVar1 = (**(code **)(**(long **)(this + 0x1c8) + 0x1f0))
                      (*(long **)(this + 0x1c8),param_1,local_30,2);
    if ((iVar1 != 0) && (uVar2 = 0xe00002bc, iVar1 == 1)) {
      _IOLog("IOFence: blocking wait timed out for surface: %d\n",
             *(undefined4 *)(*(long *)(param_1 + 0x10) + 0x10));
      uVar2 = 0xe00002d6;
    }
  }
  return uVar2;
}



// IOSurfaceRoot::waitForFence(IOFence*)

void __thiscall IOSurfaceRoot::waitForFence(IOSurfaceRoot *this,undefined8 param_1)

{
                    // WARNING: Could not recover jumptable at 0x00017544. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(**(long **)(this + 0x1c8) + 0x1c8))
            (*(long **)(this + 0x1c8),waitForFence_gated,param_1,0,0,0);
  return;
}



// IOSurfaceRoot::wakeFence(IOFence*)

void __thiscall IOSurfaceRoot::wakeFence(IOSurfaceRoot *this,undefined8 param_1)

{
                    // WARNING: Could not recover jumptable at 0x0001755e. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(**(long **)(this + 0x1c8) + 0x1e8))(*(long **)(this + 0x1c8),param_1,0);
  return;
}



// IOSurfaceRoot::timestampsEnabled()

IOSurfaceRoot __thiscall IOSurfaceRoot::timestampsEnabled(IOSurfaceRoot *this)

{
  return this[0x1b0];
}



// IOSurfaceRoot::getGraphicsCommPageDescriptor() const

undefined8 __thiscall IOSurfaceRoot::getGraphicsCommPageDescriptor(IOSurfaceRoot *this)

{
  return *(undefined8 *)(this + 0x1f8);
}



// IOSurfaceRoot::release_surface_async(IOSurface*)

void __thiscall IOSurfaceRoot::release_surface_async(IOSurfaceRoot *this,long *param_1)

{
  _IOLockLock(*(undefined8 *)(this + 0x200));
  (**(code **)(**(long **)(this + 0x208) + 0x1b8))(*(long **)(this + 0x208),param_1);
  (**(code **)(*param_1 + 0x28))(param_1);
  if (this[0x218] == (IOSurfaceRoot)0x0) {
    this[0x218] = (IOSurfaceRoot)0x1;
    (**(code **)(*(long *)this + 0x20))(this);
    _thread_call_enter(*(undefined8 *)(this + 0x210));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x200));
  return;
}



// IOSurfaceRoot::getNextGlobalTraceID()

long IOSurfaceRoot::getNextGlobalTraceID(void)

{
  long lVar1;
  
  LOCK();
  lVar1 = sNextGlobalTraceID;
  sNextGlobalTraceID = sNextGlobalTraceID + 1;
  UNLOCK();
  return lVar1;
}



// IOSurfaceRoot::getMemoryPoolBunch()

long * __thiscall IOSurfaceRoot::getMemoryPoolBunch(IOSurfaceRoot *this)

{
  char cVar1;
  long *plVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x138));
  if (*(long *)(this + 0x228) == 0) {
    plVar2 = (long *)(**(code **)(IOSurfaceMemoryPoolBunch::gMetaClass + 0x88))();
    if (*(long **)(this + 0x228) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x228) + 0x28))();
    }
    *(long **)(this + 0x228) = plVar2;
    if (plVar2 != (long *)0x0) {
      cVar1 = (**(code **)(*plVar2 + 0x88))(plVar2);
      if (cVar1 == '\0') {
        if (*(long **)(this + 0x228) != (long *)0x0) {
          (**(code **)(**(long **)(this + 0x228) + 0x28))();
        }
        *(undefined8 *)(this + 0x228) = 0;
      }
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x138));
  plVar2 = *(long **)(this + 0x228);
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x20))(plVar2);
  }
  return plVar2;
}



// IOSurfaceRoot::newWiredMemoryDescriptorFromMemoryPool(unsigned long, unsigned int, unsigned long
// long, task*, bool, int*)

long * __thiscall
IOSurfaceRoot::newWiredMemoryDescriptorFromMemoryPool
          (IOSurfaceRoot *this,ulong param_1,uint param_2,long param_3,task *param_4,uint param_6_00
          ,undefined4 *param_6)

{
  IOSurfaceMemoryPoolBunch *pIVar1;
  IOSurfaceMemoryPool *this_00;
  ulong uVar2;
  long *plVar3;
  
  *param_6 = 0;
  if (param_3 != 0) {
    pIVar1 = (IOSurfaceMemoryPoolBunch *)getMemoryPoolBunch(this);
    this_00 = (IOSurfaceMemoryPool *)IOSurfaceMemoryPoolBunch::getPool(pIVar1,param_3);
    if (pIVar1 != (IOSurfaceMemoryPoolBunch *)0x0) {
      (**(code **)(*(long *)pIVar1 + 0x28))(pIVar1);
    }
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      uVar2 = IOSurfaceMemoryPool::taskCanUsePool(this_00,param_4);
      if ((char)uVar2 == '\0') {
        *param_6 = 0xe00002e2;
        plVar3 = (long *)0x0;
      }
      else {
        pIVar1 = (IOSurfaceMemoryPoolBunch *)getMemoryPoolBunch(this);
        plVar3 = IOSurfaceMemoryPool::newWiredMemoryDescriptorWithLength
                           (this_00,param_1,param_2,param_4,pIVar1,param_6_00 & 0xff);
      }
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
      return plVar3;
    }
  }
  return (long *)0x0;
}



// IOSurfaceRoot::registerMapper(IOMapper*)

void __thiscall IOSurfaceRoot::registerMapper(IOSurfaceRoot *this,undefined8 param_1)

{
  _IOLockLock(*(undefined8 *)(this + 0x238));
  (**(code **)(**(long **)(this + 0x230) + 0x1b8))(*(long **)(this + 0x230),param_1);
  _IOLockUnlock(*(undefined8 *)(this + 0x238));
  return;
}



// IOSurfaceRoot::unregisterMapper(IOMapper*)

void __thiscall IOSurfaceRoot::unregisterMapper(IOSurfaceRoot *this,undefined8 param_1)

{
  int iVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x238));
  iVar1 = (**(code **)(**(long **)(this + 0x230) + 0x1f8))(*(long **)(this + 0x230),param_1,0);
  if (iVar1 != -1) {
    (**(code **)(**(long **)(this + 0x230) + 0x1d8))(*(long **)(this + 0x230),iVar1);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x238));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRoot::purge_iomd_from_mappers(IOMemoryDescriptor*)

void __cdecl IOSurfaceRoot::purge_iomd_from_mappers(long param_1)

{
  _IOLockLock(*(undefined8 *)(param_1 + 0x238));
  OSCollection::iterateObjects(*(_func_bool_OSObject_ptr **)(param_1 + 0x230));
  _IOLockUnlock(*(undefined8 *)(param_1 + 0x238));
  return;
}



undefined8
____ZN13IOSurfaceRoot23purge_iomd_from_mappersEP18IOMemoryDescriptor_block_invoke
          (long param_1,long *param_2)

{
  (**(code **)(*param_2 + 0x6b8))
            (param_2,__ZL32gIODARTFunctionSetCacheAttribute_0,0,*(undefined8 *)(param_1 + 0x20),
             "iomdEarlyPurge",1,0);
  return 0;
}



// IOSurfaceRoot::update_display_surface(IOService*, unsigned int, IOSurface*)

void __thiscall
IOSurfaceRoot::update_display_surface
          (IOSurfaceRoot *this,long param_1,uint param_2,IOSurface *param_3)

{
  IOSurfaceRoot *pIVar1;
  IOSurfaceRoot *pIVar2;
  IOSurfaceRoot *pIVar3;
  long lVar4;
  long lVar5;
  uint uVar6;
  uint uVar7;
  uint uVar8;
  int iVar9;
  ulong uVar10;
  long lVar11;
  ulong uVar12;
  ulong uVar13;
  
  _IOLockLock();
  pIVar2 = this + 0x250;
  pIVar3 = this + 0x390;
  if ((pIVar3 < pIVar2) || ((ulong)((long)pIVar3 - (long)pIVar2) >> 0x20 != 0)) {
LAB_00017afe:
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
              );
  }
  lVar4 = *(long *)(this + 0x248);
  uVar7 = 0xffffffff;
  uVar10 = 0;
  lVar11 = 0;
  do {
    uVar13 = -(ulong)CARRY8((ulong)pIVar2,uVar10);
    if ((CARRY8((ulong)pIVar2,uVar10) != uVar13) || ((long)uVar13 < 0)) goto LAB_00017ae6;
    uVar8 = (uint)lVar11;
    uVar6 = (uint)((long)pIVar3 - (long)pIVar2);
    if (*(long *)(pIVar2 + uVar10) == param_1) goto LAB_000179c6;
    if (uVar7 != 0xffffffff) {
      uVar8 = uVar7;
    }
    if (*(long *)(pIVar2 + uVar10) == 0) {
      uVar7 = uVar8;
    }
    lVar11 = lVar11 + 1;
    uVar10 = uVar10 + 0x28;
  } while (lVar11 != 8);
  if (uVar7 == 0xffffffff) {
LAB_00017acc:
    _IOLockUnlock(*(undefined8 *)(this + 0x240));
    return;
  }
  uVar8 = -uVar7;
  if ((int)-uVar7 < 0) {
    uVar8 = uVar7;
  }
  uVar10 = (ulong)uVar8 * -0x28;
  if (-1 < (int)uVar7) {
    uVar10 = (ulong)uVar8 * 0x28;
  }
  iVar9 = (int)uVar10;
  if ((long)iVar9 != uVar10) {
LAB_00017b0a:
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
              );
  }
  if ((iVar9 < 0) || (uVar6 < iVar9 + 0x28U)) goto LAB_00017af2;
  uVar12 = (ulong)CARRY8(uVar10 & 0xffffffff,(ulong)pIVar2);
  uVar13 = -uVar12;
  if ((uVar12 != uVar13) || ((long)uVar13 < 0)) goto LAB_00017ae6;
  *(long *)(pIVar2 + (uVar10 & 0xffffffff)) = param_1;
  uVar8 = uVar7;
LAB_000179c6:
  if ((3 < param_2) || (7 < (int)uVar8)) goto LAB_00017acc;
  uVar7 = -uVar8;
  if ((int)-uVar8 < 0) {
    uVar7 = uVar8;
  }
  uVar10 = (ulong)uVar7 * -0x28;
  if (-1 < (int)uVar8) {
    uVar10 = (ulong)uVar7 * 0x28;
  }
  iVar9 = (int)uVar10;
  if ((long)iVar9 != uVar10) goto LAB_00017b0a;
  if ((-1 < iVar9) && (iVar9 + 0x28U <= uVar6)) {
    uVar10 = uVar10 & 0xffffffff;
    uVar13 = -(ulong)CARRY8((ulong)pIVar2,uVar10);
    if ((CARRY8((ulong)pIVar2,uVar10) == uVar13) && (-1 < (long)uVar13)) {
      pIVar1 = pIVar2 + uVar10 + 8;
      uVar13 = (long)(pIVar2 + uVar10 + 0x28) - (long)pIVar1;
      if ((pIVar2 + uVar10 + 0x28 < pIVar1) || (uVar13 >> 0x20 != 0)) goto LAB_00017afe;
      if ((uint)uVar13 < param_2 * 8 + 8) goto LAB_00017af2;
      uVar13 = (ulong)CARRY8((ulong)pIVar1,(ulong)(param_2 << 3));
      uVar10 = -uVar13;
      if ((uVar13 == uVar10) && (-1 < (long)uVar10)) {
        *(long *)(this + 0x248) = lVar4 - *(long *)(pIVar1 + (param_2 << 3));
        if (param_3 == (IOSurface *)0x0) {
          lVar11 = 0;
        }
        else {
          lVar11 = IOSurface::getAllocSize(param_3);
        }
        *(long *)(pIVar1 + (param_2 << 3)) = lVar11;
        lVar5 = *(long *)(this + 0x248);
        *(long *)(this + 0x248) = lVar11 + lVar5;
        if ((lVar4 != lVar11 + lVar5) && (*(code **)pIVar3 != (code *)0x0)) {
          (**(code **)pIVar3)(*(undefined8 *)(this + 0x398));
        }
        goto LAB_00017acc;
      }
    }
LAB_00017ae6:
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
              );
  }
LAB_00017af2:
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
            );
}



// IOSurfaceRoot::get_current_display_surface_footprint() const

undefined8 __thiscall IOSurfaceRoot::get_current_display_surface_footprint(IOSurfaceRoot *this)

{
  return *(undefined8 *)(this + 0x248);
}



// IOSurfaceRoot::add_display_footprint_changed_callback(void (*)(void*), void*)

void __thiscall
IOSurfaceRoot::add_display_footprint_changed_callback
          (IOSurfaceRoot *this,undefined8 param_1,undefined8 param_2)

{
  _IOLockLock(*(undefined8 *)(this + 0x240));
  if ((*(long *)(this + 0x390) == 0) && (*(long *)(this + 0x398) == 0)) {
    *(undefined8 *)(this + 0x390) = param_1;
    *(undefined8 *)(this + 0x398) = param_2;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x240));
  return;
}



// IOSurfaceRoot::remove_display_footprint_changed_callback(void (*)(void*), void*)

void __thiscall
IOSurfaceRoot::remove_display_footprint_changed_callback
          (IOSurfaceRoot *this,long param_1,long param_2)

{
  _IOLockLock(*(undefined8 *)(this + 0x240));
  if ((*(long *)(this + 0x390) == param_1) && (*(long *)(this + 0x398) == param_2)) {
    *(undefined8 *)(this + 0x390) = 0;
    *(undefined8 *)(this + 0x398) = 0;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x240));
  return;
}



// IOSurfaceRoot::deadlockCheckLimit() const

int __thiscall IOSurfaceRoot::deadlockCheckLimit(IOSurfaceRoot *this)

{
  int iVar1;
  
  iVar1 = _gIOSurfaceDeadlockDetectionDepth;
  if (_gIOSurfaceDeadlockDetectionDepth == 0) {
    iVar1 = *(int *)(this + 0x3a0);
  }
  return iVar1;
}



// IOSurfaceRoot::add_memory_tag(IOSurfaceMemoryTag*)

void __thiscall IOSurfaceRoot::add_memory_tag(IOSurfaceRoot *this,long param_1)

{
  long *plVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x3b8));
  *(undefined8 *)(param_1 + 0x10) = 0;
  plVar1 = *(long **)(this + 0x3b0);
  *(long **)(param_1 + 0x18) = plVar1;
  *plVar1 = param_1;
  *(long *)(this + 0x3b0) = param_1 + 0x10;
  _IOLockUnlock(*(undefined8 *)(this + 0x3b8));
  return;
}



// IOSurfaceRoot::remove_memory_tag(IOSurfaceMemoryTag*)

void __thiscall IOSurfaceRoot::remove_memory_tag(IOSurfaceRoot *this,long param_1)

{
  long lVar1;
  long *plVar2;
  char *pcVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x3b8));
  lVar1 = *(long *)(param_1 + 0x10);
  if (lVar1 == 0) {
    plVar2 = *(long **)(param_1 + 0x18);
    if (*plVar2 == param_1) {
      *(long **)(this + 0x3b0) = plVar2;
LAB_00017c83:
      *plVar2 = lVar1;
      _IOLockUnlock(*(undefined8 *)(this + 0x3b8));
      return;
    }
  }
  else {
    if (*(long *)(lVar1 + 0x18) != param_1 + 0x10) {
      pcVar3 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_00017ca6;
    }
    if (**(long **)(param_1 + 0x18) == param_1) {
      *(long **)(lVar1 + 0x18) = *(long **)(param_1 + 0x18);
      plVar2 = *(long **)(param_1 + 0x18);
      goto LAB_00017c83;
    }
  }
  pcVar3 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00017ca6:
                    // WARNING: Subroutine does not return
  _panic(pcVar3,param_1,0x9f5,"IOSurfaceRoot.cpp",0x9f5);
}



// IOSurfaceRoot::signal_event_notifier_clients(bool)

void __thiscall IOSurfaceRoot::signal_event_notifier_clients(IOSurfaceRoot *this,int param_1)

{
  _IOLockLock(*(undefined8 *)(this + 0x3c8));
  *(long *)(this + 0x3e0) = *(long *)(this + 0x3e0) + 1;
  if (param_1 == 0) {
    signal_event_clients_loop(this);
  }
  else if (this[1000] == (IOSurfaceRoot)0x0) {
    this[1000] = (IOSurfaceRoot)0x1;
    (**(code **)(*(long *)this + 0x20))(this);
    _thread_call_enter(*(undefined8 *)(this + 0x3c0));
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x3c8));
  return;
}



// IOSurfaceRoot::signal_event_clients_loop()

void __thiscall IOSurfaceRoot::signal_event_clients_loop(IOSurfaceRoot *this)

{
  ulong uVar1;
  undefined8 *puVar2;
  
  uVar1 = *(ulong *)(this + 0x3e0);
  if (*(ulong *)(this + 0x3d8) < uVar1) {
    do {
      *(ulong *)(this + 0x3d8) = uVar1;
      _IOLockUnlock(*(undefined8 *)(this + 0x3c8));
      _IOLockLock(*(undefined8 *)(this + 0x3d0));
      for (puVar2 = *(undefined8 **)(this + 0x3f0); puVar2 != (undefined8 *)0x0;
          puVar2 = (undefined8 *)*puVar2) {
        (*(code *)puVar2[2])(puVar2[3]);
      }
      _IOLockUnlock(*(undefined8 *)(this + 0x3d0));
      _IOLockLock(*(undefined8 *)(this + 0x3c8));
      uVar1 = *(ulong *)(this + 0x3e0);
    } while (*(ulong *)(this + 0x3d8) < uVar1);
  }
  return;
}



// IOSurfaceRoot::addEventNotifierClient(void (*)(OSObject*), OSObject*)

undefined8 * __thiscall
IOSurfaceRoot::addEventNotifierClient(IOSurfaceRoot *this,undefined8 param_1,long *param_2)

{
  long *plVar1;
  undefined8 *puVar2;
  undefined8 *puVar3;
  
  puVar3 = (undefined8 *)
           _IOMallocTypeImpl(&addEventNotifierClient(void(*)(OSObject*),OSObject*)::
                              kalloc_type_view_2629);
  if (puVar3 != (undefined8 *)0x0) {
    puVar3[2] = param_1;
    plVar1 = (long *)puVar3[3];
    puVar3[3] = param_2;
    if (param_2 != (long *)0x0) {
      (**(code **)(*param_2 + 0x20))(param_2);
    }
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    _IOLockLock(*(undefined8 *)(this + 0x3d0));
    *puVar3 = 0;
    puVar2 = *(undefined8 **)(this + 0x3f8);
    puVar3[1] = puVar2;
    *puVar2 = puVar3;
    *(undefined8 **)(this + 0x3f8) = puVar3;
    _IOLockUnlock(*(undefined8 *)(this + 0x3d0));
  }
  return puVar3;
}



// IOSurfaceRoot::removeEventNotifierClient(IOSurfaceEventNotifierClient*)

void __thiscall IOSurfaceRoot::removeEventNotifierClient(IOSurfaceRoot *this,IOSurfaceRoot *param_1)

{
  long lVar1;
  IOSurfaceRoot *pIVar2;
  long *plVar3;
  char *pcVar4;
  
  _IOLockLock(*(undefined8 *)(this + 0x3d0));
  pIVar2 = this + 0x3f0;
  do {
    pIVar2 = *(IOSurfaceRoot **)pIVar2;
    if (pIVar2 == (IOSurfaceRoot *)0x0) {
                    // WARNING: Subroutine does not return
      _panic("\"IOSurfaceRoot::removeEventNotifierClient() invoked with bad client notifier %p\" @%s:%d"
             ,param_1,"IOSurfaceRoot.cpp",0xa68);
    }
  } while (pIVar2 != param_1);
  lVar1 = *(long *)param_1;
  if (lVar1 == 0) {
    plVar3 = *(long **)(param_1 + 8);
    if ((IOSurfaceRoot *)*plVar3 == param_1) {
      *(long **)(this + 0x3f8) = plVar3;
LAB_00017e9a:
      *plVar3 = lVar1;
      _IOLockUnlock(*(undefined8 *)(this + 0x3d0));
      if (*(long **)(param_1 + 0x18) != (long *)0x0) {
        (**(code **)(**(long **)(param_1 + 0x18) + 0x28))();
      }
      *(undefined8 *)(param_1 + 0x18) = 0;
      _IOFreeTypeImpl(&removeEventNotifierClient(IOSurfaceEventNotifierClient*)::
                       kalloc_type_view_2659,param_1);
      _IOLockUnlock(*(undefined8 *)(this + 0x3d0));
      return;
    }
  }
  else {
    if (*(IOSurfaceRoot **)(lVar1 + 8) != param_1) {
      pcVar4 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_00017eef;
    }
    if ((IOSurfaceRoot *)**(long **)(param_1 + 8) == param_1) {
      *(long **)(lVar1 + 8) = *(long **)(param_1 + 8);
      plVar3 = *(long **)(param_1 + 8);
      goto LAB_00017e9a;
    }
  }
  pcVar4 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_00017eef:
                    // WARNING: Subroutine does not return
  _panic(pcVar4,param_1,0xa60,"IOSurfaceRoot.cpp",0xa60);
}



// IOSurfaceRoot::client_started(IOSurfaceRootUserClient*, task*)

ulong __thiscall
IOSurfaceRoot::client_started(IOSurfaceRoot *this,undefined8 param_1,undefined8 param_2)

{
  ulong uVar1;
  void *pvVar2;
  void *pvVar3;
  ulong uVar4;
  long lVar5;
  size_t sVar6;
  
  _IOLockLock(*(undefined8 *)(this + 0x400));
  uVar4 = *(ulong *)(this + 0x408);
  uVar1 = *(ulong *)(this + 0x438);
  if (uVar4 == uVar1) {
    uVar4 = uVar1 + 0x20;
    lVar5 = uVar4 * 0x10;
    if (lVar5 < 0) {
      lVar5 = -0x8000000000000000;
    }
    pvVar2 = *(void **)(this + 0x440);
    if (uVar4 >> 0x3c != 0) {
      lVar5 = -0x8000000000000000;
    }
    pvVar3 = (void *)_IOMallocTypeVarImpl
                               (&client_started(IOSurfaceRootUserClient*,task*)::
                                 kalloc_type_view_2683,lVar5);
    if (pvVar3 == (void *)0x0) {
      uVar4 = 0;
      __os_log_internal(0,PTR___os_log_default_00027090,0x11,"Unable to grow task client map");
      goto LAB_00018056;
    }
    *(void **)(this + 0x440) = pvVar3;
    *(ulong *)(this + 0x438) = uVar4;
    sVar6 = uVar1 << 4;
    _memmove(pvVar3,pvVar2,sVar6);
    if ((long)sVar6 < 0) {
      sVar6 = 0x8000000000000000;
    }
    if (0xfffffffffffffff < uVar1) {
      sVar6 = 0x8000000000000000;
    }
    _IOFreeTypeVarImpl(&client_started(IOSurfaceRootUserClient*,task*)::kalloc_type_view_2693,pvVar2
                       ,sVar6);
    uVar4 = *(ulong *)(this + 0x408);
  }
  lVar5 = *(long *)(this + 0x440);
  *(undefined8 *)(lVar5 + uVar4 * 0x10) = param_2;
  *(undefined8 *)(lVar5 + 8 + uVar4 * 0x10) = param_1;
  *(ulong *)(this + 0x408) = uVar4 + 1;
  uVar4 = CONCAT71((int7)((ulong)param_1 >> 8),1);
LAB_00018056:
  _IOLockUnlock(*(undefined8 *)(this + 0x400));
  return uVar4 & 0xffffffff;
}



// IOSurfaceRoot::client_stopped(IOSurfaceRootUserClient*, task*)

void __thiscall IOSurfaceRoot::client_stopped(IOSurfaceRoot *this,long param_1,long param_2)

{
  bool bVar1;
  ulong uVar2;
  ulong uVar3;
  long *plVar4;
  long lVar5;
  long lVar6;
  bool bVar7;
  long lVar8;
  
  _IOLockLock();
  uVar2 = *(ulong *)(this + 0x408);
  if (uVar2 == 0) {
    uVar3 = 0;
LAB_000180c4:
    if (uVar3 != uVar2) {
      lVar6 = *(long *)(this + 0x440);
      lVar5 = uVar3 * 0x10;
      if (*(long *)(lVar6 + lVar5) != param_2) {
        client_stopped();
        return;
      }
      lVar8 = 0;
      bVar1 = true;
      do {
        bVar7 = bVar1;
        lVar8 = lVar8 * 0x10;
        if (*(long *)(this + lVar8 + 0x420) == param_1) {
          *(undefined8 *)(this + lVar8 + 0x420) = 0;
          *(undefined8 *)(this + lVar8 + 0x418) = 0;
        }
        lVar8 = 1;
        bVar1 = false;
      } while (bVar7);
      uVar2 = uVar2 - 1;
      *(ulong *)(this + 0x408) = uVar2;
      if (uVar3 < uVar2) {
        do {
          lVar5 = lVar5 + 0x10;
          lVar6 = *(long *)(this + 0x440);
          uVar3 = uVar3 + 1;
          *(undefined8 *)(lVar6 + -8 + lVar5) = *(undefined8 *)(lVar6 + 8 + lVar5);
          *(undefined8 *)(lVar6 + -0x10 + lVar5) = *(undefined8 *)(lVar6 + lVar5);
          uVar2 = *(ulong *)(this + 0x408);
        } while (uVar3 < uVar2);
        lVar6 = *(long *)(this + 0x440);
      }
      *(undefined8 *)(lVar6 + uVar2 * 0x10) = 0;
      *(undefined8 *)(lVar6 + 8 + uVar2 * 0x10) = 0;
      _IOLockUnlock(*(undefined8 *)(this + 0x400));
      return;
    }
  }
  else {
    plVar4 = (long *)(*(long *)(this + 0x440) + 8);
    uVar3 = 0;
    do {
      if (*plVar4 == param_1) goto LAB_000180c4;
      uVar3 = uVar3 + 1;
      plVar4 = plVar4 + 2;
    } while (uVar2 != uVar3);
  }
  client_stopped();
  return;
}



// IOSurfaceRoot::registerMapperInterface(IOSurfaceRootParavirtMapperInterface*)

void __thiscall IOSurfaceRoot::registerMapperInterface(IOSurfaceRoot *this,long *param_1)

{
  long *plVar1;
  
  plVar1 = *(long **)(this + 0x448);
  *(long **)(this + 0x448) = param_1;
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  if (param_1 != (long *)0x0) {
    _printf("IOSurfaceRoot using IOSurfaceRootParavirtMapperInterface %p",param_1);
    __os_log_internal(0,PTR___os_log_default_00027090,0,
                      "IOSurfaceRoot using IOSurfaceRootParavirtMapperInterface");
  }
  return;
}



// IOSurfaceRootParavirtMapperInterface::MetaClass::~MetaClass()

void __thiscall IOSurfaceRootParavirtMapperInterface::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceRoot::MetaClass::~MetaClass()

void __thiscall IOSurfaceRoot::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



void __GLOBAL__sub_I_IOSurfaceRoot_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceRootParavirtMapperInterface::gMetaClass,
             "IOSurfaceRootParavirtMapperInterface",(OSMetaClass *)PTR_gMetaClass_00027048,0x10);
  IOSurfaceRootParavirtMapperInterface::gMetaClass = (undefined *)&PTR__MetaClass_00029428;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceRoot::gMetaClass,"IOSurfaceRoot",
             (OSMetaClass *)PTR_gMetaClass_00027060,0x4a0);
  IOSurfaceRoot::gMetaClass = (undefined *)&PTR__MetaClass_00029d88;
  __ZL32gIODARTFunctionSetCacheAttribute_0 = OSSymbol::withCString("setIomdCacheAttribute");
  return;
}



void __GLOBAL__D_a(void)

{
  if (__ZL32gIODARTFunctionSetCacheAttribute_0 != (long *)0x0) {
    (**(code **)(*__ZL32gIODARTFunctionSetCacheAttribute_0 + 0x28))();
  }
  __ZL32gIODARTFunctionSetCacheAttribute_0 = (long *)0x0;
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceRoot::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceRootParavirtMapperInterface::gMetaClass);
  return;
}



// IOSurfaceRootUserClient::MetaClass::MetaClass()

void __thiscall IOSurfaceRootUserClient::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRootUserClient",(OSMetaClass *)PTR_gMetaClass_00027020,
             0x138);
  *(undefined ***)this = &PTR__MetaClass_0002a8a8;
  return;
}



// IOSurfaceRootUserClient::MetaClass::~MetaClass()

void __thiscall IOSurfaceRootUserClient::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceRootUserClient::IOSurfaceRootUserClient(OSMetaClass const*)

void __thiscall
IOSurfaceRootUserClient::IOSurfaceRootUserClient(IOSurfaceRootUserClient *this,OSMetaClass *param_1)

{
  IOUserClient2022::IOUserClient2022((IOUserClient2022 *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceRootUserClient_00029f00;
  *(undefined8 *)(this + 0xf8) = 0;
  *(undefined8 *)(this + 0x100) = 0;
  *(undefined4 *)(this + 0x108) = 0;
  *(undefined8 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x128) = 0;
  *(undefined8 *)(this + 0x130) = 0;
  return;
}



// IOSurfaceRootUserClient::IOSurfaceRootUserClient(OSMetaClass const*)

void __thiscall
IOSurfaceRootUserClient::IOSurfaceRootUserClient(IOSurfaceRootUserClient *this,OSMetaClass *param_1)

{
  IOUserClient2022::IOUserClient2022((IOUserClient2022 *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceRootUserClient_00029f00;
  *(undefined8 *)(this + 0xf8) = 0;
  *(undefined8 *)(this + 0x100) = 0;
  *(undefined4 *)(this + 0x108) = 0;
  *(undefined8 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x128) = 0;
  *(undefined8 *)(this + 0x130) = 0;
  return;
}



// IOSurfaceRootUserClient::~IOSurfaceRootUserClient()

void __thiscall IOSurfaceRootUserClient::~IOSurfaceRootUserClient(IOSurfaceRootUserClient *this)

{
  *(undefined ***)this = &PTR__IOSurfaceRootUserClient_00029f00;
  if (*(long **)(this + 0x130) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x130) + 0x28))();
  }
  *(undefined8 *)(this + 0x130) = 0;
  if (*(long **)(this + 0x128) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x128) + 0x28))();
  }
  *(undefined8 *)(this + 0x128) = 0;
  if (*(long **)(this + 0x110) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x110) + 0x28))();
  }
  *(undefined8 *)(this + 0x110) = 0;
  if (*(long **)(this + 0xf8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xf8) + 0x28))();
  }
  *(undefined8 *)(this + 0xf8) = 0;
  IOUserClient2022::~IOUserClient2022((IOUserClient2022 *)this);
  return;
}



// IOSurfaceRootUserClient::~IOSurfaceRootUserClient()

void __thiscall IOSurfaceRootUserClient::~IOSurfaceRootUserClient(IOSurfaceRootUserClient *this)

{
  *(undefined ***)this = &PTR__IOSurfaceRootUserClient_00029f00;
  if (*(long **)(this + 0x130) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x130) + 0x28))();
  }
  *(undefined8 *)(this + 0x130) = 0;
  if (*(long **)(this + 0x128) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x128) + 0x28))();
  }
  *(undefined8 *)(this + 0x128) = 0;
  if (*(long **)(this + 0x110) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x110) + 0x28))();
  }
  *(undefined8 *)(this + 0x110) = 0;
  if (*(long **)(this + 0xf8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xf8) + 0x28))();
  }
  *(undefined8 *)(this + 0xf8) = 0;
  IOUserClient2022::~IOUserClient2022((IOUserClient2022 *)this);
  return;
}



// IOSurfaceRootUserClient::~IOSurfaceRootUserClient()

void __thiscall IOSurfaceRootUserClient::~IOSurfaceRootUserClient(IOSurfaceRootUserClient *this)

{
  ~IOSurfaceRootUserClient(this);
  _OSObject_typed_operator_delete(&IOSurfaceRootUserClient_ktv,this,0x138);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::operator delete(void*, unsigned long)

void __cdecl IOSurfaceRootUserClient::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceRootUserClient_ktv,param_1,param_2);
  return;
}



// IOSurfaceRootUserClient::getMetaClass() const

undefined8 * IOSurfaceRootUserClient::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceRootUserClient::MetaClass::MetaClass()

void __thiscall IOSurfaceRootUserClient::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceRootUserClient",(OSMetaClass *)PTR_gMetaClass_00027020,
             0x138);
  *(undefined ***)this = &PTR__MetaClass_0002a8a8;
  return;
}



// IOSurfaceRootUserClient::MetaClass::alloc() const

IOSurfaceRootUserClient * IOSurfaceRootUserClient::MetaClass::alloc(void)

{
  IOSurfaceRootUserClient *this;
  
  this = (IOSurfaceRootUserClient *)_OSObject_typed_operator_new(&IOSurfaceRootUserClient_ktv,0x138)
  ;
  IOSurfaceRootUserClient(this);
  return this;
}



// IOSurfaceRootUserClient::operator new(unsigned long)

void * __thiscall IOSurfaceRootUserClient::operator_new(IOSurfaceRootUserClient *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceRootUserClient_ktv,this);
  return pvVar1;
}



// IOSurfaceRootUserClient::IOSurfaceRootUserClient()

void __thiscall IOSurfaceRootUserClient::IOSurfaceRootUserClient(IOSurfaceRootUserClient *this)

{
  IOSurfaceRootUserClient(this);
  return;
}



// IOSurfaceRootUserClient::IOSurfaceRootUserClient()

void __thiscall IOSurfaceRootUserClient::IOSurfaceRootUserClient(IOSurfaceRootUserClient *this)

{
  IOUserClient2022::IOUserClient2022((IOUserClient2022 *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceRootUserClient_00029f00;
  *(undefined8 *)(this + 0xf8) = 0;
  *(undefined8 *)(this + 0x100) = 0;
  *(undefined4 *)(this + 0x108) = 0;
  *(undefined8 *)(this + 0x110) = 0;
  *(undefined8 *)(this + 0x128) = 0;
  *(undefined8 *)(this + 0x130) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_create_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_create_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong uVar1;
  uint uVar2;
  undefined4 uVar3;
  long *plVar4;
  char *pcVar5;
  
  uVar1 = **(ulong **)(param_3 + 0x20);
  uVar3 = 0xe00002c2;
  if (uVar1 >> 0x20 == 0) {
    plVar4 = *(long **)(param_3 + 0x40);
    if (plVar4 == (long *)0x0) {
      uVar2 = *(uint *)(param_3 + 0x38);
      pcVar5 = *(char **)(param_3 + 0x30);
      plVar4 = (long *)0x0;
    }
    else {
      plVar4 = (long *)(**(code **)(*plVar4 + 0x200))(plVar4,0x1000);
      if (plVar4 == (long *)0x0) {
        return 0xe00002c8;
      }
      pcVar5 = (char *)(**(code **)(*plVar4 + 0x118))(plVar4);
      uVar2 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
    }
    uVar3 = 0xe00002c2;
    if ((pcVar5 != (char *)0x0) && (uVar2 != 0)) {
      uVar3 = create_surface(param_1,pcVar5,(int)uVar1,*(undefined8 **)(param_3 + 0x58),uVar2);
    }
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x28))(plVar4);
    }
  }
  return uVar3;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_release_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_release_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  release_surface(param_1,**(int **)(param_3 + 0x20));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_lock_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_lock_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  lock_surface(param_1,*(uint **)(param_3 + 0x30),*(undefined8 **)(param_3 + 0x58),
               *(int *)(param_3 + 0x38),(int *)(param_3 + 0x60));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_unlock_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_unlock_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  unlock_surface(param_1,*(uint **)(param_3 + 0x30),*(undefined4 **)(param_3 + 0x58),
                 *(int *)(param_3 + 0x38),(int *)(param_3 + 0x60));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_lookup_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_lookup_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  lookup_surface(param_1,**(uint **)(param_3 + 0x20),*(undefined8 **)(param_3 + 0x58));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_ycbcrmatrix(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_ycbcrmatrix
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  set_ycbcrmatrix(param_1,**(uint **)(param_3 + 0x20),(char)(*(uint **)(param_3 + 0x20))[2]);
  return;
}



// IOSurfaceRootUserClient::s_create_surface_fast_path(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __thiscall
IOSurfaceRootUserClient::s_create_surface_fast_path
          (IOSurfaceRootUserClient *this,undefined8 param_2_00,long param_2)

{
  create_surface_fast_path(this,*(ulonglong **)(param_2 + 0x30),*(undefined8 **)(param_2 + 0x58));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_create_surface_client_mem(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_create_surface_client_mem
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  create_surface_client_mem
            (param_1,**(ulonglong **)(param_3 + 0x20),(*(ulonglong **)(param_3 + 0x20))[1],
             *(undefined8 **)(param_3 + 0x58));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_ycbcrmatrix(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_get_ycbcrmatrix
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  get_ycbcrmatrix(param_1,**(uint **)(param_3 + 0x20));
  **(undefined8 **)(param_3 + 0x48) = 0;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_value(IOSurfaceRootUserClient*, void*, IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_set_value
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  int *piVar1;
  uint uVar2;
  undefined4 uVar3;
  long *plVar4;
  uint *puVar5;
  
  piVar1 = *(int **)(param_3 + 0x58);
  plVar4 = *(long **)(param_3 + 0x40);
  if (plVar4 == (long *)0x0) {
    puVar5 = *(uint **)(param_3 + 0x30);
    uVar2 = *(uint *)(param_3 + 0x38);
    plVar4 = (long *)0x0;
  }
  else {
    plVar4 = (long *)(**(code **)(*plVar4 + 0x200))(plVar4,0x1000);
    if (plVar4 == (long *)0x0) {
      return 0xe00002c8;
    }
    puVar5 = (uint *)(**(code **)(*plVar4 + 0x118))(plVar4);
    uVar2 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar3 = 0xe00002c2;
  if ((puVar5 != (uint *)0x0) && (8 < uVar2)) {
    uVar3 = set_value(param_1,puVar5,uVar2,piVar1);
  }
  if (plVar4 != (long *)0x0) {
    (**(code **)(*plVar4 + 0x28))(plVar4);
  }
  return uVar3;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_value(IOSurfaceRootUserClient*, void*, IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_get_value
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  undefined4 uVar2;
  long *plVar3;
  uint *puVar4;
  long *plVar5;
  long lVar6;
  uint uVar7;
  uint local_34;
  
  puVar4 = *(uint **)(param_3 + 0x30);
  lVar6 = *(long *)(param_3 + 0x58);
  uVar1 = *(uint *)(param_3 + 0x38);
  uVar7 = *(uint *)(param_3 + 0x60);
  plVar3 = *(long **)(param_3 + 0x40);
  local_34 = uVar7;
  if (plVar3 == (long *)0x0) {
    plVar3 = (long *)0x0;
LAB_000188d2:
    plVar5 = *(long **)(param_3 + 0x68);
    if (plVar5 == (long *)0x0) {
      plVar5 = (long *)0x0;
    }
    else {
      plVar5 = (long *)(**(code **)(*plVar5 + 0x200))(plVar5,0);
      if (plVar5 == (long *)0x0) {
        uVar2 = 0xe00002c8;
        goto LAB_00018977;
      }
      lVar6 = (**(code **)(*plVar5 + 0x118))(plVar5);
      uVar7 = *(uint *)(param_3 + 0x70);
      local_34 = uVar7;
    }
    uVar2 = 0xe00002c2;
    if ((((puVar4 != (uint *)0x0) && (8 < uVar1)) && (lVar6 != 0)) && (8 < uVar7)) {
      uVar2 = get_value(param_1,puVar4,lVar6,uVar1,&local_34);
    }
    uVar7 = local_34;
    if (plVar5 != (long *)0x0) {
      *(uint *)(param_3 + 0x70) = local_34;
      (**(code **)(*plVar5 + 0x28))(plVar5);
      goto LAB_0001897b;
    }
  }
  else {
    plVar3 = (long *)(**(code **)(*plVar3 + 0x200))(plVar3,0x1000);
    if (plVar3 != (long *)0x0) {
      puVar4 = (uint *)(**(code **)(*plVar3 + 0x118))(plVar3);
      uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
      goto LAB_000188d2;
    }
    uVar2 = 0xe00002c8;
    plVar3 = (long *)0x0;
  }
LAB_00018977:
  *(uint *)(param_3 + 0x60) = uVar7;
LAB_0001897b:
  if (plVar3 != (long *)0x0) {
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_remove_value(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_remove_value
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  int *piVar1;
  uint uVar2;
  long *plVar3;
  uint *puVar4;
  ulong uVar5;
  
  piVar1 = *(int **)(param_3 + 0x58);
  plVar3 = *(long **)(param_3 + 0x40);
  if (plVar3 == (long *)0x0) {
    puVar4 = *(uint **)(param_3 + 0x30);
    uVar2 = *(uint *)(param_3 + 0x38);
    plVar3 = (long *)0x0;
  }
  else {
    plVar3 = (long *)(**(code **)(*plVar3 + 0x200))(plVar3,0x1000);
    if (plVar3 == (long *)0x0) {
      return 0xe00002c8;
    }
    puVar4 = (uint *)(**(code **)(*plVar3 + 0x118))(plVar3);
    uVar2 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar5 = 0xe00002c2;
  if ((puVar4 != (uint *)0x0) && (8 < uVar2)) {
    uVar5 = remove_value(param_1,puVar4,uVar2,piVar1);
    uVar5 = uVar5 & 0xffffffff;
  }
  if (plVar3 != (long *)0x0) {
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
  return uVar5;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_bind_accel(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_bind_accel
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  bind_accel(param_1,*puVar1,puVar1[2],puVar1[4]);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_limits(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined8 __cdecl
IOSurfaceRootUserClient::s_get_limits(long param_1,undefined8 param_2,long param_3)

{
  undefined4 *puVar1;
  long lVar2;
  
  puVar1 = *(undefined4 **)(param_3 + 0x58);
  lVar2 = *(long *)(param_1 + 0xe0);
  *puVar1 = *(undefined4 *)(lVar2 + 0xac);
  puVar1[1] = *(undefined4 *)(lVar2 + 0xb0);
  *(undefined8 *)(puVar1 + 2) = *(undefined8 *)(lVar2 + 0xb8);
  *(undefined8 *)(puVar1 + 4) = *(undefined8 *)(lVar2 + 0xc0);
  *(undefined8 *)(puVar1 + 6) = *(undefined8 *)(lVar2 + 200);
  *(undefined1 *)(puVar1 + 8) = *(undefined1 *)(param_1 + 0x11e);
  *(undefined2 *)((long)puVar1 + 0x22) = 1;
  *(undefined4 *)(param_3 + 0x60) = 0x28;
  return 0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_inc_sfc_use_count_for_category(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_inc_sfc_use_count_for_category
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  increment_surface_use_count_for_category
            (param_1,**(uint **)(param_3 + 0x20),(*(uint **)(param_3 + 0x20))[2]);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_dec_sfc_use_count_for_category(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_dec_sfc_use_count_for_category
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  decrement_surface_use_count_for_category
            (param_1,**(uint **)(param_3 + 0x20),(*(uint **)(param_3 + 0x20))[2]);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_surface_use_count(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_get_surface_use_count
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint local_1c;
  
  local_1c = 0;
  get_surface_use_count(param_1,**(uint **)(param_3 + 0x20),(int *)&local_1c);
  **(ulong **)(param_3 + 0x48) = (ulong)local_1c;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_surface_notify(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined8 __cdecl
IOSurfaceRootUserClient::s_set_surface_notify(long param_1,undefined8 param_2,long param_3)

{
  undefined8 uVar1;
  
  if (*(undefined8 **)(param_3 + 0x10) != (undefined8 *)0x0) {
    uVar1 = IOSurfaceRoot::setSurfaceNotify
                      (*(IOSurfaceRoot **)(param_1 + 0xe0),*(undefined8 **)(param_3 + 0x10),
                       *(ulonglong **)(param_3 + 0x30),param_1);
    return uVar1;
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_remove_surface_notify(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_remove_surface_notify(long param_1,undefined8 param_2,long param_3)

{
  IOSurfaceRoot::removeSurfaceNotify
            (*(IOSurfaceRoot **)(param_1 + 0xe0),*(long *)(param_3 + 0x30),param_1);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_log(IOSurfaceRootUserClient*, void*, IOExternalMethodArguments*)

undefined8 __cdecl
IOSurfaceRootUserClient::s_log(undefined8 param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  char *param1;
  
  uVar1 = *(uint *)(param_3 + 0x38);
  if (uVar1 < 0x200) {
    if (*(long *)(param_3 + 0x40) != 0) {
      return 0xe00002bd;
    }
    param1 = *(char **)(param_3 + 0x30);
    if ((param1 != (char *)0x0) && (uVar1 != 0)) {
      if (param1[uVar1 - 1] != '\0') {
        return 0xe00002c2;
      }
      _kprintf("%.512s",param1);
      return 0;
    }
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_purgeable(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_purgeable
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint local_1c;
  
  local_1c = 0;
  set_purgeable(param_1,**(uint **)(param_3 + 0x20),(*(uint **)(param_3 + 0x20))[2],(int *)&local_1c
               );
  **(ulong **)(param_3 + 0x48) = (ulong)local_1c;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_ownership(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_set_ownership
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  undefined4 uVar1;
  long lVar2;
  
  if ((1 < *(int *)(*(long *)(param_3 + 0x20) + 8) + 1U) &&
     (lVar2 = _port_name_to_task(), lVar2 != 0)) {
    uVar1 = set_ownership(param_1,**(uint **)(param_3 + 0x20),(int)lVar2,
                          (*(uint **)(param_3 + 0x20))[4]);
    _task_deallocate(lVar2);
    return uVar1;
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_tiled(IOSurfaceRootUserClient*, void*, IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_tiled
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  set_tiled(param_1,**(uint **)(param_3 + 0x20),
            (uint)(*(long *)(*(uint **)(param_3 + 0x20) + 2) != 0));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_is_tiled(IOSurfaceRootUserClient*, void*, IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_is_tiled
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint local_1c;
  
  local_1c = 0;
  is_tiled(param_1,**(uint **)(param_3 + 0x20),(byte *)&local_1c);
  **(ulong **)(param_3 + 0x48) = (ulong)local_1c;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_timestamp(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_set_timestamp
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  undefined4 uVar2;
  long *plVar3;
  uint *puVar4;
  
  plVar3 = *(long **)(param_3 + 0x40);
  if (plVar3 == (long *)0x0) {
    puVar4 = *(uint **)(param_3 + 0x30);
    uVar1 = *(uint *)(param_3 + 0x38);
    plVar3 = (long *)0x0;
  }
  else {
    plVar3 = (long *)(**(code **)(*plVar3 + 0x200))(plVar3,0x1000);
    if (plVar3 == (long *)0x0) {
      return 0xe00002c8;
    }
    puVar4 = (uint *)(**(code **)(*plVar3 + 0x118))(plVar3);
    uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar2 = 0xe00002c2;
  if ((puVar4 != (uint *)0x0) && (0x10 < uVar1)) {
    uVar2 = set_timestamp(param_1,puVar4,uVar1);
  }
  if (plVar3 != (long *)0x0) {
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_tile_format(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_get_tile_format
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint local_1c;
  
  local_1c = 0;
  get_tile_format(param_1,**(uint **)(param_3 + 0x20),&local_1c);
  **(ulong **)(param_3 + 0x48) = (ulong)local_1c;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_data_value(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_get_data_value
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  undefined4 uVar2;
  long *plVar3;
  uint *puVar4;
  long *plVar5;
  void *pvVar6;
  uint uVar7;
  uint local_34;
  
  puVar4 = *(uint **)(param_3 + 0x30);
  pvVar6 = *(void **)(param_3 + 0x58);
  uVar1 = *(uint *)(param_3 + 0x38);
  uVar7 = *(uint *)(param_3 + 0x60);
  plVar3 = *(long **)(param_3 + 0x40);
  local_34 = uVar7;
  if (plVar3 == (long *)0x0) {
    plVar3 = (long *)0x0;
LAB_00018dfb:
    plVar5 = *(long **)(param_3 + 0x68);
    if (plVar5 == (long *)0x0) {
      plVar5 = (long *)0x0;
    }
    else {
      plVar5 = (long *)(**(code **)(*plVar5 + 0x200))(plVar5,0);
      if (plVar5 == (long *)0x0) {
        uVar2 = 0xe00002c8;
        goto LAB_00018e97;
      }
      pvVar6 = (void *)(**(code **)(*plVar5 + 0x118))(plVar5);
      local_34 = *(uint *)(param_3 + 0x70);
    }
    uVar2 = 0xe00002c2;
    if (((puVar4 != (uint *)0x0) && (8 < uVar1)) && (pvVar6 != (void *)0x0)) {
      uVar2 = get_data_value(param_1,puVar4,pvVar6,uVar1,&local_34);
    }
    uVar7 = local_34;
    if (plVar5 != (long *)0x0) {
      *(uint *)(param_3 + 0x70) = local_34;
      (**(code **)(*plVar5 + 0x28))(plVar5);
      goto LAB_00018e9b;
    }
  }
  else {
    plVar3 = (long *)(**(code **)(*plVar3 + 0x200))(plVar3,0x1000);
    if (plVar3 != (long *)0x0) {
      puVar4 = (uint *)(**(code **)(*plVar3 + 0x118))(plVar3);
      uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
      goto LAB_00018dfb;
    }
    uVar2 = 0xe00002c8;
    plVar3 = (long *)0x0;
  }
LAB_00018e97:
  *(uint *)(param_3 + 0x60) = uVar7;
LAB_00018e9b:
  if (plVar3 != (long *)0x0) {
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_bulk_attachments(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_bulk_attachments
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  set_bulk_attachments(param_1,*(undefined8 **)(param_3 + 0x30));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_bulk_attachments(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_get_bulk_attachments
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  get_bulk_attachments
            (param_1,**(uint **)(param_3 + 0x20),*(void **)(param_3 + 0x58),
             (undefined4 *)(param_3 + 0x60));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_prefetch_pages(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_prefetch_pages
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  prefetch_pages(param_1,**(uint **)(param_3 + 0x20));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_gather_iosurface_data(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_gather_iosurface_data
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (param_1[0x11a] == (IOSurfaceRootUserClient)0x0) {
    uVar2 = 0xe00002c1;
  }
  else if (*(long *)(param_3 + 0x78) == 0) {
    uVar2 = 0xe00002c2;
  }
  else {
    plVar1 = (long *)OSSerialize::binaryWithCapacity(0x100000,(void *)0x0,(void *)0x0);
    if (plVar1 == (long *)0x0) {
      uVar2 = 0xe00002bd;
    }
    else {
      uVar2 = gather_iosurface_data(param_1,**(long **)(param_3 + 0x20),plVar1);
      if ((int)uVar2 == 0) {
        **(undefined8 **)(param_3 + 0x78) = plVar1;
        uVar2 = 0;
      }
      else {
        uVar2 = uVar2 & 0xffffffff;
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
    }
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_cmp_tile_data_used_of_plane(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_cmp_tile_data_used_of_plane
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  set_compressed_tile_data_region_memory_used_of_plane(param_1,*puVar1,puVar1[2],puVar1[4]);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_graphics_comm_page_address(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined8 __cdecl
IOSurfaceRootUserClient::s_get_graphics_comm_page_address
          (long param_1,undefined8 param_2,long param_3)

{
  undefined8 *puVar1;
  undefined8 uVar2;
  
  if (*(long **)(param_1 + 0x128) == (long *)0x0) {
    uVar2 = 0xe00002bd;
  }
  else {
    puVar1 = *(undefined8 **)(param_3 + 0x48);
    uVar2 = (**(code **)(**(long **)(param_1 + 0x128) + 0x118))();
    *puVar1 = uVar2;
    uVar2 = 0;
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_indexed_timestamp(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_indexed_timestamp
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  set_indexed_timestamp(param_1,*puVar1,*(ulong *)(puVar1 + 2),*(undefined8 *)(puVar1 + 4));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_lookup_surface_from_port(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_lookup_surface_from_port
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  lookup_surface_from_port(param_1,**(uint **)(param_3 + 0x20),*(undefined8 **)(param_3 + 0x58));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_create_port_from_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_create_port_from_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint local_1c;
  
  local_1c = 0;
  create_port_from_surface
            (param_1,**(uint **)(param_3 + 0x20),(ulong)(*(uint **)(param_3 + 0x20))[2],&local_1c);
  **(ulong **)(param_3 + 0x48) = (ulong)local_1c;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_create_shared_event(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_create_shared_event
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong *puVar1;
  ulong local_30;
  uint local_24;
  
  local_24 = 0;
  local_30 = 0;
  create_shared_event(param_1,**(ulong **)(param_3 + 0x20),&local_24,(long *)&local_30);
  puVar1 = *(ulong **)(param_3 + 0x48);
  *puVar1 = (ulong)local_24;
  puVar1[1] = local_30;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_signal_shared_event(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_signal_shared_event
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  signal_shared_event(param_1,**(uint **)(param_3 + 0x20),*(ulong *)(*(uint **)(param_3 + 0x20) + 2)
                     );
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_query_shared_event(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_query_shared_event
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  undefined8 *puVar1;
  
  puVar1 = *(undefined8 **)(param_3 + 0x48);
  query_shared_event(param_1,**(uint **)(param_3 + 0x20),puVar1,puVar1 + 1,puVar1 + 2,puVar1 + 3);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_notify_shared_event(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_notify_shared_event
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  notify_shared_event(param_1,*puVar1,*(undefined8 *)(puVar1 + 2),*(undefined8 *)(puVar1 + 4),
                      *(undefined8 *)(puVar1 + 6),*(ulong *)(puVar1 + 8));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_add_shared_event_notify_port(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_add_shared_event_notify_port
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  undefined4 uVar1;
  
  if (*(undefined8 **)(param_3 + 0x10) != (undefined8 *)0x0) {
    uVar1 = add_shared_event_notification_port(param_1,*(undefined8 **)(param_3 + 0x10));
    return uVar1;
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_remove_shared_event_notify_port(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_remove_shared_event_notify_port
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  remove_shared_event_notification_port(param_1,**(long **)(param_3 + 0x20));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_signal_shared_event_operation(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_signal_shared_event_operation
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  signal_shared_event_operation
            (param_1,*puVar1,*(long *)(puVar1 + 2),puVar1[4],*(ulong *)(puVar1 + 6));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_gpu_policy_dict(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_set_gpu_policy_dict
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  long *plVar2;
  char *pcVar3;
  ulong uVar4;
  
  plVar2 = *(long **)(param_3 + 0x40);
  if (plVar2 == (long *)0x0) {
    pcVar3 = *(char **)(param_3 + 0x30);
    uVar1 = *(uint *)(param_3 + 0x38);
    plVar2 = (long *)0x0;
  }
  else {
    plVar2 = (long *)(**(code **)(*plVar2 + 0x200))(plVar2,0x1000);
    if (plVar2 == (long *)0x0) {
      return 0xe00002c8;
    }
    pcVar3 = (char *)(**(code **)(*plVar2 + 0x118))(plVar2);
    uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar4 = 0xe00002c2;
  if ((pcVar3 != (char *)0x0) && (uVar1 != 0)) {
    uVar4 = set_gpu_policy_dict(param_1,pcVar3,(ulong)uVar1);
    uVar4 = uVar4 & 0xffffffff;
  }
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar4;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_pid_gpu_policy_dict(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_get_pid_gpu_policy_dict(long param_1,undefined8 param_2,long param_3)

{
  long *plVar1;
  ulong uVar2;
  
  if (*(long *)(param_3 + 0x78) == 0) {
    uVar2 = 0xe00002c2;
  }
  else {
    plVar1 = (long *)OSSerialize::binaryWithCapacity(0x1000,(void *)0x0,(void *)0x0);
    if (plVar1 == (long *)0x0) {
      uVar2 = 0xe00002bd;
    }
    else {
      uVar2 = IOSurfaceRoot::get_pid_gpu_policy_dict
                        (*(IOSurfaceRoot **)(param_1 + 0xe0),(long)**(int **)(param_3 + 0x20),plVar1
                        );
      if ((int)uVar2 == 0) {
        **(undefined8 **)(param_3 + 0x78) = plVar1;
        uVar2 = 0;
      }
      else {
        uVar2 = uVar2 & 0xffffffff;
        (**(code **)(*plVar1 + 0x28))(plVar1);
      }
    }
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_detach_mode_code(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_set_detach_mode_code
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  set_detach_mode_code
            (param_1,*puVar1,*(ulong *)(puVar1 + 2),*(ulong *)(puVar1 + 4),*(long *)(puVar1 + 6));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_image_origin_and_extents(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined8 __cdecl
IOSurfaceRootUserClient::s_set_image_origin_and_extents
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  undefined8 uVar2;
  
  if (*(int *)(param_3 + 0x38) == 0x1c) {
    puVar1 = *(uint **)(param_3 + 0x30);
    uVar2 = set_image_origin_and_extents
                      (param_1,*puVar1,puVar1[1],puVar1[2],puVar1[3],puVar1[4],puVar1[5],puVar1[6]);
    return uVar2;
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_ownership_identity(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_set_ownership_identity
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  int iVar1;
  undefined4 uVar2;
  long local_28;
  
  iVar1 = *(int *)(*(long *)(param_3 + 0x20) + 8);
  local_28 = 0;
  uVar2 = 0xe00002c2;
  if (iVar1 - 1U < 0xfffffffe) {
    iVar1 = _task_id_token_port_name_to_task(iVar1,&local_28);
    if (iVar1 == 0) {
      if (local_28 == 0) {
        uVar2 = 0xe00002c7;
      }
      else {
        uVar2 = set_ownership(param_1,**(uint **)(param_3 + 0x20),(int)local_28,
                              (*(uint **)(param_3 + 0x20))[4]);
        _task_deallocate(local_28);
      }
    }
  }
  return uVar2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_wait_shared_event(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_wait_shared_event
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint *puVar1;
  
  puVar1 = *(uint **)(param_3 + 0x20);
  wait_shared_event(param_1,*puVar1,*(ulong *)(puVar1 + 2),(int)*(undefined8 *)(puVar1 + 4));
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_create_memory_pool(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined4 __cdecl
IOSurfaceRootUserClient::s_create_memory_pool
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong *puVar1;
  uint uVar2;
  undefined4 uVar3;
  long *plVar4;
  char *pcVar5;
  ulong local_40;
  uint local_34;
  
  pcVar5 = *(char **)(param_3 + 0x30);
  uVar2 = *(uint *)(param_3 + 0x38);
  local_34 = 0;
  local_40 = 0;
  plVar4 = *(long **)(param_3 + 0x40);
  if (plVar4 == (long *)0x0) {
    plVar4 = (long *)0x0;
  }
  else {
    plVar4 = (long *)(**(code **)(*plVar4 + 0x200))(plVar4,0x1000);
    if (plVar4 == (long *)0x0) {
      return 0xe00002c8;
    }
    pcVar5 = (char *)(**(code **)(*plVar4 + 0x118))(plVar4);
    uVar2 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar3 = 0xe00002c2;
  if ((pcVar5 != (char *)0x0) && (uVar2 != 0)) {
    uVar3 = create_memory_pool(param_1,&local_34,&local_40,pcVar5,uVar2);
    puVar1 = *(ulong **)(param_3 + 0x48);
    *puVar1 = (ulong)local_34;
    puVar1[1] = local_40;
  }
  if (plVar4 != (long *)0x0) {
    (**(code **)(*plVar4 + 0x28))(plVar4);
  }
  return uVar3;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_ensure_memory_pool_memory(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_ensure_memory_pool_memory
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  long *plVar2;
  char *pcVar3;
  ulong uVar4;
  
  plVar2 = *(long **)(param_3 + 0x40);
  if (plVar2 == (long *)0x0) {
    pcVar3 = *(char **)(param_3 + 0x30);
    uVar1 = *(uint *)(param_3 + 0x38);
    plVar2 = (long *)0x0;
  }
  else {
    plVar2 = (long *)(**(code **)(*plVar2 + 0x200))(plVar2,0x1000);
    if (plVar2 == (long *)0x0) {
      return 0xe00002c8;
    }
    pcVar3 = (char *)(**(code **)(*plVar2 + 0x118))(plVar2);
    uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar4 = 0xe00002c2;
  if ((pcVar3 != (char *)0x0) && (uVar1 != 0)) {
    uVar4 = ensure_memory_pool_memory(param_1,**(uint **)(param_3 + 0x20),pcVar3,uVar1);
    uVar4 = uVar4 & 0xffffffff;
  }
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar4;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_flush_memory_pool(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_flush_memory_pool
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  uint uVar1;
  long *plVar2;
  char *pcVar3;
  ulong uVar4;
  
  plVar2 = *(long **)(param_3 + 0x40);
  if (plVar2 == (long *)0x0) {
    pcVar3 = *(char **)(param_3 + 0x30);
    uVar1 = *(uint *)(param_3 + 0x38);
    plVar2 = (long *)0x0;
  }
  else {
    plVar2 = (long *)(**(code **)(*plVar2 + 0x200))(plVar2,0x1000);
    if (plVar2 == (long *)0x0) {
      return 0xe00002c8;
    }
    pcVar3 = (char *)(**(code **)(*plVar2 + 0x118))(plVar2);
    uVar1 = (**(code **)(**(long **)(param_3 + 0x40) + 0x1c8))();
  }
  uVar4 = 0xe00002c2;
  if ((pcVar3 != (char *)0x0) && (uVar1 != 0)) {
    uVar4 = flush_memory_pool(param_1,**(uint **)(param_3 + 0x20),pcVar3,uVar1);
    uVar4 = uVar4 & 0xffffffff;
  }
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar4;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_gather_memory_pool_data(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

int __cdecl
IOSurfaceRootUserClient::s_gather_memory_pool_data
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  int iVar1;
  long *plVar2;
  
  if (*(long *)(param_3 + 0x78) == 0) {
    iVar1 = -0x1ffffd3e;
  }
  else {
    plVar2 = (long *)OSSerialize::binaryWithCapacity(0x100000,(void *)0x0,(void *)0x0);
    if (plVar2 == (long *)0x0) {
      iVar1 = -0x1ffffd43;
    }
    else {
      iVar1 = gather_memory_pool_data(param_1,**(uint **)(param_3 + 0x20),plVar2);
      if (iVar1 == 0) {
        **(undefined8 **)(param_3 + 0x78) = plVar2;
        iVar1 = 0;
      }
      else {
        (**(code **)(*plVar2 + 0x28))(plVar2);
      }
    }
  }
  return iVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_set_data_property(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_set_data_property
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong uVar1;
  
  if (*(long *)(param_3 + 0x40) != 0) {
    return 0xe00002c2;
  }
  uVar1 = set_data_property(param_1,**(uint **)(param_3 + 0x20),
                            *(ulong *)(*(uint **)(param_3 + 0x20) + 2),
                            (ulong)*(uint *)(param_3 + 0x38),*(void **)(param_3 + 0x30));
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_get_data_property(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_get_data_property
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong uVar1;
  
  if (*(long *)(param_3 + 0x68) != 0) {
    return 0xe00002c2;
  }
  uVar1 = get_data_property(param_1,**(uint **)(param_3 + 0x20),
                            *(ulong *)(*(uint **)(param_3 + 0x20) + 2),
                            (ulong)*(uint *)(param_3 + 0x60),*(long **)(param_3 + 0x48),
                            (size_t *)(*(long **)(param_3 + 0x48) + 1),
                            (undefined4 *)(param_3 + 0x60),*(void **)(param_3 + 0x58));
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_clear_data_properties(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

ulong __cdecl
IOSurfaceRootUserClient::s_clear_data_properties
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  ulong uVar1;
  
  if (*(long *)(param_3 + 0x68) != 0) {
    return 0xe00002c2;
  }
  uVar1 = clear_data_properties(param_1,**(uint **)(param_3 + 0x20));
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::s_invalidate_surface(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

void __cdecl
IOSurfaceRootUserClient::s_invalidate_surface
          (IOSurfaceRootUserClient *param_1,undefined8 param_2,long param_3)

{
  invalidate_surface(param_1,**(uint **)(param_3 + 0x20));
  return;
}



// IOSurfaceRootUserClient::s_restricted(IOSurfaceRootUserClient*, void*,
// IOExternalMethodArguments*)

undefined8 IOSurfaceRootUserClient::s_restricted(void)

{
  return 0xe00002e2;
}



// IOSurfaceRootUserClient::t_inc_sfc_use_count_for_category(unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_inc_sfc_use_count_for_category
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2)

{
  increment_surface_use_count_for_category(this,param_1,param_2);
  return;
}



// IOSurfaceRootUserClient::t_dec_sfc_use_count_for_category(unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_dec_sfc_use_count_for_category
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2)

{
  decrement_surface_use_count_for_category(this,param_1,param_2);
  return;
}



// IOSurfaceRootUserClient::t_lock_surface(unsigned long, unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_lock_surface
          (IOSurfaceRootUserClient *this,uint param_1,uint param_3_00,undefined8 param_3)

{
  lock_surface(this,param_1,param_3_00,param_3);
  return;
}



// IOSurfaceRootUserClient::t_unlock_surface(unsigned long, unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_unlock_surface
          (IOSurfaceRootUserClient *this,uint param_1,uint param_3_00,undefined8 param_3)

{
  unlock_surface(this,param_1,param_3_00,param_3);
  return;
}



// IOSurfaceRootUserClient::t_invalidate_surface(unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_invalidate_surface(IOSurfaceRootUserClient *this,uint param_1)

{
  invalidate_surface(this,param_1);
  return;
}



// IOSurfaceRootUserClient::t_release_surface(unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_release_surface(IOSurfaceRootUserClient *this,int param_1)

{
  release_surface(this,param_1);
  return;
}



// IOSurfaceRootUserClient::t_wait_shared_event(unsigned long, unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_wait_shared_event
          (IOSurfaceRootUserClient *this,uint param_2_00,ulong param_2,undefined4 param_3)

{
  wait_shared_event(this,param_2_00,param_2,param_3);
  return;
}



// IOSurfaceRootUserClient::t_signal_shared_event(unsigned long, unsigned long)

void __thiscall
IOSurfaceRootUserClient::t_signal_shared_event
          (IOSurfaceRootUserClient *this,uint param_2_00,ulong param_2)

{
  signal_shared_event(this,param_2_00,param_2);
  return;
}



// IOSurfaceRootUserClient::init(IOSurfaceRoot*, task*, OSDictionary*)

ulong __thiscall
IOSurfaceRootUserClient::init
          (IOSurfaceRootUserClient *this,OSMetaClassBase *param_1,task *param_2,undefined8 param_3)

{
  long *plVar1;
  char cVar2;
  long *plVar3;
  long *plVar4;
  long lVar5;
  IOSurfaceShared *pIVar6;
  task *ptVar7;
  ulong uVar8;
  IOSurfaceRootUserClient IVar9;
  
  cVar2 = (**(code **)(PTR_vtable_00027070 + 600))(this,param_3);
  if (cVar2 == '\0') {
    uVar8 = 0;
  }
  else {
    _task_reference(param_2);
    *(task **)(this + 0xf0) = param_2;
    plVar3 = (long *)IOUserClient::copyClientEntitlement(param_2,"com.apple.private.iosurfaceinfo");
    plVar1 = *(long **)PTR__kOSBooleanTrue_000270a8;
    plVar4 = (long *)*plVar1;
    if (plVar3 != (long *)0x0) {
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
    this[0x11a] = (IOSurfaceRootUserClient)(plVar3 == plVar4);
    plVar3 = (long *)IOUserClient::copyClientEntitlement(param_2,"com.apple.private.gpu-restricted")
    ;
    plVar4 = (long *)*plVar1;
    if (plVar3 != (long *)0x0) {
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
    if (plVar3 == plVar4) {
      IVar9 = (IOSurfaceRootUserClient)0x1;
    }
    else {
      plVar3 = (long *)IOUserClient::copyClientEntitlement
                                 (param_2,"com.apple.developer.gpu-restricted");
      plVar4 = (long *)*plVar1;
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x28))(plVar3);
      }
      IVar9 = (IOSurfaceRootUserClient)(plVar3 == plVar4);
    }
    this[0x11f] = IVar9;
    plVar4 = (long *)IOUserClient::copyClientEntitlement
                               (param_2,"com.apple.private.IOSurface.protected-access");
    plVar1 = (long *)*plVar1;
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x28))(plVar4);
    }
    this[0x11b] = (IOSurfaceRootUserClient)0x0;
    this[0x11e] = (IOSurfaceRootUserClient)
                  (this[0x11a] != (IOSurfaceRootUserClient)0x0 || plVar4 == plVar1);
    lVar5 = OSMetaClassBase::safeMetaCast(param_1,(OSMetaClass *)&IOSurfaceRoot::gMetaClass);
    *(long *)(this + 0xe0) = lVar5;
    if (lVar5 == 0) {
      uVar8 = 0;
      __os_log_internal(0,PTR___os_log_default_00027090,0x11,"provider not IOSurfaceRoot");
    }
    else {
      pIVar6 = IOSurfaceShared::withTask(param_2,(long *)param_1,*(IOSurfaceShared *)(this + 0x11e))
      ;
      if (*(long **)(this + 0x110) != (long *)0x0) {
        (**(code **)(**(long **)(this + 0x110) + 0x28))();
      }
      *(IOSurfaceShared **)(this + 0x110) = pIVar6;
      if (pIVar6 == (IOSurfaceShared *)0x0) {
        uVar8 = 0;
        __os_log_internal(0,PTR___os_log_default_00027090,0x11,"Cannot allocate IOSurfaceShared");
      }
      else {
        ptVar7 = (task *)IOSurfaceRoot::getGraphicsCommPageDescriptor
                                   (*(IOSurfaceRoot **)(this + 0xe0));
        lVar5 = IOMemoryDescriptor::createMappingInTask(ptVar7,(ulonglong)param_2,0,0x1001,0);
        if (*(long **)(this + 0x128) != (long *)0x0) {
          (**(code **)(**(long **)(this + 0x128) + 0x28))();
        }
        *(long *)(this + 0x128) = lVar5;
        if (lVar5 == 0) {
          uVar8 = 0;
          __os_log_internal(0,PTR___os_log_default_00027090,0x11,"Cannot map graphics comm page");
        }
        else {
          lVar5 = OSArray::withCapacity(1);
          if (*(long **)(this + 0xf8) != (long *)0x0) {
            (**(code **)(**(long **)(this + 0xf8) + 0x28))();
          }
          *(long *)(this + 0xf8) = lVar5;
          if (lVar5 == 0) {
            uVar8 = 0;
            __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                              "Cannot allocate notification array");
          }
          else {
            lVar5 = OSArray::withCapacity(1);
            if (*(long **)(this + 0x130) != (long *)0x0) {
              (**(code **)(**(long **)(this + 0x130) + 0x28))();
            }
            *(long *)(this + 0x130) = lVar5;
            if (lVar5 == 0) {
              uVar8 = 0;
              __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                                "Cannot allocate invalidated surface array");
            }
            else {
              lVar5 = _IOLockAlloc();
              *(long *)(this + 0xd8) = lVar5;
              uVar8 = CONCAT71((int7)((ulong)this >> 8),1);
              if (lVar5 == 0) {
                uVar8 = 0;
                __os_log_internal(0,PTR___os_log_default_00027090,0x11,"Cannot allocate IOLock");
              }
            }
          }
        }
      }
    }
  }
  return uVar8 & 0xffffffff;
}



// IOSurfaceRootUserClient::taskHasEntitlement(task*, char const*)

bool __thiscall
IOSurfaceRootUserClient::taskHasEntitlement(undefined8 param_1_00,task *param_2,char *param_3)

{
  long *plVar1;
  long *plVar2;
  
  plVar2 = (long *)IOUserClient::copyClientEntitlement(param_2,param_3);
  plVar1 = (long *)**(long **)PTR__kOSBooleanTrue_000270a8;
  if (plVar2 != (long *)0x0) {
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return plVar2 == plVar1;
}



// IOSurfaceRootUserClient::free()

void __thiscall IOSurfaceRootUserClient::free(IOSurfaceRootUserClient *this)

{
  ulong uVar1;
  ulong uVar2;
  ulong uVar3;
  uint uVar4;
  uint uVar5;
  ulong uVar6;
  ulong uVar7;
  ulong uVar8;
  
  uVar2 = (ulong)*(uint *)(this + 0x108);
  if (*(uint *)(this + 0x108) == 0) {
    uVar4 = 0;
  }
  else {
    uVar6 = 0;
    do {
      uVar1 = *(ulong *)(this + 0x100);
      uVar7 = uVar1 + uVar2 * 8;
      uVar3 = uVar7 - uVar1;
      if ((uVar7 < uVar1) || (uVar3 >> 0x20 != 0)) {
LAB_00019bcd:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      if ((long)(int)(uVar6 * 8) != uVar6 * 8) {
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                  );
      }
      uVar7 = uVar6 << 0x23;
      if ((long)uVar7 < 0) {
LAB_00019bc1:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                  );
      }
      uVar8 = uVar7 >> 0x20;
      uVar4 = (int)(uVar7 >> 0x20) + 8;
      if ((uint)uVar3 < uVar4) goto LAB_00019bc1;
      uVar7 = -(ulong)CARRY8(uVar1,uVar8);
      if ((CARRY8(uVar1,uVar8) != uVar7) || ((long)uVar7 < 0)) {
LAB_00019bd9:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                  );
      }
      if (*(long **)(uVar1 + uVar8) != (long *)0x0) {
        (**(code **)(**(long **)(uVar1 + uVar8) + 0x28))();
        uVar1 = *(ulong *)(this + 0x100);
        uVar2 = (ulong)*(uint *)(this + 0x108);
        uVar7 = uVar1 + uVar2 * 8;
        uVar3 = uVar7 - uVar1;
        if ((uVar7 < uVar1) || (uVar3 >> 0x20 != 0)) goto LAB_00019bcd;
        if ((uint)uVar3 < uVar4) goto LAB_00019bc1;
        uVar7 = -(ulong)CARRY8(uVar1,uVar8);
        if ((CARRY8(uVar1,uVar8) != uVar7) || ((long)uVar7 < 0)) goto LAB_00019bd9;
        *(undefined8 *)(uVar1 + uVar8) = 0;
      }
      uVar5 = (int)uVar6 + 1;
      uVar6 = (ulong)uVar5;
      uVar4 = (uint)uVar2;
    } while (uVar5 < uVar4);
  }
  _IOFreeTypeVarImpl(&free_handles()::kalloc_type_view_2462,*(undefined8 *)(this + 0x100),
                     (ulong)uVar4 << 3);
  *(undefined8 *)(this + 0x100) = 0;
  *(undefined4 *)(this + 0x108) = 0;
  if (*(long **)(this + 0x130) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x130) + 0x28))();
  }
  *(undefined8 *)(this + 0x130) = 0;
  if (*(long *)(this + 0xf0) != 0) {
    _task_deallocate();
  }
  if (*(long *)(this + 0xd8) != 0) {
    _IOLockFree();
    *(undefined8 *)(this + 0xd8) = 0;
  }
                    // WARNING: Could not recover jumptable at 0x00019bbb. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027070 + 0xa0))(this);
  return;
}



// IOSurfaceRootUserClient::free_handles()

void __thiscall IOSurfaceRootUserClient::free_handles(IOSurfaceRootUserClient *this)

{
  _IOFreeTypeVarImpl(&free_handles()::kalloc_type_view_2462,*(undefined8 *)(this + 0x100),
                     (ulong)*(uint *)(this + 0x108) << 3);
  *(undefined8 *)(this + 0x100) = 0;
  *(undefined4 *)(this + 0x108) = 0;
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::start(IOService*)

ulong __cdecl IOSurfaceRootUserClient::start(long *param_1)

{
  undefined8 *puVar1;
  char cVar2;
  ulong uVar3;
  
  cVar2 = (**(code **)(PTR_vtable_00027070 + 0x5d0))();
  if (cVar2 == '\0') {
    uVar3 = 0;
  }
  else {
    puVar1 = *(undefined8 **)PTR__kOSBooleanFalse_000270a0;
    (**(code **)(*param_1 + 0x268))(param_1,"IOUserClientEntitlements",*puVar1);
    (**(code **)(*param_1 + 0x268))(param_1,"IOUserClientDefaultLocking",*puVar1);
    (**(code **)(*param_1 + 0x268))
              (param_1,"IOUserClientDefaultLockingSetProperties",
               **(undefined8 **)PTR__kOSBooleanTrue_000270a8);
    (**(code **)(*param_1 + 0x268))
              (param_1,"IOUserClientDefaultLockingSingleThreadExternalMethod",*puVar1);
    uVar3 = IOSurfaceRoot::client_started((IOSurfaceRoot *)param_1[0x1c],param_1,param_1[0x1e]);
    *(char *)(param_1 + 0x1d) = (char)uVar3;
  }
  return uVar3;
}



// IOSurfaceRootUserClient::stop(IOService*)

void __thiscall IOSurfaceRootUserClient::stop(IOSurfaceRootUserClient *this,undefined8 param_1)

{
  if (this[0xe8] != (IOSurfaceRootUserClient)0x0) {
    this[0xe8] = (IOSurfaceRootUserClient)0x0;
    IOSurfaceRoot::client_stopped
              (*(IOSurfaceRoot **)(this + 0xe0),(long)this,*(long *)(this + 0xf0));
    IOSurfaceRoot::clientTaskStopped(*(IOSurfaceRoot **)(this + 0xe0),*(long *)(this + 0xf0));
    IOSurfaceRoot::removeSurfaceNotifications(*(IOSurfaceRoot **)(this + 0xe0),(long)this);
  }
                    // WARNING: Could not recover jumptable at 0x00019d4b. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027070 + 0x5d8))(this,param_1);
  return;
}



// IOSurfaceRootUserClient::clientClose()

undefined8 __thiscall IOSurfaceRootUserClient::clientClose(IOSurfaceRootUserClient *this)

{
  (**(code **)(*(long *)this + 0x600))(this,0);
  return 0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::create_surface(void*, unsigned int, IOSurfaceLockResult*, unsigned int,
// unsigned int*)

undefined4 __cdecl
IOSurfaceRootUserClient::create_surface
          (IOSurfaceRootUserClient *param_1,char *param_2,int param_3,undefined8 *param_4,
          uint param_5)

{
  bool bVar1;
  undefined4 uVar2;
  OSMetaClassBase *pOVar3;
  long *plVar4;
  OSMetaClassBase *pOVar5;
  long *plVar6;
  long lVar7;
  IOSurfaceMemoryPoolBunch *this;
  IOSurfaceMemoryPool *this_00;
  ulong uVar8;
  IOSurface *pIVar9;
  IOSurfaceClient *this_01;
  undefined8 uVar10;
  IOSurfaceClient *pIVar11;
  undefined4 uVar12;
  
  if (0x3fff < *(uint *)(param_1 + 0x120)) {
    return 0xe00002be;
  }
  if (param_2 == (char *)0x0) {
    return 0xe00002c2;
  }
  pOVar3 = (OSMetaClassBase *)OSUnserializeXML(param_2,(ulong)param_5,(OSString **)0x0);
  if (pOVar3 == (OSMetaClassBase *)0x0) {
    return 0xe00002c2;
  }
  plVar4 = (long *)OSMetaClassBase::safeMetaCast(pOVar3,*(OSMetaClass **)PTR_metaClass_00027010);
  if (plVar4 == (long *)0x0) {
    uVar12 = 0xe00002c2;
    goto LAB_00019f90;
  }
  uVar2 = 0xe00002c2;
  if (param_3 == 0) {
    pOVar5 = (OSMetaClassBase *)
             (**(code **)(*plVar4 + 0x208))(plVar4,"IOSurfaceAllocateFromSuperbuffer");
    plVar6 = (long *)OSMetaClassBase::safeMetaCast(pOVar5,*(OSMetaClass **)PTR_metaClass_00027040);
    if (plVar6 == (long *)0x0) {
LAB_00019e94:
      pIVar9 = IOSurfaceRoot::create_surface_internal
                         (*(IOSurfaceRoot **)(param_1 + 0xe0),*(long *)(param_1 + 0xf0),plVar4,
                          (long *)0x0);
      if (pIVar9 == (IOSurface *)0x0) {
        uVar12 = 0xe00002c2;
      }
      else {
        this_01 = (IOSurfaceClient *)
                  IOSurfaceClient::withBuffer(*(undefined8 *)(param_1 + 0x110),pIVar9,1);
        if (this_01 == (IOSurfaceClient *)0x0) {
          uVar12 = 0xe00002bd;
        }
        else {
          _IOLockLock(*(undefined8 *)(param_1 + 0xd8));
          uVar8 = IOSurfaceRoot::set_surfaceid_with_handle
                            (*(IOSurfaceRoot **)(param_1 + 0xe0),(long)pIVar9,
                             *(uint *)(pIVar9 + 0x10));
          uVar12 = 0xe00002bd;
          if (((char)uVar8 != '\0') &&
             (pIVar11 = this_01,
             uVar10 = set_surface_handle(param_1,(long *)this_01,*(uint *)(pIVar9 + 0x10)),
             (char)uVar10 != '\0')) {
            add_client_buffer(param_1,pIVar11,1);
            IOSurfaceClient::getLockResult(this_01,param_4);
            uVar12 = 0;
          }
          _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
          (**(code **)(*(long *)this_01 + 0x28))(this_01);
        }
      }
      bVar1 = false;
      if (plVar6 != (long *)0x0) goto LAB_00019f6f;
    }
    else {
      (**(code **)(*plVar6 + 0x20))(plVar6);
      lVar7 = (**(code **)(*plVar6 + 0x150))(plVar6);
      if (lVar7 == 0) goto LAB_00019e94;
      this = (IOSurfaceMemoryPoolBunch *)
             IOSurfaceRoot::getMemoryPoolBunch(*(IOSurfaceRoot **)(param_1 + 0xe0));
      this_00 = (IOSurfaceMemoryPool *)IOSurfaceMemoryPoolBunch::getPool(this,lVar7);
      if (this != (IOSurfaceMemoryPoolBunch *)0x0) {
        (**(code **)(*(long *)this + 0x28))(this);
      }
      if (this_00 == (IOSurfaceMemoryPool *)0x0) goto LAB_00019e94;
      uVar8 = IOSurfaceMemoryPool::taskCanUsePool(this_00,*(task **)(param_1 + 0xf0));
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
      if ((char)uVar8 != '\0') goto LAB_00019e94;
      uVar12 = 0xe00002c2;
      bVar1 = true;
      pIVar9 = (IOSurface *)0x0;
LAB_00019f6f:
      (**(code **)(*plVar6 + 0x28))();
    }
    if (pIVar9 != (IOSurface *)0x0) {
      (**(code **)(*(long *)pIVar9 + 0x28))(pIVar9);
    }
    uVar2 = 0xe00002e2;
    if (!bVar1) goto LAB_00019f90;
  }
  uVar12 = uVar2;
LAB_00019f90:
  (**(code **)(*(long *)pOVar3 + 0x28))();
  return uVar12;
}



// IOSurfaceRootUserClient::release_surface(unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::release_surface(IOSurfaceRootUserClient *this,int param_1)

{
  int iVar1;
  long *plVar2;
  int iVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  iVar1 = (**(code **)(**(long **)(this + 0x130) + 0x130))();
  if (iVar1 != 0) {
    iVar3 = 0;
    do {
      plVar2 = (long *)(**(code **)(**(long **)(this + 0x130) + 0x1e8))
                                 (*(long **)(this + 0x130),iVar3);
      if ((int)plVar2[7] == param_1) {
        (**(code **)(*plVar2 + 0x20))(plVar2);
        (**(code **)(**(long **)(this + 0x130) + 0x1d8))(*(long **)(this + 0x130),iVar3);
        if ((char)plVar2[0xe] != '\0') {
          *(int *)(this + 0x120) = *(int *)(this + 0x120) + -1;
        }
        *(int *)(this + 0x124) = *(int *)(this + 0x124) + -1;
        _IOLockUnlock(*(undefined8 *)(this + 0xd8));
        (**(code **)(*plVar2 + 0x28))(plVar2);
        return 0;
      }
      iVar3 = iVar3 + 1;
    } while (iVar1 != iVar3);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  return 0xe00002c2;
}



// IOSurfaceRootUserClient::invalidate_surface(unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::invalidate_surface(IOSurfaceRootUserClient *this,uint param_1)

{
  long lVar1;
  ulong uVar2;
  long *plVar3;
  undefined8 uVar4;
  ulong uVar5;
  ulong uVar6;
  ulong uVar7;
  undefined8 uVar8;
  long *local_28;
  
  local_28 = (long *)&DAT_aaaaaaaaaaaaaaaa;
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  uVar4 = getSurfaceClient(this,param_1,(long *)&local_28);
  plVar3 = local_28;
  uVar8 = 0xe00002c2;
  if ((char)uVar4 != '\0') {
    (**(code **)(**(long **)(this + 0x130) + 0x1b8))(*(long **)(this + 0x130),local_28);
    (**(code **)(*plVar3 + 0x28))(plVar3);
    uVar2 = *(ulong *)(this + 0x100);
    uVar6 = uVar2 + (ulong)*(uint *)(this + 0x108) * 8;
    uVar5 = uVar6 - uVar2;
    if ((uVar6 < uVar2) || (uVar5 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar1 = (ulong)param_1 * 8;
    if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar6 = (ulong)param_1 << 0x23;
    if (((long)uVar6 < 0) || ((uint)uVar5 < (int)(uVar6 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar7 = (ulong)CARRY8(uVar2,uVar6 >> 0x20);
    uVar5 = -uVar7;
    if ((uVar7 != uVar5) || ((long)uVar5 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    *(undefined8 *)(uVar2 + (uVar6 >> 0x20)) = 0;
    uVar8 = 0;
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  return uVar8;
}



// IOSurfaceRootUserClient::lock_surface(IOSurfaceLockData*, IOSurfaceLockResult*, unsigned int,
// unsigned int*)

ulong __thiscall
IOSurfaceRootUserClient::lock_surface
          (IOSurfaceRootUserClient *this,uint *param_1,undefined8 *param_2,int param_3,int *param_4)

{
  uint uVar1;
  IOSurface *this_00;
  IOSurfaceClient *this_01;
  IOFence *this_02;
  ulong uVar2;
  ulong uVar3;
  uint local_34;
  
  uVar3 = 0xe00002c2;
  if ((((param_2 != (undefined8 *)0x0) && (param_1 != (uint *)0x0)) && (param_3 == 0xc)) &&
     (*param_4 == 0xc68)) {
    uVar1 = param_1[1];
    this_01 = (IOSurfaceClient *)retainSurfaceClient(this,*param_1);
    if (this_01 != (IOSurfaceClient *)0x0) {
      this_00 = *(IOSurface **)(this_01 + 0x40);
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x20))(this_00);
      }
      local_34 = 0xaaaaaaaa;
      if ((uVar1 & 4) != 0) {
        this_02 = (IOFence *)IOSurface::createFence(this_00,2 - (uVar1 & 1),0xffffffff);
        if (this_02 != (IOFence *)0x0) {
          IOFence::complete(this_02,0);
          (**(code **)(*(long *)this_02 + 0x28))(this_02);
        }
      }
      uVar2 = IOSurface::lockSurface(this_00,(ulong)uVar1,&local_34);
      uVar3 = uVar2 & 0xffffffff;
      if ((int)uVar2 == 0) {
        IOSurfaceClient::getLockResult(this_01,param_2);
        *(uint *)(param_2 + 0xd) = local_34;
      }
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x28))(this_00);
      }
      (**(code **)(*(long *)this_01 + 0x28))(this_01);
    }
  }
  return uVar3;
}



// IOSurfaceRootUserClient::unlock_surface(IOSurfaceUnlockData*, IOSurfaceUnlockResult*, unsigned
// int, unsigned int*)

ulong __thiscall
IOSurfaceRootUserClient::unlock_surface
          (IOSurfaceRootUserClient *this,uint *param_1,undefined4 *param_2,int param_3,int *param_4)

{
  uint uVar1;
  IOSurface *this_00;
  ulong uVar2;
  
  if ((((param_2 != (undefined4 *)0x0) && (param_1 != (uint *)0x0)) && (param_3 == 0xc)) &&
     (*param_4 == 4)) {
    uVar1 = param_1[1];
    this_00 = (IOSurface *)retainSurface(this,*param_1);
    if (this_00 != (IOSurface *)0x0) {
      uVar2 = IOSurface::unlockSurface(this_00,(ulong)uVar1,param_2);
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
      return uVar2 & 0xffffffff;
    }
  }
  return 0xe00002c2;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::lookup_surface(unsigned int, IOSurfaceLockResult*, unsigned int*)

undefined8 __cdecl
IOSurfaceRootUserClient::lookup_surface
          (IOSurfaceRootUserClient *param_1,uint param_2,undefined8 *param_3)

{
  undefined8 uVar1;
  IOSurface *pIVar2;
  IOSurfaceClient *this;
  undefined8 uVar3;
  IOSurfaceClient *pIVar4;
  long local_38;
  
  _IOLockLock(*(undefined8 *)(param_1 + 0xd8));
  uVar1 = getSurfaceClient(param_1,param_2,&local_38);
  if (((char)uVar1 != '\0') ||
     (pIVar2 = IOSurfaceRoot::lookupSurfaceFromClient
                         (*(IOSurfaceRoot **)(param_1 + 0xe0),(ulong)param_2,
                          *(long *)(param_1 + 0xf0),param_1), pIVar2 == (IOSurface *)0x0)) {
    _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
    return 0xe00002c2;
  }
  this = (IOSurfaceClient *)IOSurfaceClient::withBuffer(*(undefined8 *)(param_1 + 0x110),pIVar2,0);
  uVar1 = 0xe00002bd;
  if ((this != (IOSurfaceClient *)0x0) &&
     (pIVar4 = this, uVar3 = set_surface_handle(param_1,(long *)this,*(uint *)(pIVar2 + 0x10)),
     (char)uVar3 != '\0')) {
    uVar1 = 0;
    add_client_buffer(param_1,pIVar4,0);
    IOSurfaceClient::getLockResult(this,param_3);
  }
  _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
  (**(code **)(*(long *)pIVar2 + 0x28))(pIVar2);
  if (this == (IOSurfaceClient *)0x0) {
    return uVar1;
  }
  (**(code **)(*(long *)this + 0x28))(this);
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::lookup_surface_from_port(unsigned int, IOSurfaceLockResult*, unsigned
// int*)

int __cdecl
IOSurfaceRootUserClient::lookup_surface_from_port
          (IOSurfaceRootUserClient *param_1,uint param_2,undefined8 *param_3)

{
  int iVar1;
  int iVar2;
  long lVar3;
  undefined8 uVar4;
  IOSurfaceClient *this;
  IOSurfaceClient *pIVar5;
  undefined1 *local_40;
  OSMetaClassBase *local_38;
  
  local_40 = &DAT_aaaaaaaaaaaaaaaa;
  local_38 = (OSMetaClassBase *)0x0;
  iVar2 = IOUserClient::copyObjectForPortNameInTask
                    (*(task **)(param_1 + 0xf0),param_2,(OSSharedPtr *)&local_38);
  if (iVar2 == 0) {
    lVar3 = OSMetaClassBase::safeMetaCast(local_38,(OSMetaClass *)&IOSurfaceSendRight::gMetaClass);
    if (lVar3 != 0) {
      lVar3 = *(long *)(lVar3 + 0x18);
      _IOLockLock(*(undefined8 *)(param_1 + 0xd8));
      uVar4 = getSurfaceClient(param_1,*(uint *)(lVar3 + 0x10),(long *)&local_40);
      if ((char)uVar4 == '\0') {
        if (((*(byte *)(lVar3 + 0x3ca) & 8) == 0) ||
           (*(long *)(lVar3 + 0x170) == *(long *)(param_1 + 0xf0))) {
          this = (IOSurfaceClient *)
                 IOSurfaceClient::withBuffer(*(undefined8 *)(param_1 + 0x110),lVar3,0);
          iVar2 = -0x1ffffd43;
          iVar1 = -0x1ffffd43;
          if (this != (IOSurfaceClient *)0x0) {
            pIVar5 = this;
            uVar4 = set_surface_handle(param_1,(long *)this,*(uint *)(lVar3 + 0x10));
            if ((char)uVar4 != '\0') {
              iVar2 = 0;
              add_client_buffer(param_1,pIVar5,0);
              IOSurfaceClient::getLockResult(this,param_3);
            }
            goto LAB_0001a510;
          }
        }
        else {
          iVar1 = -0x1ffffd3e;
        }
        iVar2 = iVar1;
        this = (IOSurfaceClient *)0x0;
      }
      else {
        *param_3 = 0xffffffffffffffff;
        *(undefined4 *)(param_3 + 3) = *(undefined4 *)(local_40 + 0x38);
        this = (IOSurfaceClient *)0x0;
        iVar2 = 0;
      }
LAB_0001a510:
      _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
      goto LAB_0001a51c;
    }
    iVar2 = -0x1ffffd3e;
  }
  this = (IOSurfaceClient *)0x0;
LAB_0001a51c:
  if (local_38 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_38 + 0x28))();
  }
  if (this != (IOSurfaceClient *)0x0) {
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return iVar2;
}



// IOSurfaceRootUserClient::create_port_from_surface(unsigned int, unsigned long long, unsigned
// int*)

undefined4 __thiscall
IOSurfaceRootUserClient::create_port_from_surface
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,uint *param_3)

{
  undefined4 uVar1;
  long *plVar2;
  
  plVar2 = retainSurface(this,param_1);
  if (plVar2 == (long *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurfaceRoot::copyPortNameForSurfaceInTaskWithOptions
                      (*(IOSurfaceRoot **)(this + 0xe0),*(task **)(this + 0xf0),plVar2,param_2,
                       param_3);
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::set_ycbcrmatrix(unsigned int, unsigned int)

ulong __thiscall
IOSurfaceRootUserClient::set_ycbcrmatrix
          (IOSurfaceRootUserClient *this,uint param_1,undefined1 param_2)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setYCbCrMatrix(this_00,param_2);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::create_surface_fast_path(_IOSurfaceFastCreateArgs*,
// IOSurfaceLockResult*, unsigned int, unsigned int*)

undefined8 __cdecl
IOSurfaceRootUserClient::create_surface_fast_path
          (IOSurfaceRootUserClient *param_1,ulonglong *param_2,undefined8 *param_3)

{
  long *plVar1;
  long *plVar2;
  long *plVar3;
  IOSurface *pIVar4;
  IOSurfaceClient *this;
  ulong uVar5;
  undefined8 uVar6;
  IOSurfaceClient *pIVar7;
  undefined8 uVar8;
  long lVar9;
  
  uVar8 = 0xe00002be;
  if (*(uint *)(param_1 + 0x120) < 0x4000) {
    plVar1 = (long *)OSDictionary::withCapacity(8);
    if (*param_2 == 0) {
      plVar2 = (long *)0x0;
    }
    else {
      plVar2 = (long *)OSNumber::withNumber(*param_2,0x40);
      (**(code **)(*plVar1 + 0x1d0))(plVar1,"IOSurfaceAddress",plVar2);
    }
    lVar9 = 0;
    do {
      uVar5 = (ulong)*(uint *)((long)param_2 + lVar9 + 8);
      plVar3 = plVar2;
      if (uVar5 != 0) {
        plVar3 = (long *)OSNumber::withNumber(uVar5,0x20);
        if (plVar2 != (long *)0x0) {
          (**(code **)(*plVar2 + 0x28))(plVar2);
        }
        (**(code **)(*plVar1 + 0x1d0))
                  (plVar1,(long)&DAT_00026fdc + (long)*(int *)((long)&DAT_00026fdc + lVar9),plVar3);
      }
      lVar9 = lVar9 + 4;
      plVar2 = plVar3;
    } while (lVar9 != 0x18);
    pIVar4 = IOSurfaceRoot::create_surface_internal
                       (*(IOSurfaceRoot **)(param_1 + 0xe0),*(long *)(param_1 + 0xf0),plVar1,
                        (long *)0x0);
    if (pIVar4 == (IOSurface *)0x0) {
      uVar8 = 0xe00002c2;
    }
    else {
      this = (IOSurfaceClient *)
             IOSurfaceClient::withBuffer(*(undefined8 *)(param_1 + 0x110),pIVar4,1);
      if (this == (IOSurfaceClient *)0x0) {
        uVar8 = 0xe00002bd;
      }
      else {
        _IOLockLock(*(undefined8 *)(param_1 + 0xd8));
        uVar5 = IOSurfaceRoot::set_surfaceid_with_handle
                          (*(IOSurfaceRoot **)(param_1 + 0xe0),(long)pIVar4,*(uint *)(pIVar4 + 0x10)
                          );
        uVar8 = 0xe00002bd;
        if ((char)uVar5 != '\0') {
          pIVar7 = this;
          uVar6 = set_surface_handle(param_1,(long *)this,*(uint *)(pIVar4 + 0x10));
          if ((char)uVar6 != '\0') {
            add_client_buffer(param_1,pIVar7,1);
            IOSurfaceClient::getLockResult(this,param_3);
            uVar8 = 0;
          }
        }
        _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
        (**(code **)(*(long *)this + 0x28))();
      }
      (**(code **)(*(long *)pIVar4 + 0x28))(pIVar4);
    }
    if (plVar3 != (long *)0x0) {
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  return uVar8;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::create_surface_client_mem(unsigned long long, unsigned long long,
// IOSurfaceLockResult*, unsigned int*)

undefined8 __cdecl
IOSurfaceRootUserClient::create_surface_client_mem
          (IOSurfaceRootUserClient *param_1,ulonglong param_2,ulonglong param_3,undefined8 *param_4)

{
  long *plVar1;
  long *plVar2;
  long *plVar3;
  IOSurface *pIVar4;
  IOSurfaceClient *this;
  ulong uVar5;
  undefined8 uVar6;
  IOSurfaceClient *pIVar7;
  undefined8 uVar8;
  
  uVar8 = 0xe00002c2;
  if (((param_2 != 0) && (param_3 != 0)) &&
     (uVar8 = 0xe00002be, *(uint *)(param_1 + 0x120) < 0x4000)) {
    plVar1 = (long *)OSDictionary::withCapacity(3);
    if (plVar1 == (long *)0x0) {
      uVar8 = 0xe00002bd;
    }
    else {
      plVar2 = (long *)OSNumber::withNumber(param_2,0x40);
      if (plVar2 == (long *)0x0) {
        plVar3 = (long *)OSNumber::withNumber(param_3,0x40);
      }
      else {
        (**(code **)(*plVar1 + 0x1d0))(plVar1,"IOSurfaceAddress",plVar2);
        plVar3 = (long *)OSNumber::withNumber(param_3,0x40);
        (**(code **)(*plVar2 + 0x28))(plVar2);
      }
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar1 + 0x1d0))(plVar1,"IOSurfaceAllocSize",plVar3);
      }
      pIVar4 = IOSurfaceRoot::create_surface_internal
                         (*(IOSurfaceRoot **)(param_1 + 0xe0),*(long *)(param_1 + 0xf0),plVar1,
                          (long *)0x0);
      if (pIVar4 == (IOSurface *)0x0) {
        uVar8 = 0xe00002c2;
      }
      else {
        this = (IOSurfaceClient *)
               IOSurfaceClient::withBuffer(*(undefined8 *)(param_1 + 0x110),pIVar4,1);
        if (this == (IOSurfaceClient *)0x0) {
          uVar8 = 0xe00002bd;
        }
        else {
          _IOLockLock(*(undefined8 *)(param_1 + 0xd8));
          uVar5 = IOSurfaceRoot::set_surfaceid_with_handle
                            (*(IOSurfaceRoot **)(param_1 + 0xe0),(long)pIVar4,
                             *(uint *)(pIVar4 + 0x10));
          uVar8 = 0xe00002bd;
          if ((char)uVar5 != '\0') {
            pIVar7 = this;
            uVar6 = set_surface_handle(param_1,(long *)this,*(uint *)(pIVar4 + 0x10));
            if ((char)uVar6 != '\0') {
              add_client_buffer(param_1,pIVar7,1);
              IOSurfaceClient::getLockResult(this,param_4);
              uVar8 = 0;
            }
          }
          _IOLockUnlock(*(undefined8 *)(param_1 + 0xd8));
          (**(code **)(*(long *)this + 0x28))();
        }
        (**(code **)(*(long *)pIVar4 + 0x28))(pIVar4);
      }
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x28))(plVar3);
      }
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  return uVar8;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::get_ycbcrmatrix(unsigned int, unsigned int*)

ulong __cdecl
IOSurfaceRootUserClient::get_ycbcrmatrix(IOSurfaceRootUserClient *param_1,uint param_2)

{
  undefined1 uVar1;
  IOSurface *this;
  undefined7 extraout_var;
  ulong uVar2;
  
  this = (IOSurface *)retainSurface(param_1,param_2);
  if (this == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::getYCbCrMatrix(this);
    uVar2 = CONCAT71(extraout_var,uVar1) & 0xffffffff;
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return uVar2;
}



// IOSurfaceRootUserClient::set_value(IOSurfaceValueArgs*, unsigned int, IOSurfaceValueResultArgs*)

undefined4 __thiscall
IOSurfaceRootUserClient::set_value
          (IOSurfaceRootUserClient *this,uint *param_1,uint param_2,int *param_3)

{
  IOSurface *this_00;
  OSMetaClassBase *pOVar1;
  long *plVar2;
  OSMetaClassBase *pOVar3;
  OSMetaClassBase *pOVar4;
  OSString *pOVar5;
  ulong uVar6;
  undefined4 uVar7;
  
  this_00 = (IOSurface *)retainSurface(this,*param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar7 = 0xe00002c2;
  }
  else {
    pOVar1 = (OSMetaClassBase *)
             OSUnserializeXML((char *)(param_1 + 2),
                              (long)param_1 + ((ulong)param_2 - (long)(param_1 + 2)),
                              (OSString **)0x0);
    if (pOVar1 == (OSMetaClassBase *)0x0) {
      uVar7 = 0xe00002c2;
    }
    else {
      plVar2 = (long *)OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027038)
      ;
      uVar7 = 0xe00002c2;
      if (plVar2 != (long *)0x0) {
        pOVar5 = (OSString *)0x0;
        pOVar3 = (OSMetaClassBase *)(**(code **)(*plVar2 + 0x1e8))(plVar2,0);
        pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar2 + 0x1e8))(plVar2,1);
        if (pOVar4 != (OSMetaClassBase *)0x0) {
          pOVar5 = (OSString *)
                   OSMetaClassBase::safeMetaCast(pOVar4,*(OSMetaClass **)PTR_metaClass_00027058);
        }
        if ((pOVar3 != (OSMetaClassBase *)0x0) &&
           (pOVar4 == (OSMetaClassBase *)0x0 || pOVar5 != (OSString *)0x0)) {
          uVar6 = IOSurface::setValue(this_00,pOVar5,pOVar3,param_3);
          uVar7 = 0xe00002c9;
          if ((char)uVar6 != '\0') {
            uVar7 = 0;
          }
        }
      }
      (**(code **)(*(long *)pOVar1 + 0x28))(pOVar1);
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar7;
}



// IOSurfaceRootUserClient::get_value(IOSurfaceValueArgs*, IOSurfaceValueArgs*, unsigned int,
// unsigned int*)

undefined4 __thiscall
IOSurfaceRootUserClient::get_value
          (IOSurfaceRootUserClient *this,uint *param_1,long param_2,int param_3,uint *param_4)

{
  ulong uVar1;
  char cVar2;
  uint uVar3;
  uint uVar4;
  IOSurface *this_00;
  OSString *pOVar5;
  OSMetaClassBase *pOVar6;
  long *plVar7;
  void *pvVar8;
  undefined4 uVar9;
  
  this_00 = (IOSurface *)retainSurface(this,*param_1);
  if (this_00 == (IOSurface *)0x0) {
    return 0xe00002c2;
  }
  if ((char)param_1[2] == '\0') {
    pOVar5 = (OSString *)0x0;
  }
  else {
    uVar9 = 0xe00002c2;
    if ((*(char *)((long)param_1 + (long)(param_3 + -9) + 8) != '\0') ||
       (pOVar5 = (OSString *)OSString::withCString((char *)(param_1 + 2)), pOVar5 == (OSString *)0x0
       )) goto LAB_0001ac74;
  }
  pOVar6 = IOSurface::copyValue(this_00,pOVar5,(undefined4 *)(param_2 + 4));
  if (pOVar6 == (OSMetaClassBase *)0x0) {
    *param_4 = 0;
    uVar9 = 0;
  }
  else {
    plVar7 = (long *)OSSerialize::binaryWithCapacity(*param_4 - 8,(void *)0x0,(void *)0x0);
    if (plVar7 == (long *)0x0) {
      uVar9 = 0xe00002bd;
    }
    else {
      (**(code **)(*plVar7 + 0x120))(plVar7);
      cVar2 = (**(code **)(*(long *)pOVar6 + 0x30))(pOVar6,plVar7);
      uVar9 = 0xe00002c7;
      if (cVar2 != '\0') {
        uVar3 = (**(code **)(*plVar7 + 0x158))(plVar7);
        uVar1 = (ulong)uVar3 + 8;
        if (*param_4 < uVar1) {
          IOSurface::lock(this_00);
          uVar4 = IOSurface::get_max_property_size(this_00);
          uVar9 = 0xe00002db;
        }
        else {
          pvVar8 = (void *)(**(code **)(*plVar7 + 0x118))(plVar7);
          _memmove((void *)(param_2 + 8),pvVar8,(ulong)uVar3);
          *param_4 = (uint)uVar1;
          IOSurface::lock(this_00);
          uVar4 = IOSurface::get_max_property_size(this_00);
          uVar9 = 0;
        }
        if (uVar4 < uVar3) {
          IOSurface::set_max_property_size(this_00,uVar3);
        }
        IOSurface::unlock(this_00);
      }
      (**(code **)(*plVar7 + 0x28))(plVar7);
    }
    (**(code **)(*(long *)pOVar6 + 0x28))();
  }
  if (pOVar5 != (OSString *)0x0) {
    (**(code **)(*(long *)pOVar5 + 0x28))(pOVar5);
  }
LAB_0001ac74:
  (**(code **)(*(long *)this_00 + 0x28))(this_00);
  return uVar9;
}



// IOSurfaceRootUserClient::remove_value(IOSurfaceValueArgs*, unsigned int,
// IOSurfaceValueResultArgs*)

ulong __thiscall
IOSurfaceRootUserClient::remove_value
          (IOSurfaceRootUserClient *this,uint *param_1,int param_2,int *param_3)

{
  IOSurface *this_00;
  OSString *pOVar1;
  uint uVar2;
  
  this_00 = (IOSurface *)retainSurface(this,*param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    if ((char)param_1[2] == '\0') {
      uVar2 = 0;
      IOSurface::removeValue(this_00,(OSString *)0x0,param_3);
    }
    else {
      uVar2 = 0xe00002c2;
      if (*(char *)((long)param_1 + (long)(param_2 + -9) + 8) == '\0') {
        pOVar1 = (OSString *)OSString::withCString((char *)(param_1 + 2));
        if (pOVar1 != (OSString *)0x0) {
          IOSurface::removeValue(this_00,pOVar1,param_3);
          (**(code **)(*(long *)pOVar1 + 0x28))(pOVar1);
          uVar2 = 0;
        }
      }
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return (ulong)uVar2;
}



// IOSurfaceRootUserClient::bind_accel(unsigned int, unsigned int, unsigned int)

ulong __thiscall
IOSurfaceRootUserClient::bind_accel
          (IOSurfaceRootUserClient *this,uint param_1,int param_2,uint param_3)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::bind_accel(this_00,param_2,param_3);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::get_limits(IOSurfaceGetLimitsResult*, unsigned int*)

undefined8 __thiscall
IOSurfaceRootUserClient::get_limits
          (IOSurfaceRootUserClient *this,undefined4 *param_1,undefined4 *param_2)

{
  long lVar1;
  
  lVar1 = *(long *)(this + 0xe0);
  *param_1 = *(undefined4 *)(lVar1 + 0xac);
  param_1[1] = *(undefined4 *)(lVar1 + 0xb0);
  *(undefined8 *)(param_1 + 2) = *(undefined8 *)(lVar1 + 0xb8);
  *(undefined8 *)(param_1 + 4) = *(undefined8 *)(lVar1 + 0xc0);
  *(undefined8 *)(param_1 + 6) = *(undefined8 *)(lVar1 + 200);
  *(IOSurfaceRootUserClient *)(param_1 + 8) = this[0x11e];
  *(undefined2 *)((long)param_1 + 0x22) = 1;
  *param_2 = 0x28;
  return 0;
}



// IOSurfaceRootUserClient::increment_surface_use_count_for_category(unsigned int, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::increment_surface_use_count_for_category
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2)

{
  IOSurface *this_00;
  IOSurfaceClient *this_01;
  undefined8 uVar1;
  
  uVar1 = 0xe00002c2;
  if (param_2 < 2) {
    this_01 = (IOSurfaceClient *)retainSurfaceClient(this,param_1);
    if (this_01 != (IOSurfaceClient *)0x0) {
      this_00 = *(IOSurface **)(this_01 + 0x40);
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x20))(this_00);
      }
      uVar1 = IOSurfaceClient::increment_use_count_for_category(this_01,param_2);
      if ((char)uVar1 != '\0') {
        IOSurface::increment_use_count_for_category(this_00,param_2);
      }
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x28))(this_00);
      }
      (**(code **)(*(long *)this_01 + 0x28))(this_01);
      uVar1 = 0;
    }
  }
  return uVar1;
}



// IOSurfaceRootUserClient::decrement_surface_use_count_for_category(unsigned int, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::decrement_surface_use_count_for_category
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2)

{
  IOSurface *this_00;
  IOSurfaceClient *this_01;
  undefined8 uVar1;
  
  uVar1 = 0xe00002c2;
  if (param_2 < 2) {
    this_01 = (IOSurfaceClient *)retainSurfaceClient(this,param_1);
    if (this_01 != (IOSurfaceClient *)0x0) {
      this_00 = *(IOSurface **)(this_01 + 0x40);
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x20))(this_00);
      }
      uVar1 = IOSurfaceClient::decrement_use_count_for_category(this_01,param_2);
      if ((char)uVar1 != '\0') {
        IOSurface::decrement_use_count_for_category(this_00,param_2);
      }
      if (this_00 != (IOSurface *)0x0) {
        (**(code **)(*(long *)this_00 + 0x28))(this_00);
      }
      (**(code **)(*(long *)this_01 + 0x28))(this_01);
      uVar1 = 0;
    }
  }
  return uVar1;
}



// IOSurfaceRootUserClient::lock_surface(unsigned int, unsigned int, unsigned long long)

ulong __thiscall
IOSurfaceRootUserClient::lock_surface
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2,undefined8 param_3)

{
  IOSurface *this_00;
  uint uVar1;
  long *plVar2;
  IOFence *this_01;
  ulong uVar3;
  ulong uVar4;
  uint local_34;
  
  plVar2 = retainSurfaceClient(this,param_1);
  if (plVar2 == (long *)0x0) {
    uVar4 = 0xe00002c2;
  }
  else {
    this_00 = (IOSurface *)plVar2[8];
    if (this_00 != (IOSurface *)0x0) {
      (**(code **)(*(long *)this_00 + 0x20))(this_00);
    }
    if ((param_2 & 4) != 0) {
      this_01 = (IOFence *)IOSurface::createFence(this_00,2 - (param_2 & 1),0xffffffff);
      if (this_01 != (IOFence *)0x0) {
        IOFence::complete(this_01,0);
        (**(code **)(*(long *)this_01 + 0x28))(this_01);
      }
    }
    uVar3 = IOSurface::lockSurface(this_00,(ulong)param_2,&local_34);
    uVar4 = uVar3 & 0xffffffff;
    if ((int)uVar3 == 0) {
      uVar1 = _copyout(&local_34,param_3,4);
      uVar4 = (ulong)uVar1;
    }
    if (this_00 != (IOSurface *)0x0) {
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar4;
}



// IOSurfaceRootUserClient::unlock_surface(unsigned int, unsigned int, unsigned long long)

ulong __thiscall
IOSurfaceRootUserClient::unlock_surface
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2,undefined8 param_3)

{
  uint uVar1;
  IOSurface *this_00;
  ulong uVar2;
  ulong uVar3;
  undefined4 local_24;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar3 = 0xe00002c2;
  }
  else {
    uVar2 = IOSurface::unlockSurface(this_00,(ulong)param_2,&local_24);
    uVar3 = uVar2 & 0xffffffff;
    if ((int)uVar2 == 0) {
      uVar1 = _copyout(&local_24,param_3,4);
      uVar3 = (ulong)uVar1;
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar3;
}



// IOSurfaceRootUserClient::wait_shared_event(unsigned int, unsigned long long, unsigned long long)

int __thiscall
IOSurfaceRootUserClient::wait_shared_event
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,undefined4 param_3)

{
  int iVar1;
  IOSurfaceSharedEventReference *this_00;
  IOSurfaceSharedEvent *this_01;
  ulong uVar2;
  undefined1 *local_38;
  OSMetaClassBase *local_30;
  
  local_30 = (OSMetaClassBase *)0x0;
  iVar1 = IOUserClient::copyObjectForPortNameInTask
                    (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_30);
  if (iVar1 == 0) {
    this_00 = (IOSurfaceSharedEventReference *)
              OSMetaClassBase::safeMetaCast
                        (local_30,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
    if (this_00 == (IOSurfaceSharedEventReference *)0x0) {
      iVar1 = -0x1ffffd3e;
    }
    else {
      local_38 = &DAT_aaaaaaaaaaaaaaaa;
      _clock_interval_to_deadline(param_3,1000000,&local_38);
      this_01 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_00);
      uVar2 = IOSurfaceSharedEvent::waitCompleted(this_01,param_2,local_38);
      iVar1 = -0x1ffffd2a;
      if ((char)uVar2 != '\0') {
        iVar1 = 0;
      }
    }
  }
  if (local_30 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_30 + 0x28))();
  }
  return iVar1;
}



// IOSurfaceRootUserClient::signal_shared_event(unsigned int, unsigned long long)

int __thiscall
IOSurfaceRootUserClient::signal_shared_event
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2)

{
  int iVar1;
  IOSurfaceSharedEventReference *this_00;
  IOSurfaceSharedEvent *this_01;
  OSMetaClassBase *local_20;
  
  local_20 = (OSMetaClassBase *)0x0;
  iVar1 = IOUserClient::copyObjectForPortNameInTask
                    (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_20);
  if (iVar1 == 0) {
    this_00 = (IOSurfaceSharedEventReference *)
              OSMetaClassBase::safeMetaCast
                        (local_20,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
    if (this_00 == (IOSurfaceSharedEventReference *)0x0) {
      iVar1 = -0x1ffffd3e;
    }
    else {
      this_01 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_00);
      IOSurfaceSharedEvent::signalUserCompleted(this_01,param_2);
      iVar1 = 0;
    }
  }
  if (local_20 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_20 + 0x28))();
  }
  return iVar1;
}



// IOSurfaceRootUserClient::get_surface_use_count(unsigned int, unsigned int*)

undefined8 __thiscall
IOSurfaceRootUserClient::get_surface_use_count
          (IOSurfaceRootUserClient *this,uint param_1,int *param_2)

{
  int iVar1;
  IOSurface *this_00;
  undefined8 uVar2;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    iVar1 = IOSurface::get_use_count(this_00);
    *param_2 = iVar1;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurfaceRootUserClient::set_surface_notify(unsigned long long*, IOSurfaceNotifyArgs*)

void __thiscall
IOSurfaceRootUserClient::set_surface_notify
          (IOSurfaceRootUserClient *this,undefined8 *param_1,ulonglong *param_2)

{
  IOSurfaceRoot::setSurfaceNotify(*(IOSurfaceRoot **)(this + 0xe0),param_1,param_2,(long)this);
  return;
}



// IOSurfaceRootUserClient::remove_surface_notify(IOSurfaceNotifyArgs*)

void __thiscall
IOSurfaceRootUserClient::remove_surface_notify(IOSurfaceRootUserClient *this,long param_1)

{
  IOSurfaceRoot::removeSurfaceNotify(*(IOSurfaceRoot **)(this + 0xe0),param_1,(long)this);
  return;
}



// IOSurfaceRootUserClient::log(char const*, unsigned int)

undefined8 IOSurfaceRootUserClient::log(void)

{
  char *in_RSI;
  
  _kprintf("%.512s",in_RSI);
  return 0;
}



// IOSurfaceRootUserClient::set_purgeable(unsigned int, unsigned int, unsigned int*)

int __thiscall
IOSurfaceRootUserClient::set_purgeable
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2,int *param_3)

{
  int iVar1;
  IOSurface *this_00;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    iVar1 = -0x1ffffd3e;
  }
  else {
    iVar1 = IOSurface::setPurgeable(this_00,param_2,param_3);
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return iVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::set_ownership(unsigned int, task*, int, unsigned int)

undefined4 __cdecl
IOSurfaceRootUserClient::set_ownership
          (IOSurfaceRootUserClient *param_1,uint param_2,int param_3,uint param_4)

{
  undefined4 uVar1;
  long *plVar2;
  
  plVar2 = retainSurface(param_1,param_2);
  if (plVar2 == (long *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setOwnership((long)plVar2,param_3,param_4);
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::set_tiled(unsigned int, bool)

ulong __thiscall
IOSurfaceRootUserClient::set_tiled(IOSurfaceRootUserClient *this,uint param_1,uint param_2)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setTiled(this_00,param_2 & 0xff);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::is_tiled(unsigned int, bool*)

undefined8 __thiscall
IOSurfaceRootUserClient::is_tiled(IOSurfaceRootUserClient *this,uint param_1,byte *param_2)

{
  byte bVar1;
  IOSurface *this_00;
  undefined8 uVar2;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    bVar1 = IOSurface::isTiled(this_00);
    *param_2 = bVar1;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurfaceRootUserClient::set_timestamp(IOSurfaceSetTimestampArgs*, unsigned int)

undefined4 __thiscall
IOSurfaceRootUserClient::set_timestamp(IOSurfaceRootUserClient *this,uint *param_1,uint param_2)

{
  undefined4 uVar1;
  IOSurface *this_00;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  OSMetaClassBase *pOVar4;
  OSMetaClassBase *pOVar5;
  long *plVar6;
  long *plVar7;
  undefined8 uVar8;
  undefined8 uVar9;
  
  this_00 = (IOSurface *)retainSurface(this,*param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    pOVar2 = (OSMetaClassBase *)
             OSUnserializeXML((char *)(param_1 + 4),
                              (long)param_1 + ((ulong)param_2 - (long)(param_1 + 4)),
                              (OSString **)0x0);
    if (pOVar2 == (OSMetaClassBase *)0x0) {
      uVar1 = 0xe00002c2;
    }
    else {
      plVar3 = (long *)OSMetaClassBase::safeMetaCast(pOVar2,*(OSMetaClass **)PTR_metaClass_00027038)
      ;
      uVar1 = 0xe00002c2;
      if (plVar3 != (long *)0x0) {
        pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x1e8))(plVar3,0);
        pOVar5 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x1e8))(plVar3,1);
        if (pOVar4 == (OSMetaClassBase *)0x0) {
          plVar3 = (long *)0x0;
        }
        else {
          plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                     (pOVar4,*(OSMetaClass **)PTR_metaClass_00027058);
        }
        uVar1 = 0xe00002c2;
        if (pOVar5 != (OSMetaClassBase *)0x0) {
          plVar6 = (long *)OSMetaClassBase::safeMetaCast
                                     (pOVar5,*(OSMetaClass **)PTR_metaClass_00027058);
          if ((plVar3 != (long *)0x0) && (plVar6 != (long *)0x0)) {
            plVar7 = (long *)OSNumber::withNumber(*(ulonglong *)(param_1 + 2),0x40);
            if (plVar7 != (long *)0x0) {
              uVar8 = (**(code **)(*plVar3 + 0x148))(plVar3);
              uVar9 = (**(code **)(*plVar6 + 0x148))();
              uVar1 = IOSurface::setTimestamp(this_00,uVar8,uVar9,plVar7);
              (**(code **)(*plVar7 + 0x28))(plVar7);
            }
          }
        }
      }
      (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::get_tile_format(unsigned int, unsigned int*)

undefined8 __thiscall
IOSurfaceRootUserClient::get_tile_format
          (IOSurfaceRootUserClient *this,uint param_1,undefined4 *param_2)

{
  undefined4 uVar1;
  IOSurface *this_00;
  undefined8 uVar2;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::getTileFormat(this_00);
    *param_2 = uVar1;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar2 = 0;
  }
  return uVar2;
}



// IOSurfaceRootUserClient::set_bulk_attachments(IOSurfaceColorAndSpatialKeysArgs*)

undefined8 __thiscall
IOSurfaceRootUserClient::set_bulk_attachments(IOSurfaceRootUserClient *this,undefined8 *param_1)

{
  IOSurface *this_00;
  undefined8 uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,*(uint *)(param_1 + 0x10));
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    IOSurface::setBulkAttachments(this_00,param_1,(uint)param_1[0xf]);
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurfaceRootUserClient::get_bulk_attachments(unsigned int, IOSurfaceColorAndSpatialKeysArgs*,
// unsigned int*)

undefined4 __thiscall
IOSurfaceRootUserClient::get_bulk_attachments
          (IOSurfaceRootUserClient *this,uint param_1,void *param_2,undefined4 *param_3)

{
  IOSurface *this_00;
  undefined4 uVar1;
  ulong local_30;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    *param_3 = 0x88;
    uVar1 = 0xe00002c2;
  }
  else {
    local_30 = 0x70;
    IOSurface::getBulkAttachments(this_00,param_2,&local_30);
    uVar1 = 0xe00002c2;
    if (local_30 == 0x70) {
      uVar1 = 0;
    }
    *param_3 = 0x88;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceRootUserClient::prefetch_pages(unsigned int, unsigned int)

ulong __cdecl IOSurfaceRootUserClient::prefetch_pages(IOSurfaceRootUserClient *param_1,uint param_2)

{
  IOSurface *this;
  ulong uVar1;
  ulong uVar2;
  
  this = (IOSurface *)retainSurface(param_1,param_2);
  if (this == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::prepare(this);
    uVar2 = uVar1 & 0xffffffff;
    if ((int)uVar1 == 0) {
      IOSurface::complete(this);
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return uVar2;
}



// IOSurfaceRootUserClient::set_compressed_tile_data_region_memory_used_of_plane(unsigned int,
// unsigned int, unsigned int)

ulong __thiscall
IOSurfaceRootUserClient::set_compressed_tile_data_region_memory_used_of_plane
          (IOSurfaceRootUserClient *this,uint param_1,uint param_2,undefined4 param_3)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setCompressedTileDataRegionMemoryUsedOfPlane(this_00,param_2,param_3);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::get_graphics_comm_page_address(unsigned long long*)

undefined8 __thiscall
IOSurfaceRootUserClient::get_graphics_comm_page_address
          (IOSurfaceRootUserClient *this,undefined8 *param_1)

{
  undefined8 uVar1;
  
  if (*(long **)(this + 0x128) == (long *)0x0) {
    uVar1 = 0xe00002bd;
  }
  else {
    uVar1 = (**(code **)(**(long **)(this + 0x128) + 0x118))();
    *param_1 = uVar1;
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurfaceRootUserClient::set_indexed_timestamp(unsigned int, unsigned long long, unsigned long
// long)

ulong __thiscall
IOSurfaceRootUserClient::set_indexed_timestamp
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,undefined8 param_3)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setIndexedTimestamp(this_00,param_2,param_3);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::create_shared_event(unsigned long long, unsigned int*, unsigned long
// long*)

undefined4 __thiscall
IOSurfaceRootUserClient::create_shared_event
          (IOSurfaceRootUserClient *this,ulong param_1,uint *param_2,long *param_3)

{
  IOSurfaceShared *this_00;
  uint uVar1;
  undefined4 uVar2;
  IOSurfaceSharedEvent *this_01;
  OSObject *pOVar3;
  ulong uVar4;
  
  this_01 = IOSurfaceSharedEvent::sharedEventWithOptions(*(IOSurfaceRoot **)(this + 0xe0),param_1);
  if (this_01 == (IOSurfaceSharedEvent *)0x0) {
    uVar2 = 0xe00002bd;
  }
  else {
    pOVar3 = (OSObject *)IOSurfaceSharedEventReference::withSharedEvent((long *)this_01);
    if (pOVar3 == (OSObject *)0x0) {
      uVar2 = 0xe00002bd;
    }
    else {
      this_00 = *(IOSurfaceShared **)(this + 0x110);
      uVar1 = IOSurfaceSharedEvent::getSharedID(this_01);
      uVar4 = IOSurfaceShared::map_event_client_shared(this_00,(ulong)uVar1,param_3);
      uVar2 = 0xe00002c8;
      if ((char)uVar4 != '\0') {
        uVar2 = IOUserClient::copyPortNameForObjectInTask(*(task **)(this + 0xf0),pOVar3,param_2);
      }
      (**(code **)(*(long *)pOVar3 + 0x28))(pOVar3);
    }
    (**(code **)(*(long *)this_01 + 0x28))(this_01);
  }
  return uVar2;
}



// IOSurfaceRootUserClient::query_shared_event(unsigned int, unsigned long long*, unsigned long
// long*, unsigned long long*, unsigned long long*)

int __thiscall
IOSurfaceRootUserClient::query_shared_event
          (IOSurfaceRootUserClient *this,uint param_1,undefined8 *param_2,long *param_3,
          undefined8 *param_4,undefined8 *param_5)

{
  IOSurfaceShared *this_00;
  int iVar1;
  uint uVar2;
  IOSurfaceSharedEventReference *this_01;
  IOSurfaceSharedEvent *pIVar3;
  undefined8 uVar4;
  ulong uVar5;
  OSMetaClassBase *local_38;
  
  local_38 = (OSMetaClassBase *)0x0;
  iVar1 = IOUserClient::copyObjectForPortNameInTask
                    (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_38);
  if (iVar1 == 0) {
    this_01 = (IOSurfaceSharedEventReference *)
              OSMetaClassBase::safeMetaCast
                        (local_38,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
    if (this_01 == (IOSurfaceSharedEventReference *)0x0) {
      iVar1 = -0x1ffffd3e;
    }
    else {
      pIVar3 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_01);
      uVar4 = IOSurfaceSharedEvent::getCompletedValue(pIVar3);
      *param_2 = uVar4;
      pIVar3 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_01);
      uVar4 = IOSurfaceSharedEvent::getTraceID(pIVar3);
      *param_4 = uVar4;
      pIVar3 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_01);
      uVar4 = IOSurfaceSharedEvent::getEventOptions(pIVar3);
      *param_5 = uVar4;
      this_00 = *(IOSurfaceShared **)(this + 0x110);
      pIVar3 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_01);
      uVar2 = IOSurfaceSharedEvent::getSharedID(pIVar3);
      uVar5 = IOSurfaceShared::map_event_client_shared(this_00,(ulong)uVar2,param_3);
      iVar1 = -0x1ffffd38;
      if ((char)uVar5 != '\0') {
        iVar1 = 0;
      }
    }
  }
  if (local_38 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_38 + 0x28))();
  }
  return iVar1;
}



// IOSurfaceRootUserClient::notify_shared_event(unsigned int, unsigned long long, unsigned long
// long, unsigned long long, unsigned long long)

ulong __thiscall
IOSurfaceRootUserClient::notify_shared_event
          (IOSurfaceRootUserClient *this,uint param_1,undefined8 param_2,undefined8 param_3,
          undefined8 param_4,ulong param_5)

{
  uint uVar1;
  IOSurfaceSharedEventReference *this_00;
  IOSurfaceSharedEvent *this_01;
  ulong uVar2;
  undefined8 local_88;
  undefined8 *local_80;
  undefined8 local_78;
  code *local_70;
  code *local_68;
  long *local_60;
  ulong local_58;
  undefined8 local_50;
  undefined8 local_48;
  undefined8 local_40;
  OSMetaClassBase *local_38;
  
  local_38 = (OSMetaClassBase *)0x0;
  local_58 = param_5;
  uVar1 = IOUserClient::copyObjectForPortNameInTask
                    (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_38);
  uVar2 = (ulong)uVar1;
  if (uVar1 == 0) {
    local_50 = param_2;
    local_48 = param_3;
    this_00 = (IOSurfaceSharedEventReference *)
              OSMetaClassBase::safeMetaCast
                        (local_38,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
    if (this_00 == (IOSurfaceSharedEventReference *)0x0) {
      uVar2 = 0xe00002c2;
    }
    else {
      local_40 = param_4;
      _IOLockLock(*(undefined8 *)(this + 0xd8));
      local_80 = &local_88;
      local_88 = 0;
      local_78 = 0x3002000000;
      local_70 = ___Block_byref_object_copy__46;
      local_68 = ___Block_byref_object_dispose__47;
      local_60 = (long *)0x0;
      OSCollection::iterateObjects(*(_func_bool_OSObject_ptr **)(this + 0xf8));
      _IOLockUnlock(*(undefined8 *)(this + 0xd8));
      if (local_80[5] == 0) {
        uVar2 = 0xe00002c2;
      }
      else {
        this_01 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_00);
        uVar2 = IOSurfaceSharedEvent::notifyPort
                          (this_01,(long *)local_80[5],local_58,local_48,local_40);
        uVar2 = uVar2 & 0xffffffff;
      }
      __Block_object_dispose(&local_88,8);
      if (local_60 != (long *)0x0) {
        (**(code **)(*local_60 + 0x28))();
      }
    }
  }
  if (local_38 != (OSMetaClassBase *)0x0) {
    (**(code **)(*(long *)local_38 + 0x28))();
  }
  return uVar2;
}



// IOSurfaceRootUserClient::add_shared_event_notification_port(unsigned long long*)

undefined4 __thiscall
IOSurfaceRootUserClient::add_shared_event_notification_port
          (IOSurfaceRootUserClient *this,undefined8 *param_1)

{
  undefined4 uVar1;
  OSSharedPtr *pOVar2;
  IOSurfaceSharedEventNotificationPort *pIVar3;
  undefined8 local_50;
  undefined8 *local_48;
  undefined8 local_40;
  undefined4 local_38;
  IOSurfaceSharedEventNotificationPort *local_30;
  
  local_48 = &local_50;
  local_50 = 0;
  local_40 = 0x2000000000;
  local_38 = 0;
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  OSCollection::iterateObjects(*(_func_bool_OSObject_ptr **)(this + 0xf8));
  if (*(int *)(local_48 + 3) == 0) {
    pIVar3 = IOSurfaceSharedEventNotificationPort::withAsyncReference64(param_1);
    if (pIVar3 == (IOSurfaceSharedEventNotificationPort *)0x0) {
      *(undefined4 *)(local_48 + 3) = 0xe00002bd;
    }
    else {
      pOVar2 = *(OSSharedPtr **)(this + 0xf8);
      local_30 = pIVar3;
      (**(code **)(*(long *)pIVar3 + 0x20))(pIVar3);
      OSArray::setObject(pOVar2);
      if (local_30 != (IOSurfaceSharedEventNotificationPort *)0x0) {
        (**(code **)(*(long *)local_30 + 0x28))();
      }
      (**(code **)(*(long *)pIVar3 + 0x28))(pIVar3);
    }
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  uVar1 = *(undefined4 *)(local_48 + 3);
  __Block_object_dispose(&local_50,8);
  return uVar1;
}



// IOSurfaceRootUserClient::remove_shared_event_notification_port(unsigned long long)

undefined8 __thiscall
IOSurfaceRootUserClient::remove_shared_event_notification_port
          (IOSurfaceRootUserClient *this,long param_1)

{
  int iVar1;
  long lVar2;
  int iVar3;
  undefined8 uVar4;
  
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  iVar1 = (**(code **)(**(long **)(this + 0xf8) + 0x130))();
  uVar4 = 0xe00002c2;
  if (iVar1 != 0) {
    iVar3 = 0;
    do {
      lVar2 = (**(code **)(**(long **)(this + 0xf8) + 0x1e8))(*(long **)(this + 0xf8),iVar3);
      if (*(long *)(lVar2 + 0x48) == param_1) {
        (**(code **)(**(long **)(this + 0xf8) + 0x1d8))(*(long **)(this + 0xf8),iVar3);
        uVar4 = 0;
        break;
      }
      iVar3 = iVar3 + 1;
    } while (iVar1 != iVar3);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  return uVar4;
}



// IOSurfaceRootUserClient::signal_shared_event_operation(unsigned int, unsigned long long, unsigned
// int, unsigned long long)

ulong __thiscall
IOSurfaceRootUserClient::signal_shared_event_operation
          (IOSurfaceRootUserClient *this,uint param_1,long param_2,uint param_3,ulong param_4)

{
  uint uVar1;
  IOSurface *this_00;
  IOSurfaceSharedEventReference *this_01;
  IOSurfaceSharedEvent *pIVar2;
  ulong uVar3;
  OSMetaClassBase *local_38;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar3 = 0xe00002c2;
  }
  else {
    local_38 = (OSMetaClassBase *)0x0;
    uVar1 = IOUserClient::copyObjectForPortNameInTask
                      (*(task **)(this + 0xf0),param_3,(OSSharedPtr *)&local_38);
    uVar3 = (ulong)uVar1;
    if (uVar1 == 0) {
      this_01 = (IOSurfaceSharedEventReference *)
                OSMetaClassBase::safeMetaCast
                          (local_38,(OSMetaClass *)&IOSurfaceSharedEventReference::gMetaClass);
      if (this_01 == (IOSurfaceSharedEventReference *)0x0) {
        uVar3 = 0xe00002c2;
      }
      else {
        pIVar2 = (IOSurfaceSharedEvent *)IOSurfaceSharedEventReference::getSharedEvent(this_01);
        uVar3 = IOSurface::signalSharedEventOperation(this_00,param_2,pIVar2,param_4);
        uVar3 = uVar3 & 0xffffffff;
      }
    }
    if (local_38 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)local_38 + 0x28))();
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar3;
}



// IOSurfaceRootUserClient::set_image_origin_and_extents(unsigned int, unsigned int, unsigned int,
// unsigned int, unsigned int, unsigned int, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::set_image_origin_and_extents
          (IOSurfaceRootUserClient *this,uint param_1,undefined4 param_2,undefined4 param_3,
          undefined4 param_4,undefined4 param_5,undefined4 param_6,undefined4 param_7)

{
  IOSurface *this_00;
  undefined8 uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    IOSurface::set_image_origin_and_extents(this_00,param_2,param_3,param_4,param_5,param_6,param_7)
    ;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurfaceRootUserClient::create_memory_pool(unsigned int*, unsigned long long*, void*, unsigned
// int)

undefined4 __thiscall
IOSurfaceRootUserClient::create_memory_pool
          (IOSurfaceRootUserClient *this,uint *param_1,undefined8 *param_2,char *param_3,
          uint param_4)

{
  undefined4 uVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  IOSurfaceMemoryPoolBunch *this_00;
  IOSurfaceMemoryPool *pIVar4;
  
  pOVar2 = (OSMetaClassBase *)OSUnserializeXML(param_3,(ulong)param_4,(OSString **)0x0);
  plVar3 = (long *)OSMetaClassBase::safeMetaCast(pOVar2,*(OSMetaClass **)PTR_metaClass_00027010);
  if (plVar3 == (long *)0x0) {
    if (pOVar2 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
    }
    plVar3 = IOSurfaceRoot::getMemoryPoolBunch(*(IOSurfaceRoot **)(this + 0xe0));
    uVar1 = 0xe00002c2;
    if (plVar3 == (long *)0x0) {
      return 0xe00002c2;
    }
  }
  else {
    this_00 = (IOSurfaceMemoryPoolBunch *)
              IOSurfaceRoot::getMemoryPoolBunch(*(IOSurfaceRoot **)(this + 0xe0));
    if (this_00 == (IOSurfaceMemoryPoolBunch *)0x0) {
      uVar1 = 0xe00002c2;
    }
    else {
      (**(code **)(*plVar3 + 0x20))(plVar3);
      pIVar4 = IOSurfaceMemoryPoolBunch::newMemoryPool(this_00,plVar3,*(undefined8 *)(this + 0xf0));
      if (pIVar4 == (IOSurfaceMemoryPool *)0x0) {
        uVar1 = 0xe00002c2;
      }
      else {
        *param_2 = *(undefined8 *)(pIVar4 + 0x28);
        uVar1 = IOUserClient::copyPortNameForObjectInTask
                          (*(task **)(this + 0xf0),(OSObject *)pIVar4,param_1);
        (**(code **)(*(long *)pIVar4 + 0x28))(pIVar4);
      }
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
  }
  (**(code **)(*plVar3 + 0x28))(plVar3);
  return uVar1;
}



// IOSurfaceRootUserClient::ensure_memory_pool_memory(unsigned int, void*, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::ensure_memory_pool_memory
          (IOSurfaceRootUserClient *this,uint param_1,char *param_2,uint param_3)

{
  OSMetaClassBase *pOVar1;
  OSMetaClassBase *pOVar2;
  IOSurfaceMemoryPool *this_00;
  ulong uVar3;
  long lVar4;
  undefined8 uVar5;
  OSMetaClassBase *local_30;
  
  pOVar1 = (OSMetaClassBase *)OSUnserializeXML(param_2,(ulong)param_3,(OSString **)0x0);
  pOVar2 = (OSMetaClassBase *)
           OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027010);
  if (pOVar2 == (OSMetaClassBase *)0x0) {
    uVar5 = 0xe00002c2;
    if (pOVar1 == (OSMetaClassBase *)0x0) {
      return 0xe00002c2;
    }
    lVar4 = *(long *)pOVar1;
    goto LAB_0001be23;
  }
  local_30 = (OSMetaClassBase *)0x0;
  IOUserClient::copyObjectForPortNameInTask
            (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_30);
  if (local_30 == (OSMetaClassBase *)0x0) {
LAB_0001be03:
    uVar5 = 0xe00002c2;
  }
  else {
    this_00 = (IOSurfaceMemoryPool *)
              OSMetaClassBase::safeMetaCast
                        (local_30,(OSMetaClass *)&IOSurfaceMemoryPool::gMetaClass);
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      (**(code **)(*(long *)this_00 + 0x20))(this_00);
    }
    (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
    uVar3 = IOSurfaceMemoryPool::ensureMemory(this_00,(long *)pOVar2);
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
    if (local_30 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)local_30 + 0x28))();
    }
    uVar5 = 0;
    if ((char)uVar3 == '\0') goto LAB_0001be03;
  }
  lVar4 = *(long *)pOVar2;
  pOVar1 = pOVar2;
LAB_0001be23:
  (**(code **)(lVar4 + 0x28))(pOVar1);
  return uVar5;
}



// IOSurfaceRootUserClient::flush_memory_pool(unsigned int, void*, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::flush_memory_pool
          (IOSurfaceRootUserClient *this,uint param_1,char *param_2,uint param_3)

{
  OSMetaClassBase *pOVar1;
  OSMetaClassBase *pOVar2;
  IOSurfaceMemoryPool *this_00;
  undefined8 uVar3;
  long lVar4;
  undefined8 uVar5;
  OSMetaClassBase *local_30;
  
  pOVar1 = (OSMetaClassBase *)OSUnserializeXML(param_2,(ulong)param_3,(OSString **)0x0);
  pOVar2 = (OSMetaClassBase *)
           OSMetaClassBase::safeMetaCast(pOVar1,*(OSMetaClass **)PTR_metaClass_00027010);
  if (pOVar2 == (OSMetaClassBase *)0x0) {
    uVar5 = 0xe00002c2;
    if (pOVar1 == (OSMetaClassBase *)0x0) {
      return 0xe00002c2;
    }
    lVar4 = *(long *)pOVar1;
    goto LAB_0001bf1b;
  }
  local_30 = (OSMetaClassBase *)0x0;
  IOUserClient::copyObjectForPortNameInTask
            (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_30);
  if (local_30 == (OSMetaClassBase *)0x0) {
LAB_0001befb:
    uVar5 = 0xe00002c2;
  }
  else {
    this_00 = (IOSurfaceMemoryPool *)
              OSMetaClassBase::safeMetaCast
                        (local_30,(OSMetaClass *)&IOSurfaceMemoryPool::gMetaClass);
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      (**(code **)(*(long *)this_00 + 0x20))(this_00);
    }
    (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
    uVar3 = IOSurfaceMemoryPool::flush(this_00,(long *)pOVar2);
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
    if (local_30 != (OSMetaClassBase *)0x0) {
      (**(code **)(*(long *)local_30 + 0x28))();
    }
    uVar5 = 0;
    if ((char)uVar3 == '\0') goto LAB_0001befb;
  }
  lVar4 = *(long *)pOVar2;
  pOVar1 = pOVar2;
LAB_0001bf1b:
  (**(code **)(lVar4 + 0x28))(pOVar1);
  return uVar5;
}



// IOSurfaceRootUserClient::gather_memory_pool_data(unsigned int, OSSerialize*)

undefined4 __thiscall
IOSurfaceRootUserClient::gather_memory_pool_data
          (IOSurfaceRootUserClient *this,uint param_1,long *param_2)

{
  uint uVar1;
  long *plVar2;
  long *plVar3;
  long lVar4;
  IOSurfaceMemoryPoolBunch *this_00;
  undefined4 uVar5;
  OSMetaClassBase *local_38;
  
  plVar2 = (long *)OSDictionary::withCapacity(1);
  local_38 = (OSMetaClassBase *)0x0;
  IOUserClient::copyObjectForPortNameInTask
            (*(task **)(this + 0xf0),param_1,(OSSharedPtr *)&local_38);
  if (local_38 == (OSMetaClassBase *)0x0) {
    uVar5 = 0xe00002bd;
  }
  else {
    if (plVar2 == (long *)0x0) {
      uVar5 = 0xe00002bd;
    }
    else {
      plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                 (local_38,(OSMetaClass *)&IOSurfaceMemoryPool::gMetaClass);
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x20))(plVar3);
      }
      lVar4 = _current_task();
      if (lVar4 == plVar3[6]) {
        (**(code **)(*param_2 + 0x120))(param_2);
        this_00 = (IOSurfaceMemoryPoolBunch *)
                  IOSurfaceRoot::getMemoryPoolBunch(*(IOSurfaceRoot **)(this + 0xe0));
        (**(code **)(*plVar2 + 0x20))(plVar2);
        IOSurfaceMemoryPoolBunch::write_debug_info(this_00,plVar2,plVar3[5]);
        if (this_00 != (IOSurfaceMemoryPoolBunch *)0x0) {
          (**(code **)(*(long *)this_00 + 0x28))(this_00);
        }
        uVar1 = (**(code **)(*plVar2 + 0x30))(plVar2,param_2);
        (**(code **)(*plVar3 + 0x28))(plVar3);
        uVar5 = 0xe00002bc;
        if ((uVar1 & 1) != 0) {
          uVar5 = 0;
        }
      }
      else {
        (**(code **)(*plVar3 + 0x28))(plVar3);
        uVar5 = 0xe00002e2;
      }
      if (local_38 == (OSMetaClassBase *)0x0) goto LAB_0001c04d;
    }
    (**(code **)(*(long *)local_38 + 0x28))();
  }
  if (plVar2 == (long *)0x0) {
    return uVar5;
  }
LAB_0001c04d:
  (**(code **)(*plVar2 + 0x28))(plVar2);
  return uVar5;
}



// IOSurfaceRootUserClient::externalMethod(unsigned int, IOExternalMethodArgumentsOpaque*)

void __thiscall
IOSurfaceRootUserClient::externalMethod
          (IOSurfaceRootUserClient *this,IOExternalMethodArgumentsOpaque *param_2_00,
          IOExternalMethodDispatch2022 *param_2)

{
  undefined **ppuVar1;
  
  ppuVar1 = &sMethodDescsRestricted;
  if (this[0x11f] == (IOSurfaceRootUserClient)0x0) {
    ppuVar1 = &sMethodDescs;
  }
  IOUserClient2022::dispatchExternalMethod
            ((uint)this,param_2_00,param_2,(ulong)ppuVar1,
             (OSObject *)((long)&segment_command_00000020.vmaddr + 1),this);
  return;
}



// IOSurfaceRootUserClient::getTargetAndTrapForIndex(IOService**, unsigned int)

undefined ** __thiscall
IOSurfaceRootUserClient::getTargetAndTrapForIndex
          (IOSurfaceRootUserClient *this,undefined8 *param_1,uint param_2)

{
  undefined **ppuVar1;
  
  if (param_2 < 8) {
    *param_1 = this;
    if (this[0x11f] == (IOSurfaceRootUserClient)0x0) {
      ppuVar1 = &sTrapDescs;
    }
    else {
      ppuVar1 = &sTrapDescsRestricted;
    }
    return ppuVar1 + (ulong)param_2 * 3;
  }
  return (undefined **)0x0;
}



// IOSurfaceRootUserClient::getSurfaceClient(unsigned int, IOSurfaceClient**) const

undefined8 __thiscall
IOSurfaceRootUserClient::getSurfaceClient(IOSurfaceRootUserClient *this,uint param_1,long *param_2)

{
  long lVar1;
  ulong uVar2;
  ulong uVar3;
  ulong uVar4;
  ulong uVar5;
  
  if ((param_1 != 0) && (param_1 < *(uint *)(this + 0x108))) {
    uVar2 = *(ulong *)(this + 0x100);
    uVar4 = uVar2 + (ulong)*(uint *)(this + 0x108) * 8;
    uVar3 = uVar4 - uVar2;
    if ((uVar4 < uVar2) || (uVar3 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                );
    }
    lVar1 = (ulong)param_1 * 8;
    if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                );
    }
    uVar4 = (ulong)param_1 << 0x23;
    if (((long)uVar4 < 0) || ((uint)uVar3 < (int)(uVar4 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                );
    }
    uVar5 = (ulong)CARRY8(uVar2,uVar4 >> 0x20);
    uVar3 = -uVar5;
    if ((uVar5 != uVar3) || ((long)uVar3 < 0)) {
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
    lVar1 = *(long *)(uVar2 + (uVar4 >> 0x20));
    if (lVar1 != 0) {
      if (*(long *)(lVar1 + 0x10) == *(long *)(this + 0x110)) {
        *param_2 = lVar1;
        return CONCAT71((int7)((ulong)lVar1 >> 8),1);
      }
      getSurfaceClient();
      return 0;
    }
  }
  return 0;
}



// IOSurfaceRootUserClient::retainSurfaceClient(unsigned int) const

long * __thiscall
IOSurfaceRootUserClient::retainSurfaceClient(IOSurfaceRootUserClient *this,uint param_1)

{
  undefined8 uVar1;
  long *plVar2;
  long *local_28;
  
  local_28 = (long *)&DAT_aaaaaaaaaaaaaaaa;
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  uVar1 = getSurfaceClient(this,param_1,(long *)&local_28);
  plVar2 = local_28;
  if (((char)uVar1 == '\0') || (local_28 == (long *)0x0)) {
    plVar2 = (long *)0x0;
  }
  else {
    (**(code **)(*local_28 + 0x20))(local_28);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  return plVar2;
}



// IOSurfaceRootUserClient::retainSurface(unsigned int) const

long * __thiscall IOSurfaceRootUserClient::retainSurface(IOSurfaceRootUserClient *this,uint param_1)

{
  undefined8 uVar1;
  long *plVar2;
  long local_20;
  
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  local_20 = 0;
  uVar1 = getSurfaceClient(this,param_1,&local_20);
  if (((char)uVar1 == '\0') || (plVar2 = *(long **)(local_20 + 0x40), plVar2 == (long *)0x0)) {
    plVar2 = (long *)0x0;
  }
  else {
    (**(code **)(*plVar2 + 0x20))(plVar2);
  }
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  return plVar2;
}



// IOSurfaceRootUserClient::set_surface_handle(IOSurfaceClient*, unsigned int)

undefined8 __thiscall
IOSurfaceRootUserClient::set_surface_handle
          (IOSurfaceRootUserClient *this,long *param_1,uint param_2)

{
  long lVar1;
  ulong uVar2;
  bool bVar3;
  ulong uVar4;
  ulong uVar5;
  undefined8 uVar6;
  uint uVar7;
  ulong uVar8;
  
  if ((param_2 == 0) || (uVar7 = *(uint *)(this + 0x108), uVar7 <= param_2)) {
    bVar3 = alloc_handles(this);
    if (!bVar3) {
      return 0;
    }
    uVar7 = *(uint *)(this + 0x108);
  }
  uVar2 = *(ulong *)(this + 0x100);
  uVar4 = uVar2 + (ulong)uVar7 * 8;
  uVar8 = uVar4 - uVar2;
  if ((uVar4 < uVar2) || (uVar8 >> 0x20 != 0)) {
LAB_0001c3b6:
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
              );
  }
  lVar1 = (ulong)param_2 * 8;
  if ((int)lVar1 != lVar1) {
                    // WARNING: Subroutine does not return
    os_detail::panic_trapping_policy::trap
              (
              "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
              );
  }
  uVar4 = (ulong)param_2 << 0x23;
  if (-1 < (long)uVar4) {
    uVar5 = uVar4 >> 0x20;
    uVar7 = (int)(uVar4 >> 0x20) + 8;
    if (uVar7 <= (uint)uVar8) {
      uVar4 = -(ulong)CARRY8(uVar2,uVar5);
      if ((CARRY8(uVar2,uVar5) == uVar4) && (-1 < (long)uVar4)) {
        if (*(long *)(uVar2 + uVar5) == 0) {
          *(long *)(uVar2 + uVar5) = (long)param_1;
          uVar6 = (**(code **)(*param_1 + 0x20))(param_1);
          return CONCAT71((int7)((ulong)uVar6 >> 8),1);
        }
        uVar2 = *(ulong *)(this + 0x100);
        uVar4 = uVar2 + (ulong)*(uint *)(this + 0x108) * 8;
        uVar8 = uVar4 - uVar2;
        if ((uVar4 < uVar2) || (uVar8 >> 0x20 != 0)) goto LAB_0001c3b6;
        if ((uint)uVar8 < uVar7) goto LAB_0001c3aa;
        uVar4 = -(ulong)CARRY8(uVar2,uVar5);
        if ((CARRY8(uVar2,uVar5) == uVar4) && (-1 < (long)uVar4)) {
                    // WARNING: Subroutine does not return
          _panic("\"IOSurfaceRootUserClient::set_surface_handle asked to set handle %08x that was not free: %p\" @%s:%d"
                 ,(ulong)param_2,*(undefined8 *)(uVar2 + uVar5),"IOSurfaceRootUserClient.cpp",0x9aa)
          ;
        }
      }
                    // WARNING: Subroutine does not return
      os_detail::panic_trapping_policy::trap
                (
                "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                );
    }
  }
LAB_0001c3aa:
                    // WARNING: Subroutine does not return
  os_detail::panic_trapping_policy::trap
            (
            "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
            );
}



// IOSurfaceRootUserClient::add_client_buffer(IOSurfaceClient*, bool)

void __thiscall
IOSurfaceRootUserClient::add_client_buffer
          (IOSurfaceRootUserClient *this,undefined8 param_1,int param_2)

{
  uint uVar1;
  undefined4 uVar2;
  undefined8 uVar3;
  long lVar4;
  undefined1 local_128 [256];
  long local_28;
  
  local_28 = *(long *)PTR____stack_chk_guard_00027088;
  uVar1 = *(uint *)(this + 0x120);
  if (param_2 != 0) {
    uVar1 = uVar1 + 1;
    *(uint *)(this + 0x120) = uVar1;
  }
  *(int *)(this + 0x124) = *(int *)(this + 0x124) + 1;
  if (0x1fff < uVar1) {
    if (this[0x11c] == (IOSurfaceRootUserClient)0x0) {
      uVar3 = _current_task();
      lVar4 = _get_bsdtask_info(uVar3);
      if (lVar4 != 0) {
        ___bzero(local_128,0x100);
        _proc_selfname(local_128,0x100);
        _proc_pid(lVar4);
        uVar2 = _proc_pid(lVar4);
        __os_log_internal(0,PTR___os_log_default_00027090,0x10,
                          "Perf: Process %s (%d) has created %d IOSurfaces out of a limit of %d",
                          local_128,uVar2,*(undefined4 *)(this + 0x120),0x4000);
        uVar2 = _proc_pid(lVar4);
        _IOLog("Perf: Process %s (%d) has created %d IOSurfaces out of a limit of %d\n",local_128,
               uVar2,*(undefined4 *)(this + 0x120),0x4000);
      }
      this[0x11c] = (IOSurfaceRootUserClient)0x1;
      uVar1 = *(uint *)(this + 0x120);
    }
    if ((0x2fff < uVar1) && (this[0x11d] == (IOSurfaceRootUserClient)0x0)) {
      uVar3 = _current_task();
      lVar4 = _get_bsdtask_info(uVar3);
      if (lVar4 != 0) {
        ___bzero(local_128,0x100);
        _proc_selfname(local_128,0x100);
        _proc_pid(lVar4);
        uVar2 = _proc_pid(lVar4);
        __os_log_internal(0,PTR___os_log_default_00027090,0x10,
                          "Perf: Process %s (%d) has created %d IOSurfaces out of a limit of %d, possible leak?"
                          ,local_128,uVar2,*(undefined4 *)(this + 0x120),0x4000);
        uVar2 = _proc_pid(lVar4);
        _IOLog("Perf: Process %s (%d) has created %d IOSurfaces out of a limit of %d, possible leak?\n"
               ,local_128,uVar2,*(undefined4 *)(this + 0x120),0x4000);
      }
      this[0x11d] = (IOSurfaceRootUserClient)0x1;
    }
  }
  if (*(long *)PTR____stack_chk_guard_00027088 == local_28) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceRootUserClient::knows_surface(IOSurface*)

void __thiscall IOSurfaceRootUserClient::knows_surface(IOSurfaceRootUserClient *this,long param_1)

{
  long local_10;
  
  getSurfaceClient(this,*(uint *)(param_1 + 0x10),&local_10);
  return;
}



// IOSurfaceRootUserClient::notify_surface(IOSurfaceNotifyRequest*, unsigned int, unsigned int)

void __thiscall
IOSurfaceRootUserClient::notify_surface
          (IOSurfaceRootUserClient *this,long param_1,ulong param_3_00,uint param_3)

{
  undefined8 uVar1;
  long local_50;
  ulong local_48;
  ulong local_40;
  long local_38;
  
  local_38 = *(long *)PTR____stack_chk_guard_00027088;
  _IOLockLock(*(undefined8 *)(this + 0xd8));
  uVar1 = getSurfaceClient(this,param_3,&local_50);
  _IOLockUnlock(*(undefined8 *)(this + 0xd8));
  if ((char)uVar1 != '\0') {
    local_40 = (ulong)param_3;
    local_48 = param_3_00 & 0xffffffff;
    IOUserClient::sendAsyncResult64((ulonglong *)(param_1 + 0x10),0,&local_48,2);
  }
  if (*(long *)PTR____stack_chk_guard_00027088 == local_38) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceRootUserClient::set_gpu_policy_dict(void*, unsigned long long)

undefined8 __thiscall
IOSurfaceRootUserClient::set_gpu_policy_dict
          (IOSurfaceRootUserClient *this,char *param_1,ulong param_2)

{
  OSMetaClassBase *param1;
  long *plVar1;
  long lVar2;
  undefined8 uVar3;
  
  param1 = (OSMetaClassBase *)OSUnserializeXML(param_1,param_2,(OSString **)0x0);
  _kprintf("IOSurfaceRootUserClient::set_gpu_policy_dict prop: %p\n",param1);
  if (param1 == (OSMetaClassBase *)0x0) {
    uVar3 = 0xe00002c2;
  }
  else {
    plVar1 = (long *)OSMetaClassBase::safeMetaCast(param1,*(OSMetaClass **)PTR_metaClass_00027010);
    if (plVar1 == (long *)0x0) {
      uVar3 = 0xe00002c2;
    }
    else {
      lVar2 = (**(code **)(*plVar1 + 0x208))(plVar1,"gpu-policies");
      if (lVar2 == 0) {
        uVar3 = 0xe00002c2;
      }
      else {
        (**(code **)(*(long *)this + 0x268))(this,"gpu-policies",lVar2);
        uVar3 = 0;
      }
      lVar2 = (**(code **)(*plVar1 + 0x208))(plVar1,"gpu-policies-info");
      if (lVar2 != 0) {
        (**(code **)(*(long *)this + 0x268))(this,"gpu-policies-info",lVar2);
        uVar3 = 0;
      }
    }
    (**(code **)(*(long *)param1 + 0x28))(param1);
  }
  return uVar3;
}



// IOSurfaceRootUserClient::get_data_value(IOSurfaceValueArgs*, void*, unsigned int, unsigned int*)

undefined4 __thiscall
IOSurfaceRootUserClient::get_data_value
          (IOSurfaceRootUserClient *this,uint *param_1,void *param_2,int param_3,uint *param_4)

{
  uint uVar1;
  uint uVar2;
  IOSurface *this_00;
  OSString *pOVar3;
  OSMetaClassBase *pOVar4;
  long *plVar5;
  void *pvVar6;
  undefined4 uVar7;
  undefined4 local_4c;
  void *local_48;
  OSString *local_40;
  uint local_34;
  
  this_00 = (IOSurface *)retainSurface(this,*param_1);
  if (this_00 == (IOSurface *)0x0) {
    return 0xe00002c2;
  }
  if ((char)param_1[2] == '\0') {
    pOVar3 = (OSString *)0x0;
  }
  else {
    uVar7 = 0xe00002c2;
    if ((*(char *)((long)param_1 + (long)(param_3 + -9) + 8) != '\0') ||
       (pOVar3 = (OSString *)OSString::withCString((char *)(param_1 + 2)), pOVar3 == (OSString *)0x0
       )) goto LAB_0001c8ad;
  }
  local_4c = 0xaaaaaaaa;
  local_48 = param_2;
  pOVar4 = IOSurface::copyValue(this_00,pOVar3,&local_4c);
  if (pOVar4 == (OSMetaClassBase *)0x0) {
    *param_4 = 0;
    uVar7 = 0;
  }
  else {
    plVar5 = (long *)OSMetaClassBase::safeMetaCast(pOVar4,*(OSMetaClass **)PTR_metaClass_00027030);
    if (plVar5 == (long *)0x0) {
      uVar7 = 0xe00002c7;
    }
    else {
      local_40 = pOVar3;
      uVar1 = (**(code **)(*plVar5 + 0x140))(plVar5);
      pvVar6 = (void *)(**(code **)(*plVar5 + 0x178))(plVar5);
      local_34 = uVar1;
      if (*param_4 < uVar1) {
        *param_4 = uVar1;
        uVar2 = IOSurface::get_max_property_size(this_00);
        uVar7 = 0xe00002db;
      }
      else {
        _memmove(local_48,pvVar6,(ulong)uVar1);
        *param_4 = uVar1;
        uVar2 = IOSurface::get_max_property_size(this_00);
        uVar7 = 0;
      }
      pOVar3 = local_40;
      if (uVar2 < uVar1) {
        IOSurface::set_max_property_size(this_00,local_34);
      }
    }
    (**(code **)(*(long *)pOVar4 + 0x28))(pOVar4);
  }
  if (pOVar3 != (OSString *)0x0) {
    (**(code **)(*(long *)pOVar3 + 0x28))(pOVar3);
  }
LAB_0001c8ad:
  (**(code **)(*(long *)this_00 + 0x28))(this_00);
  return uVar7;
}



// IOSurfaceRootUserClient::write_debug_info(OSDictionary*)

void __thiscall
IOSurfaceRootUserClient::write_debug_info(IOSurfaceRootUserClient *this,long *param_1)

{
  write_debug_info_with_options(this,param_1,1);
  return;
}



// IOSurfaceRootUserClient::write_debug_info_with_options(OSDictionary*, unsigned int)

void __thiscall
IOSurfaceRootUserClient::write_debug_info_with_options
          (IOSurfaceRootUserClient *this,long *param_1,undefined4 param_2)

{
  ulong uVar1;
  int iVar2;
  uint uVar3;
  long lVar4;
  char *pcVar5;
  long *plVar6;
  long *plVar7;
  _func_bool_OSObject_ptr *p_Var8;
  ulong uVar9;
  uint uVar10;
  ulong uVar11;
  ulong uVar12;
  ulong uVar13;
  undefined8 local_70;
  undefined8 *local_68;
  undefined8 local_60;
  code *local_58;
  code *local_50;
  long *local_48;
  long *local_40;
  undefined4 local_34;
  
  lVar4 = _get_bsdtask_info(*(undefined8 *)(this + 0xf0));
  if (lVar4 != 0) {
    pcVar5 = (char *)_proc_best_name(lVar4);
    plVar6 = (long *)OSString::withCString(pcVar5);
    if (plVar6 != (long *)0x0) {
      (**(code **)(*param_1 + 0x1d0))(param_1,"name",plVar6);
    }
    iVar2 = _proc_pid(lVar4);
    plVar7 = (long *)OSNumber::withNumber((long)iVar2,0x20);
    if (plVar7 != (long *)0x0) {
      (**(code **)(*param_1 + 0x1d0))(param_1,"pid",plVar7);
      (**(code **)(*plVar7 + 0x28))(plVar7);
    }
    if (plVar6 != (long *)0x0) {
      (**(code **)(*plVar6 + 0x28))(plVar6);
    }
  }
  local_68 = &local_70;
  local_70 = 0;
  local_60 = 0x3002000000;
  local_58 = ___Block_byref_object_copy_;
  local_50 = ___Block_byref_object_dispose_;
  local_48 = (long *)&DAT_aaaaaaaaaaaaaaaa;
  local_34 = param_2;
  local_48 = (long *)OSArray::withCapacity(*(uint *)(this + 0x124));
  p_Var8 = (_func_bool_OSObject_ptr *)OSArray::withCapacity(*(uint *)(this + 0x124));
  if (local_68[5] != 0) {
    if (p_Var8 == (_func_bool_OSObject_ptr *)0x0) goto LAB_0001cb45;
    local_40 = param_1;
    _IOLockLock(*(undefined8 *)(this + 0xd8));
    uVar3 = *(uint *)(this + 0x108);
    if (uVar3 != 0) {
      uVar11 = 0;
      do {
        uVar1 = *(ulong *)(this + 0x100);
        uVar12 = uVar1 + (ulong)uVar3 * 8;
        uVar9 = uVar12 - uVar1;
        if ((uVar12 < uVar1) || (uVar9 >> 0x20 != 0)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                    );
        }
        if ((long)(int)(uVar11 * 8) != uVar11 * 8) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        uVar12 = uVar11 << 0x23;
        if (((long)uVar12 < 0) || ((uint)uVar9 < (int)(uVar12 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        uVar13 = (ulong)CARRY8(uVar1,uVar12 >> 0x20);
        uVar9 = -uVar13;
        if ((uVar13 != uVar9) || ((long)uVar9 < 0)) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        if (*(long *)(uVar1 + (uVar12 >> 0x20)) != 0) {
          (**(code **)(*(long *)p_Var8 + 0x1b8))(p_Var8);
          uVar3 = *(uint *)(this + 0x108);
        }
        uVar10 = (int)uVar11 + 1;
        uVar11 = (ulong)uVar10;
      } while (uVar10 < uVar3);
    }
    _IOLockUnlock(*(undefined8 *)(this + 0xd8));
    OSCollection::iterateObjects(p_Var8);
    (**(code **)(*local_40 + 0x1d0))(local_40,"Client Surfaces",local_68[5]);
  }
  if (p_Var8 != (_func_bool_OSObject_ptr *)0x0) {
    (**(code **)(*(long *)p_Var8 + 0x28))(p_Var8);
  }
LAB_0001cb45:
  __Block_object_dispose(&local_70,8);
  if (local_48 != (long *)0x0) {
    (**(code **)(*local_48 + 0x28))();
  }
  return;
}



// IOSurfaceRootUserClient::log_surface_creation_count()

void __thiscall IOSurfaceRootUserClient::log_surface_creation_count(IOSurfaceRootUserClient *this)

{
  undefined4 uVar1;
  long lVar2;
  undefined1 local_128 [256];
  long local_28;
  
  local_28 = *(long *)PTR____stack_chk_guard_00027088;
  lVar2 = _get_bsdtask_info(*(undefined8 *)(this + 0xf0));
  if (lVar2 != 0) {
    ___bzero(local_128,0x100);
    _proc_selfname(local_128,0x100);
    _proc_pid(lVar2);
    uVar1 = _proc_pid(lVar2);
    __os_log_internal(0,PTR___os_log_default_00027090,0x11,
                      "Perf: Process %s (%d) IOSurface creation count: %d total count: %d",local_128
                      ,uVar1,*(undefined4 *)(this + 0x120),*(undefined4 *)(this + 0x124));
    uVar1 = _proc_pid(lVar2);
    _IOLog("Perf: Process %s (%d) IOSurface creation count: %d total count: %d\n",local_128,uVar1,
           *(undefined4 *)(this + 0x120),*(undefined4 *)(this + 0x124));
  }
  if (*(long *)PTR____stack_chk_guard_00027088 == local_28) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



void ___Block_byref_object_copy_(long param_1,long param_2)

{
  *(undefined8 *)(param_1 + 0x28) = *(undefined8 *)(param_2 + 0x28);
  *(undefined8 *)(param_2 + 0x28) = 0;
  return;
}



void ___Block_byref_object_dispose_(long param_1)

{
  if (*(long **)(param_1 + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x28) + 0x28))();
  }
  *(undefined8 *)(param_1 + 0x28) = 0;
  return;
}



undefined8
____ZN23IOSurfaceRootUserClient29write_debug_info_with_optionsEP12OSDictionaryj_block_invoke
          (long param_1,IOSurfaceClient *param_2)

{
  long *plVar1;
  uint uVar2;
  long *plVar3;
  long *plVar4;
  void *pvVar5;
  long *plVar6;
  
  plVar3 = (long *)OSDictionary::withCapacity(1);
  if (plVar3 != (long *)0x0) {
    IOSurfaceClient::write_debug_info_with_options(param_2,plVar3,*(int *)(param_1 + 0x28));
    plVar4 = (long *)OSSerialize::binaryWithCapacity
                               (*(uint *)(param_1 + 0x2c),(void *)0x0,(void *)0x0);
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x120))(plVar4);
      (**(code **)(*plVar3 + 0x30))(plVar3,plVar4);
      pvVar5 = (void *)(**(code **)(*plVar4 + 0x118))(plVar4);
      uVar2 = (**(code **)(*plVar4 + 0x158))(plVar4);
      plVar6 = (long *)OSData::withBytes(pvVar5,uVar2);
      if (plVar6 != (long *)0x0) {
        plVar1 = *(long **)(*(long *)(*(long *)(param_1 + 0x20) + 8) + 0x28);
        (**(code **)(*plVar1 + 0x1b8))(plVar1,plVar6);
        (**(code **)(*plVar6 + 0x28))(plVar6);
      }
      (**(code **)(*plVar4 + 0x28))(plVar4);
    }
    (**(code **)(*plVar3 + 0x28))(plVar3);
  }
  return 0;
}



void ___copy_helper_block_8_32r(long param_1,long param_2)

{
  __Block_object_assign((void *)(param_1 + 0x20),*(void **)(param_2 + 0x20),8);
  return;
}



// IOSurfaceRootUserClient::alloc_handles()

bool __thiscall IOSurfaceRootUserClient::alloc_handles(IOSurfaceRootUserClient *this)

{
  uint uVar1;
  uint uVar2;
  ulong uVar3;
  ulong uVar4;
  long lVar5;
  ulong uVar6;
  ulong uVar7;
  ulong uVar8;
  ulong uVar9;
  uint uVar10;
  ulong uVar11;
  
  uVar3 = *(ulong *)(this + 0x100);
  uVar1 = *(uint *)(*(long *)(this + 0xe0) + 0xd8);
  uVar2 = *(uint *)(this + 0x108);
  lVar5 = _IOMallocTypeVarImpl(&alloc_handles()::kalloc_type_view_2433,(ulong)uVar1 * 8);
  *(long *)(this + 0x100) = lVar5;
  *(uint *)(this + 0x108) = uVar1;
  if (lVar5 == 0) {
    _IOLog("IONewZero failed to alloc handles");
    *(ulong *)(this + 0x100) = uVar3;
    *(uint *)(this + 0x108) = uVar2;
  }
  else if (uVar3 != 0) {
    if (uVar2 != 0) {
      uVar7 = uVar3 + (ulong)uVar2 * 8;
      uVar6 = uVar7 - uVar3;
      if ((uVar7 < uVar3) || (uVar6 >> 0x20 != 0)) {
LAB_0001cf59:
                    // WARNING: Subroutine does not return
        os_detail::panic_trapping_policy::trap
                  (
                  "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                  );
      }
      uVar7 = 0;
      do {
        if ((long)(int)(uVar7 * 8) != uVar7 * 8) {
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                    );
        }
        uVar8 = uVar7 << 0x23;
        if ((long)uVar8 < 0) {
LAB_0001cf35:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                    );
        }
        uVar9 = uVar8 >> 0x20;
        uVar10 = (int)(uVar8 >> 0x20) + 8;
        if ((uint)uVar6 < uVar10) goto LAB_0001cf35;
        uVar8 = -(ulong)CARRY8(uVar3,uVar9);
        if ((CARRY8(uVar3,uVar9) != uVar8) || ((long)uVar8 < 0)) {
LAB_0001cf41:
                    // WARNING: Subroutine does not return
          os_detail::panic_trapping_policy::trap
                    (
                    "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                    );
        }
        uVar4 = *(ulong *)(this + 0x100);
        uVar8 = uVar4 + (ulong)uVar1 * 8;
        uVar11 = uVar8 - uVar4;
        if ((uVar8 < uVar4) || (uVar11 >> 0x20 != 0)) goto LAB_0001cf59;
        if ((uint)uVar11 < uVar10) goto LAB_0001cf35;
        uVar8 = -(ulong)CARRY8(uVar4,uVar9);
        if ((CARRY8(uVar4,uVar9) != uVar8) || ((long)uVar8 < 0)) goto LAB_0001cf41;
        *(undefined8 *)(uVar4 + uVar9) = *(undefined8 *)(uVar3 + uVar9);
        uVar10 = (int)uVar7 + 1;
        uVar7 = (ulong)uVar10;
      } while (uVar10 < uVar2);
    }
    _IOFreeTypeVarImpl(&alloc_handles()::kalloc_type_view_2452,uVar3,(ulong)uVar2 * 8);
  }
  return lVar5 != 0;
}



void ___Block_byref_object_copy__46(long param_1,long param_2)

{
  *(undefined8 *)(param_1 + 0x28) = *(undefined8 *)(param_2 + 0x28);
  *(undefined8 *)(param_2 + 0x28) = 0;
  return;
}



void ___Block_byref_object_dispose__47(long param_1)

{
  if (*(long **)(param_1 + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(param_1 + 0x28) + 0x28))();
  }
  *(undefined8 *)(param_1 + 0x28) = 0;
  return;
}



bool ____ZN23IOSurfaceRootUserClient19notify_shared_eventEjyyyy_block_invoke
               (long param_1,long *param_2)

{
  long lVar1;
  long lVar2;
  long lVar3;
  long *plVar4;
  
  lVar1 = param_2[9];
  lVar2 = *(long *)(param_1 + 0x28);
  if (lVar1 == lVar2) {
    lVar3 = *(long *)(*(long *)(param_1 + 0x20) + 8);
    plVar4 = *(long **)(lVar3 + 0x28);
    *(long **)(lVar3 + 0x28) = param_2;
    (**(code **)(*param_2 + 0x20))(param_2);
    if (plVar4 != (long *)0x0) {
      (**(code **)(*plVar4 + 0x28))(plVar4);
    }
  }
  return lVar1 == lVar2;
}



undefined8
____ZN23IOSurfaceRootUserClient34add_shared_event_notification_portEPy_block_invoke
          (long param_1,long param_2)

{
  long lVar1;
  long lVar2;
  long lVar3;
  
  lVar1 = *(long *)(param_2 + 0x48);
  lVar3 = *(long *)(param_1 + 0x28);
  lVar2 = *(long *)(lVar3 + 0x10);
  if (lVar1 == lVar2) {
    __os_log_internal(0,PTR___os_log_default_00027090,0x10,
                      "IOSurfaceRootUserClient: duplicate listener refcon %08llx",lVar1);
    lVar3 = *(long *)(*(long *)(param_1 + 0x20) + 8);
    *(undefined4 *)(lVar3 + 0x18) = 0xe00002c2;
  }
  return CONCAT71((int7)((ulong)lVar3 >> 8),lVar1 == lVar2);
}



// IOSurfaceRootUserClient::gather_iosurface_data(unsigned long long, OSSerialize*)

undefined8 __thiscall
IOSurfaceRootUserClient::gather_iosurface_data
          (IOSurfaceRootUserClient *this,long param_1,long *param_2)

{
  char cVar1;
  long *plVar2;
  undefined8 uVar3;
  
  plVar2 = (long *)OSDictionary::withCapacity(1);
  if (plVar2 == (long *)0x0) {
    uVar3 = 0xe00002bd;
  }
  else {
    (**(code **)(*param_2 + 0x120))(param_2);
    IOSurfaceRoot::write_debug_info_with_options
              (*(IOSurfaceRoot **)(this + 0xe0),plVar2,(uint)(param_1 != 0));
    cVar1 = (**(code **)(*plVar2 + 0x30))(plVar2,param_2);
    uVar3 = 0xe00002bd;
    if (cVar1 != '\0') {
      uVar3 = 0;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return uVar3;
}



// IOSurfaceRootUserClient::set_detach_mode_code(unsigned int, unsigned long long, unsigned long
// long, unsigned long long)

undefined8 __thiscall
IOSurfaceRootUserClient::set_detach_mode_code
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,ulong param_3,long param_4)

{
  IOSurface *this_00;
  undefined8 uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    IOSurface::setDetachModeCode(this_00,param_2,param_3,param_4);
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    uVar1 = 0;
  }
  return uVar1;
}



// IOSurfaceRootUserClient::set_data_property(unsigned int, unsigned long long, unsigned long long,
// void const*)

ulong __thiscall
IOSurfaceRootUserClient::set_data_property
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,ulong param_3,void *param_4)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::setDataProperty(this_00,param_2,param_3,param_4);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::get_data_property(unsigned int, unsigned long long, unsigned long long,
// unsigned long long*, unsigned long long*, unsigned int*, void*)

ulong __thiscall
IOSurfaceRootUserClient::get_data_property
          (IOSurfaceRootUserClient *this,uint param_1,ulong param_2,ulong param_3,long *param_4,
          size_t *param_5,undefined4 *param_6,void *param_7)

{
  int iVar1;
  IOSurface *this_00;
  ulong uVar2;
  undefined4 uVar3;
  size_t local_40;
  long *local_38;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar2 = 0xe00002c2;
  }
  else {
    if (param_3 == 0) {
      param_7 = (void *)0x0;
    }
    local_40 = 0;
    local_38 = param_4;
    uVar2 = IOSurface::getDataProperty(this_00,param_2,param_3,&local_40,param_7);
    iVar1 = (int)uVar2;
    uVar2 = uVar2 & 0xffffffff;
    if ((iVar1 == 0) || (iVar1 == -0x1ffffd18)) {
      *param_5 = local_40;
      uVar3 = (undefined4)local_40;
      if (iVar1 != 0) {
        uVar3 = 0;
      }
      if (param_7 == (void *)0x0) {
        uVar3 = 0;
      }
      *param_6 = uVar3;
      *local_38 = (long)iVar1;
      uVar2 = 0;
    }
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar2;
}



// IOSurfaceRootUserClient::clear_data_properties(unsigned int)

ulong __thiscall
IOSurfaceRootUserClient::clear_data_properties(IOSurfaceRootUserClient *this,uint param_1)

{
  IOSurface *this_00;
  ulong uVar1;
  
  this_00 = (IOSurface *)retainSurface(this,param_1);
  if (this_00 == (IOSurface *)0x0) {
    uVar1 = 0xe00002c2;
  }
  else {
    uVar1 = IOSurface::clearDataProperties(this_00);
    uVar1 = uVar1 & 0xffffffff;
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
  }
  return uVar1;
}



// IOSurfaceRootUserClient::MetaClass::~MetaClass()

void __thiscall IOSurfaceRootUserClient::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



void __GLOBAL__sub_I_IOSurfaceRootUserClient_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceRootUserClient::gMetaClass,"IOSurfaceRootUserClient",
             (OSMetaClass *)PTR_gMetaClass_00027020,0x138);
  IOSurfaceRootUserClient::gMetaClass = &PTR__MetaClass_0002a8a8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceRootUserClient::gMetaClass);
  return;
}



// IOFence::MetaClass::MetaClass()

void __thiscall IOFence::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOFence",(OSMetaClass *)PTR_gMetaClass_00027048,0xd8);
  *(undefined ***)this = &PTR__MetaClass_0002bec8;
  return;
}



// IOFence::MetaClass::~MetaClass()

void __thiscall IOFence::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOFence::IOFence(OSMetaClass const*)

void __thiscall IOFence::IOFence(IOFence *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  return;
}



// IOFence::IOFence(OSMetaClass const*)

void __thiscall IOFence::IOFence(IOFence *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  return;
}



// IOFence::~IOFence()

void __thiscall IOFence::~IOFence(IOFence *this)

{
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOFence::~IOFence()

void __thiscall IOFence::~IOFence(IOFence *this)

{
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  if (*(long **)(this + 0x40) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x40) + 0x28))();
  }
  *(undefined8 *)(this + 0x40) = 0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOFence::~IOFence()

void __thiscall IOFence::~IOFence(IOFence *this)

{
  ~IOFence(this);
  _OSObject_typed_operator_delete(&IOFence_ktv,this,0xd8);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOFence::operator delete(void*, unsigned long)

void __cdecl IOFence::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOFence_ktv,param_1,param_2);
  return;
}



// IOFence::getMetaClass() const

undefined8 * IOFence::getMetaClass(void)

{
  return &gMetaClass;
}



// IOFence::MetaClass::MetaClass()

void __thiscall IOFence::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOFence",(OSMetaClass *)PTR_gMetaClass_00027048,0xd8);
  *(undefined ***)this = &PTR__MetaClass_0002bec8;
  return;
}



// IOFence::MetaClass::alloc() const

OSObject * IOFence::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOFence_ktv,0xd8);
  OSObject::OSObject(this,(OSMetaClass *)&IOFence::gMetaClass);
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOFence::operator new(unsigned long)

void * __thiscall IOFence::operator_new(IOFence *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOFence_ktv,this);
  return pvVar1;
}



// IOFence::IOFence()

void __thiscall IOFence::IOFence(IOFence *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOFence::IOFence()

void __thiscall IOFence::IOFence(IOFence *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOFence_0002bd90;
  *(undefined8 *)(this + 0x10) = 0;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x40) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOFence::init()

void __thiscall IOFence::init(IOFence *this)

{
  _iosfc_ref_init_count_internal((uint *)(this + 0xc),1);
                    // WARNING: Could not recover jumptable at 0x0001d5bd. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0x98))(this);
  return;
}



// IOFence::free()

void __thiscall IOFence::free(IOFence *this)

{
  if (*(int *)(this + 0x4c) != 0) {
                    // WARNING: Could not recover jumptable at 0x0001d5dc. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
    return;
  }
                    // WARNING: Subroutine does not return
  _panic("\"fence freed before completion: %p\" @%s:%d",this,"IOSurfaceFence.cpp",0x1f);
}



// IOFence::getRetainCount() const

undefined4 __thiscall IOFence::getRetainCount(IOFence *this)

{
  return *(undefined4 *)(this + 0xc);
}



// IOFence::tryRetain() const

void __thiscall IOFence::tryRetain(IOFence *this)

{
  _iosfc_ref_retain_try_internal((uint *)(this + 0xc));
  return;
}



// IOFence::retain() const

void __thiscall IOFence::retain(IOFence *this)

{
  uint uVar1;
  IOFence *pIVar2;
  
  pIVar2 = this + 0xc;
  LOCK();
  uVar1 = *(uint *)pIVar2;
  *(uint *)pIVar2 = *(uint *)pIVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(pIVar2,uVar1);
  return;
}



// IOFence::release() const

void __thiscall IOFence::release(IOFence *this)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x0001d655. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x118))(this);
  return;
}



// IOFence::release(int) const

void __thiscall IOFence::release(IOFence *this,int param_1)

{
  int iVar1;
  
  if (param_1 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x0001d694. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    release();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOFence::taggedRetain(void const*) const

void __cdecl IOFence::taggedRetain(long param_1)

{
  uint uVar1;
  uint *puVar2;
  
  puVar2 = (uint *)(param_1 + 0xc);
  LOCK();
  uVar1 = *puVar2;
  *puVar2 = *puVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(puVar2,uVar1);
  return;
}



// IOFence::taggedRelease(void const*, int) const

void __thiscall IOFence::taggedRelease(IOFence *this,undefined8 param_2_00,int param_2)

{
  int iVar1;
  
  if (param_2 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0xc));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x0001d6e8. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    taggedRelease();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOFence::taggedRelease(void const*) const

void __cdecl IOFence::taggedRelease(long *param_1)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)((long)param_1 + 0xc));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x0001d729. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x118))(param_1);
  return;
}



// IOFence::complete(int)

undefined8 __thiscall IOFence::complete(IOFence *this,undefined4 param_1)

{
  undefined8 uVar1;
  
  if (*(IOSurface **)(this + 0x10) == (IOSurface *)0x0) {
    uVar1 = 0xe00002bc;
  }
  else {
    *(undefined4 *)(this + 0x48) = param_1;
    IOSurface::fence_completed(*(IOSurface **)(this + 0x10),(long *)this);
    uVar1 = 0;
  }
  return uVar1;
}



// IOFence::complete_locked(int)

undefined8 __thiscall IOFence::complete_locked(IOFence *this,undefined4 param_1)

{
  undefined8 uVar1;
  
  if (*(IOSurface **)(this + 0x10) == (IOSurface *)0x0) {
    uVar1 = 0xe00002bc;
  }
  else {
    *(undefined4 *)(this + 0x48) = param_1;
    IOSurface::fence_completed_locked(*(IOSurface **)(this + 0x10),(long *)this);
    uVar1 = 0;
  }
  return uVar1;
}



// IOFence::getAcceleratorID()

undefined4 __thiscall IOFence::getAcceleratorID(IOFence *this)

{
  return *(undefined4 *)(this + 0x20);
}



// IOFence::getFenceDirection()

undefined4 __thiscall IOFence::getFenceDirection(IOFence *this)

{
  return *(undefined4 *)(this + 0x24);
}



// IOFence::writeTraceData(IOFenceTraceData*)

void __thiscall IOFence::writeTraceData(IOFence *this,long param_1)

{
  undefined8 uVar1;
  undefined8 uVar2;
  undefined8 uVar3;
  undefined8 uVar4;
  undefined8 uVar5;
  undefined8 uVar6;
  undefined8 uVar7;
  uint64_t uVar8;
  
  *(undefined4 *)(param_1 + 4) = *(undefined4 *)(this + 0x20);
  *(undefined4 *)(param_1 + 8) = *(undefined4 *)(this + 0x24);
  *(undefined8 *)(param_1 + 0x10) = *(undefined8 *)(this + 0x28);
  *(undefined8 *)(param_1 + 0x28) = *(undefined8 *)(this + 0x30);
  *(undefined8 *)(param_1 + 0x30) = *(undefined8 *)(this + 0x38);
  *(undefined8 *)(param_1 + 0x18) = *(undefined8 *)(this + 0x90);
  uVar8 = _mach_absolute_time();
  *(uint64_t *)(param_1 + 0x20) = uVar8;
  uVar1 = *(undefined8 *)(this + 0xa8);
  uVar2 = *(undefined8 *)(this + 0xb0);
  uVar3 = *(undefined8 *)(this + 0xb8);
  uVar4 = *(undefined8 *)(this + 0xc0);
  uVar5 = *(undefined8 *)(this + 200);
  uVar6 = *(undefined8 *)(this + 0xd0);
  uVar7 = *(undefined8 *)(this + 0xa0);
  *(undefined8 *)(param_1 + 0x38) = *(undefined8 *)(this + 0x98);
  *(undefined8 *)(param_1 + 0x70) = uVar6;
  *(undefined8 *)(param_1 + 0x68) = uVar5;
  *(undefined8 *)(param_1 + 0x60) = uVar4;
  *(undefined8 *)(param_1 + 0x58) = uVar3;
  *(undefined8 *)(param_1 + 0x50) = uVar2;
  *(undefined8 *)(param_1 + 0x48) = uVar1;
  *(undefined8 *)(param_1 + 0x40) = uVar7;
  return;
}



// IOFence::finalize()

void __thiscall IOFence::finalize(IOFence *this)

{
  if (*(IOFenceTransaction **)(this + 0x18) != (IOFenceTransaction *)0x0) {
    IOFenceTransaction::remove_fence(*(IOFenceTransaction **)(this + 0x18),(long)this);
  }
                    // WARNING: Could not recover jumptable at 0x0001d858. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x90))(this);
  return;
}



// IOFence::getSurface() const

undefined8 __thiscall IOFence::getSurface(IOFence *this)

{
  return *(undefined8 *)(this + 0x10);
}



// IOFence::MetaClass::~MetaClass()

void __thiscall IOFence::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceFence_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOFence::gMetaClass,"IOFence",(OSMetaClass *)PTR_gMetaClass_00027048,
             0xd8);
  IOFence::gMetaClass = &PTR__MetaClass_0002bec8;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOFence::gMetaClass);
  return;
}



// IOSurfaceShared::MetaClass::MetaClass()

void __thiscall IOSurfaceShared::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceShared",(OSMetaClass *)PTR_gMetaClass_00027048,0x48);
  *(undefined ***)this = &PTR__MetaClass_0002c0f0;
  return;
}



// IOSurfaceShared::MetaClass::~MetaClass()

void __thiscall IOSurfaceShared::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceShared::IOSurfaceShared(OSMetaClass const*)

void __thiscall IOSurfaceShared::IOSurfaceShared(IOSurfaceShared *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceShared::IOSurfaceShared(OSMetaClass const*)

void __thiscall IOSurfaceShared::IOSurfaceShared(IOSurfaceShared *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  *(undefined8 *)(this + 0x20) = 0;
  return;
}



// IOSurfaceShared::~IOSurfaceShared()

void __thiscall IOSurfaceShared::~IOSurfaceShared(IOSurfaceShared *this)

{
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceShared::~IOSurfaceShared()

void __thiscall IOSurfaceShared::~IOSurfaceShared(IOSurfaceShared *this)

{
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceShared::~IOSurfaceShared()

void __thiscall IOSurfaceShared::~IOSurfaceShared(IOSurfaceShared *this)

{
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  if (*(long **)(this + 0x20) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x20) + 0x28))();
  }
  *(undefined8 *)(this + 0x20) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceShared_ktv,this,0x48);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceShared::operator delete(void*, unsigned long)

void __cdecl IOSurfaceShared::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceShared_ktv,param_1,param_2);
  return;
}



// IOSurfaceShared::getMetaClass() const

undefined8 * IOSurfaceShared::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceShared::MetaClass::MetaClass()

void __thiscall IOSurfaceShared::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceShared",(OSMetaClass *)PTR_gMetaClass_00027048,0x48);
  *(undefined ***)this = &PTR__MetaClass_0002c0f0;
  return;
}



// IOSurfaceShared::MetaClass::alloc() const

OSObject * IOSurfaceShared::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceShared_ktv,0x48);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceShared::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceShared::operator new(unsigned long)

void * __thiscall IOSurfaceShared::operator_new(IOSurfaceShared *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceShared_ktv,this);
  return pvVar1;
}



// IOSurfaceShared::IOSurfaceShared()

void __thiscall IOSurfaceShared::IOSurfaceShared(IOSurfaceShared *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceShared::IOSurfaceShared()

void __thiscall IOSurfaceShared::IOSurfaceShared(IOSurfaceShared *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceShared_0002bfc0;
  *(undefined8 *)(this + 0x20) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl
// IOSurfaceShared::withTask(task*, IOSurfaceRoot*, bool)

IOSurfaceShared * __cdecl
IOSurfaceShared::withTask(undefined8 param_1,long *param_2,IOSurfaceShared param_3)

{
  IOSurfaceShared *this;
  undefined8 uVar1;
  
  this = (IOSurfaceShared *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (this != (IOSurfaceShared *)0x0) {
    uVar1 = init(this,param_1,param_2,param_3);
    if ((char)uVar1 != '\0') {
      return this;
    }
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return (IOSurfaceShared *)0x0;
}



// IOSurfaceShared::init(task*, IOSurfaceRoot*, bool)

undefined8 __thiscall
IOSurfaceShared::init
          (IOSurfaceShared *this,undefined8 param_2,long *param_3,IOSurfaceShared param_4)

{
  long *plVar1;
  char cVar2;
  long lVar3;
  
  cVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))();
  if (cVar2 != '\0') {
    plVar1 = *(long **)(this + 0x20);
    *(long **)(this + 0x20) = param_3;
    if (param_3 != (long *)0x0) {
      (**(code **)(*param_3 + 0x20))(param_3);
    }
    if (plVar1 != (long *)0x0) {
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
    *(undefined8 *)(this + 0x10) = param_2;
    _task_reference(param_2);
    lVar3 = _IOLockAlloc();
    *(long *)(this + 0x18) = lVar3;
    if (lVar3 != 0) {
      this[0x40] = param_4;
      return CONCAT71((int7)((ulong)lVar3 >> 8),1);
    }
  }
  return 0;
}



// IOSurfaceShared::free()

void __thiscall IOSurfaceShared::free(IOSurfaceShared *this)

{
  undefined8 *puVar1;
  undefined8 *puVar2;
  
  puVar2 = *(undefined8 **)(this + 0x28);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[1] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[1] + 0x28))();
    }
    puVar2[1] = 0;
    _IOFreeTypeImpl(&free()::kalloc_type_view_55,puVar2);
    puVar2 = puVar1;
  }
  puVar2 = *(undefined8 **)(this + 0x30);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[1] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[1] + 0x28))();
    }
    puVar2[1] = 0;
    _IOFreeTypeImpl(&free()::kalloc_type_view_64,puVar2);
    puVar2 = puVar1;
  }
  puVar2 = *(undefined8 **)(this + 0x38);
  while (puVar2 != (undefined8 *)0x0) {
    puVar1 = (undefined8 *)*puVar2;
    if ((long *)puVar2[1] != (long *)0x0) {
      (**(code **)(*(long *)puVar2[1] + 0x28))();
    }
    puVar2[1] = 0;
    _IOFreeTypeImpl(&free()::kalloc_type_view_73,puVar2);
    puVar2 = puVar1;
  }
  if (*(long *)(this + 0x10) != 0) {
    _task_deallocate();
    *(undefined8 *)(this + 0x10) = 0;
  }
  if (*(long *)(this + 0x18) != 0) {
    _IOLockFree();
    *(undefined8 *)(this + 0x18) = 0;
  }
                    // WARNING: Could not recover jumptable at 0x0001dd0f. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceShared::getOwningTask() const

undefined8 __thiscall IOSurfaceShared::getOwningTask(IOSurfaceShared *this)

{
  return *(undefined8 *)(this + 0x10);
}



// IOSurfaceShared::map_surface_client_shared(unsigned int, unsigned long long*, unsigned long
// long*)

undefined8 __thiscall
IOSurfaceShared::map_surface_client_shared
          (IOSurfaceShared *this,ulong param_2_00,long *param_2,long *param_3)

{
  ulong uVar1;
  char *pcVar2;
  undefined8 uVar3;
  
  _IOLockLock(*(undefined8 *)(this + 0x18));
  uVar1 = map_client_shared(*(long **)(*(long *)(this + 0x20) + 0xf8),(undefined8 *)(this + 0x28),
                            param_2_00 & 0xffffffff,*(ulonglong *)(this + 0x10),0x1001,0xb8,param_2)
  ;
  if ((char)uVar1 == '\0') {
    pcVar2 = "map_client_shared failed for client_shared_ro";
  }
  else {
    uVar1 = map_client_shared(*(long **)(*(long *)(this + 0x20) + 0x100),(undefined8 *)(this + 0x30)
                              ,param_2_00 & 0xffffffff,*(ulonglong *)(this + 0x10),
                              (uint)(this[0x40] == (IOSurfaceShared)0x0) << 0xc | 1,0x40,param_3);
    uVar3 = CONCAT71((int7)((param_2_00 & 0xffffffff) >> 8),1);
    if ((char)uVar1 != '\0') goto LAB_0001ddcc;
    pcVar2 = "map_client_shared failed for client_shared_rw";
  }
  uVar3 = 0;
  _IOLog(pcVar2);
LAB_0001ddcc:
  _IOLockUnlock(*(undefined8 *)(this + 0x18));
  return uVar3;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// map_client_shared(_IOSurfaceSharedListEntry*, _IOSurfaceClientSharedListEntry**, unsigned int,
// task*, unsigned int, unsigned long, unsigned long long*)

ulong __cdecl
map_client_shared(long *param_1,undefined8 *param_2,ulong param_3,ulonglong param_4,uint param_5,
                 long param_6,long *param_7)

{
  undefined8 *puVar1;
  long *plVar2;
  undefined8 uVar3;
  ulong uVar4;
  uint uVar5;
  undefined8 *puVar6;
  ulong uVar7;
  
  uVar4 = param_3 & 0xffffffff;
  if (param_1 != (long *)0x0) {
    puVar1 = param_2;
    puVar6 = (undefined8 *)0x0;
    uVar7 = uVar4;
    do {
      puVar1 = (undefined8 *)*puVar1;
      if (puVar1 == (undefined8 *)0x0) {
        puVar1 = (undefined8 *)
                 _IOMallocTypeImpl(&map_client_shared(_IOSurfaceSharedListEntry*,_IOSurfaceClientSharedListEntry**,unsigned_int,task*,unsigned_int,unsigned_long,unsigned_long_long*)
                                    ::kalloc_type_view_117);
        if (puVar1 == (undefined8 *)0x0) {
          uVar4 = 0;
          _IOLog("IONewZero failed to alloc IOSurfaceClientSharedListEntry");
          goto LAB_0001df1d;
        }
        plVar2 = (long *)IOMemoryDescriptor::createMappingInTask
                                   ((task *)param_1[1],param_4,0,(ulong)param_5,0);
        if ((long *)puVar1[1] != (long *)0x0) {
          (**(code **)(*(long *)puVar1[1] + 0x28))();
        }
        puVar1[1] = plVar2;
        if (plVar2 == (long *)0x0) {
          uVar4 = 0;
          _IOLog("IOSurfaceRootUserClient: couldn\'t map shared memory region into client");
          _IOFreeTypeImpl(&map_client_shared(_IOSurfaceSharedListEntry*,_IOSurfaceClientSharedListEntry**,unsigned_int,task*,unsigned_int,unsigned_long,unsigned_long_long*)
                           ::kalloc_type_view_129,puVar1);
          goto LAB_0001df1d;
        }
        uVar3 = (**(code **)(*plVar2 + 0x118))(plVar2);
        puVar1[2] = uVar3;
        *puVar1 = 0;
        if (puVar6 == (undefined8 *)0x0) {
          puVar6 = param_2;
        }
        *puVar6 = puVar1;
      }
      uVar5 = (uint)uVar7 - *(uint *)(param_1 + 4);
      uVar4 = (ulong)uVar5;
      if ((uint)uVar7 < *(uint *)(param_1 + 4)) {
        *param_7 = uVar7 * param_6 + puVar1[2];
        uVar4 = CONCAT71((int7)((ulong)param_1 >> 8),1);
LAB_0001df1d:
        return uVar4 & 0xffffffff;
      }
      param_1 = (long *)*param_1;
      uVar7 = (ulong)uVar5;
      puVar6 = puVar1;
    } while (param_1 != (long *)0x0);
  }
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceRootUserClient: asked to allocate client shared id %08x not known by IOSurfaceRoot\" @%s:%d"
         ,uVar4,"IOSurfaceShared.cpp",0x70);
}



// IOSurfaceShared::map_event_client_shared(unsigned int, unsigned long long*)

ulong __thiscall
IOSurfaceShared::map_event_client_shared(IOSurfaceShared *this,ulong param_2_00,long *param_2)

{
  ulong uVar1;
  
  _IOLockLock(*(undefined8 *)(this + 0x18));
  uVar1 = map_client_shared(*(long **)(*(long *)(this + 0x20) + 0x130),(undefined8 *)(this + 0x38),
                            param_2_00 & 0xffffffff,*(ulonglong *)(this + 0x10),0x1001,8,param_2);
  if ((char)uVar1 == '\0') {
    _IOLog("map_client_shared failed for event_shared_ro");
  }
  _IOLockUnlock(*(undefined8 *)(this + 0x18));
  return uVar1 & 0xffffffff;
}



// IOSurfaceShared::MetaClass::~MetaClass()

void __thiscall IOSurfaceShared::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceShared_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceShared::gMetaClass,"IOSurfaceShared",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x48);
  IOSurfaceShared::gMetaClass = &PTR__MetaClass_0002c0f0;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceShared::gMetaClass);
  return;
}



// IOSurfaceDescriptorContext::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptorContext::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptorContext",(OSMetaClass *)PTR_gMetaClass_00027048
             ,0x40);
  *(undefined ***)this = &PTR__MetaClass_0002c318;
  return;
}



// IOSurfaceDescriptorContext::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptorContext::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDescriptorContext::IOSurfaceDescriptorContext(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptorContext::IOSurfaceDescriptorContext
          (IOSurfaceDescriptorContext *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x28) = 0;
  return;
}



// IOSurfaceDescriptorContext::IOSurfaceDescriptorContext(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptorContext::IOSurfaceDescriptorContext
          (IOSurfaceDescriptorContext *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x28) = 0;
  return;
}



// IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext()

void __thiscall
IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext(IOSurfaceDescriptorContext *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext()

void __thiscall
IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext(IOSurfaceDescriptorContext *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext()

void __thiscall
IOSurfaceDescriptorContext::~IOSurfaceDescriptorContext(IOSurfaceDescriptorContext *this)

{
  ~IOSurfaceDescriptorContext(this);
  _OSObject_typed_operator_delete(&IOSurfaceDescriptorContext_ktv,this,0x40);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDescriptorContext::operator delete(void*, unsigned long)

void __cdecl IOSurfaceDescriptorContext::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceDescriptorContext_ktv,param_1,param_2);
  return;
}



// IOSurfaceDescriptorContext::getMetaClass() const

undefined8 * IOSurfaceDescriptorContext::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceDescriptorContext::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptorContext::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptorContext",(OSMetaClass *)PTR_gMetaClass_00027048
             ,0x40);
  *(undefined ***)this = &PTR__MetaClass_0002c318;
  return;
}



// IOSurfaceDescriptorContext::MetaClass::alloc() const

OSObject * IOSurfaceDescriptorContext::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceDescriptorContext_ktv,0x40);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceDescriptorContext::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x28) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceDescriptorContext::operator new(unsigned long)

void * __thiscall IOSurfaceDescriptorContext::operator_new(IOSurfaceDescriptorContext *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceDescriptorContext_ktv,this);
  return pvVar1;
}



// IOSurfaceDescriptorContext::IOSurfaceDescriptorContext()

void __thiscall
IOSurfaceDescriptorContext::IOSurfaceDescriptorContext(IOSurfaceDescriptorContext *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x28) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptorContext::IOSurfaceDescriptorContext()

void __thiscall
IOSurfaceDescriptorContext::IOSurfaceDescriptorContext(IOSurfaceDescriptorContext *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorContext_0002c1e8;
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined8 *)(this + 0x28) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptorContext::init(IOMultiMemoryDescriptor*, OSSharedPtr<OSArray>, unsigned long
// long, OSSharedPtr<IOSurfaceMemoryPoolBunch>)

undefined8 __thiscall
IOSurfaceDescriptorContext::init
          (IOSurfaceDescriptorContext *this,undefined8 param_1,long *param_2,undefined8 param_3,
          long *param_4)

{
  long *plVar1;
  undefined8 uVar2;
  
  uVar2 = (**(code **)(PTR_vtable_00027078 + 0x98))();
  *(undefined8 *)(this + 0x20) = param_1;
  plVar1 = *(long **)(this + 0x28);
  *(long **)(this + 0x28) = param_2;
  if (param_2 != (long *)0x0) {
    uVar2 = (**(code **)(*param_2 + 0x20))(param_2);
  }
  if (plVar1 != (long *)0x0) {
    uVar2 = (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  *(undefined8 *)(this + 0x10) = param_3;
  plVar1 = *(long **)(this + 0x18);
  *(long **)(this + 0x18) = param_4;
  if (param_4 != (long *)0x0) {
    uVar2 = (**(code **)(*param_4 + 0x20))(param_4);
  }
  if (plVar1 != (long *)0x0) {
    uVar2 = (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  if (param_4 != (long *)0x0) {
    uVar2 = (**(code **)(*param_4 + 0x28))(param_4);
  }
  if (param_2 != (long *)0x0) {
    uVar2 = (**(code **)(*param_2 + 0x28))(param_2);
  }
  return CONCAT71((int7)((ulong)uVar2 >> 8),1);
}



// IOSurfaceDescriptorContext::free()

void __thiscall IOSurfaceDescriptorContext::free(IOSurfaceDescriptorContext *this)

{
  IOSurfaceMemoryPool *this_00;
  long *plVar1;
  OSMetaClassBase *pOVar2;
  long *plVar3;
  long *plVar4;
  
  IOSurfaceMemoryPoolBunch::removeContext(*(IOSurfaceMemoryPoolBunch **)(this + 0x18),(long)this);
  this_00 = (IOSurfaceMemoryPool *)
            IOSurfaceMemoryPoolBunch::getPool
                      (*(IOSurfaceMemoryPoolBunch **)(this + 0x18),*(long *)(this + 0x10));
  if (this_00 != (IOSurfaceMemoryPool *)0x0) {
    plVar1 = (long *)OSCollectionIterator::withCollection(*(OSCollection **)(this + 0x28));
    if (plVar1 != (long *)0x0) {
      plVar4 = (long *)0x0;
      while( true ) {
        pOVar2 = (OSMetaClassBase *)(**(code **)(*plVar1 + 0x128))(plVar1);
        plVar3 = (long *)OSMetaClassBase::safeMetaCast
                                   (pOVar2,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass)
        ;
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x20))(plVar3);
        }
        if (plVar4 != (long *)0x0) {
          (**(code **)(*plVar4 + 0x28))(plVar4);
        }
        if (plVar3 == (long *)0x0) break;
        (**(code **)(*plVar3 + 0x20))(plVar3);
        IOSurfaceMemoryPool::returnComponentToBucket(this_00,plVar3);
        plVar4 = plVar3;
      }
      (**(code **)(*plVar1 + 0x28))(plVar1);
    }
  }
  if (*(long **)(this + 0x28) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x28) + 0x28))();
  }
  *(undefined8 *)(this + 0x28) = 0;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  if (this_00 != (IOSurfaceMemoryPool *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0001e43c. Too many branches
                    // WARNING: Treating indirect jump as call
    (**(code **)(*(long *)this_00 + 0x28))(this_00);
    return;
  }
  return;
}



// IOSurfaceMemoryPoolBunch::removeContext(IOSurfaceDescriptorContext*)

undefined8 __thiscall
IOSurfaceMemoryPoolBunch::removeContext(IOSurfaceMemoryPoolBunch *this,long param_1)

{
  long lVar1;
  long *plVar2;
  char *pcVar3;
  
  _IORWLockWrite(*(undefined8 *)(this + 0x18));
  lVar1 = *(long *)(param_1 + 0x30);
  if (lVar1 == 0) {
    plVar2 = *(long **)(param_1 + 0x38);
    if (*plVar2 == param_1) {
      *(long **)(this + 0x38) = plVar2;
LAB_0001e497:
      *plVar2 = lVar1;
      _IORWLockUnlock(*(undefined8 *)(this + 0x18));
      return 0;
    }
  }
  else {
    if (*(long *)(lVar1 + 0x38) != param_1 + 0x30) {
      pcVar3 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_0001e4ba;
    }
    if (**(long **)(param_1 + 0x38) == param_1) {
      *(long **)(lVar1 + 0x38) = *(long **)(param_1 + 0x38);
      plVar2 = *(long **)(param_1 + 0x38);
      goto LAB_0001e497;
    }
  }
  pcVar3 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0001e4ba:
                    // WARNING: Subroutine does not return
  _panic(pcVar3,param_1,0xfb,"IOSurfaceMemoryPool.cpp",0xfb);
}



// IOSurfaceMemoryPoolBunch::getPool(unsigned long long)

long * __thiscall IOSurfaceMemoryPoolBunch::getPool(IOSurfaceMemoryPoolBunch *this,long param_1)

{
  long *plVar1;
  undefined8 uVar2;
  long *plVar3;
  
  _IORWLockRead(*(undefined8 *)(this + 0x10));
  plVar1 = *(long **)(this + 0x20);
  while (plVar3 = plVar1, plVar3 != (long *)0x0) {
    plVar1 = (long *)plVar3[2];
    uVar2 = _iosfc_ref_retain_try_internal((uint *)(plVar3 + 4));
    if ((char)uVar2 != '\0') {
      if (plVar3[5] == param_1) goto LAB_0001e524;
      (**(code **)(*plVar3 + 0x28))(plVar3);
    }
  }
  plVar3 = (long *)0x0;
LAB_0001e524:
  _IORWLockUnlock(*(undefined8 *)(this + 0x10));
  return plVar3;
}



// IOSurfaceMemoryPool::returnComponentToBucket(OSSharedPtr<IOSurfaceDescriptorComponent>)

ulong __thiscall
IOSurfaceMemoryPool::returnComponentToBucket(IOSurfaceMemoryPool *this,long *param_1)

{
  long *plVar1;
  uint uVar2;
  ulong uVar3;
  IOSurfaceMemoryPool *pIVar4;
  bool bVar5;
  
  plVar1 = (long *)param_1[2];
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x20))(plVar1);
  }
  uVar3 = (**(code **)(*plVar1 + 0x1c8))(plVar1);
  (**(code **)(*plVar1 + 0x28))(plVar1);
  bVar5 = true;
  if (0xfff < uVar3) {
    pIVar4 = this + 0x40;
    uVar2 = 0xffffffff;
    uVar3 = uVar3 >> 0xc;
    do {
      uVar2 = uVar2 + 1;
      pIVar4 = pIVar4 + 8;
      bVar5 = 1 < uVar3;
      uVar3 = uVar3 >> 1;
    } while (bVar5);
    bVar5 = 10 < uVar2;
    if (!bVar5) {
      _IOLockLock(*(undefined8 *)(this + 0x40));
      (**(code **)(**(long **)pIVar4 + 0x1b8))(*(long **)pIVar4,param_1);
      _IOLockUnlock(*(undefined8 *)(this + 0x40));
    }
    if (param_1 == (long *)0x0) goto LAB_0001e5df;
  }
  (**(code **)(*param_1 + 0x28))(param_1);
LAB_0001e5df:
  return (CONCAT71((int7)((ulong)plVar1 >> 8),bVar5) ^ 1) & 0xffffffff;
}



// IOSurfaceDescriptorContext::write_debug_info(OSSharedPtr<OSDictionary>)

ulong __thiscall
IOSurfaceDescriptorContext::write_debug_info(IOSurfaceDescriptorContext *this,long *param_1)

{
  uint uVar1;
  OSSharedPtr *pOVar2;
  long *plVar3;
  OSMetaClassBase *pOVar4;
  IOSurfaceDescriptorComponent *this_00;
  OSSharedPtr *pOVar5;
  ulong uVar6;
  IOSurfaceDescriptorComponent *pIVar7;
  bool bVar8;
  OSSharedPtr *local_38;
  
  uVar1 = (**(code **)(**(long **)(this + 0x28) + 0x130))();
  pOVar2 = (OSSharedPtr *)OSArray::withCapacity(uVar1);
  bVar8 = pOVar2 != (OSSharedPtr *)0x0;
  if (bVar8) {
    local_38 = (OSSharedPtr *)0x0;
    _vm_kernel_addrhide(*(undefined8 *)(this + 0x20),&local_38);
    local_38 = (OSSharedPtr *)OSNumber::withNumber((ulonglong)local_38,0x40);
    OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Descriptor address");
    if (local_38 != (OSSharedPtr *)0x0) {
      (**(code **)(*(long *)local_38 + 0x28))();
    }
    local_38 = (OSSharedPtr *)OSNumber::withNumber(*(ulonglong *)(this + 0x10),0x40);
    OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Pool Id");
    if (local_38 != (OSSharedPtr *)0x0) {
      (**(code **)(*(long *)local_38 + 0x28))();
    }
  }
  plVar3 = (long *)OSCollectionIterator::withCollection(*(OSCollection **)(this + 0x28));
  if (plVar3 == (long *)0x0) {
    if (pOVar2 != (OSSharedPtr *)0x0) goto LAB_0001e78f;
  }
  else {
    pIVar7 = (IOSurfaceDescriptorComponent *)0x0;
    while( true ) {
      pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x128))(plVar3);
      this_00 = (IOSurfaceDescriptorComponent *)
                OSMetaClassBase::safeMetaCast
                          (pOVar4,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass);
      if (this_00 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)this_00 + 0x20))(this_00);
      }
      if (pIVar7 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)pIVar7 + 0x28))(pIVar7);
      }
      if (this_00 == (IOSurfaceDescriptorComponent *)0x0) break;
      pOVar5 = (OSSharedPtr *)OSDictionary::withCapacity(1);
      bVar8 = pOVar5 != (OSSharedPtr *)0x0;
      pIVar7 = this_00;
      if (bVar8) {
        IOSurfaceDescriptorComponent::write_debug_info(this_00,(char *)pOVar5);
        local_38 = pOVar5;
        (**(code **)(*(long *)pOVar5 + 0x20))(pOVar5);
        OSArray::setObject(pOVar2);
        if (local_38 != (OSSharedPtr *)0x0) {
          (**(code **)(*(long *)local_38 + 0x28))();
        }
        (**(code **)(*(long *)pOVar5 + 0x28))(pOVar5);
      }
    }
    (**(code **)(*plVar3 + 0x28))(plVar3);
    if (bVar8) {
LAB_0001e78f:
      local_38 = pOVar2;
      if (pOVar2 != (OSSharedPtr *)0x0) {
        (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
      }
      OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Components");
      if (local_38 != (OSSharedPtr *)0x0) {
        (**(code **)(*(long *)local_38 + 0x28))();
      }
      uVar6 = CONCAT71((int7)((ulong)&local_38 >> 8),1);
      goto LAB_0001e7c8;
    }
  }
  uVar6 = 0;
LAB_0001e7c8:
  if (pOVar2 != (OSSharedPtr *)0x0) {
    (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
  }
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x28))(param_1);
  }
  return uVar6 & 0xffffffff;
}



// IOSurfaceDescriptorComponent::write_debug_info(OSDictionary*)

undefined8 __thiscall
IOSurfaceDescriptorComponent::write_debug_info(IOSurfaceDescriptorComponent *this,char *param_1)

{
  ulonglong uVar1;
  undefined8 uVar2;
  long *local_28;
  
  local_28 = (long *)0x0;
  _vm_kernel_addrhide(*(undefined8 *)(this + 0x10),&local_28);
  local_28 = (long *)OSNumber::withNumber((ulonglong)local_28,0x40);
  OSDictionary::setObject(param_1,(OSSharedPtr *)"Descriptor address");
  if (local_28 != (long *)0x0) {
    (**(code **)(*local_28 + 0x28))();
  }
  uVar1 = (**(code **)(**(long **)(this + 0x10) + 0x1c8))();
  local_28 = (long *)OSNumber::withNumber(uVar1,0x40);
  OSDictionary::setObject(param_1,(OSSharedPtr *)"Length");
  if (local_28 != (long *)0x0) {
    (**(code **)(*local_28 + 0x28))();
  }
  uVar1 = (**(code **)(**(long **)(this + 0x10) + 0x1c8))();
  local_28 = (long *)OSNumber::withNumber(uVar1,0x20);
  uVar2 = OSDictionary::setObject(param_1,(OSSharedPtr *)"Options");
  if (local_28 != (long *)0x0) {
    uVar2 = (**(code **)(*local_28 + 0x28))();
  }
  return CONCAT71((int7)((ulong)uVar2 >> 8),1);
}



// IOSurfaceDescriptorComponent::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptorComponent::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptorComponent",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_0002c540;
  return;
}



// IOSurfaceDescriptorComponent::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptorComponent::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent
          (IOSurfaceDescriptorComponent *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  *(undefined8 *)(this + 0x10) = 0;
  return;
}



// IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent(OSMetaClass const*)

void __thiscall
IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent
          (IOSurfaceDescriptorComponent *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  *(undefined8 *)(this + 0x10) = 0;
  return;
}



// IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent()

void __thiscall
IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent(IOSurfaceDescriptorComponent *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent()

void __thiscall
IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent(IOSurfaceDescriptorComponent *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent()

void __thiscall
IOSurfaceDescriptorComponent::~IOSurfaceDescriptorComponent(IOSurfaceDescriptorComponent *this)

{
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(undefined8 *)(this + 0x10) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceDescriptorComponent_ktv,this,0x18);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceDescriptorComponent::operator delete(void*, unsigned long)

void __cdecl IOSurfaceDescriptorComponent::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceDescriptorComponent_ktv,param_1,param_2);
  return;
}



// IOSurfaceDescriptorComponent::getMetaClass() const

undefined8 * IOSurfaceDescriptorComponent::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceDescriptorComponent::MetaClass::MetaClass()

void __thiscall IOSurfaceDescriptorComponent::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceDescriptorComponent",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x18);
  *(undefined ***)this = &PTR__MetaClass_0002c540;
  return;
}



// IOSurfaceDescriptorComponent::MetaClass::alloc() const

OSObject * IOSurfaceDescriptorComponent::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceDescriptorComponent_ktv,0x18);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceDescriptorComponent::operator new(unsigned long)

void * __thiscall IOSurfaceDescriptorComponent::operator_new(IOSurfaceDescriptorComponent *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceDescriptorComponent_ktv,this);
  return pvVar1;
}



// IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent()

void __thiscall
IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent(IOSurfaceDescriptorComponent *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent()

void __thiscall
IOSurfaceDescriptorComponent::IOSurfaceDescriptorComponent(IOSurfaceDescriptorComponent *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceDescriptorComponent_0002c410;
  *(undefined8 *)(this + 0x10) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceDescriptorComponent::init(unsigned int, unsigned long long)

bool __thiscall
IOSurfaceDescriptorComponent::init(IOSurfaceDescriptorComponent *this,uint param_1,ulong param_2)

{
  long *plVar1;
  
  (**(code **)(PTR_vtable_00027078 + 0x98))();
  *(uint *)(this + 0xc) = param_1;
  plVar1 = (long *)IOBufferMemoryDescriptor::inTaskWithOptions((task *)0x0,param_1,param_2,1);
  if (*(long **)(this + 0x10) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x10) + 0x28))();
  }
  *(long **)(this + 0x10) = plVar1;
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x1f0))(plVar1,0);
  }
  return plVar1 != (long *)0x0;
}



// IOSurfaceDescriptorComponent::free()

void __thiscall IOSurfaceDescriptorComponent::free(IOSurfaceDescriptorComponent *this)

{
  long *plVar1;
  
  plVar1 = *(long **)(this + 0x10);
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x1f8))(plVar1,0);
    if (*(long **)(this + 0x10) != (long *)0x0) {
      (**(code **)(**(long **)(this + 0x10) + 0x28))();
    }
  }
  *(undefined8 *)(this + 0x10) = 0;
                    // WARNING: Could not recover jumptable at 0x0001ec08. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceMemoryPoolBunch::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryPoolBunch::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryPoolBunch",(OSMetaClass *)PTR_gMetaClass_00027048,
             0x48);
  *(undefined ***)this = &PTR__MetaClass_0002c768;
  return;
}



// IOSurfaceMemoryPoolBunch::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryPoolBunch::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch
          (IOSurfaceMemoryPoolBunch *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPoolBunch_0002c638;
  return;
}



// IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch
          (IOSurfaceMemoryPoolBunch *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPoolBunch_0002c638;
  return;
}



// IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch()

void __thiscall IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch(IOSurfaceMemoryPoolBunch *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch()

void __thiscall IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch(IOSurfaceMemoryPoolBunch *this)

{
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch()

void __thiscall IOSurfaceMemoryPoolBunch::~IOSurfaceMemoryPoolBunch(IOSurfaceMemoryPoolBunch *this)

{
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceMemoryPoolBunch_ktv,this,0x48);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryPoolBunch::operator delete(void*, unsigned long)

void __cdecl IOSurfaceMemoryPoolBunch::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceMemoryPoolBunch_ktv,param_1,param_2);
  return;
}



// IOSurfaceMemoryPoolBunch::getMetaClass() const

undefined8 * IOSurfaceMemoryPoolBunch::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceMemoryPoolBunch::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryPoolBunch::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryPoolBunch",(OSMetaClass *)PTR_gMetaClass_00027048,
             0x48);
  *(undefined ***)this = &PTR__MetaClass_0002c768;
  return;
}



// IOSurfaceMemoryPoolBunch::MetaClass::alloc() const

OSObject * IOSurfaceMemoryPoolBunch::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceMemoryPoolBunch_ktv,0x48);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceMemoryPoolBunch::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPoolBunch_0002c638;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceMemoryPoolBunch::operator new(unsigned long)

void * __thiscall IOSurfaceMemoryPoolBunch::operator_new(IOSurfaceMemoryPoolBunch *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceMemoryPoolBunch_ktv,this);
  return pvVar1;
}



// IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch()

void __thiscall IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch(IOSurfaceMemoryPoolBunch *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPoolBunch_0002c638;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch()

void __thiscall IOSurfaceMemoryPoolBunch::IOSurfaceMemoryPoolBunch(IOSurfaceMemoryPoolBunch *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPoolBunch_0002c638;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryPoolBunch::init()

bool __thiscall IOSurfaceMemoryPoolBunch::init(IOSurfaceMemoryPoolBunch *this)

{
  undefined8 uVar1;
  long lVar2;
  
  (**(code **)(PTR_vtable_00027078 + 0x98))();
  *(undefined8 *)(this + 0x40) = 1;
  uVar1 = _IORWLockAlloc();
  *(undefined8 *)(this + 0x10) = uVar1;
  lVar2 = _IORWLockAlloc();
  *(long *)(this + 0x18) = lVar2;
  *(undefined8 *)(this + 0x20) = 0;
  *(IOSurfaceMemoryPoolBunch **)(this + 0x28) = this + 0x20;
  *(undefined8 *)(this + 0x30) = 0;
  *(IOSurfaceMemoryPoolBunch **)(this + 0x38) = this + 0x30;
  return lVar2 != 0 && *(long *)(this + 0x10) != 0;
}



// IOSurfaceMemoryPoolBunch::free()

void __thiscall IOSurfaceMemoryPoolBunch::free(IOSurfaceMemoryPoolBunch *this)

{
  if (*(long *)(this + 0x10) != 0) {
    _IORWLockFree();
  }
  if (*(long *)(this + 0x18) != 0) {
    _IORWLockFree();
  }
                    // WARNING: Could not recover jumptable at 0x0001ee6f. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceMemoryPoolBunch::newMemoryPool(OSSharedPtr<OSDictionary>, task*)

IOSurfaceMemoryPool * __thiscall
IOSurfaceMemoryPoolBunch::newMemoryPool
          (IOSurfaceMemoryPoolBunch *this,long *param_1,undefined8 param_2)

{
  IOSurfaceMemoryPoolBunch *pIVar1;
  long lVar2;
  IOSurfaceMemoryPool *this_00;
  ulong uVar3;
  
  if (*(long *)(this + 0x40) == 0) {
    this_00 = (IOSurfaceMemoryPool *)0x0;
    _IOLog("Memory pool ids exhausted");
  }
  else {
    LOCK();
    pIVar1 = this + 0x40;
    lVar2 = *(long *)pIVar1;
    *(long *)pIVar1 = *(long *)pIVar1 + 1;
    UNLOCK();
    this_00 = (IOSurfaceMemoryPool *)
              (**(code **)(IOSurfaceMemoryPool::gMetaClass + 0x88))
                        (&IOSurfaceMemoryPool::gMetaClass);
    if (this_00 != (IOSurfaceMemoryPool *)0x0) {
      if (param_1 != (long *)0x0) {
        (**(code **)(*param_1 + 0x20))(param_1);
      }
      (**(code **)(*(long *)this + 0x20))(this);
      uVar3 = IOSurfaceMemoryPool::init(this_00,lVar2,param_1,param_2,(long *)this);
      if ((char)uVar3 != '\0') {
        (**(code **)(*(long *)this_00 + 0x20))(this_00);
        addPool(this,(long *)this_00);
        goto LAB_0001ef1f;
      }
      (**(code **)(*(long *)this_00 + 0x28))(this_00);
    }
    this_00 = (IOSurfaceMemoryPool *)0x0;
  }
LAB_0001ef1f:
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x28))(param_1);
  }
  return this_00;
}



// IOSurfaceMemoryPool::init(unsigned long long, OSSharedPtr<OSDictionary>, task*,
// OSSharedPtr<IOSurfaceMemoryPoolBunch>)

ulong __thiscall
IOSurfaceMemoryPool::init
          (IOSurfaceMemoryPool *this,undefined8 param_1,long *param_2,undefined8 param_3,
          long *param_4)

{
  OSMetaClass *pOVar1;
  long *plVar2;
  IOSurfaceMemoryPool IVar3;
  undefined8 uVar4;
  long lVar5;
  ulong uVar6;
  OSMetaClassBase *pOVar7;
  long *plVar8;
  long *plVar9;
  long *plVar10;
  long lVar11;
  
  (**(code **)(PTR_vtable_00027078 + 0x98))();
  plVar8 = *(long **)(this + 0x38);
  *(long **)(this + 0x38) = param_4;
  if (param_4 != (long *)0x0) {
    (**(code **)(*param_4 + 0x20))(param_4);
  }
  if (plVar8 != (long *)0x0) {
    (**(code **)(*plVar8 + 0x28))(plVar8);
  }
  _iosfc_ref_init_count_internal((uint *)(this + 0x20),1);
  *(undefined8 *)(this + 0x90) = 0;
  *(undefined8 *)(this + 0x88) = 0;
  *(undefined8 *)(this + 0x80) = 0;
  *(undefined8 *)(this + 0x78) = 0;
  *(undefined8 *)(this + 0x70) = 0;
  *(undefined8 *)(this + 0x68) = 0;
  *(undefined8 *)(this + 0x60) = 0;
  *(undefined8 *)(this + 0x58) = 0;
  *(undefined8 *)(this + 0x50) = 0;
  *(undefined8 *)(this + 0x48) = 0;
  *(undefined8 *)(this + 0x30) = param_3;
  *(undefined8 *)(this + 0x28) = param_1;
  uVar4 = _IOLockAlloc();
  *(undefined8 *)(this + 0x40) = uVar4;
  plVar8 = *(long **)(this + 0x98);
  *(long **)(this + 0x98) = param_2;
  if (param_2 != (long *)0x0) {
    (**(code **)(*param_2 + 0x20))(param_2);
  }
  if (plVar8 != (long *)0x0) {
    (**(code **)(*plVar8 + 0x28))(plVar8);
  }
  *(undefined2 *)(this + 0xa0) = 0x101;
  if (*(long **)(this + 0xa8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xa8) + 0x28))();
  }
  *(undefined8 *)(this + 0xa8) = 0;
  if (*(long *)(this + 0x40) == 0) {
LAB_0001f1e7:
    uVar6 = 0;
  }
  else {
    lVar11 = 9;
    do {
      lVar5 = OSArray::withCapacity(1);
      if (*(long **)(this + lVar11 * 8) != (long *)0x0) {
        (**(code **)(**(long **)(this + lVar11 * 8) + 0x28))();
      }
      *(long *)(this + lVar11 * 8) = lVar5;
      if (lVar5 == 0) goto LAB_0001f1e7;
      lVar11 = lVar11 + 1;
    } while (lVar11 != 0x13);
    plVar8 = *(long **)(this + 0x98);
    uVar6 = CONCAT71((int7)((ulong)lVar5 >> 8),1);
    if (plVar8 != (long *)0x0) {
      lVar11 = (**(code **)(*plVar8 + 0x208))(plVar8,"IOSurfaceMemoryPoolSize");
      if (lVar11 != 0) {
        if (param_2 != (long *)0x0) {
          (**(code **)(*param_2 + 0x20))(param_2);
        }
        uVar6 = ensureMemory(this,param_2);
        if ((char)uVar6 == '\0') {
          _IOLog("Unable to pre-allocate IOSurfaceMemoryPool memory for pool id %llu\n",param_1);
        }
      }
      pOVar7 = (OSMetaClassBase *)
               (**(code **)(*param_2 + 0x208))(param_2,"IOSurfaceMemoryPoolZerofillEnabled");
      pOVar1 = *(OSMetaClass **)PTR_metaClass_00027068;
      plVar8 = (long *)OSMetaClassBase::safeMetaCast(pOVar7,pOVar1);
      if (plVar8 != (long *)0x0) {
        (**(code **)(*plVar8 + 0x20))(plVar8);
        IVar3 = (IOSurfaceMemoryPool)(**(code **)(*plVar8 + 0x128))(plVar8);
        this[0xa0] = IVar3;
      }
      pOVar7 = (OSMetaClassBase *)
               (**(code **)(*param_2 + 0x208))(param_2,"IOSurfaceMemoryPoolCacheModeSwitchEnabled");
      plVar9 = (long *)OSMetaClassBase::safeMetaCast(pOVar7,pOVar1);
      if (plVar9 != (long *)0x0) {
        (**(code **)(*plVar9 + 0x20))(plVar9);
        IVar3 = (IOSurfaceMemoryPool)(**(code **)(*plVar9 + 0x128))(plVar9);
        this[0xa1] = IVar3;
      }
      pOVar7 = (OSMetaClassBase *)
               (**(code **)(*param_2 + 0x208))(param_2,"IOSurfaceMemoryPoolEntitlement");
      plVar10 = (long *)OSMetaClassBase::safeMetaCast
                                  (pOVar7,*(OSMetaClass **)PTR_metaClass_00027058);
      plVar2 = *(long **)(this + 0xa8);
      *(long **)(this + 0xa8) = plVar10;
      if (plVar10 != (long *)0x0) {
        (**(code **)(*plVar10 + 0x20))(plVar10);
      }
      if (plVar2 != (long *)0x0) {
        (**(code **)(*plVar2 + 0x28))(plVar2);
      }
      if (plVar9 != (long *)0x0) {
        (**(code **)(*plVar9 + 0x28))(plVar9);
      }
      if (plVar8 != (long *)0x0) {
        (**(code **)(*plVar8 + 0x28))();
      }
      uVar6 = CONCAT71((int7)((ulong)plVar9 >> 8),1);
    }
  }
  if (param_4 != (long *)0x0) {
    (**(code **)(*param_4 + 0x28))(param_4);
  }
  if (param_2 != (long *)0x0) {
    (**(code **)(*param_2 + 0x28))(param_2);
  }
  return uVar6 & 0xffffffff;
}



// IOSurfaceMemoryPoolBunch::addPool(OSSharedPtr<IOSurfaceMemoryPool>)

undefined8 __thiscall
IOSurfaceMemoryPoolBunch::addPool(IOSurfaceMemoryPoolBunch *this,long *param_1)

{
  undefined8 *puVar1;
  undefined8 uVar2;
  
  _IORWLockWrite(*(undefined8 *)(this + 0x10));
  param_1[2] = 0;
  puVar1 = *(undefined8 **)(this + 0x28);
  param_1[3] = (long)puVar1;
  *puVar1 = param_1;
  *(long **)(this + 0x28) = param_1 + 2;
  _IORWLockUnlock(*(undefined8 *)(this + 0x10));
  uVar2 = (**(code **)(*param_1 + 0x28))(param_1);
  return CONCAT71((int7)((ulong)uVar2 >> 8),1);
}



// IOSurfaceMemoryPoolBunch::addContext(OSSharedPtr<IOSurfaceDescriptorContext>)

undefined8 __thiscall
IOSurfaceMemoryPoolBunch::addContext(IOSurfaceMemoryPoolBunch *this,long *param_1)

{
  undefined8 *puVar1;
  undefined8 uVar2;
  
  _IORWLockWrite(*(undefined8 *)(this + 0x18));
  param_1[6] = 0;
  puVar1 = *(undefined8 **)(this + 0x38);
  param_1[7] = (long)puVar1;
  *puVar1 = param_1;
  *(long **)(this + 0x38) = param_1 + 6;
  _IORWLockUnlock(*(undefined8 *)(this + 0x18));
  uVar2 = (**(code **)(*param_1 + 0x28))(param_1);
  return CONCAT71((int7)((ulong)uVar2 >> 8),1);
}



// IOSurfaceMemoryPool::tryRetain() const

void __thiscall IOSurfaceMemoryPool::tryRetain(IOSurfaceMemoryPool *this)

{
  _iosfc_ref_retain_try_internal((uint *)(this + 0x20));
  return;
}



// IOSurfaceMemoryPoolBunch::removePool(IOSurfaceMemoryPool*)

undefined8 __thiscall
IOSurfaceMemoryPoolBunch::removePool(IOSurfaceMemoryPoolBunch *this,long param_1)

{
  long lVar1;
  undefined8 uVar2;
  long *plVar3;
  char *pcVar4;
  
  _IORWLockWrite(*(undefined8 *)(this + 0x10));
  lVar1 = *(long *)(param_1 + 0x10);
  if (lVar1 == 0) {
    plVar3 = *(long **)(param_1 + 0x18);
    if (plVar3 == (long *)0x0) goto LAB_0001f30b;
    if (*plVar3 != param_1) goto LAB_0001f31b;
    *(long **)(this + 0x28) = plVar3;
  }
  else {
    if (*(long *)(lVar1 + 0x18) != param_1 + 0x10) {
      pcVar4 = "\"Bad tailq elm %p next->prev != elm @%u\" @%s:%d";
      goto LAB_0001f32b;
    }
    if (**(long **)(param_1 + 0x18) != param_1) {
LAB_0001f31b:
      pcVar4 = "\"Bad tailq elm %p prev->next != elm @%u\" @%s:%d";
LAB_0001f32b:
                    // WARNING: Subroutine does not return
      _panic(pcVar4,param_1,0x125,"IOSurfaceMemoryPool.cpp",0x125);
    }
    *(long **)(lVar1 + 0x18) = *(long **)(param_1 + 0x18);
    plVar3 = *(long **)(param_1 + 0x18);
  }
  *plVar3 = lVar1;
LAB_0001f30b:
  uVar2 = _IORWLockUnlock(*(undefined8 *)(this + 0x10));
  return CONCAT71((int7)((ulong)uVar2 >> 8),1);
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryPoolBunch::newWiredMemoryDescriptorWithLength(unsigned long long, unsigned int,
// unsigned long long, task*, bool)

long * __cdecl
IOSurfaceMemoryPoolBunch::newWiredMemoryDescriptorWithLength
          (IOSurfaceMemoryPoolBunch *param_1,ulong param_2,uint param_3,long param_4,
          undefined8 param_5,uint param_6)

{
  IOSurfaceMemoryPool *this;
  long *plVar1;
  
  this = (IOSurfaceMemoryPool *)getPool(param_1,param_4);
  if (this == (IOSurfaceMemoryPool *)0x0) {
    plVar1 = (long *)0x0;
  }
  else {
    if (param_1 != (IOSurfaceMemoryPoolBunch *)0x0) {
      (**(code **)(*(long *)param_1 + 0x20))(param_1);
    }
    plVar1 = IOSurfaceMemoryPool::newWiredMemoryDescriptorWithLength
                       (this,param_2,param_3,param_4,param_1,param_6 & 0xff);
    (**(code **)(*(long *)this + 0x28))(this);
  }
  return plVar1;
}



// IOSurfaceMemoryPool::newWiredMemoryDescriptorWithLength(unsigned long, unsigned int, task*,
// OSSharedPtr<IOSurfaceMemoryPoolBunch>, bool)

long * __thiscall
IOSurfaceMemoryPool::newWiredMemoryDescriptorWithLength
          (IOSurfaceMemoryPool *this,ulong param_1,uint param_2,undefined8 param_3,
          IOSurfaceMemoryPoolBunch *param_4,undefined4 param_5)

{
  IOSurfaceDescriptorContext *pIVar1;
  OSCollection *pOVar2;
  ulong uVar3;
  OSMetaClassBase *pOVar4;
  long *plVar5;
  long *plVar6;
  undefined8 uVar7;
  ulong uVar8;
  uint uVar9;
  long lVar10;
  uint uVar11;
  char cVar12;
  ulong uVar13;
  long *plVar14;
  bool bVar15;
  IOMemoryDescriptor *local_80;
  ulong local_78;
  IOSurfaceMemoryPoolBunch *local_70;
  long local_68;
  ulong local_60;
  long *local_58;
  IOSurfaceMemoryPool *local_50;
  IOSurfaceDescriptorContext *local_48;
  OSMetaClassBase *local_40;
  uint local_38;
  undefined4 local_34;
  
  local_50 = this;
  local_38 = param_2;
  pOVar2 = (OSCollection *)OSArray::withCapacity(1);
  if (pOVar2 == (OSCollection *)0x0) {
    plVar6 = (long *)0x0;
    goto LAB_0001f615;
  }
  if (param_1 == 0) {
LAB_0001f4b6:
    uVar11 = (**(code **)(*(long *)pOVar2 + 0x130))(pOVar2);
    uVar13 = (ulong)uVar11;
    local_48 = (IOSurfaceDescriptorContext *)
               _IOMallocTypeVarImpl
                         (&newWiredMemoryDescriptorWithLength(unsigned_long,unsigned_int,task*,OSSharedPtr<>,bool)
                           ::kalloc_type_view_676,uVar13 * 8);
    if (local_48 == (IOSurfaceDescriptorContext *)0x0) {
LAB_0001f609:
      plVar6 = (long *)0x0;
    }
    else {
      local_68 = uVar13 * 8;
      local_40 = (OSMetaClassBase *)OSCollectionIterator::withCollection(pOVar2);
      local_70 = param_4;
      local_34 = param_5;
      if (local_40 != (OSMetaClassBase *)0x0) {
        local_78 = (long)(local_48 + uVar13 * 8) - (long)local_48;
        local_58 = (long *)CONCAT71(local_58._1_7_,
                                    local_78 >> 0x20 != 0 || local_48 + uVar13 * 8 < local_48);
        uVar3 = 0;
        lVar10 = 0x10000000;
        plVar6 = (long *)0x0;
        local_60 = uVar13;
        while( true ) {
          pOVar4 = (OSMetaClassBase *)(**(code **)(*(long *)local_40 + 0x128))();
          plVar5 = (long *)OSMetaClassBase::safeMetaCast
                                     (pOVar4,(OSMetaClass *)
                                             &IOSurfaceDescriptorComponent::gMetaClass);
          if (plVar5 != (long *)0x0) {
            (**(code **)(*plVar5 + 0x20))(plVar5);
          }
          if (plVar6 != (long *)0x0) {
            (**(code **)(*plVar6 + 0x28))(plVar6);
          }
          if (plVar5 == (long *)0x0) break;
          plVar6 = (long *)plVar5[2];
          if (plVar6 != (long *)0x0) {
            (**(code **)(*plVar6 + 0x20))(plVar6);
          }
          if ((char)local_58 != '\0') {
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "The range of valid memory is too large to be represented by this type, or [begin, end) is not a well-formed range"
                      );
          }
          bVar15 = lVar10 == 0;
          lVar10 = lVar10 + -1;
          if (bVar15) {
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "bounded_ptr<T>::operator+=(n): Adding the specified number of bytes to the offset representing the current position would overflow."
                      );
          }
          if (((long)uVar3 < 0) || ((uint)local_78 < (int)(uVar3 >> 0x20) + 8U)) {
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "bounded_ptr<T>::operator*: Dereferencing this pointer would access memory outside of the bounds set originally"
                      );
          }
          uVar8 = (ulong)CARRY8(uVar3 >> 0x20,(ulong)local_48);
          uVar13 = -uVar8;
          if ((uVar8 != uVar13) || ((long)uVar13 < 0)) {
                    // WARNING: Subroutine does not return
            os_detail::panic_trapping_policy::trap
                      (
                      "This bounded_ptr is pointing to memory outside of what can be represented by a native pointer."
                      );
          }
          *(long **)(local_48 + (uVar3 >> 0x20)) = plVar6;
          if (plVar6 != (long *)0x0) {
            (**(code **)(*plVar6 + 0x28))(plVar6);
          }
          uVar3 = uVar3 + 0x800000000;
          plVar6 = plVar5;
        }
        (**(code **)(*(long *)local_40 + 0x28))();
        uVar11 = (uint)local_60;
      }
      pIVar1 = local_48;
      cVar12 = (char)local_34;
      uVar9 = local_38 & 7;
      pOVar4 = (OSMetaClassBase *)
               IOMultiMemoryDescriptor::withDescriptors
                         ((IOMemoryDescriptor **)local_48,uVar11,uVar9,false);
      param_4 = local_70;
      _IOFreeTypeVarImpl(&newWiredMemoryDescriptorWithLength(unsigned_long,unsigned_int,task*,OSSharedPtr<>,bool)
                          ::kalloc_type_view_692,pIVar1,local_68);
      local_40 = pOVar4;
      local_80 = (IOMemoryDescriptor *)
                 OSMetaClassBase::safeMetaCast(pOVar4,*(OSMetaClass **)PTR_metaClass_00027028);
      plVar6 = (long *)IOMultiMemoryDescriptor::withDescriptors(&local_80,1,uVar9,false);
      local_48 = (IOSurfaceDescriptorContext *)
                 (**(code **)(IOSurfaceDescriptorContext::gMetaClass + 0x88))
                           (&IOSurfaceDescriptorContext::gMetaClass);
      (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
      uVar7 = *(undefined8 *)(local_50 + 0x28);
      if (param_4 != (IOSurfaceMemoryPoolBunch *)0x0) {
        (**(code **)(*(long *)param_4 + 0x20))(param_4);
      }
      pIVar1 = local_48;
      IOSurfaceDescriptorContext::init(local_48,plVar6,(long *)pOVar2,uVar7,(long *)param_4);
      OSMetaClassBase::safeMetaCast
                ((OSMetaClassBase *)pIVar1,*(OSMetaClass **)PTR_metaClass_00027050);
      IOMemoryDescriptor::setContext((OSObject *)local_40);
      if (pIVar1 != (IOSurfaceDescriptorContext *)0x0) {
        (**(code **)(*(long *)pIVar1 + 0x20))(pIVar1);
      }
      IOSurfaceMemoryPoolBunch::addContext(param_4,(long *)pIVar1);
      plVar5 = (long *)OSCollectionIterator::withCollection(pOVar2);
      if (plVar5 != (long *)0x0) {
        plVar14 = (long *)0x0;
        local_58 = plVar6;
        while( true ) {
          pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar5 + 0x128))(plVar5);
          plVar6 = (long *)OSMetaClassBase::safeMetaCast
                                     (pOVar4,(OSMetaClass *)
                                             &IOSurfaceDescriptorComponent::gMetaClass);
          if (plVar6 != (long *)0x0) {
            (**(code **)(*plVar6 + 0x20))(plVar6);
          }
          if (plVar14 != (long *)0x0) {
            (**(code **)(*plVar14 + 0x28))(plVar14);
          }
          if (plVar6 == (long *)0x0) break;
          *(uint *)((long)plVar6 + 0xc) = local_38;
          plVar14 = plVar6;
        }
        (**(code **)(*plVar5 + 0x28))(plVar5);
        cVar12 = (char)local_34;
        plVar6 = local_58;
      }
      pOVar4 = local_40;
      if (cVar12 == '\0') {
        if (plVar6 != (long *)0x0) goto LAB_0001f7fd;
        bVar15 = true;
      }
      else {
        if (local_50[0xa0] == (IOSurfaceMemoryPool)0x0) {
          uVar13 = (**(code **)(*plVar6 + 0x1c8))(plVar6);
          if (0x2000 < uVar13) goto LAB_0001f7fd;
        }
        uVar7 = (**(code **)(*plVar6 + 0x1c8))(plVar6);
        (**(code **)(*plVar6 + 0x1e8))(plVar6,0,0,uVar7);
LAB_0001f7fd:
        (**(code **)(*plVar6 + 0x20))(plVar6);
        bVar15 = false;
      }
      if (local_48 != (IOSurfaceDescriptorContext *)0x0) {
        (**(code **)(*(IOMemoryDescriptor **)local_48 + 0x28))();
      }
      if (!bVar15) {
        (**(code **)(*plVar6 + 0x28))(plVar6);
      }
      if (pOVar4 != (OSMetaClassBase *)0x0) {
        (**(code **)(*(long *)pOVar4 + 0x28))(pOVar4);
      }
    }
  }
  else {
    uVar11 = 9;
    local_34 = param_5;
    do {
      uVar13 = (ulong)(0x1000 << ((byte)uVar11 & 0x1f));
      for (; param_5 = local_34, uVar13 <= param_1; param_1 = param_1 - uVar13) {
        (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
        uVar3 = getComponentsFromBucket
                          (local_50,uVar11,(ulong)local_38,(OSSharedPtr *)pOVar2,'\x01');
        if ((char)uVar3 == '\0') goto LAB_0001f609;
      }
      bVar15 = uVar11 != 0;
      uVar11 = uVar11 - 1;
    } while ((bVar15) && (param_1 != 0));
    if (param_1 < 0x1001) {
      if (param_1 != 0) {
        plVar6 = (long *)0x0;
        _IOLog("Descriptor length isn\'t rounded to bucket size");
        (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
        uVar13 = getComponentsFromBucket(local_50,0,(ulong)local_38,(OSSharedPtr *)pOVar2,'\x01');
        if ((char)uVar13 == '\0') goto LAB_0001f60c;
      }
      goto LAB_0001f4b6;
    }
    plVar6 = (long *)0x0;
    _IOLog("Unable to assemble descriptor of the correct length");
  }
LAB_0001f60c:
  (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
LAB_0001f615:
  if (param_4 != (IOSurfaceMemoryPoolBunch *)0x0) {
    (**(code **)(*(long *)param_4 + 0x28))(param_4);
  }
  return plVar6;
}



// IOSurfaceMemoryPoolBunch::writeContextsDebugInfoArray(OSSharedPtr<OSDictionary>)

ulong __thiscall
IOSurfaceMemoryPoolBunch::writeContextsDebugInfoArray(IOSurfaceMemoryPoolBunch *this,long *param_1)

{
  IOSurfaceDescriptorContext *pIVar1;
  OSSharedPtr *pOVar2;
  OSSharedPtr *pOVar3;
  ulong uVar4;
  IOSurfaceDescriptorContext *this_00;
  char cVar5;
  OSSharedPtr *local_38;
  
  pOVar2 = (OSSharedPtr *)OSArray::withCapacity(1);
  if (pOVar2 == (OSSharedPtr *)0x0) {
    uVar4 = 0;
    goto LAB_0001f98f;
  }
  _IORWLockRead(*(undefined8 *)(this + 0x18));
  this_00 = *(IOSurfaceDescriptorContext **)(this + 0x30);
  if (this_00 == (IOSurfaceDescriptorContext *)0x0) {
    _IORWLockUnlock(*(undefined8 *)(this + 0x18));
LAB_0001f954:
    local_38 = pOVar2;
    (**(code **)(*(long *)pOVar2 + 0x20))(pOVar2);
    OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Contexts");
    if (local_38 != (OSSharedPtr *)0x0) {
      (**(code **)(*(long *)local_38 + 0x28))();
    }
    uVar4 = CONCAT71((int7)((ulong)&local_38 >> 8),1);
  }
  else {
    do {
      pIVar1 = *(IOSurfaceDescriptorContext **)(this_00 + 0x30);
      pOVar3 = (OSSharedPtr *)OSDictionary::withCapacity(1);
      if (pOVar3 == (OSSharedPtr *)0x0) {
        cVar5 = '\0';
      }
      else {
        (**(code **)(*(long *)pOVar3 + 0x20))(pOVar3);
        uVar4 = IOSurfaceDescriptorContext::write_debug_info(this_00,(long *)pOVar3);
        cVar5 = (char)uVar4;
        if (cVar5 != '\0') {
          local_38 = pOVar3;
          (**(code **)(*(long *)pOVar3 + 0x20))(pOVar3);
          OSArray::setObject(pOVar2);
          if (local_38 != (OSSharedPtr *)0x0) {
            (**(code **)(*(long *)local_38 + 0x28))();
          }
        }
        (**(code **)(*(long *)pOVar3 + 0x28))(pOVar3);
      }
      this_00 = pIVar1;
    } while (pIVar1 != (IOSurfaceDescriptorContext *)0x0);
    _IORWLockUnlock(*(undefined8 *)(this + 0x18));
    if (cVar5 != '\0') goto LAB_0001f954;
    uVar4 = 0;
  }
  (**(code **)(*(long *)pOVar2 + 0x28))(pOVar2);
LAB_0001f98f:
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x28))(param_1);
  }
  return uVar4 & 0xffffffff;
}



// IOSurfaceMemoryPoolBunch::write_debug_info(OSSharedPtr<OSDictionary>)

ulong __thiscall
IOSurfaceMemoryPoolBunch::write_debug_info(IOSurfaceMemoryPoolBunch *this,long *param_1)

{
  ulong uVar1;
  
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
    uVar1 = write_debug_info(this,param_1,0);
    (**(code **)(*param_1 + 0x28))(param_1);
    return uVar1 & 0xffffffff;
  }
  uVar1 = write_debug_info(this,(long *)0x0,0);
  return uVar1;
}



// IOSurfaceMemoryPoolBunch::write_debug_info(OSSharedPtr<OSDictionary>, unsigned long long)

ulong __thiscall
IOSurfaceMemoryPoolBunch::write_debug_info
          (IOSurfaceMemoryPoolBunch *this,long *param_1,long param_2)

{
  IOSurfaceMemoryPool *pIVar1;
  IOSurfaceDescriptorContext *pIVar2;
  IOSurfaceMemoryPool *this_00;
  IOSurfaceMemoryPoolBunch *pIVar3;
  long *plVar4;
  long *plVar5;
  undefined8 uVar6;
  ulong uVar7;
  IOSurfaceDescriptorContext *this_01;
  long *local_60;
  long *local_58;
  long *local_50;
  long *local_48;
  IOSurfaceMemoryPoolBunch *local_40;
  long *local_38;
  
  plVar4 = (long *)OSArray::withCapacity(1);
  plVar5 = (long *)OSArray::withCapacity(1);
  if (plVar4 == (long *)0x0) {
LAB_0001fbc1:
    uVar7 = CONCAT71((int7)((ulong)this >> 8),plVar4 != (long *)0x0);
    if (plVar5 != (long *)0x0) {
LAB_0001fc32:
      (**(code **)(*plVar5 + 0x28))();
    }
    if (plVar4 == (long *)0x0) goto LAB_0001fc47;
  }
  else {
    if (plVar5 != (long *)0x0) {
      local_48 = plVar5;
      local_38 = (long *)OSArray::withCapacity(1);
      _IORWLockRead(*(undefined8 *)(this + 0x10));
      pIVar1 = *(IOSurfaceMemoryPool **)(this + 0x20);
      local_40 = this;
      local_58 = param_1;
      local_50 = plVar4;
      this = (IOSurfaceMemoryPoolBunch *)CONCAT71((int7)((ulong)this >> 8),1);
      plVar4 = local_38;
      while (this_00 = pIVar1, this_00 != (IOSurfaceMemoryPool *)0x0) {
        pIVar1 = *(IOSurfaceMemoryPool **)(this_00 + 0x10);
        uVar6 = _iosfc_ref_retain_try_internal((uint *)(this_00 + 0x20));
        if ((char)uVar6 != '\0') {
          (**(code **)(*plVar4 + 0x1b8))(plVar4,this_00);
          if ((param_2 == 0) || (*(long *)(this_00 + 0x28) == param_2)) {
            plVar4 = (long *)OSDictionary::withCapacity(1);
            if (plVar4 == (long *)0x0) {
              this = (IOSurfaceMemoryPoolBunch *)0x0;
              plVar4 = local_38;
            }
            else {
              (**(code **)(*plVar4 + 0x20))(plVar4);
              uVar7 = IOSurfaceMemoryPool::write_debug_info(this_00,plVar4);
              this = (IOSurfaceMemoryPoolBunch *)(uVar7 & 0xffffffff);
              if ((char)uVar7 != '\0') {
                (**(code **)(*local_50 + 0x1b8))(local_50,plVar4);
              }
              (**(code **)(*plVar4 + 0x28))(plVar4);
              plVar4 = local_38;
            }
          }
          (**(code **)(*(long *)this_00 + 0x28))(this_00);
        }
      }
      _IORWLockUnlock(*(undefined8 *)(local_40 + 0x10));
      if (plVar4 != (long *)0x0) {
        (**(code **)(*plVar4 + 0x28))(plVar4);
      }
      pIVar3 = local_40;
      _IORWLockRead(*(undefined8 *)(local_40 + 0x18));
      pIVar2 = *(IOSurfaceDescriptorContext **)(pIVar3 + 0x30);
      while (this_01 = pIVar2, this_01 != (IOSurfaceDescriptorContext *)0x0) {
        pIVar2 = *(IOSurfaceDescriptorContext **)(this_01 + 0x30);
        if ((param_2 == 0) || (*(long *)(this_01 + 0x10) == param_2)) {
          plVar4 = (long *)OSDictionary::withCapacity(1);
          if (plVar4 == (long *)0x0) {
            this = (IOSurfaceMemoryPoolBunch *)0x0;
          }
          else {
            (**(code **)(*plVar4 + 0x20))(plVar4);
            uVar7 = IOSurfaceDescriptorContext::write_debug_info(this_01,plVar4);
            this = (IOSurfaceMemoryPoolBunch *)(uVar7 & 0xffffffff);
            if ((char)uVar7 != '\0') {
              (**(code **)(*local_48 + 0x1b8))(local_48,plVar4);
            }
            (**(code **)(*plVar4 + 0x28))(plVar4);
          }
        }
      }
      _IORWLockUnlock(*(undefined8 *)(local_40 + 0x18));
      plVar4 = local_50;
      param_1 = local_58;
      plVar5 = local_48;
      if (((ulong)this & 1) == 0) goto LAB_0001fbc1;
      local_60 = local_48;
      (**(code **)(*local_48 + 0x20))();
      OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"InUse");
      if (local_60 != (long *)0x0) {
        (**(code **)(*local_60 + 0x28))();
      }
      local_60 = plVar4;
      (**(code **)(*plVar4 + 0x20))(plVar4);
      OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"OutOfUse");
      if (local_60 != (long *)0x0) {
        (**(code **)(*local_60 + 0x28))();
      }
      uVar7 = CONCAT71((int7)((ulong)&local_60 >> 8),1);
      plVar5 = local_48;
      goto LAB_0001fc32;
    }
    uVar7 = 0;
  }
  (**(code **)(*plVar4 + 0x28))(plVar4);
LAB_0001fc47:
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x28))(param_1);
  }
  return uVar7 & 0xffffffff;
}



// IOSurfaceMemoryPool::write_debug_info(OSSharedPtr<OSDictionary>)

ulong __thiscall IOSurfaceMemoryPool::write_debug_info(IOSurfaceMemoryPool *this,long *param_1)

{
  uint uVar1;
  OSSharedPtr *pOVar2;
  long *plVar3;
  OSSharedPtr *pOVar4;
  long *plVar5;
  OSMetaClassBase *pOVar6;
  IOSurfaceDescriptorComponent *this_00;
  long *plVar7;
  ulong uVar8;
  IOSurfaceDescriptorComponent *pIVar9;
  ulong unaff_R15;
  bool bVar10;
  bool bVar11;
  bool bVar12;
  
  pOVar2 = (OSSharedPtr *)OSArray::withCapacity(10);
  if (pOVar2 == (OSSharedPtr *)0x0) {
    unaff_R15 = 0;
  }
  else {
    _IOLockLock(*(undefined8 *)(this + 0x40));
    uVar8 = 0;
    do {
      plVar3 = (long *)OSDictionary::withCapacity(1);
      uVar1 = (**(code **)(**(long **)(this + uVar8 * 8 + 0x48) + 0x130))();
      pOVar4 = (OSSharedPtr *)OSArray::withCapacity(uVar1);
      bVar10 = plVar3 != (long *)0x0;
      bVar11 = pOVar4 != (OSSharedPtr *)0x0;
      bVar12 = bVar11 && bVar10;
      if (bVar11 && bVar10) {
        plVar5 = (long *)OSNumber::withNumber((ulong)(uint)(0x1000 << ((byte)uVar8 & 0x1f)),0x20);
        OSDictionary::setObject((char *)plVar3,(OSSharedPtr *)"Bucket buffer size");
        if (plVar5 != (long *)0x0) {
          (**(code **)(*plVar5 + 0x28))();
        }
      }
      plVar5 = (long *)OSCollectionIterator::withCollection
                                 (*(OSCollection **)(this + uVar8 * 8 + 0x48));
      if (plVar5 == (long *)0x0) {
        if (!bVar11 || !bVar10) goto LAB_0001fe6b;
LAB_0001fdfa:
        if (pOVar4 != (OSSharedPtr *)0x0) {
          (**(code **)(*(long *)pOVar4 + 0x20))(pOVar4);
        }
        OSDictionary::setObject((char *)plVar3,(OSSharedPtr *)"Descriptors");
        if (pOVar4 != (OSSharedPtr *)0x0) {
          (**(code **)(*(long *)pOVar4 + 0x28))();
        }
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x20))(plVar3);
        }
        OSArray::setObject(pOVar2);
        if (plVar3 != (long *)0x0) {
          (**(code **)(*plVar3 + 0x28))();
        }
        unaff_R15 = CONCAT71((int7)(unaff_R15 >> 8),1);
      }
      else {
        pIVar9 = (IOSurfaceDescriptorComponent *)0x0;
        while( true ) {
          pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar5 + 0x128))(plVar5);
          this_00 = (IOSurfaceDescriptorComponent *)
                    OSMetaClassBase::safeMetaCast
                              (pOVar6,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass);
          if (this_00 != (IOSurfaceDescriptorComponent *)0x0) {
            (**(code **)(*(long *)this_00 + 0x20))(this_00);
          }
          if (pIVar9 != (IOSurfaceDescriptorComponent *)0x0) {
            (**(code **)(*(long *)pIVar9 + 0x28))(pIVar9);
          }
          if (this_00 == (IOSurfaceDescriptorComponent *)0x0) break;
          plVar7 = (long *)OSDictionary::withCapacity(1);
          bVar12 = plVar7 != (long *)0x0;
          pIVar9 = this_00;
          if (bVar12) {
            IOSurfaceDescriptorComponent::write_debug_info(this_00,(char *)plVar7);
            (**(code **)(*plVar7 + 0x20))(plVar7);
            OSArray::setObject(pOVar4);
            if (plVar7 != (long *)0x0) {
              (**(code **)(*plVar7 + 0x28))();
            }
            (**(code **)(*plVar7 + 0x28))(plVar7);
          }
        }
        (**(code **)(*plVar5 + 0x28))(plVar5);
        if (bVar12) goto LAB_0001fdfa;
LAB_0001fe6b:
        unaff_R15 = 0;
      }
      if (pOVar4 != (OSSharedPtr *)0x0) {
        (**(code **)(*(long *)pOVar4 + 0x28))(pOVar4);
      }
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x28))(plVar3);
      }
      bVar12 = uVar8 < 9;
      uVar8 = uVar8 + 1;
    } while (((byte)unaff_R15 & bVar12) != 0);
    _IOLockUnlock(*(undefined8 *)(this + 0x40));
    if ((byte)unaff_R15 != 0) {
      plVar3 = (long *)OSNumber::withNumber(*(ulonglong *)(this + 0x28),0x40);
      OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Pool Id");
      if (plVar3 != (long *)0x0) {
        (**(code **)(*plVar3 + 0x28))();
      }
      (**(code **)(*(long *)pOVar2 + 0x20))();
      OSDictionary::setObject((char *)param_1,(OSSharedPtr *)"Buckets");
      if (pOVar2 != (OSSharedPtr *)0x0) {
        (**(code **)(*(long *)pOVar2 + 0x28))();
      }
    }
    (**(code **)(*(long *)pOVar2 + 0x28))();
  }
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x28))();
  }
  return unaff_R15 & 0xffffffff;
}



// IOSurfaceMemoryPoolBunch::write_debug_infoForDescriptor(OSSharedPtr<OSDictionary>,
// OSSharedPtr<IOMemoryDescriptor>)

undefined8 __thiscall
IOSurfaceMemoryPoolBunch::write_debug_infoForDescriptor
          (IOSurfaceMemoryPoolBunch *this,long *param_1,long *param_2)

{
  IOSurfaceDescriptorContext *this_00;
  undefined8 uVar1;
  
  _IORWLockRead(*(undefined8 *)(this + 0x18));
  this_00 = (IOSurfaceDescriptorContext *)this;
  do {
    this_00 = *(IOSurfaceDescriptorContext **)(this_00 + 0x30);
    if (this_00 == (IOSurfaceDescriptorContext *)0x0) goto LAB_0001ff98;
  } while (*(long **)(this_00 + 0x20) != param_2);
  if (param_1 != (long *)0x0) {
    (**(code **)(*param_1 + 0x20))(param_1);
  }
  IOSurfaceDescriptorContext::write_debug_info(this_00,param_1);
LAB_0001ff98:
  uVar1 = _IORWLockUnlock(*(undefined8 *)(this + 0x18));
  if (param_2 != (long *)0x0) {
    uVar1 = (**(code **)(*param_2 + 0x28))(param_2);
  }
  if (param_1 != (long *)0x0) {
    uVar1 = (**(code **)(*param_1 + 0x28))(param_1);
  }
  return CONCAT71((int7)((ulong)uVar1 >> 8),1);
}



// IOSurfaceMemoryPool::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryPool::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryPool",(OSMetaClass *)PTR_gMetaClass_00027048,0xb0);
  *(undefined ***)this = &PTR__MetaClass_0002c998;
  return;
}



// IOSurfaceMemoryPool::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryPool::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryPool::IOSurfaceMemoryPool(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryPool::IOSurfaceMemoryPool(IOSurfaceMemoryPool *this,OSMetaClass *param_1)

{
  long lVar1;
  
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPool_0002c860;
  *(undefined8 *)(this + 0x38) = 0;
  lVar1 = 0;
  do {
    *(undefined8 *)(this + lVar1 + 0x48) = 0;
    lVar1 = lVar1 + 8;
  } while (lVar1 != 0x50);
  *(undefined8 *)(this + 0x98) = 0;
  *(undefined8 *)(this + 0xa8) = 0;
  return;
}



// IOSurfaceMemoryPool::IOSurfaceMemoryPool(OSMetaClass const*)

void __thiscall
IOSurfaceMemoryPool::IOSurfaceMemoryPool(IOSurfaceMemoryPool *this,OSMetaClass *param_1)

{
  long lVar1;
  
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPool_0002c860;
  *(undefined8 *)(this + 0x38) = 0;
  lVar1 = -0x50;
  do {
    *(undefined8 *)(this + lVar1 + 0x98) = 0;
    lVar1 = lVar1 + 8;
  } while (lVar1 != 0);
  *(undefined8 *)(this + 0x98) = 0;
  *(undefined8 *)(this + 0xa8) = 0;
  return;
}



// IOSurfaceMemoryPool::~IOSurfaceMemoryPool()

void __thiscall IOSurfaceMemoryPool::~IOSurfaceMemoryPool(IOSurfaceMemoryPool *this)

{
  long lVar1;
  
  *(undefined ***)this = &PTR__IOSurfaceMemoryPool_0002c860;
  if (*(long **)(this + 0xa8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xa8) + 0x28))();
  }
  *(undefined8 *)(this + 0xa8) = 0;
  if (*(long **)(this + 0x98) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x98) + 0x28))();
  }
  *(undefined8 *)(this + 0x98) = 0;
  lVar1 = 0x90;
  do {
    if (*(long **)(this + lVar1) != (long *)0x0) {
      (**(code **)(**(long **)(this + lVar1) + 0x28))();
    }
    *(undefined8 *)(this + lVar1) = 0;
    lVar1 = lVar1 + -8;
  } while (lVar1 != 0x40);
  if (*(long **)(this + 0x38) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x38) + 0x28))();
  }
  *(undefined8 *)(this + 0x38) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryPool::~IOSurfaceMemoryPool()

void __thiscall IOSurfaceMemoryPool::~IOSurfaceMemoryPool(IOSurfaceMemoryPool *this)

{
  long lVar1;
  
  *(undefined ***)this = &PTR__IOSurfaceMemoryPool_0002c860;
  if (*(long **)(this + 0xa8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xa8) + 0x28))();
  }
  *(undefined8 *)(this + 0xa8) = 0;
  if (*(long **)(this + 0x98) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x98) + 0x28))();
  }
  *(undefined8 *)(this + 0x98) = 0;
  lVar1 = 0x90;
  do {
    if (*(long **)(this + lVar1) != (long *)0x0) {
      (**(code **)(**(long **)(this + lVar1) + 0x28))();
    }
    *(undefined8 *)(this + lVar1) = 0;
    lVar1 = lVar1 + -8;
  } while (lVar1 != 0x40);
  if (*(long **)(this + 0x38) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x38) + 0x28))();
  }
  *(undefined8 *)(this + 0x38) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceMemoryPool::~IOSurfaceMemoryPool()

void __thiscall IOSurfaceMemoryPool::~IOSurfaceMemoryPool(IOSurfaceMemoryPool *this)

{
  ~IOSurfaceMemoryPool(this);
  _OSObject_typed_operator_delete(&IOSurfaceMemoryPool_ktv,this,0xb0);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryPool::operator delete(void*, unsigned long)

void __cdecl IOSurfaceMemoryPool::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceMemoryPool_ktv,param_1,param_2);
  return;
}



// IOSurfaceMemoryPool::getMetaClass() const

undefined8 * IOSurfaceMemoryPool::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceMemoryPool::MetaClass::MetaClass()

void __thiscall IOSurfaceMemoryPool::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceMemoryPool",(OSMetaClass *)PTR_gMetaClass_00027048,0xb0);
  *(undefined ***)this = &PTR__MetaClass_0002c998;
  return;
}



// IOSurfaceMemoryPool::MetaClass::alloc() const

IOSurfaceMemoryPool * IOSurfaceMemoryPool::MetaClass::alloc(void)

{
  IOSurfaceMemoryPool *this;
  
  this = (IOSurfaceMemoryPool *)_OSObject_typed_operator_new(&IOSurfaceMemoryPool_ktv,0xb0);
  IOSurfaceMemoryPool(this);
  return this;
}



// IOSurfaceMemoryPool::operator new(unsigned long)

void * __thiscall IOSurfaceMemoryPool::operator_new(IOSurfaceMemoryPool *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceMemoryPool_ktv,this);
  return pvVar1;
}



// IOSurfaceMemoryPool::IOSurfaceMemoryPool()

void __thiscall IOSurfaceMemoryPool::IOSurfaceMemoryPool(IOSurfaceMemoryPool *this)

{
  IOSurfaceMemoryPool(this);
  return;
}



// IOSurfaceMemoryPool::IOSurfaceMemoryPool()

void __thiscall IOSurfaceMemoryPool::IOSurfaceMemoryPool(IOSurfaceMemoryPool *this)

{
  long lVar1;
  
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceMemoryPool_0002c860;
  *(undefined8 *)(this + 0x38) = 0;
  lVar1 = 0;
  do {
    *(undefined8 *)(this + lVar1 + 0x48) = 0;
    lVar1 = lVar1 + 8;
  } while (lVar1 != 0x50);
  *(undefined8 *)(this + 0x98) = 0;
  *(undefined8 *)(this + 0xa8) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceMemoryPool::ensureMemory(OSSharedPtr<OSDictionary>)

ulong __thiscall IOSurfaceMemoryPool::ensureMemory(IOSurfaceMemoryPool *this,long *param_1)

{
  OSMetaClass *pOVar1;
  OSMetaClass *pOVar2;
  OSMetaClass *pOVar3;
  char cVar4;
  uint uVar5;
  OSMetaClassBase *pOVar6;
  OSCollection *pOVar7;
  long *plVar8;
  long *plVar9;
  long *plVar10;
  OSCollection *pOVar11;
  long *plVar12;
  long *plVar13;
  long lVar14;
  ulong uVar15;
  OSCollection *pOVar16;
  undefined7 uVar17;
  byte local_31;
  
  pOVar6 = (OSMetaClassBase *)(**(code **)(*param_1 + 0x208))(param_1,"IOSurfaceMemoryPoolSize");
  pOVar7 = (OSCollection *)
           OSMetaClassBase::safeMetaCast(pOVar6,*(OSMetaClass **)PTR_metaClass_00027038);
  if (pOVar7 != (OSCollection *)0x0) {
    (**(code **)(*(long *)pOVar7 + 0x20))(pOVar7);
  }
  plVar8 = (long *)OSCollectionIterator::withCollection(pOVar7);
  pOVar1 = *(OSMetaClass **)PTR_metaClass_00027010;
  pOVar2 = *(OSMetaClass **)PTR_metaClass_00027040;
  pOVar3 = *(OSMetaClass **)PTR_metaClass_00027068;
  local_31 = 1;
  pOVar16 = pOVar7;
  plVar10 = (long *)0x0;
  do {
    if (plVar8 == (long *)0x0) {
      uVar17 = (undefined7)((ulong)pOVar16 >> 8);
      local_31 = 1;
      goto LAB_0002055a;
    }
    pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar8 + 0x128))(plVar8);
    plVar9 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar1);
    if (plVar9 != (long *)0x0) {
      (**(code **)(*plVar9 + 0x20))(plVar9);
    }
    if (plVar10 != (long *)0x0) {
      (**(code **)(*plVar10 + 0x28))(plVar10);
    }
    if (plVar9 == (long *)0x0) goto LAB_0002054a;
    pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar9 + 0x208))(plVar9,"IOSurfaceCacheMode");
    plVar10 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar2);
    pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar9 + 0x208))(plVar9,"IOSurfaceAllocSize");
    pOVar11 = (OSCollection *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar2);
    pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar9 + 0x208))(plVar9,"IOSurfaceUseReserve");
    plVar12 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar3);
    pOVar6 = (OSMetaClassBase *)(**(code **)(*plVar9 + 0x208))(plVar9,"IOSurfaceNonPurgeable");
    plVar13 = (long *)OSMetaClassBase::safeMetaCast(pOVar6,pOVar3);
    pOVar16 = pOVar11;
    if ((plVar10 != (long *)0x0) && (pOVar11 != (OSCollection *)0x0)) {
      uVar5 = (**(code **)(*plVar10 + 0x148))(plVar10);
      pOVar16 = (OSCollection *)(ulong)(uVar5 | 0x110023);
      if (plVar12 != (long *)0x0) {
        cVar4 = (**(code **)(*plVar12 + 0x128))(plVar12);
        if (cVar4 != '\0') {
          pOVar16 = (OSCollection *)(ulong)(uVar5 | 0x910023);
        }
      }
      if (plVar13 == (long *)0x0) {
LAB_00020504:
        pOVar16 = (OSCollection *)(ulong)((uint)pOVar16 | 0x40);
      }
      else {
        cVar4 = (**(code **)(*plVar13 + 0x128))(plVar13);
        if (cVar4 == '\0') goto LAB_00020504;
      }
      lVar14 = (**(code **)(*(long *)pOVar11 + 0x150))(pOVar11);
      uVar15 = ensureMemoryWithOptions(this,(uint)pOVar16,lVar14 + 0xfffU & 0xfffffffffffff000);
      local_31 = (byte)uVar15;
    }
    plVar10 = plVar9;
  } while ((local_31 & 1) != 0);
  (**(code **)(*plVar9 + 0x28))(plVar9);
LAB_0002054a:
  (**(code **)(*plVar8 + 0x28))(plVar8);
  uVar17 = (undefined7)((ulong)pOVar16 >> 8);
LAB_0002055a:
  if (pOVar7 != (OSCollection *)0x0) {
    (**(code **)(*(long *)pOVar7 + 0x28))();
  }
  (**(code **)(*param_1 + 0x28))();
  return CONCAT71(uVar17,local_31) & 0xffffff01;
}



// IOSurfaceMemoryPool::free()

void __thiscall IOSurfaceMemoryPool::free(IOSurfaceMemoryPool *this)

{
  long lVar1;
  
  if (*(long **)(this + 0x38) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x38) + 0x28))();
  }
  *(undefined8 *)(this + 0x38) = 0;
  if (*(long **)(this + 0x98) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x98) + 0x28))();
  }
  *(undefined8 *)(this + 0x98) = 0;
  if (*(long **)(this + 0xa8) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0xa8) + 0x28))();
  }
  *(undefined8 *)(this + 0xa8) = 0;
  lVar1 = 9;
  do {
    if (*(long **)(this + lVar1 * 8) != (long *)0x0) {
      (**(code **)(**(long **)(this + lVar1 * 8) + 0x28))();
    }
    *(undefined8 *)(this + lVar1 * 8) = 0;
    lVar1 = lVar1 + 1;
  } while (lVar1 != 0x13);
  if (*(long *)(this + 0x40) != 0) {
    _IOLockFree();
  }
                    // WARNING: Could not recover jumptable at 0x00020625. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceMemoryPool::getRetainCount() const

undefined4 __thiscall IOSurfaceMemoryPool::getRetainCount(IOSurfaceMemoryPool *this)

{
  return *(undefined4 *)(this + 0x20);
}



// IOSurfaceMemoryPool::retain() const

void __thiscall IOSurfaceMemoryPool::retain(IOSurfaceMemoryPool *this)

{
  uint uVar1;
  IOSurfaceMemoryPool *pIVar2;
  
  pIVar2 = this + 0x20;
  LOCK();
  uVar1 = *(uint *)pIVar2;
  *(uint *)pIVar2 = *(uint *)pIVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(pIVar2,uVar1);
  return;
}



// IOSurfaceMemoryPool::release() const

void __thiscall IOSurfaceMemoryPool::release(IOSurfaceMemoryPool *this)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0x20));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x00020677. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x118))(this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryPool::taggedRetain(void const*) const

void __cdecl IOSurfaceMemoryPool::taggedRetain(long param_1)

{
  uint uVar1;
  uint *puVar2;
  
  puVar2 = (uint *)(param_1 + 0x20);
  LOCK();
  uVar1 = *puVar2;
  *puVar2 = *puVar2 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(puVar2,uVar1);
  return;
}



// IOSurfaceMemoryPool::taggedRelease(void const*, int) const

void __thiscall
IOSurfaceMemoryPool::taggedRelease(IOSurfaceMemoryPool *this,undefined8 param_2_00,int param_2)

{
  int iVar1;
  
  if (param_2 == 1) {
    iVar1 = _iosfc_ref_release_explicit_internal((int *)(this + 0x20));
    if (iVar1 == 0) {
                    // WARNING: Could not recover jumptable at 0x000206c4. Too many branches
                    // WARNING: Treating indirect jump as call
      (**(code **)(*(long *)this + 0x118))(this);
      return;
    }
  }
  else {
    taggedRelease();
  }
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceMemoryPool::taggedRelease(void const*) const

void __cdecl IOSurfaceMemoryPool::taggedRelease(long *param_1)

{
  int iVar1;
  
  iVar1 = _iosfc_ref_release_explicit_internal((int *)(param_1 + 4));
  if (iVar1 != 0) {
    return;
  }
                    // WARNING: Could not recover jumptable at 0x00020705. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x118))(param_1);
  return;
}



// IOSurfaceMemoryPool::finalize()

void __thiscall IOSurfaceMemoryPool::finalize(IOSurfaceMemoryPool *this)

{
  IOSurfaceMemoryPoolBunch::removePool(*(IOSurfaceMemoryPoolBunch **)(this + 0x38),(long)this);
                    // WARNING: Could not recover jumptable at 0x0002072d. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*(long *)this + 0x90))(this);
  return;
}



// IOSurfaceMemoryPool::getComponentsFromBucket(unsigned int, unsigned int, OSSharedPtr<OSArray>,
// bool)

ulong __thiscall
IOSurfaceMemoryPool::getComponentsFromBucket
          (IOSurfaceMemoryPool *this,uint param_1,undefined8 param_2,OSSharedPtr *param_3,
          char param_4)

{
  bool bVar1;
  bool bVar2;
  undefined4 uVar3;
  long *plVar4;
  OSMetaClassBase *pOVar5;
  IOSurfaceDescriptorComponent *pIVar6;
  long lVar7;
  undefined8 uVar8;
  OSCollection *pOVar9;
  ulong uVar10;
  long *plVar11;
  IOSurfaceDescriptorComponent *pIVar12;
  uint uVar13;
  IOSurfaceDescriptorComponent *pIVar14;
  long *plVar15;
  ulong local_48;
  char local_34;
  
  if (param_1 < 10) {
    _IOLockLock(*(undefined8 *)(this + 0x40));
    plVar4 = (long *)OSCollectionIterator::withCollection
                               (*(OSCollection **)(this + (ulong)param_1 * 8 + 0x48));
    local_34 = param_4;
    if (plVar4 == (long *)0x0) {
LAB_00020912:
      bVar2 = false;
LAB_0002091e:
      bVar1 = true;
      local_48 = 0;
      pIVar14 = (IOSurfaceDescriptorComponent *)0x0;
    }
    else {
      pIVar12 = (IOSurfaceDescriptorComponent *)0x0;
      pIVar14 = (IOSurfaceDescriptorComponent *)0x0;
LAB_000207ae:
      pOVar5 = (OSMetaClassBase *)(**(code **)(*plVar4 + 0x128))(plVar4);
      pIVar6 = (IOSurfaceDescriptorComponent *)
               OSMetaClassBase::safeMetaCast
                         (pOVar5,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass);
      if (pIVar6 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)pIVar6 + 0x20))(pIVar6);
      }
      if (pIVar12 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)pIVar12 + 0x28))(pIVar12);
      }
      if (pIVar6 == (IOSurfaceDescriptorComponent *)0x0) goto LAB_00020891;
      if ((*(uint *)(pIVar6 + 0xc) & 0xf00) != ((uint)param_2 & 0xf00)) {
        pIVar12 = pIVar6;
        if (this[0xa1] != (IOSurfaceMemoryPool)0x0) {
          if (pIVar14 == (IOSurfaceDescriptorComponent *)0x0) {
            lVar7 = 4;
            pIVar14 = pIVar6;
          }
          else {
            if (((*(uint *)(pIVar14 + 0xc) & 0xf00) != 0x700) ||
               ((*(uint *)(pIVar6 + 0xc) & 0xf00) == 0x700)) goto LAB_000207ae;
            (**(code **)(*(long *)pIVar6 + 0x20))(pIVar6);
            lVar7 = 5;
          }
          (**(code **)(*(long *)pIVar14 + lVar7 * 8))(pIVar14);
          pIVar14 = pIVar6;
        }
        goto LAB_000207ae;
      }
      (**(code **)(*(long *)pIVar6 + 0x20))(pIVar6);
      if (pIVar14 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)pIVar14 + 0x28))(pIVar14);
      }
      (**(code **)(*(long *)pIVar6 + 0x28))(pIVar6);
      pIVar14 = pIVar6;
LAB_00020891:
      (**(code **)(*plVar4 + 0x28))(plVar4);
      if (pIVar14 == (IOSurfaceDescriptorComponent *)0x0) goto LAB_00020912;
      plVar4 = *(long **)(this + (ulong)param_1 * 8 + 0x48);
      uVar3 = (**(code **)(*plVar4 + 0x1f8))(plVar4,pIVar14,0);
      (**(code **)(*plVar4 + 0x1d8))(plVar4,uVar3);
      if ((((uint)param_2 & 0xf00) == 0x700) && ((*(uint *)(pIVar14 + 0xc) & 0xf00) != 0x700)) {
        (**(code **)(*(long *)pIVar14 + 0x28))(pIVar14);
        local_34 = '\x01';
        bVar2 = true;
        goto LAB_0002091e;
      }
      uVar8 = (**(code **)(*(long *)param_3 + 0x1b8))(param_3,pIVar14);
      local_48 = CONCAT71((int7)((ulong)uVar8 >> 8),1) & 0xffffffff;
      bVar1 = false;
      bVar2 = false;
    }
    _IOLockUnlock(*(undefined8 *)(this + 0x40));
    if (((!bVar2) && (param_1 != 0)) && (bVar1)) {
      pOVar9 = (OSCollection *)OSArray::withCapacity(1);
      uVar13 = param_1 - 1;
      if (pOVar9 == (OSCollection *)0x0) {
        uVar10 = getComponentsFromBucket(this,uVar13,(ulong)(uint)param_2,(OSSharedPtr *)0x0,'\0');
        if ((char)uVar10 != '\0') goto LAB_000209ad;
LAB_00020a59:
        plVar4 = (long *)OSCollectionIterator::withCollection(pOVar9);
        if (plVar4 != (long *)0x0) {
          plVar15 = (long *)0x0;
          while( true ) {
            pOVar5 = (OSMetaClassBase *)(**(code **)(*plVar4 + 0x128))(plVar4);
            plVar11 = (long *)OSMetaClassBase::safeMetaCast
                                        (pOVar5,(OSMetaClass *)
                                                &IOSurfaceDescriptorComponent::gMetaClass);
            if (plVar11 != (long *)0x0) {
              (**(code **)(*plVar11 + 0x20))(plVar11);
            }
            if (plVar15 != (long *)0x0) {
              (**(code **)(*plVar15 + 0x28))(plVar15);
            }
            if (plVar11 == (long *)0x0) break;
            (**(code **)(*plVar11 + 0x20))(plVar11);
            returnComponentToBucket(this,plVar11);
            plVar15 = plVar11;
          }
          (**(code **)(*plVar4 + 0x28))(plVar4);
        }
      }
      else {
        (**(code **)(*(long *)pOVar9 + 0x20))(pOVar9);
        uVar10 = getComponentsFromBucket
                           (this,uVar13,(ulong)(uint)param_2,(OSSharedPtr *)pOVar9,'\0');
        if ((char)uVar10 == '\0') goto LAB_00020a59;
        (**(code **)(*(long *)pOVar9 + 0x20))(pOVar9);
LAB_000209ad:
        uVar10 = getComponentsFromBucket
                           (this,uVar13,(ulong)(uint)param_2,(OSSharedPtr *)pOVar9,'\0');
        if ((char)uVar10 == '\0') goto LAB_00020a59;
        plVar4 = (long *)OSCollectionIterator::withCollection(pOVar9);
        local_48 = CONCAT71((int7)((ulong)plVar4 >> 8),1) & 0xffffffff;
        if (plVar4 != (long *)0x0) {
          plVar15 = (long *)0x0;
          while( true ) {
            pOVar5 = (OSMetaClassBase *)(**(code **)(*plVar4 + 0x128))(plVar4);
            plVar11 = (long *)OSMetaClassBase::safeMetaCast
                                        (pOVar5,(OSMetaClass *)
                                                &IOSurfaceDescriptorComponent::gMetaClass);
            if (plVar11 != (long *)0x0) {
              (**(code **)(*plVar11 + 0x20))(plVar11);
            }
            if (plVar15 != (long *)0x0) {
              (**(code **)(*plVar15 + 0x28))(plVar15);
            }
            if (plVar11 == (long *)0x0) break;
            (**(code **)(*plVar11 + 0x20))(plVar11);
            OSArray::setObject(param_3);
            plVar15 = plVar11;
            if (plVar11 != (long *)0x0) {
              (**(code **)(*plVar11 + 0x28))();
            }
          }
          (**(code **)(*plVar4 + 0x28))(plVar4);
        }
      }
      if (pOVar9 != (OSCollection *)0x0) {
        (**(code **)(*(long *)pOVar9 + 0x28))();
      }
    }
    if (local_34 == '\x01' && (char)local_48 == '\0') {
      pIVar12 = (IOSurfaceDescriptorComponent *)
                (**(code **)(IOSurfaceDescriptorComponent::gMetaClass + 0x88))
                          (&IOSurfaceDescriptorComponent::gMetaClass);
      if (pIVar14 != (IOSurfaceDescriptorComponent *)0x0) {
        (**(code **)(*(long *)pIVar14 + 0x28))(pIVar14);
      }
      if (pIVar12 == (IOSurfaceDescriptorComponent *)0x0) goto LAB_0002074d;
      bVar2 = IOSurfaceDescriptorComponent::init
                        (pIVar12,(uint)param_2,(ulong)(uint)(0x1000 << ((byte)param_1 & 0x1f)));
      if (bVar2) {
        (**(code **)(*(long *)param_3 + 0x1b8))(param_3,pIVar12);
        local_48 = CONCAT71((uint7)(uint3)((uint)param_2 >> 8),1);
      }
      else {
        local_48 = 0;
      }
    }
    else {
      pIVar12 = pIVar14;
      if (pIVar14 == (IOSurfaceDescriptorComponent *)0x0) goto LAB_00020baa;
    }
    (**(code **)(*(long *)pIVar12 + 0x28))(pIVar12);
  }
  else {
LAB_0002074d:
    local_48 = 0;
  }
LAB_00020baa:
  if (param_3 != (OSSharedPtr *)0x0) {
    (**(code **)(*(long *)param_3 + 0x28))(param_3);
  }
  return local_48;
}



// IOSurfaceMemoryPool::flush(OSSharedPtr<OSDictionary>)

undefined8 __thiscall IOSurfaceMemoryPool::flush(IOSurfaceMemoryPool *this,long *param_1)

{
  undefined8 uVar1;
  long lVar2;
  
  _IOLockLock(*(undefined8 *)(this + 0x40));
  lVar2 = 0;
  do {
    (**(code **)(**(long **)(this + lVar2 * 8 + 0x48) + 0x158))();
    lVar2 = lVar2 + 1;
  } while (lVar2 != 10);
  uVar1 = _IOLockUnlock(*(undefined8 *)(this + 0x40));
  if (param_1 != (long *)0x0) {
    uVar1 = (**(code **)(*param_1 + 0x28))(param_1);
  }
  return CONCAT71((int7)((ulong)uVar1 >> 8),1);
}



// IOSurfaceMemoryPool::ensureMemoryWithOptions(unsigned int, unsigned long long)

ulong __thiscall
IOSurfaceMemoryPool::ensureMemoryWithOptions(IOSurfaceMemoryPool *this,uint param_1,ulong param_2)

{
  OSSharedPtr *pOVar1;
  bool bVar2;
  long *plVar3;
  OSMetaClassBase *pOVar4;
  long *plVar5;
  ulong uVar6;
  IOSurfaceDescriptorComponent *this_00;
  long lVar7;
  ulong uVar8;
  long *unaff_R13;
  ulong uVar9;
  long *plVar10;
  ulong uVar11;
  long local_40;
  
  _IOLockLock(*(undefined8 *)(this + 0x40));
  lVar7 = 0;
  uVar9 = 0;
  do {
    plVar3 = (long *)OSCollectionIterator::withCollection
                               (*(OSCollection **)(this + lVar7 * 8 + 0x48));
    if (plVar3 != (long *)0x0) {
      plVar10 = (long *)0x0;
      while( true ) {
        pOVar4 = (OSMetaClassBase *)(**(code **)(*plVar3 + 0x128))(plVar3);
        plVar5 = (long *)OSMetaClassBase::safeMetaCast
                                   (pOVar4,(OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass)
        ;
        if (plVar5 != (long *)0x0) {
          (**(code **)(*plVar5 + 0x20))(plVar5);
        }
        if (plVar10 != (long *)0x0) {
          (**(code **)(*plVar10 + 0x28))(plVar10);
        }
        if (plVar5 == (long *)0x0) break;
        uVar6 = 0;
        if (((*(uint *)((long)plVar5 + 0xc) ^ param_1) & 0xf00) == 0) {
          uVar6 = (ulong)(uint)(0x1000 << ((byte)lVar7 & 0x1f));
        }
        uVar9 = uVar9 + uVar6;
        plVar10 = plVar5;
      }
      (**(code **)(*plVar3 + 0x28))(plVar3);
      unaff_R13 = plVar3;
    }
    lVar7 = lVar7 + 1;
  } while (lVar7 != 10);
  uVar6 = CONCAT71((int7)((ulong)unaff_R13 >> 8),1);
  if (uVar9 < param_2) {
    uVar6 = 1;
    local_40 = 9;
    do {
      uVar8 = param_2 - uVar9 >> (local_40 != 0);
      if (uVar6 != 0) {
        uVar11 = (ulong)(0x1000 << ((byte)local_40 & 0x1f));
        do {
          if (uVar8 <= uVar11) break;
          this_00 = (IOSurfaceDescriptorComponent *)
                    (**(code **)(IOSurfaceDescriptorComponent::gMetaClass + 0x88))
                              (&IOSurfaceDescriptorComponent::gMetaClass);
          if (this_00 == (IOSurfaceDescriptorComponent *)0x0) {
            uVar6 = 0;
            goto LAB_00020de5;
          }
          bVar2 = IOSurfaceDescriptorComponent::init(this_00,param_1,uVar11);
          if (bVar2) {
            pOVar1 = *(OSSharedPtr **)(this + local_40 * 8 + 0x48);
            (**(code **)(*(long *)this_00 + 0x20))(this_00);
            OSArray::setObject(pOVar1);
            if (this_00 != (IOSurfaceDescriptorComponent *)0x0) {
              (**(code **)(*(long *)this_00 + 0x28))();
            }
            uVar8 = uVar8 - uVar11;
            uVar9 = uVar9 + uVar11;
          }
          else {
            uVar6 = 0;
          }
          (**(code **)(*(long *)this_00 + 0x28))(this_00);
        } while (uVar6 != 0);
      }
      bVar2 = local_40 != 0;
      local_40 = local_40 + -1;
    } while (((bVar2) && ((char)uVar6 != '\0')) && (uVar9 < param_2));
  }
LAB_00020de5:
  _IOLockUnlock(*(undefined8 *)(this + 0x40));
  return uVar6 & 0xffffffff;
}



// IOSurfaceMemoryPool::taskCanUsePool(task*)

ulong __thiscall IOSurfaceMemoryPool::taskCanUsePool(IOSurfaceMemoryPool *this,task *param_1)

{
  int pid;
  char *pcVar1;
  long *plVar2;
  long lVar3;
  undefined8 unaff_RBX;
  ulong uVar4;
  undefined8 local_48;
  undefined8 local_40;
  undefined8 local_38;
  undefined8 local_30;
  long local_28;
  
  local_28 = *(long *)PTR____stack_chk_guard_00027088;
  uVar4 = CONCAT71((int7)((ulong)unaff_RBX >> 8),1);
  if ((*(task **)(this + 0x30) == param_1) || (*(task **)PTR__kernel_task_000270b8 == param_1))
  goto LAB_00020ee9;
  if (*(long **)(this + 0xa8) == (long *)0x0) {
LAB_00020e66:
    plVar2 = (long *)IOUserClient::copyClientEntitlement(param_1,"com.apple.private.iosurfaceinfo");
    if (plVar2 == (long *)0x0) {
      lVar3 = _get_bsdtask_info(param_1);
      pid = 0;
      local_30 = 0;
      local_38 = 0;
      local_48 = 0x6e776f6e6b6e7528;
      local_40 = 0x29;
      if (lVar3 != 0) {
        pid = _proc_pid(lVar3);
        _proc_name(pid,&local_48,0x20);
      }
      uVar4 = 0;
      _IOLog("IOSurfaceMemoryPool: %s (%d) can\'t access pool id %llu (wrong entitlements)\n",
             &local_48,pid,*(undefined8 *)(this + 0x28));
      goto LAB_00020ee9;
    }
  }
  else {
    pcVar1 = (char *)(**(code **)(**(long **)(this + 0xa8) + 0x148))();
    plVar2 = (long *)IOUserClient::copyClientEntitlement(param_1,pcVar1);
    if (plVar2 == (long *)0x0) goto LAB_00020e66;
  }
  (**(code **)(*plVar2 + 0x28))(plVar2);
LAB_00020ee9:
  if (*(long *)PTR____stack_chk_guard_00027088 == local_28) {
    return uVar4 & 0xffffffff;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



// IOSurfaceDescriptorContext::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptorContext::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceDescriptorComponent::MetaClass::~MetaClass()

void __thiscall IOSurfaceDescriptorComponent::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryPoolBunch::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryPoolBunch::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceMemoryPool::MetaClass::~MetaClass()

void __thiscall IOSurfaceMemoryPool::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// os_detail::panic_trapping_policy::trap(char const*)

void __cdecl os_detail::panic_trapping_policy::trap(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",param_1,"OSBoundedPtr.h",0x35);
}



void __GLOBAL__sub_I_IOSurfaceMemoryPool_cpp(void)

{
  undefined *puVar1;
  
  puVar1 = PTR_gMetaClass_00027048;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceDescriptorContext::gMetaClass,"IOSurfaceDescriptorContext",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x40);
  IOSurfaceDescriptorContext::gMetaClass = &PTR__MetaClass_0002c318;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass,"IOSurfaceDescriptorComponent"
             ,(OSMetaClass *)puVar1,0x18);
  IOSurfaceDescriptorComponent::gMetaClass = &PTR__MetaClass_0002c540;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceMemoryPoolBunch::gMetaClass,"IOSurfaceMemoryPoolBunch",
             (OSMetaClass *)puVar1,0x48);
  IOSurfaceMemoryPoolBunch::gMetaClass = &PTR__MetaClass_0002c768;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceMemoryPool::gMetaClass,"IOSurfaceMemoryPool",
             (OSMetaClass *)puVar1,0xb0);
  IOSurfaceMemoryPool::gMetaClass = &PTR__MetaClass_0002c998;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceMemoryPool::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceMemoryPoolBunch::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceDescriptorComponent::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceDescriptorContext::gMetaClass);
  return;
}



void _iosfc_ref_init_count_internal(uint *param_1,uint param_2)

{
  uint uVar1;
  
  if (param_2 != 0) {
    *param_1 = param_2;
    return;
  }
  _iosfc_ref_panic_underflow(param_1);
  LOCK();
  uVar1 = *param_1;
  *param_1 = *param_1 + 1;
  UNLOCK();
  _iosfc_ref_check_retain(param_1,uVar1);
  return;
}



void _iosfc_ref_check_retain(undefined8 param_1,uint param_2)

{
  if (param_2 == 0) {
    _iosfc_ref_panic_resurrection(param_1);
  }
  else if (param_2 < 0xfffffff) {
    return;
  }
                    // WARNING: Subroutine does not return
  _iosfc_ref_panic_overflow(param_1);
}



undefined8 _iosfc_ref_retain_try_internal(uint *param_1)

{
  uint uVar1;
  uint uVar2;
  ulong uVar3;
  
  uVar3 = (ulong)*param_1;
  do {
    uVar2 = (uint)uVar3;
    if (uVar2 == 0) break;
    _iosfc_ref_check_retain(param_1,uVar2);
    LOCK();
    uVar1 = *param_1;
    if (uVar2 == uVar1) {
      *param_1 = uVar2 + 1;
    }
    else {
      uVar3 = (ulong)uVar1;
    }
    UNLOCK();
  } while (uVar2 != uVar1);
  return CONCAT71((int7)(uVar3 >> 8),uVar2 != 0);
}



// WARNING: Switch with 1 destination removed at 0x000210d3 : 5 cases all go to same destination

void _iosfc_ref_release_explicit_internal(int *param_1)

{
  int iVar1;
  
  LOCK();
  iVar1 = *param_1;
  *param_1 = *param_1 + -1;
  UNLOCK();
  if (iVar1 == 0) {
    _iosfc_ref_panic_underflow(param_1);
  }
  return;
}



// IOSurfaceSendRight::MetaClass::MetaClass()

void __thiscall IOSurfaceSendRight::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSendRight",(OSMetaClass *)PTR_gMetaClass_00027048,0x28);
  *(undefined ***)this = &PTR__MetaClass_0002cbd0;
  return;
}



// IOSurfaceSendRight::MetaClass::~MetaClass()

void __thiscall IOSurfaceSendRight::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceSendRight::IOSurfaceSendRight(OSMetaClass const*)

void __thiscall
IOSurfaceSendRight::IOSurfaceSendRight(IOSurfaceSendRight *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  *(undefined8 *)(this + 0x18) = 0;
  return;
}



// IOSurfaceSendRight::IOSurfaceSendRight(OSMetaClass const*)

void __thiscall
IOSurfaceSendRight::IOSurfaceSendRight(IOSurfaceSendRight *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  *(undefined8 *)(this + 0x18) = 0;
  return;
}



// IOSurfaceSendRight::~IOSurfaceSendRight()

void __thiscall IOSurfaceSendRight::~IOSurfaceSendRight(IOSurfaceSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSendRight::~IOSurfaceSendRight()

void __thiscall IOSurfaceSendRight::~IOSurfaceSendRight(IOSurfaceSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceSendRight::~IOSurfaceSendRight()

void __thiscall IOSurfaceSendRight::~IOSurfaceSendRight(IOSurfaceSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceSendRight_ktv,this,0x28);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSendRight::operator delete(void*, unsigned long)

void __cdecl IOSurfaceSendRight::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceSendRight_ktv,param_1,param_2);
  return;
}



// IOSurfaceSendRight::getMetaClass() const

undefined8 * IOSurfaceSendRight::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceSendRight::MetaClass::MetaClass()

void __thiscall IOSurfaceSendRight::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceSendRight",(OSMetaClass *)PTR_gMetaClass_00027048,0x28);
  *(undefined ***)this = &PTR__MetaClass_0002cbd0;
  return;
}



// IOSurfaceSendRight::MetaClass::alloc() const

OSObject * IOSurfaceSendRight::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceSendRight_ktv,0x28);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceSendRight::gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceSendRight::operator new(unsigned long)

void * __thiscall IOSurfaceSendRight::operator_new(IOSurfaceSendRight *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceSendRight_ktv,this);
  return pvVar1;
}



// IOSurfaceSendRight::IOSurfaceSendRight()

void __thiscall IOSurfaceSendRight::IOSurfaceSendRight(IOSurfaceSendRight *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceSendRight::IOSurfaceSendRight()

void __thiscall IOSurfaceSendRight::IOSurfaceSendRight(IOSurfaceSendRight *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  *(undefined8 *)(this + 0x18) = 0;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSendRight::withSurface(IOSurfaceRoot*, IOSurface*)

long * __cdecl IOSurfaceSendRight::withSurface(undefined8 param_1,undefined8 param_2)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x120))(plVar2,param_1,param_2,0);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSendRight::withSurface(IOSurfaceRoot*, IOSurface*, unsigned long long)

long * __cdecl
IOSurfaceSendRight::withSurface(undefined8 param_1,undefined8 param_2,undefined8 param_3)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x120))(plVar2,param_1,param_2,param_3);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceSendRight::init(IOSurfaceRoot*, IOSurface*)

void __cdecl IOSurfaceSendRight::init(long *param_1)

{
                    // WARNING: Could not recover jumptable at 0x00021453. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(*param_1 + 0x120))();
  return;
}



// IOSurfaceSendRight::init(IOSurfaceRoot*, IOSurface*, unsigned long long)

undefined4 __thiscall
IOSurfaceSendRight::init
          (IOSurfaceSendRight *this,undefined8 param_1,IOSurface *param_2,ulong param_3)

{
  long *plVar1;
  byte bVar2;
  undefined4 uVar3;
  
  uVar3 = (**(code **)(PTR_vtable_00027078 + 0x98))();
  *(undefined8 *)(this + 0x10) = param_1;
  if ((param_3 & 2) == 0) {
    bVar2 = IOSurface::prohibitsUseCount(param_2);
    if (bVar2 == 0) {
      this[0x20] = (IOSurfaceSendRight)0x1;
    }
  }
  plVar1 = *(long **)(this + 0x18);
  *(IOSurface **)(this + 0x18) = param_2;
  if (param_2 != (IOSurface *)0x0) {
    (**(code **)(*(long *)param_2 + 0x20))(param_2);
  }
  if (plVar1 != (long *)0x0) {
    (**(code **)(*plVar1 + 0x28))(plVar1);
  }
  IOSurface::clientRetain(param_2);
  if (this[0x20] != (IOSurfaceSendRight)0x0) {
    IOSurface::increment_use_count_for_category(*(IOSurface **)(this + 0x18),0);
  }
  return uVar3;
}



// IOSurfaceSendRight::free()

void __thiscall IOSurfaceSendRight::free(IOSurfaceSendRight *this)

{
  IOSurface *this_00;
  
  this_00 = *(IOSurface **)(this + 0x18);
  if (this_00 != (IOSurface *)0x0) {
    if (this[0x20] != (IOSurfaceSendRight)0x0) {
      IOSurface::decrement_use_count_for_category(this_00,0);
      this_00 = *(IOSurface **)(this + 0x18);
    }
    *(undefined8 *)(this + 0x18) = 0;
    IOSurfaceRoot::release_surface_async(*(IOSurfaceRoot **)(this + 0x10),(long *)this_00);
  }
                    // WARNING: Could not recover jumptable at 0x00021531. Too many branches
                    // WARNING: Treating indirect jump as call
  (**(code **)(PTR_vtable_00027078 + 0xa0))(this);
  return;
}



// IOSurfaceWiredSendRight::MetaClass::MetaClass()

void __thiscall IOSurfaceWiredSendRight::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceWiredSendRight",
             (OSMetaClass *)&IOSurfaceSendRight::gMetaClass,0x28);
  *(undefined ***)this = &PTR__MetaClass_0002ce08;
  return;
}



// IOSurfaceWiredSendRight::MetaClass::~MetaClass()

void __thiscall IOSurfaceWiredSendRight::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(OSMetaClass const*)

void __thiscall
IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined ***)this = &PTR__IOSurfaceWiredSendRight_0002ccc8;
  return;
}



// IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(OSMetaClass const*)

void __thiscall
IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this,OSMetaClass *param_1)

{
  OSObject::OSObject((OSObject *)this,param_1);
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined ***)this = &PTR__IOSurfaceWiredSendRight_0002ccc8;
  return;
}



// IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight()

void __thiscall IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight()

void __thiscall IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  return;
}



// IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight()

void __thiscall IOSurfaceWiredSendRight::~IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this)

{
  *(undefined ***)this = &PTR__IOSurfaceSendRight_0002ca90;
  if (*(long **)(this + 0x18) != (long *)0x0) {
    (**(code **)(**(long **)(this + 0x18) + 0x28))();
  }
  *(undefined8 *)(this + 0x18) = 0;
  OSObject::~OSObject((OSObject *)this);
  _OSObject_typed_operator_delete(&IOSurfaceWiredSendRight_ktv,this,0x28);
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceWiredSendRight::operator delete(void*, unsigned long)

void __cdecl IOSurfaceWiredSendRight::operator_delete(undefined8 param_1,undefined8 param_2)

{
  _OSObject_typed_operator_delete(&IOSurfaceWiredSendRight_ktv,param_1,param_2);
  return;
}



// IOSurfaceWiredSendRight::getMetaClass() const

undefined8 * IOSurfaceWiredSendRight::getMetaClass(void)

{
  return &gMetaClass;
}



// IOSurfaceWiredSendRight::MetaClass::MetaClass()

void __thiscall IOSurfaceWiredSendRight::MetaClass::MetaClass(MetaClass *this)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)this,"IOSurfaceWiredSendRight",
             (OSMetaClass *)&IOSurfaceSendRight::gMetaClass,0x28);
  *(undefined ***)this = &PTR__MetaClass_0002ce08;
  return;
}



// IOSurfaceWiredSendRight::MetaClass::alloc() const

OSObject * IOSurfaceWiredSendRight::MetaClass::alloc(void)

{
  OSObject *this;
  
  this = (OSObject *)_OSObject_typed_operator_new(&IOSurfaceWiredSendRight_ktv,0x28);
  OSObject::OSObject(this,(OSMetaClass *)&IOSurfaceWiredSendRight::gMetaClass);
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined ***)this = &PTR__IOSurfaceWiredSendRight_0002ccc8;
  OSMetaClass::instanceConstructed();
  return this;
}



// IOSurfaceWiredSendRight::operator new(unsigned long)

void * __thiscall IOSurfaceWiredSendRight::operator_new(IOSurfaceWiredSendRight *this)

{
  void *pvVar1;
  
  pvVar1 = (void *)_OSObject_typed_operator_new(&IOSurfaceWiredSendRight_ktv,this);
  return pvVar1;
}



// IOSurfaceWiredSendRight::IOSurfaceWiredSendRight()

void __thiscall IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined ***)this = &PTR__IOSurfaceWiredSendRight_0002ccc8;
  OSMetaClass::instanceConstructed();
  return;
}



// IOSurfaceWiredSendRight::IOSurfaceWiredSendRight()

void __thiscall IOSurfaceWiredSendRight::IOSurfaceWiredSendRight(IOSurfaceWiredSendRight *this)

{
  OSObject::OSObject((OSObject *)this,(OSMetaClass *)&gMetaClass);
  *(undefined8 *)(this + 0x18) = 0;
  *(undefined ***)this = &PTR__IOSurfaceWiredSendRight_0002ccc8;
  OSMetaClass::instanceConstructed();
  return;
}



// WARNING: Unknown calling convention: __cdecl -- yet parameter storage is locked
// IOSurfaceWiredSendRight::withSurface(IOSurfaceRoot*, IOSurface*, unsigned long long)

long * __cdecl
IOSurfaceWiredSendRight::withSurface(undefined8 param_1,undefined8 param_2,undefined8 param_3)

{
  char cVar1;
  long *plVar2;
  
  plVar2 = (long *)(**(code **)(gMetaClass + 0x88))(&gMetaClass);
  if (plVar2 != (long *)0x0) {
    cVar1 = (**(code **)(*plVar2 + 0x120))(plVar2,param_1,param_2,param_3);
    if (cVar1 != '\0') {
      return plVar2;
    }
    (**(code **)(*plVar2 + 0x28))(plVar2);
  }
  return (long *)0x0;
}



// IOSurfaceWiredSendRight::init(IOSurfaceRoot*, IOSurface*, unsigned long long)

IOSurfaceWiredSendRight __thiscall
IOSurfaceWiredSendRight::init
          (IOSurfaceWiredSendRight *this,undefined8 param_2,IOSurface *param_3,ulong param_4)

{
  undefined4 uVar1;
  int iVar2;
  long lVar3;
  long *plVar4;
  
  uVar1 = IOSurfaceSendRight::init((IOSurfaceSendRight *)this,param_2,param_3,param_4 | 2);
  if ((char)uVar1 != '\0') {
    lVar3 = IOSurface::getMemoryDescriptor(*(IOSurface **)(this + 0x18));
    if (lVar3 == 0) {
      this[0x21] = (IOSurfaceWiredSendRight)0x1;
    }
    else {
      plVar4 = (long *)IOSurface::getMemoryDescriptor(*(IOSurface **)(this + 0x18));
      iVar2 = (**(code **)(*plVar4 + 0x1f0))(plVar4,0);
      this[0x21] = (IOSurfaceWiredSendRight)(iVar2 == 0);
      if (iVar2 != 0) goto LAB_00021863;
    }
    _OSIncrementAtomic(*(long *)(this + 0x18) + 0x3a8);
  }
LAB_00021863:
  return this[0x21];
}



// IOSurfaceWiredSendRight::free()

void __thiscall IOSurfaceWiredSendRight::free(IOSurfaceWiredSendRight *this)

{
  long lVar1;
  long *plVar2;
  
  if ((*(long *)(this + 0x18) != 0) && (this[0x21] != (IOSurfaceWiredSendRight)0x0)) {
    _OSDecrementAtomic(*(long *)(this + 0x18) + 0x3a8);
    lVar1 = IOSurface::getMemoryDescriptor(*(IOSurface **)(this + 0x18));
    if (lVar1 != 0) {
      plVar2 = (long *)IOSurface::getMemoryDescriptor(*(IOSurface **)(this + 0x18));
      (**(code **)(*plVar2 + 0x1f8))(plVar2,0);
    }
    this[0x21] = (IOSurfaceWiredSendRight)0x0;
  }
  IOSurfaceSendRight::free((IOSurfaceSendRight *)this);
  return;
}



// IOSurfaceSendRight::MetaClass::~MetaClass()

void __thiscall IOSurfaceSendRight::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



// IOSurfaceWiredSendRight::MetaClass::~MetaClass()

void __thiscall IOSurfaceWiredSendRight::MetaClass::~MetaClass(MetaClass *this)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)this);
  return;
}



void __GLOBAL__sub_I_IOSurfaceSendRight_cpp(void)

{
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceSendRight::gMetaClass,"IOSurfaceSendRight",
             (OSMetaClass *)PTR_gMetaClass_00027048,0x28);
  IOSurfaceSendRight::gMetaClass = &PTR__MetaClass_0002cbd0;
  OSMetaClass::OSMetaClass
            ((OSMetaClass *)&IOSurfaceWiredSendRight::gMetaClass,"IOSurfaceWiredSendRight",
             (OSMetaClass *)&IOSurfaceSendRight::gMetaClass,0x28);
  IOSurfaceWiredSendRight::gMetaClass = &PTR__MetaClass_0002ce08;
  return;
}



void __GLOBAL__D_a(void)

{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceWiredSendRight::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&IOSurfaceSendRight::gMetaClass);
  return;
}



undefined8 __start(void)

{
  undefined8 uVar1;
  
  if (__realmain != (code *)0x0) {
                    // WARNING: Could not recover jumptable at 0x00021975. Too many branches
                    // WARNING: Treating indirect jump as call
    uVar1 = (*__realmain)();
    return uVar1;
  }
  return 0;
}



undefined8 __stop(void)

{
  undefined8 uVar1;
  
  if (__antimain != (code *)0x0) {
                    // WARNING: Could not recover jumptable at 0x0002198f. Too many branches
                    // WARNING: Treating indirect jump as call
    uVar1 = (*__antimain)();
    return uVar1;
  }
  return 0;
}



// IOSurfaceSharedEventListener::free() [clone .cold.1]

void IOSurfaceSharedEventListener::free(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceSharedEventListener::free(): notification list is not empty\" @%s:%d",
         "IOSurfaceEvent.cpp",0x59);
}



// IOSurfaceSharedEvent::free() [clone .cold.1]

void IOSurfaceSharedEvent::free(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceSharedEvent::free() called with non-empty notification list\" @%s:%d",
         "IOSurfaceEvent.cpp",0x151);
}



// IOSurfaceSharedEvent::release(int) const [clone .cold.1]

void IOSurfaceSharedEvent::release(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceSharedEvent does not support release with when != 1\" @%s:%d",
         "IOSurfaceEvent.cpp",0x29d);
}



// IOSurfaceSharedEvent::taggedRelease(void const*, int) const [clone .cold.1]

void IOSurfaceSharedEvent::taggedRelease(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceSharedEvent does not support taggedRelease with when != 1\" @%s:%d",
         "IOSurfaceEvent.cpp",0x2ab);
}



// IOFenceTransaction::add_fence(IOFence*) [clone .cold.1]

void IOFenceTransaction::add_fence(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"failed to allocate memory\" @%s:%d","IOSurfaceFenceTransaction.cpp",0x8c);
}



// IOSurface::release(int) const [clone .cold.1]

void IOSurface::release(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurface does not support release with when != 1\" @%s:%d","IOSurface.cpp",0x1e0);
}



// IOSurface::taggedRelease(void const*, int) const [clone .cold.1]

void IOSurface::taggedRelease(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurface does not support taggedRelease with when != 1\" @%s:%d","IOSurface.cpp",0x1ee)
  ;
}



// IOSurfaceRoot::terminateDeviceCachesWithAccelerator(void*) [clone .cold.1]

void IOSurfaceRoot::terminateDeviceCachesWithAccelerator(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceRoot::terminateDeviceCachesWithAccelerator() timeout.\" @%s:%d",
         "IOSurfaceRoot.cpp",0x40a);
}



// IOSurfaceRoot::alloc_surfaceid(unsigned int*) [clone .cold.1]

void IOSurfaceRoot::alloc_surfaceid(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"%s\" @%s:%d",
         "IOSurfaceRoot::alloc_surface_id: Map said entry free but something was there\n",
         "IOSurfaceRoot.cpp",0x64d);
}



// IOSurfaceRoot::client_stopped(IOSurfaceRootUserClient*, task*) [clone .cold.1]

void IOSurfaceRoot::client_stopped(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"user client not found in map\" @%s:%d","IOSurfaceRoot.cpp",0xaa3);
}



// IOSurfaceRoot::client_stopped(IOSurfaceRootUserClient*, task*) [clone .cold.2]

void IOSurfaceRoot::client_stopped(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"unexpected client map mismatch\" @%s:%d","IOSurfaceRoot.cpp",0xaa5);
}



// IOSurfaceRootUserClient::getSurfaceClient(unsigned int, IOSurfaceClient**) const [clone .cold.1]

void IOSurfaceRootUserClient::getSurfaceClient(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"Bad IOSurfaceClient\" @%s:%d","IOSurfaceRootUserClient.cpp",0x438);
}



// IOFence::release(int) const [clone .cold.1]

void IOFence::release(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOFence does not support release with when != 1\" @%s:%d","IOSurfaceFence.cpp",0x3d);
}



// IOFence::taggedRelease(void const*, int) const [clone .cold.1]

void IOFence::taggedRelease(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOFence does not support taggedRelease with when != 1\" @%s:%d","IOSurfaceFence.cpp",
         0x4b);
}



// IOSurfaceMemoryPool::taggedRelease(void const*, int) const [clone .cold.1]

void IOSurfaceMemoryPool::taggedRelease(void)

{
                    // WARNING: Subroutine does not return
  _panic("\"IOSurfaceMemoryPool does not support taggedRelease with when != 1\" @%s:%d",
         "IOSurfaceMemoryPool.cpp",0x20b);
}



void _iosfc_ref_panic_underflow(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"os_refcnt: underflow (rc=%p)\\n\" @%s:%d",param_1,"iosfcrefcnt.c",0x15);
}



void _iosfc_ref_panic_resurrection(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"os_refcnt: attempted resurrection (rc=%p)\\n\" @%s:%d",param_1,"iosfcrefcnt.c",0x1d);
}



void _iosfc_ref_panic_overflow(undefined8 param_1)

{
                    // WARNING: Subroutine does not return
  _panic("\"os_refcnt: overflow (rc=%p)\\n\" @%s:%d",param_1,"iosfcrefcnt.c",0x25);
}


